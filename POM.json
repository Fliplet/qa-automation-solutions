{
  "pages": [
    {
      "id": 1744587,
      "isLayout": false,
      "layout": "{{{widget 30951782}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1731057,
      "layoutOrder": 1,
      "order": 1,
      "sectionId": null,
      "title": "Onboarding",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003ECustomize slide content to explain your app&rsquo;s purpose. Only shown to first-time users.\u003C/p\u003E",
          "preview": "\u003Cp\u003EDisplays onboarding slides once per user. To test, ensure you click the Reset Preview button in the right hand menu.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Intro / Login",
            "Popular",
            "New"
          ],
          "queries": [
            "Onboarding",
            "Slider"
          ],
          "category": "Intro / Login",
          "description": "Customize your app's onboarding screen welcoming users to your app. Drag and drop other Studio components to build out the functionality of your onboarding slider. "
        },
        "customJS": "",
        "customCSS": "body{padding-bottom:0 !important;padding-top:0 !important}.fl-viewport-header{display:none}.fl-with-top-menu{padding-top:0}.fl-bottom-bar-menu-holder{display:none}.fl-menu-circle-header{display:none}.fl-menu-circle-nav-holder .nav-circle{display:none}.swiper-pagination-bullets{margin-bottom:10px}[data-has-notch].no-supports-container body,[data-has-notch].supports-container .fl-page-content-wrapper{padding-bottom:0}.supports-container .fl-page-content-wrapper{padding-bottom:0}.btn.btn-secondary{background:#fff !important}\n",
        "customSCSS": "body {\n  padding-bottom: 0!important;\n  padding-top: 0!important;\n}\n.fl-viewport-header { \n   display: none; \n}\n\n.fl-with-top-menu {\n    padding-top: 0;\n}\n.fl-bottom-bar-menu-holder {\n\tdisplay: none;\n}\n.fl-menu-circle-header \n{display: none; \n}\n.fl-menu-circle-nav-holder .nav-circle {\n  display:none\n}\n.swiper-pagination-bullets{\n  margin-bottom: 10px;\n}\n[data-has-notch].no-supports-container body, [data-has-notch].supports-container .fl-page-content-wrapper{\n  padding-bottom: 0;\n}\n.supports-container .fl-page-content-wrapper{\n  padding-bottom: 0;\n}\n.btn.btn-secondary{\n  background: #ffffff!important;\n}",
        "interactVersion": "3.0",
        "isBlockedScreen": false,
        "widgetInstancesInUse": [30951781, 30951782, 30951783, 30951784, 30951785, 30951786, 30951787, 30951788, 30951789, 30951790, 30951791, 30951792, 30951793, 30951794, 30951795, 30951796, 30951797, 30951798, 30951799, 30951800, 30951801, 30951802]
      },
      "updatedAt": "2025-07-02T16:49:49.999Z",
      "slug": "onboarding-1l7mb"
    },
    {
      "id": 1744573,
      "isLayout": false,
      "layout": "{{{widget 30951729}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 103297,
      "layoutOrder": 2,
      "order": 2,
      "sectionId": null,
      "title": "Registration",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EYou can edit some of the fields here to gather different information from new app users. However, it is not recommended to change the email or password fields.&nbsp;\u003C/p\u003E\n\u003Cp\u003EIf you do not wish to use a registration screen for your app, you can delete this screen, but be sure to remove the link to this screen from the login screen as well.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThe registration screen is designed to allow app users to create an account for your app. If you create an account here and login note that you will be a regular user, not an admin and therefore will not have the ability to edit event details or access the admin menu.\u003C/p\u003E"
        },
        "customJS": "/*Fliplet.Hooks.on('beforeFormSubmit', function(data) {\n  return Fliplet.DataSources.connectByName('Event - Attendees & User List')\n    .then(function(connection) {\n      return connection.find({\n        attributes: ['Email'],\n        where: {\n          Email: data.Email\n        }\n      });\n    })\n    .then(function(records) {\n      if (records.length \u003E 0) {\n        return Promise.reject('Email already exists');\n      }\n    });\n});*/\n\n//Insert 'generate' button to call AI and generate the biography\n/*Fliplet.FormBuilder.get().then(function(form) {\n  $('\u003Cbutton type=\"button\" class=\"btn btn-primary generateBio\"\u003EGenerate Bio\u003C/button\u003E').insertAfter(\n    '[data-field=\"Format Paragraph\"]' //change this to the field name for the field you want the generate button to appear after\n  );\n});*/\n\n/* \nWhen the generate button is clicked\n1. get the data from the form\n2. insert it into a prompt\n3. confirm the AI API settings\n4. display a loading message\n5. call the AI API\n6. insert the result into the bio field\n7. remove the loading message\n*/\n$(document).on('click', '.btn.btn-primary.generateBio', function() {\n  Fliplet.FormBuilder.get().then(async function(form) {\n    var data = {\n      // change each of the fields below before and after the : to any appropriate fields in your form to help generate a bio\n      Title: form.field('Title').get(),\n      'First Name': form.field('First Name').get(),\n      Company: form.field('Company').get(),\n      Location: form.field('Location').get(),\n      Sectors: form.field('Sectors').get(),\n      Expertize: form.field('Expertize').get()\n    };\n    const prompt = `Please generate a 2 paragraph engaging and professional biography written as the first person using the below JSON data. The output must be in HTML format and only include paragraph tags. No other formatting is allowed. ### below\n###\n${JSON.stringify(data)}\n###`;\n    const chat = Fliplet.AI({ temperature: 0.3 });\n    var options = {\n      type: 'regular',\n      backdrop: true,\n      tapToDismiss: false,\n      progress: true,\n      message: 'Getting Bio...'\n    };\n    Fliplet.UI.Toast(options);\n    Fliplet.UI.Toast.setProgress(0.5);\n\n    try {\n      const result = await chat.ask(prompt);\n\n      // Log the full result object for debugging\n      console.log('AI result:', result);\n\n      // Extract the biography content from the AI response object.\n      // The path is result.choices[0].message.content\n      const bioContent = result?.choices?.[0]?.message?.content;\n\n      // Validate that we received a usable string\n      if (typeof bioContent !== 'string' || !bioContent.trim()) {\n        console.error('Unexpected AI response format or empty content:', result);\n        throw new Error('Could not get a valid biography from the AI.');\n      }\n\n      // Set the \"Bio\" field with the extracted content\n      form.field('Bio').set(bioContent);\n      Fliplet.UI.Toast.setProgress(1);\n      Fliplet.UI.Toast.dismiss();\n    } catch (err) {\n      console.error('Error generating bio:', err);\n      Fliplet.UI.Toast.setProgress(1);\n      Fliplet.UI.Toast.dismiss();\n\n      // Display a user-friendly error toast\n      Fliplet.UI.Toast({\n        type: 'error',\n        message: err.message || 'An unexpected error occurred.'\n      });\n    }\n  });\n});\n\n",
        "customCSS": "[data-fl-widget-instance][data-type=\"menu\"]{display:none}.generateBio .fa{padding-right:5px}\n",
        "customSCSS": "[data-fl-widget-instance][data-type=\"menu\"]{\n  display: none;\n}\n.generateBio .fa{\n  padding-right: 5px;\n  //margin-top: 10px;\n}",
        "widgetInstancesInUse": [30951727, 30951728, 30951729, 30951730]
      },
      "updatedAt": "2025-07-02T16:49:43.075Z",
      "slug": "registration-1l7lt"
    },
    {
      "id": 1744583,
      "isLayout": false,
      "layout": "{{{widget 30951766}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 3,
      "order": 3,
      "sectionId": null,
      "title": "Login",
      "settings": {
        "notes": {
          "edit": "\u003Ch4\u003EThis solution \u003Cstrong\u003Erequires a login to work correctly\u003C/strong\u003E.\u003C/h4\u003E\n\u003Cp\u003EIf you don't want to allow users to register to this app, you can delete the link to the Registration screen on this screen.&nbsp;\u003C/p\u003E",
          "preview": "\u003Cp\u003EUse this screen to log in as an admin (using the details you created during the app setup) or as a regular user (using the details provided below) to test the app. This solution&nbsp;\u003Cstrong\u003Erequires a login to function correctly\u003C/strong\u003E. By default (with security enabled in Preview mode), you should be redirected automatically to the Home screen after logging in correctly. You can also manually navigate to the Home screen using the screen list on the left.\u003Cbr /\u003E\u003Cbr /\u003E\u003Cspan style=\"text-decoration: underline;\"\u003ERegular user test login details\u003C/span\u003E \u003Cbr /\u003EEmail: user@email.com \u003Cbr /\u003EPassword: user\u003C/p\u003E"
        },
        "customJS": "/*Fliplet.Session.get('enableSecurity').then(function onSessionKeyRetrieved(value) {\n  if (value == 'true') {\n    return Fliplet.Session.set({ enableSecurity: 'false' }).then(function onSessionUpdated() {\n      Fliplet.Studio.emit('navigate', { name: 'appPreview' });\n      Fliplet.Studio.emit('toggle-app-security', true);\n      setTimeout(function() {\n        Fliplet.Studio.emit('toggle-pages-sidebar', true);\n        Fliplet.Studio.emit('toggle-preview-sidebar', true);\n        Fliplet.Studio.emit('set-device-category', 'web');\n        return Fliplet.Session.get('Email').then(function onSessionKeyRetrieved(email) {\n          if (email) {\n            $(document)\n              .find('[name=\"Email\"]')\n              .val(email);\n            return Fliplet.Session.set({ Email: 'false' });\n          }\n        });\n      }, 3000);\n    });\n  }\n\n  Fliplet.Studio.emit('toggle-app-security', true);\n});*/\n\nFliplet.Studio.emit('toggle-app-security', true);\n\n// Select the form\nvar $form = $('.fl-login-form .form-login');\n\nif ($form.length) {\n  $form.attr('autocomplete', 'off');\n}\n\n// Select the email field\nvar $emailField = $('.fl-login-form .profile_email');\n\nif ($emailField) {\n  $emailField.attr('autocomplete', 'off');\n}\n\n// Select the password field\nvar $passwordField = $('.fl-login-form .profile_password');\nif ($passwordField) {\n  $passwordField.attr('autocomplete', 'new-password');\n  $passwordField.removeAttr('aria-autocomplete');\n}\n",
        "customCSS": "[data-fl-widget-instance][data-type=\"menu\"]{display:none}\n",
        "customSCSS": "[data-fl-widget-instance][data-type=\"menu\"]{\n  display: none;\n}\n",
        "widgetInstancesInUse": [30951765, 30951766, 30951767, 30951768]
      },
      "updatedAt": "2025-07-02T16:49:48.531Z",
      "slug": "login-1l7m7"
    },
    {
      "id": 1744565,
      "isLayout": false,
      "layout": "{{{widget 30951680}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-helper"
      ],
      "appId": 389751,
      "layoutId": 674962,
      "layoutOrder": 4,
      "order": 4,
      "sectionId": null,
      "title": "Home",
      "settings": {
        "private": {
          "tags": [
            "Home screens",
            "No code",
            "Popular"
          ],
          "queries": [
            "Icon menu",
            "grid menu"
          ],
          "category": "Home screens",
          "description": "Add a grid home screen to guide users to app features."
        },
        "customJS": "var pushWidget = Fliplet.Widget.get('PushNotifications');\n\npushWidget.ask().then(function (subscriptionId) {\n// user pressed allow and has been registered\n}).catch(function (err) {\n// contains code and message\n});\n\nFliplet.Hooks.on('flListDataBeforeRenderList', function(/** @type {object} */ options) {\n  // 1. Validation\n  // Ensure that the options parameter is a valid object before proceeding.\n  if (typeof options !== 'object' || options === null) {\n    // A TypeError is thrown as the function cannot proceed without a valid options object.\n    throw new TypeError('The \"options\" argument must be an object.');\n  }\n  console.assert(typeof options === 'object' && options !== null, 'Validation failed: options is not an object.');\n\n  // Ensure that options.records is an array, as we will be performing array operations on it.\n  if (!Array.isArray(options.records)) {\n    // If options.records is not an array, we log an error and exit to prevent further issues.\n    console.error('options.records is not an array for LFD component with UUID:', options.uuid);\n    return;\n  }\n  console.assert(Array.isArray(options.records), 'Validation failed: options.records is not an array.');\n\n  // 2. Logging\n  // Log the initial number of records to provide visibility into the state before modification.\n  console.log(`LFD with UUID ${options.uuid} has ${options.records.length} records before rendering.`);\n\n  // 3. Code\n  // This is the core logic to limit the number of records to 3.\n  if (options.records.length \u003E 5) {\n    // The splice method modifies the array in-place, removing records from the 4th position onwards.\n    options.records.splice(5);\n  }\n\n  // 4. Logging & Final Validation\n  // Log the final state of the records array to confirm the operation was successful.\n  console.log(`LFD with UUID ${options.uuid} now has ${options.records.length} records before rendering.`);\n  console.assert(options.records.length \u003C= 3, 'Assertion failed: The number of records exceeds 3.');\n});\n\nFliplet.Hooks.on('flListDataAfterRenderList', function() {\n  /**\n   * Updates the session date display based on the active date in the agenda selector.\n   * This function is called after the list renders to ensure the DOM is up-to-date.\n   */\n  function updateSessionDate() {\n    // 1. **Validation & Selection**: Find the list item with the 'active' class.\n    var activeDateElement = $('.agenda-date-selector li.active');\n    console.assert(activeDateElement.length \u003E 0, 'Assertion Failed: No active date element found.');\n    if (activeDateElement.length === 0) {\n      console.log('No active date element found.');\n      return;\n    }\n\n    // 2. **Data Extraction**: Get the text for week, day, and month.\n    var week = activeDateElement.find('.week').text();\n    var day = activeDateElement.find('.day').text();\n    var month = activeDateElement.find('.month').text();\n    console.log('Extracted date parts:', { week: week, day: day, month: month });\n\n    // 3. **Formatting**: Combine the parts into a single string.\n    var formattedDate = week + ', ' + month + ' ' + day;\n\n    // 4. **DOM Update**: Find the target paragraph element.\n    var targetElement = $('.session-date-text p');\n    if (targetElement.length === 0) {\n      // The element might be inside a custom component tag, let's try a different selector\n      targetElement = $('fl-text.session-date-text p');\n    }\n    console.assert(targetElement.length \u003E 0, 'Assertion Failed: Target element for session date not found.');\n    if (targetElement.length === 0) {\n      console.error('Target element .session-date-text p not found.');\n      return;\n    }\n\n    // Update the text of the target element.\n    targetElement.text(formattedDate);\n\n    // 5. **Final Validation**: Check if the text was updated.\n    console.assert(targetElement.text() === formattedDate, 'Assertion Failed: Session date text did not update.');\n  }\n\n  // Use a timeout to ensure the DOM is fully painted after the render event.\n  setTimeout(updateSessionDate, 0);\n});\n\n/*Fliplet.User.getCachedSession().then(function(session) {\n  var user = _.get(session, 'entries.dataSource.data');\n\n  if (!user) {\n    return console.log('User is not logged in'); // user is not logged in\n  }\n\n  $(document).on('click', '.my-qr-btn', function() {\n    let AppScreens = Fliplet.Env.get('appPages');\n    let SlugId = _.find(AppScreens, function(obj) {\n      if (obj.title == SCREENS.publicProfile) {\n        return true;\n      }\n    });\n    \n    const isPreview = Fliplet.Env.get('preview');\n    const slug = Fliplet.App.getPublicSlugForPage(SlugId.id);\n    const param = (isPreview ? '&' : '?') + 'email=' + encodeURIComponent(user.Email);\n\n    if (!webAppUrl) {\n      webAppUrl = slug.includes('email=') ? slug : slug + param;\n    } else {\n      webAppUrl = webAppUrl.includes('email=') ? webAppUrl : webAppUrl + param;\n    }\n    \n    return Fliplet.Barcode.show(webAppUrl, {\n      message: 'Use this QR code to check in to the event or share your digital business card with other attendees.'\n    })\n      .then(function(data) {\n      })\n      .catch(function(error) {\n        // encoding failed\n      });\n  });\n});*/\n\n$(document).on('click', '.my-meetings-btn', function() {\n  getUser().then(function(user) {\n    if (!user || !user.Email) {\n      return alert('User email not found.');\n    }\n    var query = '?my-meetings=' + encodeURIComponent(user.Email);\n    Fliplet.Navigate.screen(SCREENS.meetings, { query: query });\n  });\n});\n\n// start-ai-feature 29709478\ndocument.addEventListener('DOMContentLoaded', function() {\n  try {\n    // Using Fliplet.User.getCachedSession() to get user details\n    Fliplet.User.getCachedSession().then(function(session) {\n      try {\n        // Safely retrieve user data from the session object using lodash's get method\n        var user = _.get(session, 'entries.dataSource.data');\n        // Check if user exists and if the Name property exists; if column name contains a space, wrap it with square brackets, but here column is \"First Name\" & \"Lasts Name\"\n        if (user && user['First Name'] && user['Last Name']) {\n          // Chain promises if necessary (here just returning a resolved value)\n          return Promise.resolve(user['First Name'] + ' ' + user['Last Name']);\n        } else {\n          // If Name is not available, return a default value\n          return Promise.resolve('');\n        }\n      } catch (innerError) {\n        // Log any errors encountered during processing of user data\n        console.error('Error processing user data:', innerError);\n        return Promise.resolve('Error retrieving user');\n      }\n    }).then(function(name) {\n      try {\n        // Select the element to display the user's name using the correct selector with .ai-feature-29709478\n        var nameElement = document.querySelector('#userName');\n        // Update the element's text content with the user's name\n        if (nameElement) {\n          nameElement.textContent = name;\n        }\n        return Promise.resolve();\n      } catch (innerError) {\n        // Log any errors encountered while updating the DOM\n        console.error('Error updating the user name on the page:', innerError);\n        return Promise.resolve();\n      }\n    }).catch(function(error) {\n      // Catch and log any errors in the promise chain\n      console.error('Error in promise chain:', error);\n    });\n  } catch (error) {\n    // Log any errors encountered during the initialization\n    console.error('General error:', error);\n  }\n});\n// end-ai-feature 29709478\n\nFliplet.Widget.instance('list-thumb-s', function() {\n  $(this).addClass('iconsLFD');\n  $('.list.list-thumb-s.iconsLFD').css('visibility', 'visible');\n});\n\nFliplet.Helper({\n  name: 'conditionalContainer',\n  displayName: 'Conditional container',\n  icon: 'fa-file-code-o',\n  render: {\n    template: [\n      '\u003Cdiv class=\"placeholder\"\u003E\u003Ci class=\"icon fl-icon-settings\"\u003E\u003C/i\u003E{! placeholder !}\u003C/div\u003E',\n      '\u003Cdiv class=\"conditional\" data-view=\"dt-content\"\u003E\u003C/div\u003E'\n    ].join(''),\n    beforeReady: function() {\n      let element = $(this.$el);\n      Fliplet.Env.get('interact') ? element.addClass('edit') : element.removeClass('edit');\n    },\n    ready: function() {\n      let helper = this;\n      let conditions = this.fields.conditions;\n      let result = false;\n      let environment = Fliplet.Env.get('preview');\n      $(helper.el).addClass('hidden'); //by default button is hidden\n\n      return Fliplet.Session.get().then(function onSessionRetrieved(session) {\n        if (session && session.entries) {\n          if (session.entries.dataSource) {\n            let user = session.entries.dataSource.data;\n            let result;\n\n            if (conditions) {\n              for (let i = 0; i \u003C conditions.length; i++) {\n                if (user.hasOwnProperty(conditions[i]['user_key'])) {\n                  let expression;\n                  let logic = conditions[i]['logic'];\n\n                  if (logic !== 'contains') {\n                    expression = '\"' + user[conditions[i]['user_key']] + '\"';\n                    if (logic === 'equal') {\n                      expression += ' === ' + '\"' + conditions[i]['user_value'] + '\"';\n                    } else if (logic === 'not-equal') {\n                      expression += ' !== ' + '\"' + conditions[i]['user_value'] + '\"';\n                    }\n                    /*else if (logic === 'starts'){\n                      expression += '.indexOf(\"' + conditions[i]['user_value'] + '\") === 0';\n                    } else if (logic === 'ends'){\n                      expression +=  '.endsWith(\"' + conditions[i]['user_value'] + '\")';\n                    }*/\n\n                    setResult(evaluate(conditions[i], expression));\n                  } else {\n                    let keyType = ifArray(user[conditions[i]['user_key']]);\n                    if (!keyType) {\n                      //other type but array or string\n                      expression =\n                        '\"' +\n                        user[conditions[i]['user_key']] +\n                        '\".indexOf(\"' +\n                        conditions[i]['user_value'] +\n                        '\") \u003E -1';\n                      setResult(evaluate(conditions[i], expression));\n                    } else if (keyType === 'string') {\n                      //check if string can be parsed into JSON array\n                      let ifJSON = ifValidJson(user[conditions[i]['user_key']]);\n                      if (!ifJSON || ifJSON === 'string') {\n                        //parsed value is not an array nor a string\n                        expression =\n                          '\"' +\n                          user[conditions[i]['user_key']] +\n                          '\".indexOf(\"' +\n                          conditions[i]['user_value'] +\n                          '\") \u003E -1';\n                        setResult(evaluate(conditions[i], expression));\n                      } else if (ifJSON === 'array') {\n                        let currentArray = JSON.parse(user[conditions[i]['user_key']]);\n                        ifArrayIncludes(currentArray, conditions[i]);\n                      }\n                    } else if (keyType === 'array') {\n                      ifArrayIncludes(user[conditions[i]['user_key']], conditions[i]);\n                    }\n                  }\n\n                  function ifArray(elem) {\n                    //if array\n                    if (Array.isArray(elem)) {\n                      return 'array';\n                    } else if (typeof elem === 'string') {\n                      return 'string';\n                    } else {\n                      return false;\n                    }\n                  }\n\n                  function ifValidJson(elem) {\n                    try {\n                      JSON.parse(elem);\n                      let parsedValue = JSON.parse(elem);\n                      //if array\n                      if (Array.isArray(parsedValue)) {\n                        return 'array';\n                      }\n                      return false;\n                    } catch (error) {\n                      return 'string';\n                    }\n                  }\n\n                  function evaluate(condition, expression) {\n                    try {\n                      eval(expression);\n\n                      //console.log('if eval: ', eval(expression));\n\n                      if (eval(expression)) {\n                        return condition['visibility'];\n                      }\n                    } catch (error) {\n                      console.log(\"Expression can't be evaluated. Error: \" + error);\n                      return false;\n                    }\n                  }\n\n                  function setResult(expr) {\n                    if (expr) {\n                      result = expr === 'hide' ? false : true;\n                    }\n                  }\n\n                  function ifArrayIncludes(array, condition) {\n                    if (array.includes(condition['user_value'])) {\n                      setResult(condition['visibility']);\n                    } else {\n                      _.forEach(array, function(value) {\n                        if (typeof value === 'number') {\n                          //user value to number\n                          if (value === +condition['user_value']) {\n                            setResult(condition['visibility']);\n                          }\n                        }\n                      });\n                    }\n                  }\n                } else {\n                  if (environment) {\n                    Fliplet.UI.Toast(\"User doesn't contain key: \" + conditions[i]['user_key']);\n                  }\n                }\n              }\n            }\n\n            if (result) {\n              $(helper.el).removeClass('hidden');\n            }\n          } else {\n            if (environment) {\n              Fliplet.UI.Toast('User is not logged in!');\n            }\n          }\n        } else {\n          if (environment) {\n            Fliplet.UI.Toast('User is not logged in!');\n          }\n        }\n        return Promise.resolve(true);\n      });\n    }\n  },\n  data: {\n    placeholder: 'Conditional container configurations'\n  },\n  views: [\n    {\n      name: 'dt-content',\n      displayName: 'Drag&drop area',\n      placeholder: '\u003Cdiv class=\"well text-center\"\u003EAdd components here.\u003C/div\u003E'\n    }\n  ],\n  configuration: {\n    fields: [\n      {\n        type: 'html',\n        html:\n          '\u003Cdiv class=\"alert alert-info\"\u003E\u003Cp\u003EPlease note the container will hide the components by default.\u003C/p\u003E\u003Cp\u003EIf multiple conditions are added and a user matches more than one condition, the last condition will overwite the previous conditions.\u003C/p\u003E\u003C/div\u003E'\n      },\n      {\n        name: 'conditions',\n        label: 'Conditions',\n        type: 'list',\n        addLabel: 'Add condition',\n        headingFieldName: 'title',\n        emptyListPlaceholderHtml: '\u003Cp\u003EPlease add at least one condition\u003C/p\u003E',\n        fields: [\n          {\n            type: 'text',\n            name: 'text',\n            required: false,\n            ready: function(el, value) {\n              $(el).hide();\n            }\n          },\n          {\n            type: 'radio',\n            name: 'visibility',\n            label: 'Container visibility if condition is true',\n            options: [{ value: 'hide', label: 'Hide' }, { value: 'show', label: 'Show' }],\n            required: true\n          },\n          {\n            name: 'user_key',\n            type: 'text',\n            label: 'Data field',\n            required: true\n          },\n          {\n            type: 'dropdown',\n            name: 'logic',\n            label: 'Logic',\n            options: [\n              { value: 'equal', label: 'Equals' },\n              { value: 'not-equal', label: \"Doesn't equal\" },\n              { value: 'contains', label: 'Contains' }\n            ],\n            required: true\n          },\n          {\n            name: 'user_value',\n            type: 'text',\n            label: 'Value',\n            required: true\n          }\n        ],\n        ready: function(el, arrayOfFields) {\n          //action on expand/collapse all\n          let collapseButton = $(el).find('.list-field .expand-items');\n          collapseButton.on('click', function() {\n            if (\n              $('.panel-title')\n                .first()\n                .find('.fa.chevron')\n                .hasClass('fa-chevron-right')\n            ) {\n              $.each($('.panel-title'), function() {\n                let index = $(this)\n                  .closest('.panel.panel-default')\n                  .index();\n                updatePanelTitleName($(this), index);\n              });\n            }\n          });\n\n          //update condition title on ready\n          $.each($('.panel-title'), function() {\n            let index = $(this)\n              .closest('.panel.panel-default')\n              .index();\n            updatePanelTitleName($(this), index);\n          });\n\n          //update condition title on collapsing\n          $(document).on('click', '.panel-title', function() {\n            if (\n              $(this)\n                .find('.fa.chevron')\n                .hasClass('fa-chevron-right')\n            ) {\n              let index = $(this)\n                .closest('.panel.panel-default')\n                .index();\n              console.log('index', index);\n              updatePanelTitleName($(this), index);\n            }\n          });\n\n          function updatePanelTitleName(panelTitle, index) {\n            let panelBody = panelTitle.closest('.panel-heading').next('.panel-collapse');\n            let visibility = panelBody\n              .find('[data-field=\"visibility\"] input[type=\"radio\"]:checked')\n              .val();\n            let key = panelBody.find('[data-field=\"user_key\"] input[type=\"text\"]').val();\n            let condition = panelBody\n              .find('[data-field=\"logic\"] select[id*=\"logic\"] :selected')\n              .text();\n            condition = condition == '-- Select an option' ? '' : condition;\n            let value = panelBody.find('[data-field=\"user_value\"] input[type=\"text\"]').val();\n            arrayOfFields = Fliplet.Helper.field('conditions').get();\n\n            if (visibility && key && condition && value) {\n              visibility = visibility.charAt(0).toUpperCase() + visibility.slice(1);\n              condition = condition.charAt(0).toLowerCase() + condition.slice(1);\n              if (condition.indexOf('equal') \u003E -1) {\n                condition += ' to';\n              }\n              let titleName = `${visibility} if \"${key}\" ${condition} \"${value}\"`;\n              arrayOfFields[index][0].value = titleName;\n              panelTitle.find('.panel-title-text').text(titleName);\n            } else {\n              arrayOfFields[index][0].value = 'Incomplete condition';\n              panelTitle.find('.panel-title-text').text('Incomplete condition');\n            }\n          }\n        },\n        change: function(arrayOfFields) {\n          _.forEach(arrayOfFields, function(field) {\n            updatePanelTitleName(field);\n          });\n\n          function updatePanelTitleName(field) {\n            let visibility = field[1].value;\n            let key = field[2].value;\n            let condition = field[3].value || '';\n            let value = field[4].value;\n\n            if (visibility && key && condition && value) {\n              visibility = visibility.charAt(0).toUpperCase() + visibility.slice(1);\n              condition = condition.charAt(0).toLowerCase() + condition.slice(1);\n              if (condition.indexOf('equal') \u003E -1) {\n                condition += ' to';\n              }\n\n              let titleName = `${visibility} if \"${key}\" ${condition} \"${value}\"`;\n              field[0].value = titleName;\n            } else {\n              field[0].value = 'Incomplete condition';\n            }\n          }\n        }\n      }\n    ]\n  }\n});\n\n// This hook runs before the data for the list is fetched.\nFliplet.Hooks.on('flListDataAfterGetData', function(options) {\n  // 1. Validation & Targeting\n  if (!options || !options.config) {\n    return; // Exit if the hook is not running on a configured LFD\n  }\n\n  // Only apply custom click handling to LFDs with the 'agenda' layout\n  if (options.config.layout === 'agenda') {\n    // IMPORTANT: To target a specific LFD, uncomment and use your component's UUID\n    // if (options.uuid !== 'YOUR_AGENDA_COMPONENT_UUID') { return; }\n\n    // 2. Logic: Define the beforeOpen callback to handle clicks\n    options.config.beforeOpen = function(item) {\n      // Ensure the clicked item object and its ID are valid\n      if (!item || !item.entryId) {\n        console.error('LFD beforeOpen error: Invalid item data provided.');\n        // Allow default behavior to proceed if data is invalid\n        return Promise.resolve();\n      }\n\n      console.log('Item clicked with ID:', item.entryId);\n\n      // Navigate to the Agenda screen with the item's ID as a query parameter\n      Fliplet.Navigate.screen(SCREENS.agenda, {\n        query: '?dynamicListOpenId=' + item.entryId\n      });\n\n      // Reject the promise to prevent the default action (opening the detail view)\n      return Promise.reject('Navigation handled by beforeOpen hook.');\n    };\n\n    // 3. Final Validation\n    console.assert(typeof options.config.beforeOpen === 'function', 'Assertion failed: beforeOpen function was not set.');\n  }\n});\n",
        "customCSS": ".limit-entries-text{display:none}.news-feed-item-title::after{display:none !important}.new-news-feed-list-container .news-feed-list-item:not(.open) .slide-over .news-feed-item-inner-content .news-feed-item-description{-webkit-line-clamp:2}.new-agenda-list-container .agenda-date-selector{display:none}.my-qr-btn{display:inline-block;font-size:14px !important;padding:8px 16px !important}.my-qr-btn i{padding-right:5px}.ai-feature-29709478 h1{color:#337ab7;text-align:center;margin-top:20px}.list.list-thumb-s{visibility:hidden}.fl-menu-circle-header{display:none}.fl-menu-circle-nav-holder .nav-circle{display:none}.fl-menu-circle-header{display:none !important}.nav-circle{display:none !important}.iconsLFD\u003E.list-holder{width:100%;display:grid;grid-template-columns:1fr 1fr 1fr 1fr;row-gap:15px;max-width:100% !important;background-color:transparent !important}.iconsLFD\u003E.list-holder .iconsLFD\u003E.list-holder .fl-list-icon{display:flex !important;align-items:center !important;background-color:transparent !important}.iconsLFD\u003E.list-holder li{display:grid;justify-items:center;align-content:center;row-gap:8px;padding:0 !important;border:none !important;height:75px;text-align:center}.iconsLFD\u003E.list-holder li .list-title{white-space:normal;word-wrap:break-word;width:100%}.iconsLFD\u003E.list-holder .linked::after{display:none}.iconsLFD\u003E.list-holder .list-image{position:static !important;height:30px;width:30px}.iconsLFD\u003E.list-holder .list-desc{margin-top:0}.iconsLFD\u003E.list-holder .fl-list-icon{height:30px;display:flex !important;align-items:flex-start !important}fl-helper[name=\"conditional-container\"] .container.conditional{padding:0;margin:0}fl-helper[name=\"conditional-container\"]:not(.edit) .placeholder{display:none}fl-helper[name=\"conditional-container\"].edit{position:relative}fl-helper[name=\"conditional-container\"].edit .placeholder{content:attr(data-placeholder);display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;text-align:center;padding:10px;font-size:16px;color:#8F8F8F;width:100%;border:2px dashed #8F8F8F;background-color:#ddd;line-height:1}fl-helper[name=\"conditional-container\"].edit .placeholder .icon{font-size:24px;margin-right:5px}@media screen and (min-width: 768px){.barcode-message{font-size:14px !important}}\n",
        "customSCSS": ".limit-entries-text{\n  display: none;\n}\n.news-feed-item-title::after{\n  display: none!important;\n}\n\n.new-news-feed-list-container .news-feed-list-item:not(.open) .slide-over .news-feed-item-inner-content .news-feed-item-description{\n  -webkit-line-clamp: 2;\n}\n\n.new-agenda-list-container .agenda-date-selector{\n  display: none;\n}\n\n.my-qr-btn{\n  display: inline-block;\n  font-size: 14px!important;\n  //padding-left: 5px!important;\n  padding: 8px 16px!important;\n  i{\n    padding-right: 5px;\n  }\n}\n\n/* start-ai-feature 29709478 */\n.ai-feature-29709478 h1 {\n  /* Custom styling for the user name header */\n  color: #337ab7;\n  text-align: center;\n  margin-top: 20px;\n}\n/* end-ai-feature 29709478 */\n\n.list.list-thumb-s{\n  visibility: hidden;\n}\n\n.fl-menu-circle-header \n{\n  display: none;\n}\n.fl-menu-circle-nav-holder .nav-circle {\n  display:none\n}\n.fl-menu-circle-header {\n  display: none !important;\n}\n.nav-circle {\n  display: none !important;\n}\n/*\nIcons\n*/\n.iconsLFD \u003E.list-holder {\n  width: 100%;\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr 1fr;\n  row-gap: 15px;\n  max-width: 100% !important;\n  background-color: transparent !important;\n  .iconsLFD\u003E.list-holder .fl-list-icon {\n    display: flex !important;\n    align-items: center !important;\n    background-color: transparent !important;\n  }\n  li {\n    display: grid;\n    justify-items: center;\n    align-content: center;\n    row-gap: 8px;\n    padding: 0 !important;\n    border: none !important;\n    height: 75px;\n    text-align: center;\n    .list-title {\n      white-space: normal;\n      word-wrap: break-word;\n      width: 100%;\n    }\n  }\n  .linked::after {\n    display: none;\n  }\n  .list-image {\n    position: static !important;\n    height: 30px;\n    width: 30px;\n    //position: initial !important;\n    // height: auto !important;\n    /* \n  }\n    $gradientSecondColor: #7c74ee;\n    $gradient2: linear-gradient(0deg, $gradientSecondColor 0%, $primaryButtonColor 100%) !important;\n    .fl-list-icon.fa {\n    color:unset !important;\n    background: $gradient2;\n    -webkit-background-clip: text;\n    -moz-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color:transparent;\n    */ \n  }\n  .list-desc{\n    margin-top: 0;\n  }\n  .fl-list-icon {\n    height: 30px;\n    //font-size: 20px !important;\n    display: flex!important;\n    align-items: flex-start !important;\n  }\n  \n}\n/*\nTABLET & DESKTOP\n*/\n/*@media all and (min-width: 600px) {\n  .iconsLFD \u003E .list-holder {\n    grid-template-columns: 1fr 1fr 1fr 1fr;\n    .fl-list-icon {\n      font-size: 40px !important;\n    }\n  }\n  .small-card-list-item.mix  {\n    height: 140px;\n  }\n  .small-card-list-wrapper \u003E div:first-child  {\n    height: 200px;\n  }\n  .small-card-list-wrapper \u003E div:first-child .small-card-list-text-wrapper  div {\n    font-size: 35px !important;\n  }\n  .small-card-list-wrapper \u003E div .small-card-list-text-wrapper  div {\n    font-size: 20px !important\n  }\n}*/\n//Conditional container helper CSS code\nfl-helper[name=\"conditional-container\"] .container.conditional{\n  padding: 0;\n  margin: 0;\n}\nfl-helper[name=\"conditional-container\"]:not(.edit) .placeholder {\n  display: none;\n}\nfl-helper[name=\"conditional-container\"].edit{\n  position: relative;\n}\nfl-helper[name=\"conditional-container\"].edit .placeholder {\n  content: attr(data-placeholder);\n  display: flex;\n  -webkit-box-pack: center;\n  -ms-flex-pack: center;\n  justify-content: center;\n  -webkit-box-align: center;\n  -ms-flex-align: center;\n  align-items: center;\n  text-align: center;\n  padding: 10px;\n  font-size: 16px;\n  color: #8F8F8F;\n  width: 100%;\n  border: 2px dashed #8F8F8F;\n  background-color: #ddd;\n  line-height: 1;\n}\nfl-helper[name=\"conditional-container\"].edit .placeholder .icon{\n  font-size: 24px;\n  margin-right: 5px;\n}\n@media screen and (min-width: 768px) {\n  .barcode-message{\n    font-size: 14px!important;\n  }\n}\n/*@media (min-width: 1200px){\n  fl-helper[name=\"conditional-container\"] {\n    width: inherit;\n  }\n}*/\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951680, 30951681, 30951682, 30951683, 30951684, 30951685, 30951686, 30951687, 30951688, 30951689, 30951690]
      },
      "updatedAt": "2025-07-02T16:49:50.529Z",
      "slug": "home-1l7ll"
    },
    {
      "id": 1744611,
      "isLayout": false,
      "layout": "{{{widget 30951979}}}\n{{{widget 30951977}}}\n\n\u003C!--\u003Cpre class=\"test\"\u003E\u003C/pre\u003E--\u003E\n\u003Cdiv class=\"loadingIcon\"\u003E\n  \u003Clord-icon class=\"iconClock\" src=\"https://cdn.lordicon.com/unukghxb.json\" trigger=\"loop\" state=\"loop-spin\" colors=\"primary:#000000,secondary:#ffffff\" style=\"width:250px;height:250px\"\u003E\u003C/lord-icon\u003E\n  \u003Cdiv class=\"loadingText\"\u003EPlease wait...\u003C/div\u003E\n\u003C/div\u003E",
      "dependencies": [
        "bootstrap-css",
        "fliplet-helper",
        "bootstrap-datepicker",
        {
          "url": "https://cdn.fliplet.com/apps/185878/dependencies/lordicon-385103febaef54fc86537e61bf35169a.js",
          "name": "lordicon",
          "path": "apps/185878/dependencies/lordicon-385103febaef54fc86537e61bf35169a.js",
          "latest": "https://cdn.lordicon.com/lordicon.js",
          "updatedAt": 1705336210
        }
      ],
      "appId": 389751,
      "layoutId": 553456,
      "layoutOrder": 5,
      "order": 5,
      "sectionId": null,
      "title": "Universal Search",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is powered by AI to allow app users to search for various types of content, including speakers, attendees, exhibitors, event info, and agenda sessions. You cannot edit this screen directly through the standard interface, but it can be modified in the screen's JavaScript.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen uses the related data sources - event info, exhibitors, attendees &amp; user list, and agenda.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis is the AI-powered Universal Search screen. Users can search across various types of event-related content, including speakers, attendees, exhibitors, event information, and agenda sessions.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003EImportant:\u003C/strong\u003E App admins must to click the button on this screen anytime changes are made to the related data. This ensures that the AI search has the latest information to pull from when users perform searches.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Basic screens",
            "No code"
          ],
          "queries": [
            "hide components",
            "show components",
            "user roles"
          ],
          "category": "Basic screens",
          "previews": {
            "web": {
              "id": 5988385,
              "url": "https://fliplet-production.s3.eu-west-1.amazonaws.com/organizations/2647/conditional-container-3-282-621-7559.jpg",
              "name": "conditional container 3.jpg",
              "path": "organizations/2647/conditional-container-3-282-621-7559.jpg",
              "size": [1280, 800],
              "appId": null,
              "userId": 379269,
              "metadata": {
                "av": {
                  "status": "queued"
                },
                "size": 44296,
                "checksum": "5fcb4675c2dc9e7b4c320ad6d2775a4a"
              },
              "versions": {

              },
              "createdAt": "2022-03-21T17:07:13.765Z",
              "deletedAt": null,
              "thumbnail": "https://cdn.api.fliplet.com/v1/media/files/5988385/thumb/preview.jpg",
              "updatedAt": "2022-03-21T17:07:13.765Z",
              "contentType": "image/jpeg",
              "isEncrypted": null,
              "mediaFolderId": null,
              "dataTrackingId": null,
              "organizationId": 2647,
              "dataSourceEntryId": null,
              "masterMediaFileId": null,
              "isOrganizationMedia": false
            },
            "mobile": {
              "id": 7048757,
              "url": "https://cdn.fliplet.com/organizations/2647/Conditional-container-886-358-2520.png",
              "name": "Conditional container.png",
              "path": "organizations/2647/Conditional-container-886-358-2520.png",
              "size": [430, 873],
              "appId": null,
              "userId": 379269,
              "metadata": {
                "av": {
                  "status": "queued"
                },
                "size": 43048,
                "checksum": "a333d4e071080a694242a6c4ab2d7a4c"
              },
              "versions": {

              },
              "createdAt": "2023-09-13T09:11:46.581Z",
              "deletedAt": null,
              "thumbnail": "https://cdn.api.fliplet.com/v1/media/files/7048757/thumb/preview.jpg",
              "updatedAt": "2023-09-13T09:11:46.581Z",
              "contentType": "image/png",
              "isEncrypted": null,
              "mediaFolderId": null,
              "dataTrackingId": null,
              "organizationId": 2647,
              "dataSourceEntryId": null,
              "masterMediaFileId": null,
              "isOrganizationMedia": false
            },
            "tablet": {
              "id": 5988386,
              "url": "https://fliplet-production.s3.eu-west-1.amazonaws.com/organizations/2647/conditonal-container-2-069-782-4680.jpg",
              "name": "conditonal container 2.jpg",
              "path": "organizations/2647/conditonal-container-2-069-782-4680.jpg",
              "size": [768, 1024],
              "appId": null,
              "userId": 379269,
              "metadata": {
                "av": {
                  "status": "queued"
                },
                "size": 34236,
                "checksum": "21be703df3c98708ebbc3342ccb9da12"
              },
              "versions": {

              },
              "createdAt": "2022-03-21T17:07:13.842Z",
              "deletedAt": null,
              "thumbnail": "https://cdn.api.fliplet.com/v1/media/files/5988386/thumb/preview.jpg",
              "updatedAt": "2022-03-21T17:07:13.842Z",
              "contentType": "image/jpeg",
              "isEncrypted": null,
              "mediaFolderId": null,
              "dataTrackingId": null,
              "organizationId": 2647,
              "dataSourceEntryId": null,
              "masterMediaFileId": null,
              "isOrganizationMedia": false
            }
          },
          "description": "Add components inside the conditional container to show/hide them based on logged in user data."
        },
        "customJS": "//add object for referencing columns and ds\n//variable for embeddings\n\n\nconst systemPrompt = `You are an event organiser that answers users questions in an event app. I will provide you with my query and relevant information from the event and you will provide me with highly relevant answers. Only use information that I provide you, do not make assumptions or add additional information. The information could be data from the agenda, exhibitors, attendees, speakers, or general event info.\n Do not explain your overall response, only return JSON data. Order the results by most relevant to least relevant. Return all the results that are relevant from any data source applicable. If there are no highly relevant results then return nothing. Use the ‘Relevance’ field to explain why you think the result is relevant to my query in the format of 'This may be relevant because...'. \n\n\u003Cresult format\u003E\n{\nQuery: [Query],\nResults: [\n{\ndataType: 'Agenda',\nID: [GUID],\nTitle: [Title],\nContent: [Content],\nDate: [Date],\n'Start Time': ['Start Time'],\n'End Time': ['End Time'],\nLocation: ['Location'],\nRelevance: [Relevance]\n},\n{\ndataType: 'Users',\nID: [GUID],\n'Last Name': [Last Name],\n'First Name': [First Name],\nTitle: [Title],\nCompany: [Company],\nSectors: [Sectors],\nLocation: [Location],\nExpertize: [Expertize],\nBio: [Bio],\nType: [Type],\nRelevance: [Relevance]\n},\n{\ndataType: 'Event-info',\nID: [GUID],\nTitle: [Title],\nContent: [Content],\nRelevance: [Relevance]\n},\n{\ndataType: 'Exhibitors',\nID: [GUID],\nName: [Name],\nDescription: [Content],\nLocation: [Location],\nExpertise: [Expertise],\nRelevance: [Relevance]\n});\n}\n]\n}\n\u003C/result format\u003E`;\n\nvar agendaTemplate = `\u003Cdiv class=\"agenda-container\" data-title=\"{{this.Title}}\"\u003E\n\t\t\u003Cdiv class=\"agenda\"\u003E\n\t\t\t\u003Cdiv class=\"agenda-body\"\u003E\n\t\t\t\t\u003Cdiv class=\"dataType\"\u003EAgenda\u003C/div\u003E\n\t\t\t\t \u003Cdiv class=\"small-card-list-detail-body-text line1\"\u003E{{this.Title}}\u003C/div\u003E\n\t\t\t\t\u003Cdiv class=\"small-card-list-detail-body-text line2\"\u003ERelevance: {{this.Relevance}}\u003C/div\u003E\n\t\t\t\u003C/div\u003E\n\t\t\u003C/div\u003E\n  \u003C/div\u003E`;\n\nvar peopleTemplate = `\u003Cdiv class=\"people-container\" data-title=\"{{this.Email}}\"\u003E\n\t\t\u003Cdiv class=\"people\"\u003E\n\t\t\t\u003Cdiv class=\"people-body\"\u003E\n\t\t\t\t\u003Cdiv class=\"dataType\"\u003E{{this.Type}}\u003C/div\u003E\n\t\t\t\t\u003Cdiv class=\"small-card-list-detail-body-text line1\"\u003E\u003Cdiv class=\"nameText\"\u003E{{this.[First Name]}}, {{this.[Last Name]}}\u003C/div\u003E\u003Cdiv class=\"companyText\"\u003E{{this.[Company]}}\u003C/div\u003E\u003C/div\u003E\n\t\t\t\t\u003Cdiv class=\"small-card-list-detail-body-text line2\"\u003ERelevance: {{this.Relevance}}\u003C/div\u003E\n\t\t\t\u003C/div\u003E\n\t\t\u003C/div\u003E\n  \u003C/div\u003E`;\n\nvar eventTemplate = `\u003Cdiv class=\"event-container\" data-title=\"{{this.Title}}\"\u003E\n\t\t\u003Cdiv class=\"event\"\u003E\n\t\t\t\u003Cdiv class=\"event-body\"\u003E\n\t\t\t\t\u003Cdiv class=\"dataType\"\u003EEvent Info\u003C/div\u003E\n\t\t\t\t \u003Cdiv class=\"small-card-list-detail-body-text line1\"\u003E{{this.Title}}\u003C/div\u003E\n\t\t\t\t\u003Cdiv class=\"small-card-list-detail-body-text line2\"\u003ERelevance: {{this.Relevance}}\u003C/div\u003E\n\t\t\t\u003C/div\u003E\n\t\t\u003C/div\u003E\n  \u003C/div\u003E`;\n\nvar exhibitorsTemplate = `\u003Cdiv class=\"exhibit-container\" data-title=\"{{this.Name}}\"\u003E\n\t\t\u003Cdiv class=\"exhibit\"\u003E\n\t\t\t\u003Cdiv class=\"exhibit-body\"\u003E\n\t\t\t\t\u003Cdiv class=\"dataType\"\u003EExhibitor\u003C/div\u003E\n\t\t\t\t \u003Cdiv class=\"small-card-list-detail-body-text line1\"\u003E{{this.Name}}\u003C/div\u003E\n\t\t\t\t\u003Cdiv class=\"small-card-list-detail-body-text line2\"\u003ERelevance: {{this.Relevance}}\u003C/div\u003E\n\t\t\t\u003C/div\u003E\n\t\t\u003C/div\u003E\n  \u003C/div\u003E`;\n\nconst COSINE_SIM_THRESHOLD = 0.73;\n\nasync function generateQuestionEmbedding(question) {\n  const result = await Fliplet.AI.createEmbedding({\n    input: question\n  });\n  return Promise.resolve(result.data[0].embedding);\n}\n\nasync function QueryAI(question, filteredRecords) {\n  const filesString = filteredRecords\n    .map(record =\u003E `${JSON.stringify(record.data.data)}`)\n    .join('\\n');\n\n  let prompt =\n    systemPrompt +\n    `Query: ${question} \u003Crelevant information\u003E ${JSON.stringify(\n      filesString\n    )} \u003Crelevant information\u003E`;\n\n  console.log(prompt);\n\n  let response;\n  try {\n    response = await Fliplet.AI.createCompletion({\n      model: 'gpt-3.5-turbo-1106',\n      messages: [{ role: 'user', content: prompt }],\n      response_format: { type: 'json_object' },\n      temperature: 0.3\n    });\n    //console.log(response.choices[0].message.content);\n    console.log(JSON.parse(response.choices[0].message.content));\n    $('.test').text(JSON.stringify(JSON.parse(response.choices[0].message.content), null, 2));\n    return JSON.parse(response.choices[0].message.content);\n  } catch (error) {\n    Fliplet.UI.Toast.error(error, 'Something went wrong');\n  }\n}\n\nfunction calculateCosineSimilarity(questionEmbedding) {\n  return Fliplet.DataSources.connectByName('Embeddings').then(function(connection) {\n    return connection.find().then(function(records) {\n      var cosineProducts = [];\n      _.forEach(records, function(record) {\n        var AiColumn = 'Embedding';\n\n        const dotProduct = record.data[AiColumn].reduce(\n          (sum, val, i) =\u003E sum + val * questionEmbedding[i],\n          0\n        );\n        delete record.data[AiColumn];\n        //delete record.data['tokens'];\n\n        cosineProducts.push({ data: record.data, score: dotProduct, tokens: record.data.tokens });\n      });\n      cosineProducts = cosineProducts\n        .sort((a, b) =\u003E b.score - a.score)\n        .filter(chunk =\u003E chunk.score \u003E COSINE_SIM_THRESHOLD);\n      //.slice(0, 10);\n      // console.log(cosineProducts);\n      let tokenTotal = 9000;\n      let tokenCount = 0;\n      let finalData = [];\n      cosineProducts.every(function(element, index) {\n        tokenCount = tokenCount + parseInt(element.tokens);\n        if (tokenCount \u003E tokenTotal) {\n          return false;\n        } else {\n          delete element.tokens;\n          finalData.push(element);\n          return true;\n        }\n      });\n      console.log(finalData);\n      return Promise.resolve(finalData);\n    });\n  });\n}\n\n$(document).on('click', '.agenda-container', function() {\n  var queryText = encodeURIComponent($(this).data('title'));\n\treturn Fliplet.Navigate.screen(SCREENS.agenda, {query:'?dynamicListOpenColumn=Title&dynamicListOpenValue=' + queryText});\n});\n\n$(document).on('click', '.people-container', function() {\n  var queryText = encodeURIComponent($(this).data('title'));\n  console.log(queryText);\n\treturn Fliplet.Navigate.screen(SCREENS.speakers, {query:'?dynamicListOpenColumn=Email&dynamicListOpenValue=' + queryText});\n});\n\n$(document).on('click', '.event-container', function() {\n  var queryText = encodeURIComponent($(this).data('title'));\n  console.log(queryText);\n\treturn Fliplet.Navigate.screen(SCREENS.info, {query:'?dynamicListOpenColumn=Title&dynamicListOpenValue=' + queryText});\n});\n\n$(document).on('click', '.exhibit-container', function() {\n  var queryText = encodeURIComponent($(this).data('title'));\n  console.log(queryText);\n\treturn Fliplet.Navigate.screen(SCREENS.exhibitors, {query:'?dynamicListOpenColumn=Name&dynamicListOpenValue=' + queryText});\n});\n\nfunction renderOutput(AiOutput) {\n  $('.results').empty();\n  _.forEach(AiOutput.Results, function(record) {\n    if (record.dataType === 'Users') {\n      //debugger;\n      var peopleCompiledTemplate = Handlebars.compile(peopleTemplate);\n      var peopleHtml = peopleCompiledTemplate(record);\n      //console.log(peopleHtml);\n      $('.results').append(peopleHtml);\n    }\n    if (record.dataType === 'Agenda') {\n      var agendaCompiledTemplate = Handlebars.compile(agendaTemplate);\n      var agendaHtml = agendaCompiledTemplate(record);\n      //console.log(agendaHtml);\n      $('.results').append(agendaHtml);\n    }\n    if (record.dataType === 'Exhibitors') {\n      var exhibitCompiledTemplate = Handlebars.compile(exhibitorsTemplate);\n      var exhibitHtml = exhibitCompiledTemplate(record);\n      //console.log(exhibitHtml);\n      $('.results').append(exhibitHtml);\n    }\n    if (record.dataType === 'Event-info') {\n      var eventCompiledTemplate = Handlebars.compile(eventTemplate);\n      var eventHtml = eventCompiledTemplate(record);\n      //console.log(eventHtml);\n      $('.results').append(eventHtml);\n    }\n  });\n}\n\nFliplet.Hooks.on('beforeFormSubmit', function(response) {\n  $('.results').empty()\n  $('.loadingIcon').css('visibility', 'visible');\n  return generateQuestionEmbedding(response.Question).then(function(embedding) {\n    return calculateCosineSimilarity(embedding).then(function(records) {\n      return QueryAI(response.Question, records).then(function(AiReponse) {\n        renderOutput(AiReponse);\n        $('.loadingIcon').css('visibility', 'hidden');\n        return Promise.reject('');\n      });\n    });\n  });\n});\n\n\n\n//Generate embeddings from data sources\n// A function that splits a text into smaller pieces of roughly equal length\n// The pieces are delimited by sentences and try to avoid breaking words or punctuation\n// This can be useful for processing long texts with natural language models that have a limited input size\nfunction chunkText(text) {\n  let maxCharLength = 250 * 4;\n  // Create an empty array to store the pieces\n  let chunks = [];\n\n  // Create a variable to hold the current piece\n  let currentChunk = '';\n\n  // Remove any newline characters from the text and split it by periods\n  // This assumes that periods mark the end of sentences, which may not be true for some languages\n  const sentences = text.replace(/\\n/g, ' ').split(/([.])/);\n\n  for (const sentence of sentences) {\n    // Remove any extra whitespace from the beginning and end of the sentence\n    const trimmedSentence = sentence.trim();\n\n    // If the sentence is empty, skip it\n    if (!trimmedSentence) continue;\n\n    // Check if adding the sentence to the current piece would make it too long, too short, or just right\n    // This uses a tolerance range of 50% of the maximum length to allow some flexibility\n    // If the piece is too long, save it and start a new one\n    // If the piece is too short, add the sentence and continue\n    // If the piece is just right, save it and start a new one\n    const chunkLength = currentChunk.length + trimmedSentence.length + 1;\n    const lowerBound = maxCharLength - maxCharLength * 0.5;\n    const upperBound = maxCharLength + maxCharLength * 0.5;\n\n    if (chunkLength \u003E= lowerBound && chunkLength \u003C= upperBound && currentChunk) {\n      // The piece is just right, so we save it and start a new one\n      // We remove any periods or spaces from the beginning of the piece and trim any whitespace\n      currentChunk = currentChunk.replace(/^[. ]+/, '').trim();\n      // We only push the piece if it is not empty\n      if (currentChunk) chunks.push(currentChunk);\n      // Reset the current piece\n      currentChunk = '';\n    } else if (chunkLength \u003E upperBound) {\n      // The piece is too long, so save it and start a new one with the sentence\n      // Remove any periods or spaces from the beginning of the piece and trim any whitespace\n      currentChunk = currentChunk.replace(/^[. ]+/, '').trim();\n      // We only push the piece if it is not empty\n      if (currentChunk) chunks.push(currentChunk);\n      // Set the current piece to the sentence\n      currentChunk = trimmedSentence;\n    } else {\n      // The piece is too short, so add the sentence and continue\n      // Add a space before the sentence unless it is a period\n      currentChunk += `${trimmedSentence === '.' ? '' : ' '}${trimmedSentence}`;\n    }\n  }\n\n  // If there is any remaining piece, save it\n  if (currentChunk) {\n    chunks.push(currentChunk);\n  }\n\n  // Return the array of pieces\n  return chunks;\n}\nvar embeddingsData = [];\nasync function getEmbedding(string) {\n  const response = await Fliplet.AI.createEmbedding({\n    input: string\n  });\n  embeddingsData.push({\n    data: {\n      data: string,\n      Embedding: response.data[0].embedding,\n      tokens: response.usage.total_tokens\n    }\n  });\n  return Promise.resolve('success');\n}\n\n$(document).on('click', '.searchUpdateBtn', function() {\n  $('.loadingIcon').css('visibility', 'visible');\n  let finalData = [];\n  Fliplet.DataSources.connectByName('Event - Agenda').then(function(connection) {\n    return connection\n      .find({\n        attributes: ['Session ID', 'Title', 'Date', 'Start Time', 'End Time', 'Location', 'Content']\n      })\n      .then(function(records) {\n        //console.log(records);\n        _.forEach(records, function(record) {\n          var chunks;\n          if (record.data.Content) {\n            chunks = chunkText(record.data.Content);\n            _.forEach(chunks, function(chunk) {\n              finalData.push({\n                dataType: 'Agenda',\n                ID: record.data['Session ID'],\n                Title: record.data.Title,\n                Content: chunk,\n                Date: record.data.Date,\n                'Start Time': record.data['Start Time'],\n                'End Time': record.data['End Time'],\n                Location: record.data.Location\n              });\n            });\n          } else {\n            finalData.push({\n              dataType: 'Agenda',\n              ID: record.data['Session ID'],\n              Title: record.data.Title,\n              Content: record.data.Content,\n              Date: record.data.Date,\n              'Start Time': record.data['Start Time'],\n              'End Time': record.data['End Time'],\n              Location: record.data.Location\n            });\n          }\n        });\n        return Fliplet.DataSources.connectByName('Event - Event Info').then(function(connection) {\n          return connection\n            .find({\n              attributes: ['Title', 'Content', 'GUID']\n            })\n            .then(function(records) {\n              //console.log(records);\n\n              _.forEach(records, function(record) {\n                if (record.data.Content) {\n                  var chunks = chunkText(record.data.Content);\n                  //console.log(chunks);\n                  _.forEach(chunks, function(chunk) {\n                    finalData.push({\n                      dataType: 'Event-info',\n                      ID: record.data['GUID'],\n                      Title: record.data.Title,\n                      Content: chunk\n                    });\n                  });\n                } else {\n                  finalData.push({\n                    dataType: 'Event-info',\n                    ID: record.data['GUID'],\n                    Title: record.data.Title,\n                    Content: record.data.Content\n                  });\n                }\n              });\n              return Fliplet.DataSources.connectByName('Event - Exhibitors').then(function(\n                connection\n              ) {\n                return connection\n                  .find({\n                    attributes: ['Name', 'Location', 'Expertise', 'Description', 'GUID']\n                  })\n                  .then(function(records) {\n                    //console.log(records);\n                    _.forEach(records, function(record) {\n                      if (record.data.Description) {\n                        var chunks = chunkText(record.data.Description);\n                        //console.log(chunks);\n\n                        _.forEach(chunks, function(chunk) {\n                          finalData.push({\n                            dataType: 'Exhibitors',\n                            ID: record.data['GUID'],\n                            Name: record.data.Name,\n                            Description: chunk,\n                            Location: record.data.Location,\n                            Expertise: record.data.Expertise\n                          });\n                        });\n                      } else {\n                        finalData.push({\n                          dataType: 'Exhibitors',\n                          ID: record.data['GUID'],\n                          Name: record.data.Name,\n                          Description: record.data.Description,\n                          Location: record.data.Location,\n                          Expertise: record.data.Expertise\n                        });\n                      }\n                    });\n                    return Fliplet.DataSources.connectByName('Event - Attendees & User List').then(\n                      function(connection) {\n                        return connection\n                          .find({\n                            attributes: [\n                              'GUID',\n                              //'Email',\n                              'Last Name',\n                              'First Name',\n                              'Title',\n                              'Company',\n                              'Sectors',\n                              'Location',\n                              'Expertize',\n                              'Bio',\n                              'Type'\n                            ]\n                          })\n                          .then(function(records) {\n                            //console.log(records);\n\n                            _.forEach(records, function(record) {\n                              if (record.data.Bio) {\n                                var chunks = chunkText(record.data.Bio);\n                                // debugger;\n\n                                _.forEach(chunks, function(chunk) {\n                                  finalData.push({\n                                    dataType: 'Users',\n                                    ID: record.data['GUID'],\n                                   // Email: record.data.Email,\n                                    'Last Name': record.data['Last Name'],\n                                    'First Name': record.data['First Name'],\n                                    Title: record.data['Title'],\n                                    Company: record.data['Company'],\n                                    Sectors: record.data.Sectors,\n                                    Location: record.data.Location,\n                                    Expertize: record.data.Expertize,\n                                    Bio: chunk,\n                                    Type: record.data.Type\n                                  });\n                                });\n                              } else {\n                                finalData.push({\n                                  dataType: 'Users',\n                                  ID: record.data['GUID'],\n                                  //Email: record.data.Email,\n                                  'Last Name': record.data['Last Name'],\n                                  'First Name': record.data['First Name'],\n                                  Title: record.data['Title'],\n                                  Company: record.data['Company'],\n                                  Sectors: record.data.Sectors,\n                                  Location: record.data.Location,\n                                  Expertize: record.data.Expertize,\n                                  Bio: record.data.Bio,\n                                  Type: record.data.Type\n                                });\n                              }\n                            });\n                            var promises = [];\n                            _.forEach(finalData, function(record) {\n                              promises.push(getEmbedding(JSON.stringify(record)));\n                            });\n                            return Promise.all(promises).then(function() {\n                              return Fliplet.DataSources.connectByName('Embeddings').then(function(\n                                connection\n                              ) {\n                                return connection\n                                  .commit({\n                                    entries: embeddingsData\n                                  })\n                                  .then(function(data) {\n                                    console.log(data);\n                                    $('.loadingIcon').css('visibility', 'hidden');\n                                  });\n                              });\n                            });\n                          });\n                      }\n                    );\n                  });\n              });\n            });\n        });\n      });\n  });\n});\n\n\nFliplet.Helper({\n  name: 'conditionalContainer',\n  displayName: 'Conditional container',\n  icon: 'fa-file-code-o',\n  render: {\n    template: [\n      '\u003Cdiv class=\"placeholder\"\u003E\u003Ci class=\"icon fl-icon-settings\"\u003E\u003C/i\u003E{! placeholder !}\u003C/div\u003E',\n      '\u003Cdiv class=\"conditional\" data-view=\"dt-content\"\u003E\u003C/div\u003E'\n    ].join(''),\n    beforeReady: function() {\n      let element = $(this.$el);\n      Fliplet.Env.get('interact') ? element.addClass('edit') : element.removeClass('edit');\n    },\n    ready: function() {\n      let helper = this;\n      let conditions = this.fields.conditions;\n      let result = false;\n      let environment = Fliplet.Env.get('preview');\n      $(helper.el).addClass('hidden'); //by default button is hidden\n\n      if (helper.fields.hasOwnProperty('conditions')) {\n        if (helper.fields.conditions.length) {\n          replaceMultipleSpaces(helper.fields.conditions);\n        }\n      }\n\n      return Fliplet.Session.get().then(function onSessionRetrieved(session) {\n        if (session && session.entries) {\n          if (session.entries.dataSource) {\n            let user = session.entries.dataSource.data;\n            let result;\n\n            if (conditions) {\n              for (let i = 0; i \u003C conditions.length; i++) {\n                if (user.hasOwnProperty(conditions[i]['user_key'])) {\n                  let expression;\n                  let logic = conditions[i]['logic'];\n\n                  if (logic !== 'contains') {\n                    expression = '\"' + user[conditions[i]['user_key']] + '\"';\n                    if (logic === 'equal') {\n                      expression +=\n                        ' === ' + '\"' + decodeHTMLEntities(conditions[i]['user_value']) + '\"';\n                    } else if (logic === 'not-equal') {\n                      expression +=\n                        ' !== ' + '\"' + decodeHTMLEntities(conditions[i]['user_value']) + '\"';\n                    }\n\n                    setResult(evaluate(conditions[i], expression));\n                  } else {\n                    let keyType = ifArray(user[conditions[i]['user_key']]);\n                    if (!keyType) {\n                      //other type but array or string\n                      expression =\n                        '\"' +\n                        user[conditions[i]['user_key']] +\n                        '\".indexOf(\"' +\n                        conditions[i]['user_value'] +\n                        '\") \u003E -1';\n                      setResult(evaluate(conditions[i], expression));\n                    } else if (keyType === 'string') {\n                      //check if string can be parsed into JSON array\n                      let ifJSON = ifValidJson(user[conditions[i]['user_key']]);\n                      if (!ifJSON || ifJSON === 'string') {\n                        //parsed value is not an array nor a string\n                        expression = user[conditions[i]['user_key']]\n                          .split(',')\n                          .map(el =\u003E el.trim())\n                          .includes(decodeHTMLEntities(conditions[i]['user_value']));\n\n\n                        setResult(evaluate(conditions[i], expression));\n                      } else if (ifJSON === 'array') {\n                        let currentArray = JSON.parse(user[conditions[i]['user_key']]);\n                        ifArrayIncludes(currentArray, conditions[i]);\n                      }\n                    } else if (keyType === 'array') {\n                      ifArrayIncludes(user[conditions[i]['user_key']], conditions[i]);\n                    }\n                  }\n\n                  function ifArray(elem) {\n                    //if array\n                    if (Array.isArray(elem)) {\n                      return 'array';\n                    } else if (typeof elem === 'string') {\n                      return 'string';\n                    } else {\n                      return false;\n                    }\n                  }\n\n                  function ifValidJson(elem) {\n                    try {\n                      JSON.parse(elem);\n                      let parsedValue = JSON.parse(elem);\n                      //if array\n                      if (Array.isArray(parsedValue)) {\n                        return 'array';\n                      }\n                      return false;\n                    } catch (error) {\n                      return 'string';\n                    }\n                  }\n\n                  function evaluate(condition, expression) {\n                    try {\n                      // eval(expression);\n                      if (eval(expression)) {\n                        return condition['visibility'];\n                      }\n                    } catch (error) {\n                      console.log(\"Expression can't be evaluated. Error: \" + error);\n                      return false;\n                    }\n                  }\n\n                  function setResult(expr) {\n                    if (expr) {\n                      result = expr === 'hide' ? false : true;\n                    }\n                  }\n\n                  function decodeHTMLEntities(str) {\n                    var temp = document.createElement('div');\n                    temp.style.display = 'none';\n                    temp.innerHTML = str;\n                    return temp.textContent || temp.innerText;\n                  }\n\n                  function ifArrayIncludes(array, condition) {\n                    let arrayIncludesValue = false;\n                    _.forEach(array, function(array_value) {\n                      let decodedStr1 = decodeHTMLEntities(array_value);\n                      let decodedStr2 = decodeHTMLEntities(condition['user_value']);\n\n                      if (decodedStr1 === decodedStr2) {\n                        setResult(condition['visibility']);\n                        arrayIncludesValue = true;\n                      }\n                    });\n\n                    if (!arrayIncludesValue) {\n                      _.forEach(array, function(value) {\n                        if (typeof value === 'number') {\n                          //user value to number\n                          if (value === +condition['user_value']) {\n                            setResult(condition['visibility']);\n                          }\n                        }\n                      });\n                    }\n                  }\n                } else {\n                  if (environment) {\n                    Fliplet.UI.Toast(\"User doesn't contain key: \" + conditions[i]['user_key']);\n                  }\n                }\n              }\n            }\n\n            if (result) {\n              $(helper.el).removeClass('hidden');\n            }\n          } else {\n            if (environment) {\n              //Fliplet.UI.Toast('User is not logged in');\n              console.log('User is not logged in');\n            }\n          }\n        } else {\n          if (environment) {\n            //Fliplet.UI.Toast('User is not logged in');\n            console.log('User is not logged in');\n          }\n        }\n        return Promise.resolve(true);\n      });\n    }\n  },\n  data: {\n    placeholder: 'Conditional container configurations'\n  },\n  views: [\n    {\n      name: 'dt-content',\n      displayName: 'Drag&drop area',\n      placeholder: '\u003Cdiv class=\"well text-center\"\u003EAdd components here.\u003C/div\u003E'\n    }\n  ],\n  configuration: {\n    fields: [\n      {\n        type: 'html',\n        html:\n          '\u003Cdiv class=\"alert alert-info\"\u003E\u003Cp\u003EPlease note the container will hide the components by default.\u003C/p\u003E\u003Cp\u003EIf multiple conditions are added and a user matches more than one condition, the last condition will overwite the previous conditions.\u003C/p\u003E\u003C/div\u003E'\n      },\n      {\n        name: 'conditions',\n        label: 'Conditions',\n        type: 'list',\n        addLabel: 'Add condition',\n        headingFieldName: 'title',\n        emptyListPlaceholderHtml: '\u003Cp\u003EPlease add at least one condition\u003C/p\u003E',\n        fields: [\n          {\n            type: 'text',\n            name: 'text',\n            required: false,\n            ready: function(el, value) {\n              $(el).hide();\n            }\n          },\n          {\n            type: 'radio',\n            name: 'visibility',\n            label: 'Container visibility if condition is true',\n            options: [{ value: 'hide', label: 'Hide' }, { value: 'show', label: 'Show' }],\n            required: true\n          },\n          {\n            name: 'user_key',\n            type: 'text',\n            label: 'Data field',\n            required: true\n          },\n          {\n            type: 'dropdown',\n            name: 'logic',\n            label: 'Logic',\n            options: [\n              { value: 'equal', label: 'Equals' },\n              { value: 'not-equal', label: \"Doesn't equal\" },\n              { value: 'contains', label: 'Contains' }\n            ],\n            required: true\n          },\n          {\n            name: 'user_value',\n            type: 'text',\n            label: 'Value',\n            required: true\n          }\n        ],\n        ready: function(el, arrayOfFields) {\n          //action on expand/collapse all\n          let collapseButton = $(el).find('.list-field .expand-items');\n          collapseButton.on('click', function() {\n            if (\n              $('.panel-title')\n                .first()\n                .find('.fa.chevron')\n                .hasClass('fa-chevron-right')\n            ) {\n              $.each($('.panel-title'), function() {\n                let index = $(this)\n                  .closest('.panel.panel-default')\n                  .index();\n                updatePanelTitleName($(this), index);\n              });\n            }\n          });\n\n          //update condition title on ready\n          $.each($('.panel-title'), function() {\n            let index = $(this)\n              .closest('.panel.panel-default')\n              .index();\n            updatePanelTitleName($(this), index);\n          });\n\n          //update condition title on collapsing\n          $(document).on('click', '.panel-title', function() {\n            if (\n              $(this)\n                .find('.fa.chevron')\n                .hasClass('fa-chevron-right')\n            ) {\n              let index = $(this)\n                .closest('.panel.panel-default')\n                .index();\n              console.log('index', index);\n              updatePanelTitleName($(this), index);\n            }\n          });\n\n          function updatePanelTitleName(panelTitle, index) {\n            let panelBody = panelTitle.closest('.panel-heading').next('.panel-collapse');\n            let visibility = panelBody\n              .find('[data-field=\"visibility\"] input[type=\"radio\"]:checked')\n              .val();\n            let key = panelBody.find('[data-field=\"user_key\"] input[type=\"text\"]').val();\n            let condition = panelBody\n              .find('[data-field=\"logic\"] select[id*=\"logic\"] :selected')\n              .text();\n            condition = condition == '-- Select an option' ? '' : condition;\n            let value = panelBody.find('[data-field=\"user_value\"] input[type=\"text\"]').val();\n            arrayOfFields = Fliplet.Helper.field('conditions').get();\n\n            if (visibility && key && condition && value) {\n              visibility = visibility.charAt(0).toUpperCase() + visibility.slice(1);\n              condition = condition.charAt(0).toLowerCase() + condition.slice(1);\n              if (condition.indexOf('equal') \u003E -1) {\n                condition += ' to';\n              }\n              let titleName = `${visibility} if \"${key}\" ${condition} \"${value}\"`;\n              arrayOfFields[index][0].value = titleName;\n              panelTitle.find('.panel-title-text').text(titleName);\n            } else {\n              arrayOfFields[index][0].value = 'Incomplete condition';\n              panelTitle.find('.panel-title-text').text('Incomplete condition');\n            }\n          }\n        },\n        change: function(arrayOfFields) {\n          _.forEach(arrayOfFields, function(field) {\n            updatePanelTitleName(field);\n          });\n\n          function updatePanelTitleName(field) {\n            let visibility = field[1].value;\n            let key = field[2].value;\n            let condition = field[3].value || '';\n            let value = field[4].value;\n\n            if (visibility && key && condition && value) {\n              visibility = visibility.charAt(0).toUpperCase() + visibility.slice(1);\n              condition = condition.charAt(0).toLowerCase() + condition.slice(1);\n              if (condition.indexOf('equal') \u003E -1) {\n                condition += ' to';\n              }\n\n              let titleName = `${visibility} if \"${key}\" ${condition} \"${value}\"`;\n              field[0].value = titleName;\n            } else {\n              field[0].value = 'Incomplete condition';\n            }\n          }\n        }\n      }\n    ],\n    beforeSave: function(data, configuration) {\n      if (data.hasOwnProperty('conditions')) {\n        if (data.conditions.length) {\n          _.forEach(data.conditions, function(listItem) {\n            let titleName = '';\n            if (listItem.user_key) {\n              listItem.user_key = listItem.user_key.replace(/\\s\\s+/g, ' ');\n              titleName = listItem.user_key;\n            } else {\n              titleName = 'Select a column';\n            }\n          });\n        }\n      }\n    }\n  }\n});\n\nfunction replaceMultipleSpaces(arrayOfFields) {\n  _.forEach(arrayOfFields, function(listItem) {\n    let titleName = '';\n    if (listItem.user_key) {\n      listItem.user_key = listItem.user_key.replace(/\\s\\s+/g, ' ');\n      titleName = listItem.user_key;\n    } else {\n      titleName = 'Select a column';\n    }\n  });\n}\n\n",
        "customCSS": ".line2{margin-top:5px;font-style:italic;font-size:14px}.companyText,.locText{font-size:14px;right:0;position:relative}.nameText,.line1{font-family:helvetica;color:#345091;font-size:18px;font-weight:bold}.agenda,.people,.event,.exhibit{width:100%;height:auto;margin:0 0 15px 0;display:flex;align-items:flex-start;padding:15px;border:1px solid #cccccc;border-radius:15px;box-shadow:3px 3px 3px 0px #e5e5e5;cursor:pointer;transition:box-shadow 0.15s ease-out}.agenda-body,.people-body,.event-body,.exhibit-body{height:100%;display:inline-block;vertical-align:top;color:#333;width:100%}.dataType{width:fit-content;margin-bottom:10px;font-size:12px;color:#ffffff;border-radius:10px;padding:5px 10px}.agenda-body .dataType{background-color:#173A7B}.people-body .dataType{background-color:#488466}.event-body .dataType{background-color:#715D98}.exhibit-body .dataType{background-color:#C55D30}.spinner-holder.animated{display:none}.loadingIcon{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.2);display:flex;justify-content:center;align-items:center;flex-direction:column;visibility:hidden}.loadingText{margin-top:20px;color:black;font-size:20px;text-align:center}fl-helper[name=\"conditional-container\"] .container.conditional{padding:0;margin:0}fl-helper[name=\"conditional-container\"]:not(.edit) .placeholder{display:none}fl-helper[name=\"conditional-container\"].edit{position:relative}fl-helper[name=\"conditional-container\"].edit .placeholder{content:attr(data-placeholder);display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;text-align:center;padding:10px;font-size:16px;color:#8F8F8F;width:100%;border:2px dashed #8F8F8F;background-color:#ddd;line-height:1}fl-helper[name=\"conditional-container\"].edit .placeholder .icon{font-size:24px;margin-right:5px}@media (min-width: 1200px){fl-helper[name=\"conditional-container\"]{width:inherit}}[data-widget-package=\"com.fliplet.text\"].instructions{display:none !important;color:#3c763d !important;background-color:#dff0d8 !important;padding:15px !important;border-color:#d6e9c6;border:1px solid transparent;border-radius:4px}[data-widget-package=\"com.fliplet.text\"].instructions p,[data-widget-package=\"com.fliplet.text\"].instructions li{color:black !important}[data-widget-package=\"com.fliplet.text\"].danger{background-color:#f2dede !important}.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions{display:block !important}\n",
        "customSCSS": ".line2{\n  margin-top: 5px;\n  font-style: italic;\n  font-size: 14px;\n}\n.companyText, .locText{\n  font-size: 14px;\n  right: 0;\n  position: relative;\n}\n.nameText, .line1{\n  font-family: $headingFourFontFamily;\n  color: $headingFourColor;\n  font-size: $headingFourSize;\n  font-weight: bold;\n}\n.agenda, .people, .event, .exhibit {\n  width: 100%;\n  height: auto;\n  margin: 0 0 15px 0;\n  display: flex;\n  align-items: flex-start;\n  padding: 15px;\n  border: 1px solid #cccccc;\n  border-radius: 15px;\n  box-shadow: 3px 3px 3px 0px #e5e5e5;\n  cursor: pointer;\n  transition: box-shadow 0.15s ease-out;\n}\n.agenda-body, .people-body, .event-body, .exhibit-body{\n  height: 100%;\n  display: inline-block;\n  vertical-align: top;\n  color: $bodyTextColor;\n  width: 100%;\n}\n.dataType{\n  width: fit-content;\n  margin-bottom: 10px;\n  font-size: 12px;\n  color: #ffffff;\n  border-radius: 10px;\n  padding: 5px 10px;\n}\n.agenda-body .dataType{\n  background-color: #173A7B;\n}\n.people-body .dataType{\n  background-color: #488466;\n}\n.event-body .dataType{\n  background-color: #715D98;\n}\n.exhibit-body .dataType{\n  background-color: #C55D30;\n}\n\n//Loading icon css below\n.spinner-holder.animated{\n  display: none;\n}\n.loadingIcon{\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  visibility: hidden;\n}\n.iconClock{\n // z-index: 1000;\n // display: flex;\n}\n.loadingText {\n  margin-top: 20px;\n  /* Spacing between the icon and the text */\n  color: black;\n  /* Color of the text */\n  font-size: 20px;\n  /* Size of the text */\n  text-align: center;\n  /* Center align the text */\n}\nfl-helper[name=\"conditional-container\"] .container.conditional{\n  padding: 0;\n  margin: 0;\n}\nfl-helper[name=\"conditional-container\"]:not(.edit) .placeholder {\n  display: none;\n}\nfl-helper[name=\"conditional-container\"].edit{\n  position: relative;\n}\nfl-helper[name=\"conditional-container\"].edit .placeholder {\n  content: attr(data-placeholder);\n  display: flex;\n  -webkit-box-pack: center;\n  -ms-flex-pack: center;\n  justify-content: center;\n  -webkit-box-align: center;\n  -ms-flex-align: center;\n  align-items: center;\n  text-align: center;\n  padding: 10px;\n  font-size: 16px;\n  color: #8F8F8F;\n  width: 100%;\n  border: 2px dashed #8F8F8F;\n  background-color: #ddd;\n  line-height: 1;\n}\nfl-helper[name=\"conditional-container\"].edit .placeholder .icon{\n  font-size: 24px;\n  margin-right: 5px;\n}\n@media (min-width: 1200px){\n  fl-helper[name=\"conditional-container\"] {\n    width: inherit;\n  }\n}\n/* hide instructions, only show when in edit mode */\n[data-widget-package=\"com.fliplet.text\"].instructions {\n  display:none !important;\n  color: #3c763d !important;\n  background-color: #dff0d8 !important;\n  padding: 15px !important;\n  border-color: #d6e9c6;\n  border: 1px solid transparent;\n  border-radius: 4px;\n}\n[data-widget-package=\"com.fliplet.text\"].instructions p, [data-widget-package=\"com.fliplet.text\"].instructions li {\n  color:black !important;\n}\n[data-widget-package=\"com.fliplet.text\"].danger {\n  background-color: #f2dede !important;\n}\n.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions {\n  display:block !important;\n}\n/* End */",
        "interactVersion": "3.0",
        "isBlockedScreen": false,
        "widgetInstancesInUse": [30951975, 30951976, 30951977, 30951978, 30951979, 30951980, 30951981]
      },
      "updatedAt": "2025-07-02T16:49:45.836Z",
      "slug": "universal-search-1l7n3"
    },
    {
      "id": 1744610,
      "isLayout": false,
      "layout": "{{{widget 30951974}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1718111,
      "layoutOrder": 6,
      "order": 6,
      "sectionId": null,
      "title": "Agenda",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays the agenda sessions for the event. The layout can be edited using the standard List from Data Source options. However, some elements, like the links to Poll, Questions, Session Survey, Floorplan, Materials, and related Speaker profiles, are set with custom code. These links will only appear if the relevant data is provided for each session.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is connected to the agenda data source, which determines the sessions displayed to users.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen shows the event's agenda sessions, along with links to related features like Poll, Questions, Session Survey, Floorplan, Materials, and Speaker profiles.\u003C/p\u003E\n\u003Cp\u003EApp admins can update session information and ensure that relevant data for these features is added by clicking the \"Admin\" menu at the bottom of the app, then selecting \"Manage Agenda\" to make changes.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E Some sessions, marked as optional, will only be visible to the users they are assigned to.\u003C/p\u003E"
        },
        "customJS": "const unlimitedCapacityText = 'Unlimited'; //'&infin;'; // HTML entity for infinity\nconst fullCapacityText = 'Capacity: Full';\nconst fullCapacityColor = 'red';\nconst capacityTextColor = 'green';\nconst capacityText = 'Capacity: ';\nlet attendingLogsConnection, loggedInUser, selectedAgenda, sessionAttendanceConnection, timeConversionIsRequired, userTimezone;\nconst attendeesToShow = 6;\nlet currentSessionAttendees = []; // Add global variable to store current session attendees\nlet agendaRecords = [];\n\nconsole.log(Fliplet.Navigate.query);\n\n// Add check-in status constants\nconst CHECK_IN_STATUS = {\n  NOT_CHECKED_IN: 'not_checked_in',\n  CHECKED_IN: 'checked_in',\n  CHECKED_OUT: 'checked_out',\n  SESSION_ENDED: 'session_ended',\n  VISITED: 'visited'\n};\n\nconst confirmCancelRSVP = {\n  title: 'Confirm RSVP Cancellation',\n  message: 'Are you sure you want to cancel your reservation for this session? If you cancel, you may not be able to re-reserve your spot if it fills up again.',\n  labels: ['Cancel RSVP', 'Go Back']\n};\n\n// add a speakers to the agenda\nFliplet.Hooks.on('flListDataBeforeGetData', function(data) {\n  return getUser().then(user =\u003E {\n    loggedInUser = user;\n\n    data.config.useApiFilters = true;\n\n    data.config.beforeOpen = function(opt) {\n      if (opt.event && $(opt.event.target).closest('.rsvp-attend').length) {\n        return Promise.reject('RSVP button click handled separately, preventing detail open.');\n      }\n      if (opt.entry && opt.entry.data && opt.entry.data['Status']) {\n        Fliplet.Navigate.screen('My meetings', { query: `?dynamicListOpenId=${opt.entry.id}`});\n        return Promise.reject('Navigating to My Meetings due to status.');\n      }\n\n      if ($(opt.event.target).closest('.check-in-btn:not(.disabled)').length){\n        //prevent opening the detail view when the check-in button is clicked\n        return Promise.reject('');\n      } else if ($(opt.event.target).closest('.check-out-btn:not(.disabled)').length){      \n        //prevent opening the detail view when the check-out button is clicked\n        return Promise.reject('');\n      }\n    };\n    \n    data.config.beforeShowDetails = function(options) {\n      // Set a default for showLeaveButton\n      _.set(options.data, 'originalData.showLeaveButton', false);\n\n      var speakerEmails = _.map(_.split(_.get(options, 'data.originalData.Speakers'), ','), function(item) { return item.trim(); });\n\n      // Filter out empty strings which can occur if the 'Speakers' field is empty.\n      speakerEmails = _.filter(speakerEmails, function(email) {\n        return email && email.length;\n      });\n\n      // If there are no valid speaker emails, set an empty array and resolve.\n      if (!speakerEmails.length) {\n        _.set(options.data, 'originalData.SpeakerProfiles', []);\n        return Promise.resolve();\n      }\n      \n      // Promise chain for speakers and RSVP check\n      const speakerPromise = Fliplet.DataSources.connectByName(DS.users)\n        .then(function(connection) { return connection.find({ where: { $or: _.map(speakerEmails, function(email) { return { Email: { $iLike: email } }; }) } }); })\n        .then(function(speakerRecords) {\n          speakerRecords.sort(function(a, b){ return speakerEmails.indexOf(a.data.Email) - speakerEmails.indexOf(b.data.Email); });\n          _.set(options.data, 'originalData.SpeakerProfiles', _.map(speakerRecords, function(record) {\n            if (!_.isArray(record.data.Image)) { record.data.Image = [record.data.Image]; }\n            if (record.data.Image[0] === undefined || !record.data.Image.length) { record.data.Image[0] = 'https://us.api.fliplet.com/v1/media/files/102358/contents/placeholder_image.png'; }\n            return record.data;\n          }));\n        })\n        .catch(function(error) { console.error('Error loading speaker details:', error); });\n      \n      return Promise.all([speakerPromise]).then(() =\u003E {\n        return Promise.resolve(); // Resolve after all operations\n      }).catch(error =\u003E {\n        console.error('Error in beforeShowDetails processing:', error);\n        return Promise.resolve(); // Still resolve to show details, but log error\n      });\n    };\n    \n    data.config.afterShowDetails = function(options) {\n      selectedAgenda = options;\n      if (!loggedInUser) { return; }\n\n      // --- Start of Attendee Profile Pills Injection Logic ---\n      const $detailBodyText = $('.agenda-detail-overlay .agenda-item-detail-body-text');\n      $('.attendee-profile-pills-container').remove(); // Remove any existing pills container\n      \n      const record = options.data.originalData;\n      const showAttendees = record.showRSVP &&\n        record[VARIABLES.showAttendees] === VARIABLES.showAttendeesOptions.allUsersVisibility;\n      \n      // Only fetch attendees if we need to show the attendee list\n      if (showAttendees) {\n        getAttendingLogsConnection().then(conn =\u003E {\n          return conn.find({ \n            where: { \n              'Session ID': selectedAgenda.data.originalData['Session ID'], \n              'RSVP Status': 'Going' \n            }}).then(allAttendees =\u003E {\n            // Store attendees globally for other functions to use\n            currentSessionAttendees = allAttendees;\n            \n            // Update capacity message\n            const capacityMessage = getCapacityMessage(record, allAttendees.length);\n            \n            // Render attendee list if there are attendees\n            if (allAttendees.length) {\n              renderAttendeeList(allAttendees, loggedInUser);\n            }\n          });\n        });\n      }\n    };\n\n    data.config.getData = function() {\n      return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n        return connection.find({\n          join: { meetings: { dataSourceName: DS.meetingsLogs, where: { 'Status': { $in: ['Accepted', 'Pending']}, $or: [ { 'Booked by': loggedInUser.Email }, { 'Booked with': loggedInUser.Email } ] } } }\n        });\n      });\n    };\n  });\n});\n\n// Update the flListDataAfterGetData hook to update check-in status\nFliplet.Hooks.on('flListDataAfterGetData', function(data) {\n  agendaRecords = data.records;\n\n  if (!data || !data.records) {\n    return Promise.resolve(data);\n  }\n\n  // Get all sessions with RSVP enabled\n  const sessionsWithRSVP = data.records.filter(record =\u003E {\n    // Only include sessions (have Title and no Status)\n    if (!record.data.Title || record.data.Status) return false;\n    record.data.showRSVP = isRSVPEnabled(record);\n    return record.data.showRSVP;\n  });\n  \n  const sessionsWithCheckIn = data.records.filter(record =\u003E {\n    if (!record.data.Title || record.data.Status) return false;\n    record.data.showCheckIn = isCheckInEnabled(record);\n    return record.data.showCheckIn;\n  });\n  \n  // 2. Combine session IDs\n  const sessionIds = [\n    ...new Set([\n      ...sessionsWithRSVP.map(r =\u003E r.data['Session ID']),\n      ...sessionsWithCheckIn.map(r =\u003E r.data['Session ID'])\n    ])\n  ].filter(Boolean);\n\n  // 3. If there are any relevant sessions, fetch attendance records\n  if (sessionIds.length) {\n    return getAttendingLogsConnection().then(conn =\u003E {\n      return conn.find({\n        where: {\n          'Session ID': { $in: sessionIds },\n          //'Email': loggedInUser.Email,\n          //'RSVP Status': 'Going'\n        }\n      }).then(attendanceRecords =\u003E {\n        // Create a map of session IDs to attendance records for quick lookup\n        const attendanceRSVPMap = {};\n        const attendanceCheckInMap = {};\n        \n        const goingRecords = attendanceRecords.filter(r =\u003E r.data['RSVP Status'] === 'Going');\n        const attendanceRecordsGroupedBySessionID = _.groupBy(goingRecords, 'data[Session ID]');\n        const userRSVPAttendanceRecords = goingRecords.filter(r =\u003E r.data.Email === loggedInUser.Email);\n        const userAttendanceRecordsGroupedBySessionID = _.groupBy(userRSVPAttendanceRecords, 'data[Session ID]');\n        const userCheckInAttendanceRecords = attendanceRecords.filter(r =\u003E r.data.Email === loggedInUser.Email);\n\n        userRSVPAttendanceRecords.forEach(record =\u003E {\n          attendanceRSVPMap[record.data['Session ID']] = record;\n        });\n        \n        userCheckInAttendanceRecords.forEach(record =\u003E {\n          attendanceCheckInMap[record.data['Session ID']] = record;\n        });\n        \n        // Process all records in a single loop\n        data.records.forEach(record =\u003E {\n          // Process RSVP status and store attendance record reference\n          if (record.data.showRSVP) {\n            const attendanceRecord = attendanceRSVPMap[record.data['Session ID']];\n            record.data.userRSVPed = !!attendanceRecord;\n            // Store the attendance record reference\n            record.data.attendanceRecord = attendanceRecord;\n            const allAttendanceRecords = attendanceRecordsGroupedBySessionID[record.data['Session ID']];\n            record.data.allAttendanceRecords = allAttendanceRecords;\n          } else {\n            record.data.userRSVPed = false;\n          }\n\n          // Process check-in status\n          if (record.data.showCheckIn) {\n            const attendanceRecord = attendanceCheckInMap[record.data['Session ID']];\n            if (attendanceRecord) {\n              if (!record.data.attendanceRecord){\n                // Store the attendance record reference\n                record.data.attendanceRecord = attendanceRecord;\n              }\n              if (attendanceRecord.data['Check in time'] && attendanceRecord.data['Check out time']) {\n                record.data.checkInStatus = CHECK_IN_STATUS.VISITED;\n              } else if (attendanceRecord.data['Check in time']) {\n                record.data.checkInStatus = CHECK_IN_STATUS.CHECKED_IN;\n              } else {\n                record.data.checkInStatus = CHECK_IN_STATUS.NOT_CHECKED_IN;\n              }\n            } else {\n              record.data.checkInStatus = CHECK_IN_STATUS.NOT_CHECKED_IN;\n            }\n          }\n        });\n\n        // Continue with the rest of your processing\n        return processData(data);\n      });\n    });\n  }\n\n  // 6. If no relevant sessions, continue as normal\n  return processData(data);\n});\n\nFliplet.Hooks.on('flListDataAfterRenderList', function(options) {\n  //console.log('[AFTER RENDER LIST] Hook fired. Processing', options.records.length, 'records.');\n  options.records.forEach(function(record, index) {\n    if (!record || !record.data) {\n      //console.log(`[AFTER RENDER LIST] Record ${index} is invalid or has no data. Skipping.`);\n      return;\n    }\n\n    // Log the state of every record BEFORE applying classes\n    //console.log(`[AFTER RENDER LIST] Record ${index} data:`, record.data);\n\n    const entryId = record.id;\n    const $agendaItem = $(`.agenda-list-item[data-entry-id=\"${entryId}\"]`);\n\n    if ($agendaItem.length \u003E 0 && record.data.customClass) {\n      $agendaItem.removeClass('attending show_rsvp').addClass(record.data.customClass);\n    //  console.log(`[AFTER RENDER LIST] Applied class \"${record.data.customClass}\" to element for record ID ${entryId}.`);\n    }\n  });\n});\n\n/**\n * @typedef {object} Filter\n * @property {string} column - The column name to filter on.\n * @property {string} title - The display title of the filter.\n * @property {string} type - The type of filter control (e.g., 'toggle').\n * @property {Array\u003Cstring\u003E} values - The possible values for the filter.\n */\n\n/**\n * @typedef {object} FlListDataBeforeRenderFiltersOptions\n * @property {object} config - Component configuration.\n * @property {Array\u003CFilter\u003E} filters - Array of filters to be rendered.\n * @property {Array\u003Cobject\u003E} records - Collection of records.\n */\n\n/**\n * The 'flListDataBeforeRenderFilters' hook is used to manipulate the filter configuration\n * before the UI is rendered. Here, we split the 'Location' filter into two separate\n * filter groups: one for general locations and one specifically for meetings.\n * Both groups will initially be rendered with the name 'Location' to ensure they\n * correctly filter on the 'Location' data column.\n */\nFliplet.Hooks.on('flListDataBeforeRenderFilters', function(options) {\n  if (!options || !Array.isArray(options.filters)) {\n    return;\n  }\n\n  var locationFilterIndex = _.findIndex(options.filters, { name: 'Location' });\n\n  if (locationFilterIndex === -1) {\n    return;\n  }\n  \n  var locationFilter = options.filters[locationFilterIndex];\n\n  if (!locationFilter.data || !Array.isArray(locationFilter.data)) {\n    return;\n  }\n\n  var meetingStatusNames = ['Accepted Meeting', 'Pending Meeting'];\n  var meetingValues = [];\n  var otherLocationValues = [];\n\n  locationFilter.data.forEach(function(item) {\n    if (item && typeof item.name === 'string' && meetingStatusNames.includes(item.name)) {\n      meetingValues.push(item);\n    } else {\n      otherLocationValues.push(item);\n    }\n  });\n\n  // Only proceed if the split is meaningful (i.e., both groups will have values)\n  if (meetingValues.length \u003E 0 && otherLocationValues.length \u003E 0) {\n    // 1. Update the original 'Location' filter to only contain non-meeting values\n    locationFilter.data = otherLocationValues;\n\n    // 2. Create a new filter for meetings. Crucially, it's also named 'Location'\n    // so that the generated HTML has the correct 'data-field=\"Location\"' attribute.\n    var meetingsFilter = _.cloneDeep(locationFilter);\n    meetingsFilter.name = 'Location';\n    meetingsFilter.data = meetingValues;\n    delete meetingsFilter.id;\n\n    options.filters.push(meetingsFilter);\n  }\n});\n\nfunction renameMeetingsFilterLabel() {\n  $('fieldset[data-field=\"Location\"]').each(function() {\n    var $fieldset = $(this);\n    var $filterButtons = $fieldset.find('.btn[data-value]');\n    var values = $filterButtons.map(function() {\n      return $(this).data('value');\n    }).get();\n\n    var meetingValues = ['Accepted Meeting', 'Pending Meeting'];\n    \n    var isMeetingsOnlyFilter = values.length \u003E 0 && _.every(values, function(value) {\n      return meetingValues.includes(value);\n    });\n\n    if (isMeetingsOnlyFilter) {\n      var $title = $fieldset.closest('.panel').find('.panel-title-text');\n      if ($title.text().trim() === 'Location') {\n        $title.text('Meetings');\n      }\n    }\n  });\n}\n\n/**\n * After the filters are rendered, this hook finds the filter group we created for\n * meetings (which was temporarily named 'Location') and updates its UI label to 'Meetings'.\n * This gives us the desired UI without breaking the filtering mechanism. A timeout is\n * used to ensure this runs after the component's own rendering cycle is complete.\n */\nFliplet.Hooks.on('flListDataAfterRenderFilters', function() {\n  // Use a timeout to ensure this runs after the component's own render cycle.\n  setTimeout(renameMeetingsFilterLabel, 0);\n});\n\n/**\n * When the list is re-rendered (e.g., after a filter is applied), we need to\n * re-apply our label change, as the component may have re-rendered the filters.\n */\nFliplet.Hooks.on('flListDataAfterRenderList', function() {\n  renameMeetingsFilterLabel();\n});\n\n//take the user to Scan QR Code screen when the check-in button is clicked in the list or detail view\n$(document).on('click', '.check-in-btn', function(event) {\n  event.preventDefault();\n  event.stopPropagation();\n  $(this).addClass('disabled');\n\n  Fliplet.Navigate.screen(SCREENS.scanQRCode, { query: `?id=${$(this).attr('data-entry-id')}`});\n});\n\n// Add click handler for check-out button\n$(document).on('click', '.check-out-btn:not(.disabled)', function(event) {\n  event.preventDefault();\n  event.stopPropagation();\n  \n  $(this).addClass('disabled');\n  const recordId = $(this).data('entry-id');\n  const record = agendaRecords.find(r =\u003E r.id === recordId);\n  \n  if (!record) {\n    console.error('Record not found for check-out');\n    return;\n  }\n\n  if (checkIfAgendaIsNotOver(record)) {\n    const userSession = record.data.attendanceRecord;\n    if (userSession) {\n      // Update the check out time and calculate attendance duration\n      const checkOutTime = moment().tz(userTimezone).format('YYYY-MM-DD HH:mm');\n      const checkInTime = moment(userSession.data['Check in time']);\n      const checkOutTimeMoment = moment(checkOutTime);\n      const diff = checkOutTimeMoment.diff(checkInTime, 'minutes');\n      \n      // Update the record in Attending Logs\n      return getAttendingLogsConnection().then(conn =\u003E {\n        return conn.update(userSession.id, {\n          'Check out time': checkOutTime,\n          'Attendance in minutes': diff\n        }).then(() =\u003E {\n          location.reload();\n        });\n      });\n    }\n  } else {\n    // If session is over, set check out time to session end time\n    const userSession = record.data.attendanceRecord;\n    if (userSession) {\n      const dateTime = moment(`${record.data['Date']} ${record.data['End Time']}`, 'YYYY-MM-DD HH:mm');\n      const checkOutTime = moment(dateTime).tz(userTimezone).format('YYYY-MM-DD HH:mm');\n      const checkInTime = moment(userSession.data['Check in time']);\n      const diff = moment(checkOutTime).diff(checkInTime, 'minutes');\n      \n      // Update the record in Attending Logs\n      return getAttendingLogsConnection().then(conn =\u003E {\n        return conn.update(userSession.id, {\n          'Check out time': checkOutTime,\n          'Attendance in minutes': diff\n        }).then(() =\u003E {\n          location.reload();\n        });\n      });\n    }\n  }\n});\n\n// Update the RSVP click handler\n$(document).on('click', '.rsvp-attend', function(event) {\n  const $button = $(this);\n  if ($button.hasClass('selected') || $button.prop('disabled')) { return; }\n  if (!loggedInUser) { Fliplet.UI.Toast('Please login.'); return; }\n\n  const sessionId = $button.data('session-id');\n  const recordId = $button.data('record-id');\n  let processedCapacity;\n\n  if (!sessionId) { console.error('RSVP click: Missing session-id.'); Fliplet.UI.Toast('Error: Session ID missing.'); return; }\n\n  // Get capacity from button attribute\n  let capacityString = $button.data('capacity');\n  if (!capacityString) {\n    processedCapacity = Infinity;\n  } else {\n    processedCapacity = parseInt(String(capacityString), 10);\n    if (isNaN(processedCapacity)) {\n      processedCapacity = Infinity;\n    }\n  }\n\n  $button.removeClass('btn-primary').addClass('disabled').text('Processing...');\n  $button.css({\n    \"border-radius\": \"100px\",\n    \"padding\": \"8px 16px\"\n  });\n\n  const itemForRSVP = {\n    data: { originalData: { 'Session ID': sessionId, [VARIABLES.capacity]: processedCapacity }, id: recordId }\n  };\n\n  updateUsersRSVP('Going', itemForRSVP)\n    .then(() =\u003E { \n      return updateRSVPUI(recordId, sessionId, true).then(()=\u003E {\n        $button.addClass('btn-primary').removeClass('disabled').text('RSVP');\n      });\n    })\n    .catch(error =\u003E {\n      if (error === 'Capacity full') {\n        // Handle capacity full case\n        const $listButton = $(`.agenda-list-item[data-entry-id=\"${recordId}\"] .rsvp-attend`);\n        if ($listButton.length) {\n          $listButton.removeClass('disabled btn-primary')\n                   .prop('disabled', true)\n                   .html(`\u003Cspan style=\"color: ${fullCapacityColor}\"\u003E${fullCapacityText}\u003C/span\u003E`);\n        }\n\n        const $detailView = $('.agenda-item-inner-content[data-entry-id=\"' + recordId + '\"]');\n        if ($detailView.length) {\n          const $detailButton = $detailView.find('.rsvp-attend');\n          if ($detailButton.length) {\n            $detailButton.removeClass('disabled btn-primary')\n                        .prop('disabled', true)\n                        .html(`\u003Cspan style=\"color: ${fullCapacityColor}\"\u003E${fullCapacityText}\u003C/span\u003E`);\n          }\n        }\n\n        // Update record properties\n        const record = options.records.find(r =\u003E r.id === recordId);\n        if (record && record.data) {\n          record.data.capacityMessage = 'full';\n          record.data.capacityHTML = `\u003Cspan style=\"color: ${fullCapacityColor}\"\u003E${fullCapacityText}\u003C/span\u003E`;\n        }\n      } else {\n        // Handle other errors\n        console.error('RSVP click .catch error:', error); \n        Fliplet.UI.Toast('RSVP failed. Please try again.');\n        \n        // Reset buttons to RSVP state\n        const $listButton = $(`.agenda-list-item[data-entry-id=\"${recordId}\"] .rsvp-attend`);\n        if ($listButton.length) {\n          $listButton.removeClass('disabled selected attending-green')\n                   .addClass('btn-primary')\n                   .prop('disabled', false)\n                   .text('RSVP');\n        }\n\n        const $detailView = $('.agenda-item-inner-content[data-entry-id=\"' + recordId + '\"]');\n        if ($detailView.length) {\n          const $detailButton = $detailView.find('.rsvp-attend');\n          if ($detailButton.length) {\n            $detailButton.removeClass('disabled selected attending-green')\n                        .addClass('btn-primary')\n                        .prop('disabled', false)\n                        .text('RSVP');\n          }\n        }\n      }\n    });\n});\n\n// Click handler for the leave session button in detail view\n$(document).on('click', '.leave-session-btn', function(event) {\n  event.preventDefault();\n  event.stopPropagation();\n\n  const $button = $(this);\n  const sessionId = $button.data('session-id');\n  const recordId = $button.data('record-id');\n  let capacityString = $button.data('capacity');\n  let processedCapacity;\n  \n  if (!loggedInUser) { \n    Fliplet.UI.Toast('Please login.'); \n    return; \n  }\n  if (!sessionId) { \n    console.error('Leave session click: Missing session-id.'); \n    Fliplet.UI.Toast('Error: Session ID missing.'); \n    return; \n  }\n\n  // Confirmation before leaving\n  const styleId = 'rsvp-cancel-toast-styles';\n  const customToastClass = 'rsvp-cancel-toast';\n\n  // Function to remove the dynamically added styles\n  const removeToastStyles = () =\u003E {\n    const styleElement = document.getElementById(styleId);\n    if (styleElement) {\n      styleElement.remove();\n    }\n  };\n\n  // Add custom styles for the toast buttons\n  const styles = `\n    .${customToastClass} .fl-toast-links {\n        overflow: auto;\n        padding-right: 0;\n    }\n    .${customToastClass} .fl-toast-links .link:last-child {\n        float: right;\n        padding-right: 15px;\n    }\n    .${customToastClass} .fl-toast-links .link:first-child {\n        color: #f44336 !important;\n        background-color: transparent !important;\n    }\n  `;\n  const styleElement = document.createElement('style');\n  styleElement.id = styleId;\n  styleElement.innerHTML = styles;\n  document.head.appendChild(styleElement);\n  \n  Fliplet.UI.Toast({\n    type: 'regular',\n    title: confirmCancelRSVP.title,\n    backdrop: true,\n    message: confirmCancelRSVP.message,\n    duration: false,\n    actions: [\n      {\n        label: confirmCancelRSVP.labels[0],\n        action: function() {\n          removeToastStyles();\n          $button.addClass('disabled').text('Processing...');\n\n          if (!capacityString) {\n            processedCapacity = Infinity;\n          } else {\n            processedCapacity = parseInt(String(capacityString), 10);\n            if (isNaN(processedCapacity)) {\n              processedCapacity = Infinity;\n            }\n          }\n\n          const itemForUpdate = {\n            data: { originalData: { 'Session ID': sessionId, [VARIABLES.capacity]: processedCapacity }, id: recordId }\n          };\n\n          updateUsersRSVP('Not Going', itemForUpdate)\n            .then(() =\u003E {\n              return updateRSVPUI(recordId, sessionId, false).then(()=\u003E {\n                $button.removeClass('disabled').html('\u003Ci class=\"fa fa-times\"\u003E\u003C/i\u003E Cancel RSVP');\n              });\n            })\n            .catch(error =\u003E {\n              console.error('Leave session .catch error:', error);\n              Fliplet.UI.Toast('Failed to leave session. Please try again.');\n              $button.removeClass('disabled').text('Cancel');\n            });\n        }\n      },\n      {\n        label: confirmCancelRSVP.labels[1],\n        action: function() { \n          removeToastStyles();\n          /* Dismisses toast */ \n        }\n      }\n    ]\n  });\n\n  setTimeout(() =\u003E {\n    const toastElements = document.querySelectorAll('.fl-toast-top.active');\n    toastElements.forEach(toast =\u003E {\n        const titleElement = toast.querySelector('.fl-toast-title');\n        if (titleElement && titleElement.textContent === confirmCancelRSVP.title) {\n            toast.classList.add(customToastClass);\n        }\n    });\n  }, 100);\n});\n\n// Click handler for the entire attendee pills container\n$(document).on('click', '.attendee-profile-pills-container', function() {\n  const emails = $(this).data('all-emails'); // This is a JS array\n  if (!emails || !emails.length) {\n    return; // No attendees to show\n  }\n  const sessionTitle = $(this).closest('.agenda-detail-overlay').find('.agenda-item-title').text().trim();\n  const emailsStr = `[${emails.map(e =\u003E encodeURIComponent(e)).join(',')}]`;\n  \n  const queryParams = [\n    'dynamicListPrefilterColumn=Email',\n    `dynamicListPrefilterValue=${emailsStr}`,\n    'dynamicListPrefilterLogic=oneof'\n  ];\n\n  if (sessionTitle) {\n    queryParams.push(`sessionTitle=${encodeURIComponent(sessionTitle)}`);\n  }\n\n  Fliplet.Navigate.screen(SCREENS.speakers, {\n    query: queryParams.join('&')\n  });\n});\n\nfunction getAttendingLogsConnection() {\n  if (attendingLogsConnection && typeof attendingLogsConnection.update === 'function' && typeof attendingLogsConnection.insert === 'function') {\n    return Promise.resolve(attendingLogsConnection);\n  }\n  return Fliplet.DataSources.connectByName(DS.attendingLogs).then(function(connection) {\n    attendingLogsConnection = connection;\n    return connection;\n  }).catch(error =\u003E {\n    console.error('getAttendingLogsConnection: CRITICAL - Failed to connect to DS.attendingLogs:', error);\n    return Promise.reject('DS connect error for attendingLogs'); // More specific error\n  });\n}\n\nfunction hasUserRSVPed(sessionId) {\n  if (typeof sessionId !== 'string') { return Promise.resolve(false); }\n  if (!loggedInUser || !loggedInUser.Email) { return Promise.resolve(false); }\n  return getAttendingLogsConnection().then(conn =\u003E {\n      return conn.findOne({ where: { Email: loggedInUser.Email, 'Session ID': sessionId, 'RSVP Status': 'Going' } });\n  }).then(record =\u003E !!record)\n  .catch(error =\u003E {\n    return false; \n  });\n}\n\nfunction updateUsersRSVP(status, currentAgendaItem) {\n  const sessionID = currentAgendaItem.data.originalData['Session ID'];\n  const record = agendaRecords.find(s =\u003E s.id == currentAgendaItem.data.id);\n\n  if (!loggedInUser || !loggedInUser.Email) {\n    console.error('updateUsersRSVP: No loggedInUser or email.');\n    return Promise.reject('User not logged in for RSVP');\n  }\n  if (!sessionID) {\n    console.error('updateUsersRSVP: No sessionID provided.');\n    return Promise.reject('Session ID missing for RSVP');\n  }\n\n  // Check if session has started\n  if (isSessionStarted(record)) {\n    return Promise.reject('Session has already started');\n  }\n\n  // Check capacity if trying to RSVP\n  if (status === 'Going' && isRSVPEnabled(record) && isCapacityEnforced(record)) {\n    return getAttendeeCount(sessionID).then(count =\u003E {\n      const capacity = getSessionCapacity(record);\n      if (count \u003E= capacity) {\n        Fliplet.UI.Toast('Capacity is full');\n        return Promise.reject('Capacity full');\n      }\n      return updateRSVPRecord(status, sessionID);\n    });\n  }\n\n  return updateRSVPRecord(status, sessionID);\n}\n\nfunction updateRSVPRecord(status, sessionID) {\n  return getAttendingLogsConnection().then(conn =\u003E {\n    return conn.findOne({\n      where: { \n        Email: loggedInUser.Email, \n        'Session ID': sessionID \n      }\n    }).then(userRecord =\u003E {\n      const dataToSave = { \n        'RSVP Status': status, \n        'RSVP Timestamp': moment().utc().format('YYYY-MM-DDTHH:mm:ss[Z]') \n      };\n\n      if (userRecord){\n        return conn.update(userRecord.id, dataToSave);\n      } else {\n        dataToSave.Email = loggedInUser.Email;\n        dataToSave['Session ID'] = sessionID;\n        return conn.insert(dataToSave);\n      }\n    }).then(()=\u003E {\n      // Update UI without reloading\n      return getAttendeeCount(sessionID).then(count =\u003E {\n        const record = selectedAgenda ? selectedAgenda.data.originalData : null;\n        if (record) {\n          record.attendeeCount = count;\n          record.capacityMessage = getCapacityMessage(record, count);\n\n          // Update capacity message in UI\n          const $totalCount = $('.total-count');\n          if ($totalCount.length) {\n            $totalCount.html(record.capacityMessage);\n          }\n        }\n        return Promise.resolve(true);\n      });\n    });\n  });\n}\n\n// Function to get user (ensure it's defined if used, or remove if loggedInUser is set differently)\nfunction getUser() {\n  return Fliplet.User.getCachedSession().then(function(session) {\n    if (!session || !session.entries || !session.entries.dataSource) {\n        return Promise.reject('User not logged in or session data incomplete');\n    }\n    const user = session.entries.dataSource.data;\n    if (!user || !user.Email) {\n        return Promise.reject('User data or email is missing');\n    }\n    return user;\n  }).catch(function(error){\n      console.error('Error getting user:', error);\n      return Promise.reject('Error fetching user session');\n  });\n}\n\n// Helper functions for session states and properties\nfunction isMeeting(record) {\n  return record.data && record.data.Status;\n}\n\nfunction isSession(record) {\n  return record.data && record.data.Title && !record.data.Status;\n}\n\nfunction isRSVPEnabled(record) {\n  const rsvp = record.data && record.data[VARIABLES.rsvp];\n  return Array.isArray(rsvp) && rsvp.includes(VARIABLES.rsvpEnabled);\n}\n\nfunction isCapacityEnforced(record) {\n  return record.data && record.data[VARIABLES.enforceCapacity] === VARIABLES.enforceCapacityOptions.yes;\n}\n\nfunction getSessionCapacity(record) {\n  if (!isRSVPEnabled(record)) return null;\n  if (!isCapacityEnforced(record)) return unlimitedCapacityText;\n  return record.data[VARIABLES.capacity] || unlimitedCapacityText;\n}\n\nfunction isCheckInEnabled(record) {\n  return record.data && record.data[VARIABLES.enableCheckIn] === VARIABLES.enableCheckInOptions.users;\n}\n\nfunction isSessionStarted(record) {\n  if (!record.data || !record.data['Date'] || !record.data['Start Time']) return false;\n  const sessionStart = moment(`${record.data['Date']} ${record.data['Start Time']}`, 'YYYY-MM-DD HH:mm:ss');\n  return moment().isAfter(sessionStart);\n}\n\nfunction isSessionEnded(record) {\n  if (!record.data || !record.data['Date'] || !record.data['End Time']) return false;\n  const sessionEnd = moment(`${record.data['Date']} ${record.data['End Time']}`, 'YYYY-MM-DD HH:mm:ss');\n  return moment().isAfter(sessionEnd);\n}\n\nfunction getSessionStatus(record) {\n  if (!isSession(record)) return null;\n  \n  if (isSessionEnded(record)) {\n    if (record.data.checkInStatus === CHECK_IN_STATUS.CHECKED_IN) {\n      return CHECK_IN_STATUS.CHECKED_IN;\n    } else if (record.data.checkInStatus === CHECK_IN_STATUS.CHECKED_OUT) {\n      return CHECK_IN_STATUS.VISITED;\n    }\n    return CHECK_IN_STATUS.SESSION_ENDED;\n  }\n  \n  return record.data.checkInStatus || CHECK_IN_STATUS.NOT_CHECKED_IN;\n}\n\nfunction getAttendeeCount(sessionId) {\n  return getAttendingLogsConnection().then(conn =\u003E {\n    return conn.find({ where: { 'Session ID': sessionId, 'RSVP Status': 'Going' } })\n      .then(records =\u003E records.length);\n  });\n}\n\nfunction getCapacityMessage(record, attendeeCount) {\n  if (!isRSVPEnabled(record)) {\n    return null;\n  }\n  \n  const capacity = getSessionCapacity(record);\n  \n  if (attendeeCount \u003E= capacity && capacity !== unlimitedCapacityText) {\n    return 'full';\n  }\n  \n  const message = `${capacityText}${attendeeCount}/${capacity}`;\n  return message;\n}\n\n// Function to update session check-in status\nfunction updateSessionCheckInStatus(sessionId, status) {\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.update(sessionId, {\n      data: {\n        checkInStatus: status\n      }\n    });\n  });\n}\n\n// Helper function to handle the rest of the data processing\nfunction processData(data) {\n  if (data && data.records) {\n    _.remove(data.records, function(record) { \n      return agendaItemIsOptional(record) && !agendaItemIsPersonalized(record, loggedInUser); \n    });\n  }\n    \n  return TimeConversion.getAppSetup().then(function(appSettings) {\n    if (appSettings) {\n      if (TimeConversion.checkIfConversionIsRequired(appSettings)) {   \n        timeConversionIsRequired = true;\n        const originalTimezone = appSettings.data['Event Timezone'];\n        userTimezone = TimeConversion.getCurrentUserTimezone();\n        _.forEach(data.records, function(record) {\n          if (!record.data) { record.data = {}; }\n          const originalDate = record.data['Date'];\n          const originalStartTime = record.data['Start Time'];\n          const originalEndTime = record.data['End Time'];\n          if (!originalDate || !originalStartTime || !originalEndTime) { return; }\n          const converted = TimeConversion.convertToUserTimezone(originalDate, originalStartTime, originalEndTime, originalTimezone, userTimezone);\n          _.set(record, 'data[\"Date\"]', converted.date);\n          _.set(record, 'data[\"Start Time\"]', converted.startTime);\n          _.set(record, 'data[\"End Time\"]', converted.endTime);\n        });\n      } else { \n        userTimezone = appSettings.data['Event Timezone']; \n      }\n    }  \n    return Promise.resolve(true);\n  }).then(() =\u003E {\n    const meetings = data.records.filter(record =\u003E record.data && record.data.Status);\n    const emailsSet = new Set();\n    meetings.forEach(record =\u003E { \n      if (record.data['Booked by']) emailsSet.add(record.data['Booked by']); \n      if (record.data['Booked with']) emailsSet.add(record.data['Booked with']); \n    });\n    const uniqueEmails = Array.from(emailsSet);\n    return Fliplet.DataSources.connectByName(DS.users).then(function(connection) { \n      return connection.find({ where: { Email: { $in: uniqueEmails } } }); \n    })\n    .then(function(users) {\n      data.records.map(record =\u003E {\n        // Handle meetings\n        if (isMeeting(record)) {\n          const bookedWithUser = users.find(user =\u003E user.data.Email === record.data['Booked with']);\n          const bookedByUser = users.find(user =\u003E user.data.Email === record.data['Booked by']);\n          const bookedWithUserName = bookedWithUser ? `${bookedWithUser.data['First Name']} ${bookedWithUser.data['Last Name']}` : 'Unknown User';\n          const bookedByUserName = bookedByUser ? `${bookedByUser.data['First Name']} ${bookedByUser.data['Last Name']}` : 'Unknown User';\n          record.data.Title = `${record.data['Booked with'] === (loggedInUser && loggedInUser.Email) ? bookedByUserName : bookedWithUserName}`;\n          record.data.Location = `${record.data['Status']} Meeting`;\n        }\n        \n        // Handle sessions\n        if (isSession(record)) {\n          // Set RSVP related properties\n          record.data.showRSVP = isRSVPEnabled(record);\n          record.data.isCapacityEnforced = isCapacityEnforced(record);\n          record.data.capacity = getSessionCapacity(record);\n          \n          // Set check-in related properties\n          record.data.showCheckIn = isCheckInEnabled(record);\n          record.data.isSessionStarted = isSessionStarted(record);\n          record.data.isSessionEnded = isSessionEnded(record);\n          record.data.checkInStatus = getSessionStatus(record);\n          \n          // Get attendee count and set capacity message\n          if (record.data.showRSVP && record.data['Session ID']) {\n            record.data.attendeeCount = record.data.allAttendanceRecords ? record.data.allAttendanceRecords.length : 0;\n            record.data.capacityMessage = getCapacityMessage(record, record.data.attendeeCount);\n            record.data.capacityHTML = record.data.capacityMessage === 'full' \n                  ? `\u003Cspan style=\"color: ${fullCapacityColor}\"\u003E${fullCapacityText}\u003C/span\u003E` \n                  : `\u003Cspan style=\"color: ${capacityTextColor}\"\u003E${record.data.capacityMessage}\u003C/span\u003E`;\n          }\n          \n          //add custom class to the record to show RSVp buttons\n          setCustomClass(record);\n        }\n      });\n      \n      return Promise.resolve(data);\n    });\n  });\n}\n\nfunction setCustomClass(record){\n  if (record.data.showRSVP){\n    if (record.data.userRSVPed){\n      record.data.customClass = 'attending';\n    } else {\n      record.data.customClass = 'show_rsvp';\n    }\n  }\n}\n\n// Function to render attendee list in detail view\nfunction renderAttendeeList(attendees, loggedInUser) {\n  if (!selectedAgenda || !selectedAgenda.data.originalData.showRSVP) return;\n\n  const showAttendees = selectedAgenda.data.originalData[VARIABLES.showAttendees] === VARIABLES.showAttendeesOptions.allUsersVisibility;\n  if (!showAttendees) return;\n\n  if (attendees.length === 0) {\n    $('.attendee-profile-pills-container').remove();\n    return;\n  }\n\n  // Exclude current user for pill logic\n  const attendeesExcludingCurrent = attendees.filter(a =\u003E a.data.Email !== loggedInUser.Email);\n  const currentUserIsAttending = attendees.some(a =\u003E a.data.Email === loggedInUser.Email);\n\n  // Get emails for first attendeesToShow attendees (excluding current user)\n  let sortedAttendees = attendeesExcludingCurrent\n    .sort((a, b) =\u003E new Date(a.data['RSVP Timestamp']) - new Date(b.data['RSVP Timestamp']));\n  let emails = sortedAttendees\n    .slice(0, attendeesToShow)\n    .map(a =\u003E a.data.Email);\n\n  // If current user is attending and not in the first attendeesToShow, add their email\n  if (currentUserIsAttending && !emails.includes(loggedInUser.Email)) {\n    emails.push(loggedInUser.Email);\n  }\n\n  // Query user profiles for these emails only\n  Fliplet.DataSources.connectByName(DS.users).then(connection =\u003E {\n    return connection.find({ \n      where: { Email: { $in: emails } },\n      attributes: ['Email', 'First Name', 'Last Name', 'Image']\n    });\n  }).then(users =\u003E {\n    // Map user profiles to emails\n    const userMap = {};\n    users.forEach(u =\u003E { userMap[u.data.Email] = u.data; });\n    \n    const allEmails = attendees.map(a =\u003E a.data.Email);\n\n    // Pills rendering logic (same as before, but use userMap for profile info)\n    const totalAttendees = attendees.length;\n    const otherCount = attendeesExcludingCurrent.length;\n    let pillsHtml = `\u003Cdiv class=\"attendee-profile-pills-container\" data-all-emails='${JSON.stringify(allEmails)}'\u003E`;\n    pillsHtml += `\u003Cdiv class=\"attendee-topbar\"\u003E\u003Cdiv class=\"all-users\"\u003EAttendees\u003C/div\u003E`;\n\t\tpillsHtml += `\u003Cdiv class=\"users-btn\"\u003ESee More\u003C/div\u003E\u003C/div\u003E`;\n    // --- RSVP BUTTON CLICKED LOGIC ---\n    if (currentUserIsAttending) {\n      if (otherCount \u003C attendeesToShow) {\n        // Show all other attendees, then current user as separate icon\n        sortedAttendees.forEach(attendee =\u003E {\n          const user = userMap[attendee.data.Email] || {};\n          const imgSrc = Array.isArray(user.Image) && user.Image.length ? user.Image[0] : user.Image;\n          if (imgSrc) {\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill\"\u003E\u003Cimg src=\"${imgSrc}\" alt=\"Attendee\" /\u003E\u003C/div\u003E`;\n          } else {\n            const initials = (user['First Name'] ? user['First Name'][0] : '') + (user['Last Name'] ? user['Last Name'][0] : '');\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill initials\"\u003E${initials}\u003C/div\u003E`;\n          }\n        });\n        // Add current user as separate icon\n        const user = userMap[loggedInUser.Email] || loggedInUser;\n        const imgSrc = Array.isArray(user.Image) && user.Image.length ? user.Image[0] : user.Image;\n        if (imgSrc) {\n          pillsHtml += `\u003Cdiv class=\"attendee-profile-pill\"\u003E\u003Cimg src=\"${imgSrc}\" alt=\"Attendee\" /\u003E\u003C/div\u003E`;\n        } else {\n          const initials = (user['First Name'] ? user['First Name'][0] : '') + (user['Last Name'] ? user['Last Name'][0] : '');\n          pillsHtml += `\u003Cdiv class=\"attendee-profile-pill initials\"\u003E${initials}\u003C/div\u003E`;\n        }\n      } else if (otherCount === attendeesToShow) {\n        // Show attendeesToShow others, current user as +1\n        sortedAttendees.slice(0, attendeesToShow).forEach(attendee =\u003E {\n          const user = userMap[attendee.data.Email] || {};\n          const imgSrc = Array.isArray(user.Image) && user.Image.length ? user.Image[0] : user.Image;\n          if (imgSrc) {\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill\"\u003E\u003Cimg src=\"${imgSrc}\" alt=\"Attendee\" /\u003E\u003C/div\u003E`;\n          } else {\n            const initials = (user['First Name'] ? user['First Name'][0] : '') + (user['Last Name'] ? user['Last Name'][0] : '');\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill initials\"\u003E${initials}\u003C/div\u003E`;\n          }\n        });\n        pillsHtml += `\u003Cdiv class=\"attendee-profile-pill more-attendees\"\u003E+1\u003C/div\u003E`;\n      } else if (otherCount \u003E attendeesToShow) {\n        // Show first attendeesToShow others, current user as +x (x = total - attendeesToShow + 1)\n        sortedAttendees.slice(0, attendeesToShow).forEach(attendee =\u003E {\n          const user = userMap[attendee.data.Email] || {};\n          const imgSrc = Array.isArray(user.Image) && user.Image.length ? user.Image[0] : user.Image;\n          if (imgSrc) {\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill\"\u003E\u003Cimg src=\"${imgSrc}\" alt=\"Attendee\" /\u003E\u003C/div\u003E`;\n          } else {\n            const initials = (user['First Name'] ? user['First Name'][0] : '') + (user['Last Name'] ? user['Last Name'][0] : '');\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill initials\"\u003E${initials}\u003C/div\u003E`;\n          }\n        });\n        const moreCount = totalAttendees - attendeesToShow;\n        pillsHtml += `\u003Cdiv class=\"attendee-profile-pill more-attendees\"\u003E+${moreCount}\u003C/div\u003E`;\n      }\n    } else {\n      // --- CANCEL BUTTON CLICKED LOGIC ---\n      if (otherCount \u003C= attendeesToShow) {\n        // Show all others, no current user\n        sortedAttendees.forEach(attendee =\u003E {\n          const user = userMap[attendee.data.Email] || {};\n          const imgSrc = Array.isArray(user.Image) && user.Image.length ? user.Image[0] : user.Image;\n          if (imgSrc) {\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill\"\u003E\u003Cimg src=\"${imgSrc}\" alt=\"Attendee\" /\u003E\u003C/div\u003E`;\n          } else {\n            const initials = (user['First Name'] ? user['First Name'][0] : '') + (user['Last Name'] ? user['Last Name'][0] : '');\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill initials\"\u003E${initials}\u003C/div\u003E`;\n          }\n        });\n      } else if (otherCount === attendeesToShow + 1) {\n        // Remove +1, show attendeesToShow remaining\n        sortedAttendees.slice(0, attendeesToShow).forEach(attendee =\u003E {\n          const user = userMap[attendee.data.Email] || {};\n          const imgSrc = Array.isArray(user.Image) && user.Image.length ? user.Image[0] : user.Image;\n          if (imgSrc) {\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill\"\u003E\u003Cimg src=\"${imgSrc}\" alt=\"Attendee\" /\u003E\u003C/div\u003E`;\n          } else {\n            const initials = (user['First Name'] ? user['First Name'][0] : '') + (user['Last Name'] ? user['Last Name'][0] : '');\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill initials\"\u003E${initials}\u003C/div\u003E`;\n          }\n        });\n      } else if (otherCount \u003E attendeesToShow + 1) {\n        // Update +x (decrease by 1)\n        sortedAttendees.slice(0, attendeesToShow).forEach(attendee =\u003E {\n          const user = userMap[attendee.data.Email] || {};\n          const imgSrc = Array.isArray(user.Image) && user.Image.length ? user.Image[0] : user.Image;\n          if (imgSrc) {\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill\"\u003E\u003Cimg src=\"${imgSrc}\" alt=\"Attendee\" /\u003E\u003C/div\u003E`;\n          } else {\n            const initials = (user['First Name'] ? user['First Name'][0] : '') + (user['Last Name'] ? user['Last Name'][0] : '');\n            pillsHtml += `\u003Cdiv class=\"attendee-profile-pill initials\"\u003E${initials}\u003C/div\u003E`;\n          }\n        });\n        const moreCount = otherCount - attendeesToShow;\n        pillsHtml += `\u003Cdiv class=\"attendee-profile-pill more-attendees\"\u003E+${moreCount}\u003C/div\u003E`;\n      }\n    }\n\n    pillsHtml += '\u003C/div\u003E';\n\n    // Update the UI\n    $('.attendee-profile-pills-container').remove();\n    const $detailBodyText = $('.agenda-detail-overlay .agenda-item-detail-body-text');\n    if ($detailBodyText.length) {\n      $detailBodyText.after(pillsHtml);\n    } else {\n      $('.agenda-detail-overlay .agenda-item-content-holder').append(pillsHtml);\n    }\n  });\n}\n\n// Helper function to get capacity text from record\nfunction getCapacityText(record) {\n  if (!record || !record.data) return unlimitedCapacityText;\n  const capacity = record.data[VARIABLES.capacity];\n  return (capacity !== undefined && capacity !== '') ? \n    parseInt(capacity, 10) : \n    unlimitedCapacityText;\n}\n\n// Helper function to generate capacity message\nfunction generateCapacityMessage(currentGoing, capacityValue) {\n  const isFull = currentGoing \u003E= capacityValue;\n  const message = isFull ? 'full' : `${capacityText}${currentGoing}/${capacityValue}`;\n  const html = isFull ? \n    `\u003Cspan style=\"color: ${fullCapacityColor}\"\u003E${fullCapacityText}\u003C/span\u003E` : \n    `\u003Cspan style=\"color: ${capacityTextColor}\"\u003E${message}\u003C/span\u003E`;\n  return { message, html };\n}\n\n// Helper function to update record properties\nfunction updateRecordProperties(record, isRSVPing, currentGoing, capacityValue) {\n  if (!record) return;\n  \n  const { message, html } = generateCapacityMessage(currentGoing, capacityValue);\n  record.data.userRSVPed = isRSVPing;\n  record.data.attendeeCount = currentGoing;\n  record.data.capacityMessage = message;\n  record.data.capacityHTML = html;\n  \n  setCustomClass(record);\n}\n\n// Helper function to update capacity message in view\nfunction updateCapacityMessage($container, html) {\n  const $totalCount = $container.find('.total-count');\n  if ($totalCount.length) {\n    $totalCount.html(html);\n  }\n}\n\n// Main function to update UI after RSVP status changes\nfunction updateRSVPUI(recordId, sessionId, isRSVPing) {\n  return getAttendingLogsConnection().then(conn =\u003E {\n    // Fetch the latest attendees from backend\n    return conn.find({ \n      where: { \n        'Session ID': sessionId, \n        'RSVP Status': 'Going' \n      }\n    }).then(attendees =\u003E {\n      // Update global attendees\n      currentSessionAttendees = attendees;\n      \n      const currentGoing = attendees.length;\n      const record = agendaRecords.find(r =\u003E r.id === recordId);\n      if (!record) return;\n\n      const capacityValue = getCapacityText(record);\n\n      // Update record properties\n      updateRecordProperties(record, isRSVPing, currentGoing, capacityValue);\n\n      // Update the single list view item for this record\n      const $listItem = $(`.agenda-list-item[data-entry-id=\"${recordId}\"]`);\n      const $detailedItem = $(`.agenda-item-inner-content[data-entry-id='${recordId}']`);\n      \n      if ($listItem.length) {\n        updateCapacityMessage($listItem, record.data.capacityHTML);\n        $listItem.removeClass('attending show_rsvp').addClass(record.data.customClass);\n      }\n      \n      if ($detailedItem.length){\n        updateCapacityMessage($detailedItem, record.data.capacityHTML);\n        // Always re-render attendee list with the latest attendees from backend\n        renderAttendeeList(attendees, loggedInUser);\n        $detailedItem.removeClass('attending show_rsvp').addClass(record.data.customClass);\n      }\n    });\n  });\n}\n\nHandlebars.registerHelper('eq', function(a, b) {\n  return a === b;\n});\n\nHandlebars.registerHelper('capacityIsFull', function(capacityMessage) {\n  return /full/.test(capacityMessage);\n});\n\n$(document).on('click', '.media', function() {\n  var speakerEmail = $(this).data('name');\n  Fliplet.Navigate.screen(SCREENS.speakers, {\n    query:\n      '?dynamicListOpenColumn=Email&dynamicListOpenValue=' +\n      speakerEmail +\n      '&dynamicListPreviousScreen=true'\n  });\n});\n\n//listener which redirects to the materials screen\n//target:  .materials-button\n$(document).on('click', '.materials-button', function() {\n  var entryId = $(this).attr('id');\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findById(entryId).then(function(record) {\n      var session = record.data['Session ID'];\n      var query =\n        '?sessionTitle=true&dynamicListPrefilterColumn=Associated%20Session&dynamicListPrefilterValue=' +\n        encodeURIComponent(session) +\n        '&dynamicListPrefilterLogic=oneof';\n      return Fliplet.Navigate.screen(SCREENS.materials, { query: query });\n    });\n  });\n});\n\n$(document).on('click', '.floorplan-button', function(event) {\n  event.preventDefault();\n  var locationID = this.id;\n  Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findById(locationID).then(function(record) {\n      Fliplet.Navigate.screen(SCREENS.floorplan, {\n        query: '?entryName=' + encodeURIComponent(record.data.Location)\n      });\n    });\n  });\n});\n\n//listener which redirects to the poll screen\n//target:  .go-to-poll\n$(document).on('click', '.go-to-poll', function() {\n  console.log('poll');\n  var entryId = $(this)\n    .parents('.agenda-item-inner-content')\n    .data('entry-id');\n  //console.log(entryId);\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findById(entryId).then(function(record) {\n      // records is the found object\n      //console.log(record);\n      //console.log(record.data['Session ID']);\n      return Fliplet.Navigate.screen(SCREENS.poll, {\n        query:\n          '?sessionID=' +\n          encodeURIComponent(record.data['Session ID']) +\n          '&title=' +\n          encodeURIComponent(record.data['Title'])\n      });\n    });\n  });\n});",
        "customCSS": ".agenda-list-item .rsvp-attend.list-view{display:none !important}.agenda-list-item.attending .rsvp-attend.list-view.attending-green{display:block !important}.agenda-list-item.show_rsvp .rsvp-attend.list-view.not-attending{display:block !important}.agenda-item-inner-content .buttons{display:flex;align-items:center;margin-bottom:10px}.agenda-item-inner-content .leave-session-btn,.agenda-item-inner-content .detailed-view.rsvp-attend{display:none !important;margin-right:10px}.agenda-item-inner-content.attending .leave-session-btn{display:block !important}.agenda-item-inner-content.show_rsvp .detailed-view.rsvp-attend{display:block !important}.rsvp-attend.list-view{bottom:5px !important;right:5px !important;box-shadow:0 1px 3px rgba(0,0,0,0.12) !important;padding:12px !important;padding-top:4px !important;padding-bottom:4px !important}.agenda-item-bookmark{margin-bottom:10px}.check-out-btn{margin:10px}.action{display:none}.agenda-item-location.status-pending{color:#FFA500 !important}.agenda-item-location.status-accepted{color:#4CAF50 !important}.rsvp-attend.attending-green{border-radius:100px}.badge-success{background:none !important;color:#777 !important;font-size:16px !important;padding-left:15px;text-decoration:underline}.total-count{margin-bottom:10px;font-size:14px}.session-container{background-color:#fff !important}.special-button.check-in,.special-button.check-out{position:relative;display:flex;align-items:center;justify-content:center;width:calc(50% - 30px);margin:-30px 15px 15px 0;float:right;color:white;min-height:40px;border-radius:10px;font-size:20px;overflow:hidden;background-color:#8fa7df}.special-button.check-in p,.special-button.check-out p{font-size:18px;margin:0 0 2px 10px;z-index:2}.special-button.check-in i,.special-button.check-out i{z-index:2}.special-button.check-in{background-color:#8fa7df}.special-button.check-out::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;display:block;background-color:#90BFD3}.special-button.disabled{background:#999 !important;cursor:not-allowed !important}.special-button.visited{position:absolute;top:10px;right:10px;text-align:center;font-size:20px;z-index:2;text-transform:uppercase;color:#345091}.special-button.visited p{margin-bottom:0}.special-button p{font-size:12px;margin-top:-5px}.rsvp-not-attend.selected,.rsvp-attend.selected{cursor:not-allowed !important}.rsvp-not-attend.selected *,.rsvp-attend.selected *{color:#999 !important}.new-agenda-list-container .agenda-list-item:not(.open) .agenda-item-bookmark-holder{top:0;height:25px}.leave-session-btn{display:inline-block;padding:8px 16px;font-size:16px;font-weight:bold;line-height:1.5;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;user-select:none;background-color:rgba(217,83,79,0.1);color:#d9534f !important;border:1px solid #d9534f !important;border-radius:20px;margin-top:10px;margin-bottom:10px}.leave-session-btn i.fa.fa-times{margin-right:5px}.leave-session-btn:hover,.leave-session-btn:focus{background-color:#e9ecef;color:#d9534f !important;border-color:#d9534f !important;text-decoration:none}.leave-session-btn:active,.leave-session-btn.active{background-color:#dae0e5;color:#d9534f !important;border-color:#d9534f !important;box-shadow:inset 0 3px 5px rgba(0,0,0,0.125)}.leave-session-btn.disabled,.leave-session-btn:disabled{background-color:#f8f9fa;color:#d9534f !important;border-color:#d9534f !important;opacity:0.65;cursor:not-allowed}.rsvp-attend.disabled{background-color:grey}.rsvp-attend.list-view{position:absolute;right:0;bottom:0;padding-top:7px !important;padding-bottom:7px !important;font-size:14px !important;color:white}.rsvp-attend.attending-green{background-color:#28A745 !important;color:#fff !important;border-color:#28A745 !important;cursor:not-allowed !important}.award{display:inline-block;text-align:center;padding:8px;width:31%;vertical-align:top}.new-agenda-list-container .slide-over .agenda-item-inner-content h2.agenda-item-title{padding-right:15px}.agenda-item-bookmark.more-buttons{align-items:center;flex-wrap:wrap;width:100%;display:flex;gap:5px}.session-button{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;width:56px;margin:0 !important;padding:0;box-sizing:border-box;font-size:11px;cursor:pointer;word-wrap:break-word;color:#8fa7df}.session-button .fa{margin-bottom:4px;font-size:22px}.agenda-item-bookmark.more-buttons .agenda-item-bookmark-holder{margin:0 !important;width:56px}.agenda-detail-overlay .bookmark-wrapper{color:#8fa7df}.agenda-detail-overlay .bookmarked .bookmark-wrapper.btn-bookmarked{color:#345091}.agenda-detail-overlay .bookmark-wrapper{margin:0}.media{display:flex;align-items:center;height:75px;width:100%;max-width:400px;border-radius:25px;box-shadow:rgba(0,0,0,0.15) 2px 2px 3px;overflow:hidden;background:#fff}.media-left{flex:0 0 70px;display:flex;align-items:center;justify-content:center;background:#f7f7f7;padding:10px 0 0 0}.media-object{width:100%;object-fit:cover;display:block}.media-object .fa{font-size:32px;color:#9e9e9e}.media-body{flex:1;padding:15px;display:flex;flex-direction:column;justify-content:center}.media-heading{font-weight:bold;font-family:helvetica;font-size:16px;color:#345091;margin-bottom:0;line-height:20px}.company-name,.title-name{font-size:0.9em;line-height:20px}.right-chevron{width:15px;position:relative;right:10px}.media-container{margin-top:5px;margin-bottom:20px}.btn-primary{color:#fff !important;background-color:#345091 !important;border-color:#345091 !important}.btn-primary:hover,.btn-primary:focus,.btn-primary:active,.btn-primary.active{color:#fff !important;background-color:#273b6b !important;border-color:#243764 !important}.rsvp-action-buttons-container{display:flex;justify-content:flex-start;align-items:center;margin-top:10px;margin-bottom:10px}.rsvp-action-buttons-container .btn{margin-left:8px}.rsvp-action-buttons-container .btn:first-child{margin-left:0}.attendee-profile-pills-container{display:flex;align-items:center;margin-top:15px;margin-bottom:15px;flex-wrap:wrap}.attendee-profile-pills-container .attendee-topbar{width:100%;display:inline-block}.attendee-profile-pills-container .attendee-topbar .all-users{width:50%;margin-bottom:5px;display:inline-block}.attendee-profile-pills-container .attendee-topbar .users-btn{width:50%;text-align:right;font-size:14px;color:blue;text-decoration:underline;display:inline-block}.attendee-profile-pills-container .attendee-topbar .users-btn:hover{cursor:pointer}.attendee-profile-pills-container .more-attendees,.attendee-profile-pills-container .user-pill,.attendee-profile-pills-container .all-users{cursor:pointer}.attendee-profile-pill{width:30px;height:30px;border-radius:50%;background-color:#e0e0e0;margin-right:-8px;border:2px solid #fff;display:flex;align-items:center;justify-content:center;font-size:12px;color:#757575;font-weight:bold;box-shadow:0 1px 2px rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:center;overflow:hidden}.attendee-profile-pill.more-attendees{background-color:#f0f0f0;color:#345091;z-index:1}@media (min-width: 768px){.attendee-profile-pill{width:45px;height:45px;font-size:18px}.attendee-profile-pill.more-attendees{font-size:18px}}@media (max-width: 767px){.attendee-profile-pills-container{flex-wrap:wrap;justify-content:flex-start}.attendee-profile-pill{width:40px;height:40px;margin-right:8px;margin-bottom:8px;border:1px solid #ccc;display:flex;align-items:center;justify-content:center;overflow:hidden}.attendee-profile-pill.more-attendees{font-size:14px}}.attendees-label{font-size:16px;font-weight:bold;color:#333;margin-bottom:8px;margin-top:15px}\n",
        "customSCSS": "//list view RSVP buttons are hidden by default\n.agenda-list-item {\n  .rsvp-attend.list-view{\n    display: none !important;\n  }\n  &.attending{\n    .rsvp-attend.list-view.attending-green{\n      display: block !important;\n    }\n  }\n  &.show_rsvp{\n    .rsvp-attend.list-view.not-attending{\n      display: block !important;\n    }\n  }\n}\n//detailed view RSVP buttons are hidden by default\n.agenda-item-inner-content {\n  .buttons{\n    display: flex;\n    align-items: center;\n    margin-bottom: 10px;\n  }\n  .leave-session-btn, .detailed-view.rsvp-attend{\n    display: none !important;\n    margin-right: 10px;\n  }\n  &.attending{\n    .leave-session-btn{\n      display: block !important;\n    }\n  }\n  &.show_rsvp{\n    .detailed-view.rsvp-attend{\n      display: block !important;\n    }\n  }\n}\n.rsvp-attend.list-view{\n  bottom: 5px!important;\n  right: 5px!important;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.12)!important;\n  padding: 12px!important;\n  padding-top: 4px!important;\n  padding-bottom: 4px!important;\n}\n\n.agenda-item-bookmark{\n  margin-bottom: 10px;\n}\n\n.check-out-btn{\n  margin: 10px;\n}\n\n.action{\n  display: none;\n}\n\n.agenda-item-location.status-pending {\n    color: #FFA500 !important;\n  }\n  .agenda-item-location.status-accepted {\n    color: #4CAF50 !important;\n  }\n\n.rsvp-attend.attending-green{\n  border-radius: 100px;\n}\n\n.agenda-item-bookmark {\n   // position: absolute;\n   // right: 10px;\n}\n\n.badge-success{\n\tbackground: none!important;\n color: #777!important;\n   font-size: 16px!important;\n   padding-left: 15px;\n  text-decoration:underline;\n}\n\n.total-count{\n  margin-bottom: 10px;\n  font-size: 14px;\n}\n\n//QR Code\n.session-container{\n  background-color: #fff !important;\n}\n.special-button{\n  &.check-in, &.check-out{\n    position: relative;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: calc(50% - 30px);\n    margin: -30px 15px 15px 0;\n    float: right;\n    color: white;\n    min-height: 40px;\n    border-radius: 10px;\n    font-size: 20px;\n    overflow: hidden;\n    background-color: $secondaryColor;\n    p {\n      font-size: 18px;\n    \tmargin: 0 0 2px 10px;\n      z-index: 2;\n    }\n    i{\n      z-index: 2;\n    }\n  }\n  &.check-in{\n    background-color: $secondaryColor;\n  }\n  &.check-out{\n    &::before{\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      display: block;\n      background-color: #90BFD3;\n    }\n  }  \n  &.disabled{\n    background: #999 !important;\n    cursor: not-allowed !important;\n  }\n}\n.special-button.visited {\n  position:absolute;\n  top: 10px;\n  right: 10px;\n  text-align:center;\n  font-size:20px;\n  z-index: 2;\n  text-transform: uppercase;\n  color: $agendaItemTimeFontColor;\n  p{\n    margin-bottom: 0;\n  }\n}\n.special-button p {\n  font-size:12px;\n  margin-top: -5px;\n}\n//END of QR Code\n.rsvp-not-attend, .rsvp-attend {\n  &.selected {\n    cursor: not-allowed !important;\n    * {\n      color: #999 !important;\n    }\n  }\n}\n\n.new-agenda-list-container .agenda-list-item:not(.open) .agenda-item-bookmark-holder{\n  top: 0;\n  height: 25px;\n}\n\n.leave-session-btn {\n  display: inline-block;\n  padding: 8px 16px;\n  font-size: 16px;\n  font-weight: bold;\n  line-height: 1.5;\n  text-align: center;\n  white-space: nowrap;\n  vertical-align: middle;\n  cursor: pointer;\n  user-select: none;\n  background-color: rgba(217, 83, 79, 0.1);\n  color: #d9534f !important;\n  border: 1px solid #d9534f !important;\n  border-radius: 20px;\n  margin-top: 10px;\n  margin-bottom: 10px;\n\n  i.fa.fa-times {\n    margin-right: 5px;\n  }\n\n  &:hover,\n  &:focus {\n    background-color: #e9ecef;\n    color: #d9534f !important;\n    border-color: #d9534f !important;\n    text-decoration: none;\n  }\n\n  &:active,\n  &.active {\n    background-color: #dae0e5;\n    color: #d9534f !important;\n    border-color: #d9534f !important;\n    box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);\n  }\n\n  &.disabled,\n  &:disabled {\n    background-color: #f8f9fa;\n    color: #d9534f !important;\n    border-color: #d9534f !important;\n    opacity: 0.65;\n    cursor: not-allowed;\n  }\n}\n\n.rsvp-attend {\n  &.disabled{\n    background-color: grey;\n  }\n  &.list-view{\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    padding-top: 7px!important;    // Reduced top padding\n    padding-bottom: 7px!important; // Reduced bottom padding\n    font-size: 14px!important;     // Explicit font size\n    color: white;\n  }\n  &.detailed-view{}\n  \n  &.attending-green {\n    background-color: #28A745 !important; \n    color: #fff !important;\n    border-color: #28A745 !important; \n    cursor: not-allowed !important;\n    // padding-top, padding-bottom, and font-size will be inherited from .rsvp-attend\n  }\n}\n/*.rsvp-attend.attending-green {\n  background-color: #4CAF50 !important;\n  color: #fff !important;\n  border: none !important;\n  cursor: not-allowed !important;\n}*/\n\n.award{\n  display:inline-block;\n  text-align: center;\n  padding: 8px;\n  width: 31%;\n  vertical-align: top;\n}\n\n.new-agenda-list-container .slide-over .agenda-item-inner-content h2.agenda-item-title{\n  padding-right: 15px;\n}\n.agenda-item-bookmark.more-buttons{\n  align-items: center;\n  flex-wrap: wrap;\n  width: 100%;\n  display: flex;\n  gap: 5px;\n}\n.session-button {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  width: 56px;\n  margin: 0 !important;\n  padding: 0;\n  box-sizing: border-box;\n  font-size: 11px; /* Adjust to fit text */\n  cursor: pointer;\n  word-wrap: break-word;\n  color: $agendaListDetailOverlayIconsColor;\n}\n.session-button .fa{\n    margin-bottom: 4px;\n    font-size: 22px;\n}\n.agenda-item-bookmark.more-buttons .agenda-item-bookmark-holder{\n  margin: 0 !important;\n  width: 56px;\n}\n.agenda-detail-overlay .bookmark-wrapper{\n  color: $agendaBookmarkIconColor;\n}\n\n.agenda-detail-overlay .bookmarked .bookmark-wrapper.btn-bookmarked{\n color: $agendaBookmarkIconActiveColor;\n}\n.agenda-detail-overlay .bookmark-wrapper{\n  margin: 0;\n}\n\n/* --- INDIVIDUAL CARD ------------------------------------- */\n.media{\n  display:flex;\n  align-items:center;\n  height:75px;\n  width:100%;\n  max-width: 400px;\n  /* fill the grid cell */\n  border-radius:25px;\n  box-shadow:rgba(0,0,0,.15) 2px 2px 3px;\n  overflow:hidden;\n  background:#fff;\n}\n/* left column (image or icon) */\n.media-left{\n  flex:0 0 70px;\n  /* fixed 70 px column */\n  //height:100%;\n  display:flex;\n  align-items:center;\n  justify-content:center;\n  background:#f7f7f7;\n  padding: 10px 0 0 0;\n}\n.media-object{\n  width:100%;\n  //height:100%;\n  object-fit:cover;\n  /* scales & crops to fill both axes */\n  display:block;\n}\n.media-object .fa{\n  font-size:32px;\n  color:#9e9e9e;\n}\n/* text block */\n.media-body{\n  flex:1;\n  padding: 15px;\n  display:flex;\n  flex-direction:column;\n  justify-content:center;\n}\n.media-heading{\n  font-weight: bold;\n  font-family: $smallCardTitleFontFamily;\n  font-size: $smallCardTitleFontSize;\n  color: $lfdFontColor;\n  margin-bottom: 0;\n  line-height: 20px;\n}\n\n\n\n///\n/*\n\n.media-left img{\n  //width: 100%;\n  height: auto;\n}\n.media {\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: flex-start;\n  padding-right: 10px;\n}\n.media-body{\n  width: 100%;\n}\n/* Create three equal columns that sits next to each other */\n/*.media-body, .media-left, .media-right {\n  display: table-cell;\n  vertical-align: top;\n  color: $bodyTextColor;\n  padding: 0;\n}\n.media-heading{\n  font-size: 1.3em;\n  color: $headingFourColor;\n  margin-bottom: 0;\n}*/\n\n.company-name, .title-name{\n  font-size:0.9em;\n  line-height: 20px;\n}\n.right-chevron{\n  width: 15px;\n  position: relative;\n  right: 10px;\n}\n\n.media-container{\n  margin-top: 5px;\n  margin-bottom: 20px;\n}\n\n\n/*@media (min-width: 1000px) {\n  .media:first-child{\n    margin-top: 15px!important;\n  }\n  .media {\n    margin-top: 15px;\n    flex: 0 0 47%;\n    margin-right: 15px;\n  }\n  .media-container {\n    display: flex;\n    justify-content: flex-start;\n    flex-wrap: wrap;\n  }\n}\n@media (max-width: 1000px) {\n  .media-object {\n    max-height: 220px;\n  }\n}*/\n\n// Base button style (re-introducing for consistency)\n\n\n.btn-primary {\n  color: #fff !important; // Important to override potential theme styles if not specific enough\n  background-color: $highlightColor !important; // Using $highlightColor\n  border-color: $highlightColor !important;     // Using $highlightColor\n  &:hover,\n  &:focus,\n  &:active,\n  &.active {\n    color: #fff !important;\n    background-color: darken($highlightColor, 10%) !important; // Using $highlightColor\n    border-color: darken($highlightColor, 12%) !important; // Using $highlightColor\n  }\n}\n\n.rsvp-action-buttons-container {\n  display: flex; // Align buttons in a row\n  justify-content: flex-start; // Align to the start (left), can be changed to flex-end for right alignment\n  align-items: center; // Vertically align items\n  margin-top: 10px; // Space above the container\n  margin-bottom: 10px; // Space below the container\n\n  .btn { // Style for buttons within this container\n    margin-left: 8px; // Spacing between buttons\n    &:first-child {\n      margin-left: 0; // No left margin for the first button\n    }\n  }\n}\n\n.attendee-profile-pills-container {\n  display: flex;\n  align-items: center;\n  margin-top: 15px;\n  margin-bottom: 15px;\n  flex-wrap: wrap;\n  .attendee-topbar{\n    width: 100%;\n    display: inline-block;\n    .all-users{\n      width: 50%;\n      margin-bottom: 5px;\n      display: inline-block;\n    }\n    .users-btn{\n      width: 50%;\n      text-align: right;\n      font-size: 14px;\n      color: blue;\n      text-decoration: underline;\n      display: inline-block;\n    }\n    .users-btn:hover{\n      cursor: pointer;\n    }\n  }\n  .more-attendees, .user-pill, .all-users{\n    cursor: pointer;\n  }\n}\n\n.attendee-profile-pill {\n  width: 30px;\n  height: 30px;\n  border-radius: 50%;\n  background-color: #e0e0e0; // Placeholder background\n  margin-right: -8px; // Creates an overlapping effect, adjust as needed\n  border: 2px solid #fff; // White border to distinguish overlapping pills\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 12px;\n  color: #757575;\n  font-weight: bold;\n  box-shadow: 0 1px 2px rgba(0,0,0,0.1);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n\n  // Default to a generic user icon if an image isn't set (for actual implementation)\n  // For now, background-color is enough as a placeholder.\n  // background-image: url('path/to/default-user-icon.png');\n  // background-size: cover;\n\n  &.more-attendees {\n    background-color: #f0f0f0; // Slightly different background for the 'more' pill\n    color: $highlightColor; // Use highlight color for the text\n    z-index: 1; // Ensure it's above other pills if they truly overlap\n  }\n}\n\n// Increase attendee-profile-pill size by 50% for screens larger than 767px\n@media (min-width: 768px) {\n  .attendee-profile-pill {\n    width: 45px;\n    height: 45px;\n    font-size: 18px;\n  }\n  .attendee-profile-pill.more-attendees {\n    font-size: 18px;\n  }\n}\n\n@media (max-width: 767px) { // Mobile-specific styles\n  .attendee-profile-pills-container {\n    flex-wrap: wrap; // Allow pills to wrap\n    justify-content: flex-start; // Align wrapped items to the start\n    // No specific width needed, it will be full width by default as a block-like flex container\n  }\n\n  .attendee-profile-pill {\n    width: 40px; // Larger pills on mobile\n    height: 40px;\n    margin-right: 8px; // Spacing between pills, no overlap\n    margin-bottom: 8px; // Spacing when pills wrap\n    border: 1px solid #ccc; // Simple border, as overlap effect is removed\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n    // background-image: none; // If you had a default user icon, ensure it scales or is appropriate\n\n    &.more-attendees {\n      font-size: 14px; // Slightly larger font for the number in the larger pill\n    }\n  }\n}\n\n.attendees-label {\n  font-size: 16px; // Or your desired size\n  font-weight: bold;\n  color: #333; // Or your desired text color\n  margin-bottom: 8px; // Space between the label and the pills\n  margin-top: 15px; // Space above the label\n}",
        "widgetInstancesInUse": [30951972, 30951973, 30951974]
      },
      "updatedAt": "2025-07-02T16:49:40.051Z",
      "slug": "agenda-1l7n2"
    },
    {
      "id": 1744559,
      "isLayout": false,
      "layout": "{{{widget 30951651}}}{{{widget 30951640}}}\n\u003Cdiv class=\"dynamic-container\"\u003E\n  \n  \n\u003C/div\u003E",
      "dependencies": [
        "bootstrap-css",
        {
          "url": "https://cdn.fliplet.com/apps/176736/dependencies/VCard-eaec36a8a0a9fa8d58831006f5ea1aff.js",
          "name": "VCard",
          "path": "apps/176736/dependencies/VCard-eaec36a8a0a9fa8d58831006f5ea1aff.js",
          "latest": "https://api.fliplet.com/v1/media/files/6968635/contents/VCard.js",
          "updatedAt": 1700077657
        }
      ],
      "appId": 389751,
      "layoutId": 1654579,
      "layoutOrder": 7,
      "order": 7,
      "sectionId": null,
      "title": "Public Profile",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays a user's public profile and will show placeholder information unless accessed by scanning a QR code from a user's profile in the Directory. Editing this screen requires using fields from the Users data source in a special syntax: \u003Ccode\u003E((%[field name]%))\u003C/code\u003E. While static content like accordions, links, and videos can be added, take care when making changes as this screen is highly custom.\u003C/p\u003E\n\u003Cp\u003EThe \"Add to Contacts\" feature allows users to download a vCard to their device. This functionality can be edited by following the instructions in this article: \u003Ca href=\"https://help.fliplet.com/how-to-edit-the-digital-business-card-information/\" target=\"_blank\" rel=\"noopener\"\u003EHow to Edit the Digital Business Card Information\u003C/a\u003E.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen displays a user's public profile with information pulled dynamically from the Users data source. It provides features like \"Add to Contacts,\" which lets users download a vCard, and additional options for static content such as accordions and links.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let userEmail, FullName, RecordData, linkedin, phone, email;\nlet mode = Fliplet.Env.get('mode');\nlet queryEmail = Fliplet.Navigate.query.email;\n\nFliplet.App.get().then(function(app) {\n  $('.error').toggle(!app.productionAppId && Fliplet.Env.get('preview'));\n});\n\ngetUser().then(user =\u003E {\n  if (!user) {\n    $(document).find('.fl-menu-body').hide();\n  }\n});\n\nif (queryEmail) {\n  userEmail = queryEmail;\n} else {\n  userEmail = 'admin@email.com';\n  $('body').attr('style', 'display: block !important');\n}\n\nif (!Fliplet.Env.get('interact')) {\n  $('.fl-page-content-wrapper').hide();\n}\n\nif (userEmail) {\n  if (mode !== 'interact') {\n    loadData();\n  } else {\n    $('.content').removeClass('invisible');\n  }\n} else {\n  console.log('User came without QR Code scan.');\n  if (!Fliplet.Env.get('interact')) {\n    $('.fl-page-content-wrapper').html('\u003Ccenter\u003E\u003Ch1\u003EUser came without QR Code scan\u003C/h1\u003E\u003C/center\u003E');\n  }\n  $('.fl-page-content-wrapper').fadeIn();\n}\n\n$(document).on('click', '.email', function() {\n  if (email) {\n    var options = {\n      to: [{ email: email, type: 'to' }]\n    };\n\n    return Fliplet.Communicate.composeEmail(options);\n  }\n});\n\n$(document).on('click', '.phone', function() {\n  if (phone) {\n    document.location.href = 'tel:' + phone;\n  }\n});\n\n$(document).on('click', '.linkedIn', function() {\n  if (linkedin) {\n    return Fliplet.Navigate.url(linkedin);\n  }\n});\n\nfunction loadData() {\n  return Fliplet.DataSources.connectByName(DS.users).then(function(connection) {\n    return connection\n      .findOne({\n        where: { Email: userEmail }\n      })\n      .then(function(record) {\n        if (record) {\n          RecordData = record.data;\n          email = record.data.Email ? record.data.Email : '';\n          phone = record.data['Cell/Mobile Phone'] ? record.data['Cell/Mobile Phone'] : '';\n          linkedin = record.data.LinkedIn ? record.data.LinkedIn : '';\n\n          if (!email) {\n            $(document)\n              .find('.email')\n              .addClass('hidden');\n          }\n          if (!phone) {\n            $(document)\n              .find('.phone')\n              .addClass('hidden');\n          }\n          if (!linkedin) {\n            $(document)\n              .find('.linkedIn')\n              .addClass('hidden');\n          }\n\n          if (record.data.Image) {\n            renderAvatar(record);\n          }\n\n          if (record.data['Bio Link']) {\n            $('.Link a').attr('href', record.data['Bio Link']);\n          }\n\n          // this is the node with the template\n          var $el = $('.fl-page-content-wrapper').find('.content');\n\n          // read the template from the node\n          var htmlTemplate = $el\n            .html()\n            .replace(/\\(\\(%/g, '{{{')\n            .replace(/\\%\\)\\)/g, '}}}')\n            .replace(/\\(%/g, '{{')\n            .replace(/\\%\\)/g, '}}');\n\n          // compile the template string into a handlebars template\n          var compiledTemplate = Handlebars.compile(htmlTemplate);\n\n          // compile the handlebars template to a html string\n          var html = compiledTemplate(record.data);\n\n          // replace the initial template with the compiled string\n          $el.html(html);\n\n          $el\n            .find('.panel-collapse .container:empty')\n            .parents('.panel')\n            .remove();\n          $el.fadeIn();\n          $('.fl-page-content-wrapper').fadeIn();\n          $('body').attr('style', 'display: block !important');\n          $('.content').removeClass('invisible');\n        } else {\n          Fliplet.UI.Toast({\n            type: 'minimal',\n            title: 'Warning!',\n            message: `User with GUID ${guid} is not found in \"${DS.USERS}\" data source`\n          });\n        }\n      })\n      .catch(function(error) {\n        console.log(error);\n        if (!Fliplet.Env.get('interact')) {\n          $('.fl-page-content-wrapper').html(\n            '\u003Ccenter\u003E\u003Ch1\u003ESystem Does not recognise this user\u003C/h1\u003E\u003C/center\u003E'\n          );\n          $('.fl-page-content-wrapper').fadeIn();\n          $('.content').removeClass('invisible');\n        }\n        Fliplet.UI.Toast.error(error, {\n          message: 'No data found'\n        });\n      });\n  });\n}\n\nfunction renderAvatar(record) {\n  const ImagePath = record.data.Image;\n\n  function isString(url) {\n    return typeof url === 'string';\n  }\n\n  function isMediaURL(url) {\n    return url.includes('.com');\n  }\n\n  if (isString(ImagePath)) {\n    if (isMediaURL(ImagePath)) {\n      $('.image img').attr('src', Fliplet.Media.authenticate(ImagePath));\n    } else {\n      return Fliplet.Media.Folders.search({ name: ImagePath }).then(function(mediaFiles) {\n        // Assuming the search returns an array of media files with matching names\n\n        if (mediaFiles.length \u003E 0) {\n          $('.image img').attr('src', Fliplet.Media.authenticate(mediaFiles[0].url));\n        } else {\n          console.error('Media file not found:', ImagePath);\n        }\n      });\n    }\n  } else {\n    $('.image img').attr('src', Fliplet.Media.authenticate(ImagePath[0]));\n  }\n}\n\nfunction downloadVcf(data) {\n  // build data url\n  var url = 'data:text/x-vcard;charset=utf-8,' + encodeURIComponent(data);\n\n  // ask the browser to download it\n  document.location.href = url;\n}\n\n\n$(document).on('click', '.atc input', function() {\n  let MutipleSupporteArray = [\n    'email',\n    'workEmail',\n    'otherEmail',\n    'cellPhone',\n    'pagerPhone',\n    'homePhone',\n    'workPhone',\n    'homeFax',\n    'workFax',\n    'otherPhone'\n  ];\n  let SocialApps = ['facebook', 'linkedIn', 'twitter', 'flickr', 'instagram'];\n  let AddressFields = [\n    'homeAddress.label',\n    'homeAddress.street',\n    'homeAddress.city',\n    'homeAddress.stateProvince',\n    'homeAddress.postalCode',\n    'homeAddress.countryRegion',\n    'workAddress.label',\n    'workAddress.street',\n    'workAddress.city',\n    'workAddress.stateProvince',\n    'workAddress.postalCode',\n    'workAddress.countryRegion'\n  ];\n  var vCard = vCardLib();\n  let myPromise = Promise.resolve();\n\n  return Fliplet.DataSources.connectByName(DS.vcard).then(function(connection) {\n    return connection.find().then(function(records) {\n      if (records.length \u003E 0) {\n        _.forEach(records, function(value) {\n          const VCardColumn = value.data.VCard;\n          const VCardLabel = value.data['VCard Label'];\n          const userColumn = value.data['User Data'];\n          const userValue = RecordData[userColumn];\n          \n          if (VCardColumn == 'birthday' || VCardColumn == 'anniversary') {\n            vCard[VCardColumn] = userValue ? new Date(userValue) : '';\n          } else if (MutipleSupporteArray.includes(VCardColumn)) {\n            \n            console.log('if MutipleSupporteArray.includes(VCardColumn): ', MutipleSupporteArray.includes(VCardColumn), VCardColumn, userValue, 'includes email: ', VCardColumn.includes('email'));\n            \n            // Handle phone numbers and emails with their labels\n            if (userValue) {\n              if (VCardColumn.includes('Phone')) {\n                // For phone numbers\n                if (VCardColumn.includes('cell')) {\n                  //vCard.cellPhone = userValue;\n                  if (VCardLabel) {\n                    vCard.cellPhone_type = VCardLabel;\n                    /*vCard.cellPhone = {\n                      value: userValue,\n                      type: VCardLabel\n                    };*/\n                    console.log('custom cell phone label: ', VCardLabel);\n                  }\n                } else if (VCardColumn.includes('pager')) {\n                  //vCard.pagerPhone = userValue;\n                } else if (VCardColumn.includes('home')) {\n                  //vCard.homePhone = userValue;\n                } else if (VCardColumn.includes('work')) {\n                  //vCard.workPhone = userValue;\n                } else if (VCardColumn.includes('Fax')) {\n                  /*if (VCardColumn.includes('home')) {\n                    vCard.homeFax = userValue;\n                  } else {\n                    vCard.workFax = userValue;\n                  }*/\n                } else {\n                  //vCard.otherPhone = userValue;\n                }\n              } else if (VCardColumn.includes('email') || VCardColumn.includes('Email')) {\n                // For emails\n                if (VCardColumn === 'email') {\n                  vCard.email = userValue;\n                } else if (VCardColumn === 'workEmail') {\n                  vCard.workEmail = userValue;\n                } else {\n                  vCard.otherEmail = userValue;\n                }\n              }\n            }\n          } else if (SocialApps.includes(VCardColumn)) {\n            /*vCard.socialUrls[VCardColumn] = userValue || '';\n            if (VCardLabel) {\n              vCard.socialUrls[VCardColumn + '_label'] = VCardLabel;\n            }*/\n          } else if (AddressFields.includes(VCardColumn)) {\n            let AddressArray = VCardColumn.split('.');\n            const addressType = AddressArray[0];\n            const addressField = AddressArray[1];\n\n            // Initialize the address object if it doesn't exist\n            if (!vCard[addressType]) {\n              //vCard[addressType] = getMailingAddress();\n            }\n\n            // Set the address field\n            if (addressField === 'label' && VCardLabel) {\n              //vCard[addressType].label = VCardLabel;\n            } else {\n              vCard[addressType][addressField] = userValue || '';\n            }\n          } else if (VCardColumn == 'photo') {\n            if (userValue) {\n              let extension = userValue[0].split(/[#?]/)[0].split('.').pop().trim();\n              \n              myPromise = new Promise((resolve, reject) =\u003E {\n                fetch(Fliplet.Media.authenticate(userValue[0]))\n                  .then(response =\u003E response.blob())\n                  .then(blob =\u003E {\n                    const reader = new FileReader();\n                    reader.onloadend = function() {\n                      const base64 = reader.result.split(',')[1];\n                      resolve(base64);\n                      vCard.photo.embedFromString(base64, 'image/' + extension);\n                    };\n                    reader.readAsDataURL(blob);\n                  });\n              });\n            }\n          } else {\n            // For all other fields\n            /*vCard[VCardColumn] = userValue || '';\n            if (VCardLabel) {\n              vCard[VCardColumn + '_label'] = VCardLabel;\n            }*/\n          }\n        });\n\n        myPromise.then(() =\u003E {\n          let VCFCompiledText = vCard.getFormattedString();\n          console.log('VCFCompiledText: ', VCFCompiledText);\n          downloadVcf(VCFCompiledText);\n        });\n      }\n    });\n  });\n});",
        "customCSS": "[data-name=\"Accordion Heading\"] ~ [data-name=\"Accordion Heading\"] .collapse-start{width:100%}.content.invisible{opacity:0;transition:ease 0.25s}#icons{text-align:center}#icons span{color:#345091;font-size:150%;position:relative;overflow:hidden;border-radius:16px;display:flex !important;align-items:center;justify-content:center;cursor:pointer}#icons span.hidden{display:none !important}#icons span::after{content:'';display:block;position:absolute;top:0;bottom:0;left:0;right:0;background-color:#345091;opacity:10%}.dynamic-container{width:100%;max-width:600px;margin:0 auto}.image span{width:100%;height:100%}.image span img{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}\n",
        "customSCSS": "[data-name=\"Accordion Heading\"] ~ [data-name=\"Accordion Heading\"] .collapse-start{\n  width: 100%;\n}\n.content.invisible{\n  opacity: 0;\n  transition: ease 0.25s;\n}\n#icons{\n  text-align: center;\n  span{\n    color: $highlightColor;\n    font-size: 150%;\n    position: relative;\n    overflow: hidden;\n    border-radius: 16px;\n    display: flex !important;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    &.hidden{\n      display: none !important;\n    }\n    &::after{\n      content:'';\n      display: block;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background-color: $highlightColor;\n      opacity: 10%;\n    }\n  }\n}\n.dynamic-container {\n  width: 100%;\n  max-width: 600px;\n  margin: 0 auto;\n}\n.image span{\n  width: 100%;\n  height: 100%;\n  img{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n  }\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951628, 30951629, 30951630, 30951631, 30951632, 30951633, 30951634, 30951635, 30951636, 30951637, 30951638, 30951639, 30951640, 30951641, 30951642, 30951643, 30951644, 30951645, 30951646, 30951647, 30951648, 30951649, 30951650, 30951651, 30951652]
      },
      "updatedAt": "2025-07-02T16:49:41.212Z",
      "slug": "public-profile-1l7lf"
    },
    {
      "id": 1744568,
      "isLayout": false,
      "layout": "{{{widget 30951699}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1203000,
      "layoutOrder": 8,
      "order": 8,
      "sectionId": null,
      "title": "Attendees & Speakers",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays a list of both Speakers (at the top) and Attendees (below). You can manage the layout and functionality using the List from Data Source settings. By default, users can edit their own information here, but this can be disabled along with other standard options in the List from Data Source settings.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is tied to the Attendees &amp; User List data source, which controls the displayed user information.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen shows a list of Speakers at the top and Attendees below. Users can view and edit their own information unless this option is disabled.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E To link a speaker to a session, app admins must add the speaker's email address (which must match the one in their user data) in a comma-separated list in the \"Speakers\" field when editing a session via the admin menu. Speakers are then associated with their respective sessions on the Agenda screen.\u003C/p\u003E"
        },
        "customJS": "/** @format  */\nlet webAppUrl = '';\nlet QRCode, currentUser;\n\nconsole.log(Fliplet.Navigate.query);\n\n$(function () {\n\tif (Fliplet.Navigate.query.sessionTitle) {\n\t\tconsole.log('Session title found, showing session-specific view');\n\t\t$('.speakerTitle').css('cssText', 'display: none !important');\n\t\t$('.speakersList').css('cssText', 'display: none !important');\n\t\t$('.screenTitle h1').text(Fliplet.Navigate.query.sessionTitle);\n\t\t$('.session-button').css('cssText', 'display: block !important');\n\t} else {\n\t\tconsole.log('No session title, showing default view');\n\t\t$('.speakerTitle').css('cssText', 'display: block !important');\n\t\t$('.speakersList').css('cssText', 'display: block !important');\n\t\t$('.screenTitle h1').text('Attendees & Speakers');\n\t\t$('.session-button').css('cssText', 'display: none !important');\n\t}\n\n\tconsole.log('.speakerTitle element:', $('.speakerTitle'));\n\tconsole.log('.speakersList element:', $('.speakersList'));\n\tconsole.log('.session-button element:', $('.session-button'));\n});\n\n//add session of a speaker to the record\nFliplet.Hooks.on('flListDataBeforeGetData', function (data) {\n\tdata.config.beforeShowDetails = function (options) {\n\t\tQRCode = encodeURIComponent(options.data.originalData.Email);\n\t\tvar loadTimeout = setTimeout(function () {\n\t\t\tFliplet.UI.Toast({\n\t\t\t\tmessage: 'Loading...',\n\t\t\t\tduration: false\n\t\t\t});\n\t\t}, 2000);\n\t\treturn Fliplet.DataSources.connectByName(DS.agenda)\n\t\t\t.then(function (connection) {\n\t\t\t\treturn connection.find({\n\t\t\t\t\twhere: {\n\t\t\t\t\t\tSpeakers: { $regex: options.data.originalData.Email, $options: 'i' }\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(function (value) {\n\t\t\t\tconsole.log(value);\n\t\t\t\t_.set(\n\t\t\t\t\toptions.data,\n\t\t\t\t\t'originalData.Agenda',\n\t\t\t\t\t_.map(value, function (record) {\n\t\t\t\t\t\treturn record.data;\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\tFliplet.UI.Toast.dismiss();\n\t\t\t});\n\t};\n  \n\tdata.config.afterShowDetails = function (options) {\n\t\t//user can't book a meeting with himself\n\t\tif (options.data.originalData.Email == currentUser.Email){\n\t\t\t$(document).find('.book_meeting').remove();\n\t\t}\n\t};\n  \n\tgetUser().then(user =\u003E {\n\t\tif (user){\n\t\t\tcurrentUser = user;\n\t\t}\n\t});\n});\n\n//listener which navigates to the agenda screen\n//target: .media\n$(document).on('click', '.media', function () {\n\tvar sessionID = $(this).data('name');\n\n\tFliplet.Navigate.screen(SCREENS.agenda, {\n\t\tquery:\n\t\t\t'?dynamicListOpenColumn=' +\n\t\t\tencodeURIComponent('Session ID') +\n\t\t\t'&dynamicListOpenValue=' +\n\t\t\tsessionID\n\t});\n});\n\n//QR code button is clicked\n$(document).on('click', '.qr-code-btn', function(e) {\n\tlet AppScreens = Fliplet.Env.get('appPages');\n\tlet SlugId = _.find(AppScreens, function(obj) {\n\t\tif (obj.title == SCREENS.publicProfile) {\n\t\t\treturn true;\n\t\t}\n\t});\n\n\tif (!SlugId){\n\t\tFliplet.UI.Toast(`Screen with name \"${SCREENS.publicProfile}\" is not found`);\n\t\treturn false;\n\t}\n  \n\tif (!webAppUrl) {\n\t\tconst public_slug = Fliplet.App.getPublicSlugForPage(SlugId.id);\n\t\tconst url_without_id = public_slug.indexOf('?email') \u003E -1 ? public_slug.split('?email')[0] : public_slug.indexOf('&email') \u003E -1 ? public_slug.split('&email')[0] : public_slug;\n\t\t\n\t\twebAppUrl = url_without_id.indexOf('?') \u003E -1 ? url_without_id + '&email=' + QRCode : url_without_id + '?email=' + QRCode;\n\t} else {\n\t\tconst url_without_id = webAppUrl.indexOf('?email') \u003E -1 ? webAppUrl.split('?email')[0] : webAppUrl.indexOf('&email') \u003E -1 ? webAppUrl.split('&email')[0] : webAppUrl;\n\t\t\n\t\twebAppUrl = url_without_id.indexOf('?') \u003E -1 ? url_without_id + '&email=' + QRCode : url_without_id + '?email=' + QRCode;\n\t}\n\n\treturn Fliplet.Barcode.show(webAppUrl);\n});\n\n//Book a Meeting button is clicked\n$(document).on('click', '.book_meeting', function(e){\n\te.preventDefault();\n\tconst email = $(this).attr('data-email');\n\tFliplet.Navigate.screen(SCREENS.bookMeeting, { query: `?email=${email}` });\n});",
        "customCSS": ".new-small-card-list-container .small-card-list-image.no-image{display:block}.new-small-h-card-list-container .small-h-card-list-detail-name,.new-small-card-list-container .small-card-list-name{color:#345091}.new-small-card-list-container .small-card-list-detail-close-btn,.new-small-h-card-list-container .small-h-card-list-detail-close-btn.open{color:#333}.right-chevron{float:right}.media-left,.media-right,.media-body{border-bottom:1px solid #0000004d}.time{padding-bottom:10px}.small-card-detail-overlay .small-card-list-detail-button-image,.small-card-detail-overlay .small-card-list-detail-button-text,.small-h-card-detail-overlay .small-h-card-list-detail-button-image,.small-h-card-detail-overlay .small-h-card-list-detail-button-text{color:#345091 !important}.new-small-card-list-container .small-card-list-item{width:100%}@media screen and (min-width: 1000px){.new-small-card-list-container .small-card-list-item{width:47%}}.new-small-card-list-container.ready .small-card-list-wrapper{display:flex;flex-wrap:wrap;justify-content:space-between}.small-card-list-detail-buttons-wrapper a{text-decoration:none}.my-qr-btn{font-size:15px !important;position:absolute;right:0;padding-bottom:5px;margin-top:-5px}.my-qr-btn i{padding-right:5px}\n",
        "customSCSS": ".new-small-card-list-container .small-card-list-image.no-image{\n  display: block;\n}\n\n.new-small-h-card-list-container .small-h-card-list-detail-name, \n.new-small-card-list-container .small-card-list-name {\n  color: $headingTwoColor;\n}\n.new-small-card-list-container .small-card-list-detail-close-btn,\n.new-small-h-card-list-container .small-h-card-list-detail-close-btn.open{\n  color: #333;\n}\n.right-chevron{\n  float: right;\n}\n\n.media-left, .media-right, .media-body {\n    border-bottom: 1px solid #0000004d;\n}\n\n.time {\npadding-bottom: 10px;\n}\n\n.small-card-detail-overlay .small-card-list-detail-button-image, .small-card-detail-overlay .small-card-list-detail-button-text, .small-h-card-detail-overlay .small-h-card-list-detail-button-image, .small-h-card-detail-overlay .small-h-card-list-detail-button-text{\n  color: $linkColor!important;\n}\n\n.new-small-card-list-container .small-card-list-item {\n  width: 100%;\n}\n@media screen and (min-width:1000px) {\n  .new-small-card-list-container .small-card-list-item {\n    width: 47%;\n  }\n}\n.new-small-card-list-container.ready .small-card-list-wrapper {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n}\n\n.small-card-list-detail-buttons-wrapper a{\n  text-decoration: none;\n}\n\n.my-qr-btn{\n  font-size: 15px!important;\n  position: absolute;\n  right: 0;\n  padding-bottom: 5px;\n  margin-top: -5px;\n  i{\n    padding-right: 5px;\n  }\n}",
        "widgetInstancesInUse": [30951697, 30951698, 30951699, 30951700, 30951701, 30951702, 30951703, 30951704]
      },
      "updatedAt": "2025-07-02T16:49:41.744Z",
      "slug": "attendees-speakers-1l7lo"
    },
    {
      "id": 1744589,
      "isLayout": false,
      "layout": "{{{widget 30951868}}}\n\n\u003Cdiv class=\"modal fade cd-modal\" id=\"confirm_rejection\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\"\u003E\n  \u003Cdiv class=\"modal-dialog modal-dialog-centered\" role=\"document\"\u003E\n    \u003Cdiv class=\"modal-content\"\u003E\n      {{{widget 30951869}}}\n    \u003C/div\u003E\n  \u003C/div\u003E\n\u003C/div\u003E",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1683575,
      "layoutOrder": 9,
      "order": 9,
      "sectionId": null,
      "title": "My Meetings",
      "settings": {
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let currentUser, allMeetings, form, conversionRequired, appSettings, userTimezone, originalTimezone;\nconst instance = Fliplet.Notifications.init({});\nconst reasonFormField = 'Reason';\n\nconst bookedByTemplate = {\n  'Accepted': {\n    'Email': {\n      to: [{ email: \"{{bookedBy.[Email]}}\", name: \"{{bookedBy.[First Name]}} {{bookedBy.[Last Name]}}\", type: \"to\" }],\n      subject: \"Your meeting has been accepted!\",\n      html: `\u003Cp\u003EYour meeting request with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} has been \u003Cstrong\u003Eaccepted\u003C/strong\u003E.\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E\n      \u003Cp\u003EAn invitation has been attached to your calendar.\u003C/p\u003E`\n    },\n    'Immediate': {\n      'Push': {\n        title: 'Meeting accepted!',\n        body: `Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} is confirmed for {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      },\n      'In-app': {\n        title: 'Meeting accepted!',\n        message: `Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} is confirmed for {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      }\n    },\n    'Scheduled': {\n      'Push': {\n        title: 'Upcoming meeting reminder',\n        body: `Reminder: Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} is starting soon at {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      },\n      'In-app': {\n        title: 'Upcoming meeting reminder',\n        message: `Reminder: Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} is starting soon at {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      }\n    }\n  },\n  'Rejected': {\n    'Email': {\n      to: [{ email: \"{{bookedBy.[Email]}}\", name: \"{{bookedBy.[First Name]}} {{bookedBy.[Last Name]}}\", type: \"to\" }],\n      subject: \"Your meeting request was declined\",\n      html: `\u003Cp\u003EUnfortunately, your meeting request with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} was \u003Cstrong\u003Edeclined\u003C/strong\u003E.\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E\n\t\t\t\u003Cp\u003E\u003Cstrong\u003EReason:\u003C/strong\u003E {{meeting.[Reason]}}\u003C/p\u003E\n      \u003Cp\u003EYou may try to reschedule or contact the attendee for more information.\u003C/p\u003E`\n    },\n    'Immediate': {\n      'Push': {\n        title: 'Meeting declined',\n        body: `Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} was declined.`\n      },\n      'In-app': {\n        title: 'Meeting declined',\n        message: `Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} was declined.`\n      }\n    }\n  },\n  'Deleted': {\n    'Email': {\n      to: [{ email: \"{{bookedBy.[Email]}}\", name: \"{{bookedBy.[First Name]}} {{bookedBy.[Last Name]}}\", type: \"to\" }],\n      subject: \"Meeting cancelled\",\n      html: `\u003Cp\u003EA meeting has been \u003Cstrong\u003Ecancelled\u003C/strong\u003E.\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EReason:\u003C/strong\u003E {{meeting.[Reason]}}\u003C/p\u003E\n      \u003Cp\u003EThe meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} has been canceled.\u003C/p\u003E`\n    },\n    'Immediate': {\n      'Push': {\n        title: 'Meeting cancelled',\n        body: `Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}} has been cancelled.`\n      },\n      'In-app': {\n        title: 'Meeting cancelled',\n        message: `Your meeting with {{bookedWith.[First Name]}} {{bookedWith.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}} has been cancelled.`\n      }\n    }\n  }\n};\n\nconst bookedWithTemplates = {\n  'Accepted': {\n    'Email': {\n      to: [\n        { email: \"{{bookedWith.[Email]}}\", name: \"{{bookedWith.[First Name]}} {{bookedWith.[Last Name]}}\", type: \"to\" }\n      ],\n      subject: \"You have a new meeting!\",\n      html: `\u003Cp\u003E{{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} has scheduled a meeting with you and it has been \u003Cstrong\u003Econfirmed\u003C/strong\u003E.\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E\n      \u003Cp\u003EAn invitation has been attached to your calendar.\u003C/p\u003E`\n    },\n    'Immediate': {\n      'Push': {\n        title: 'New meeting confirmed!',\n        body: `You have a confirmed meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      },\n      'In-app': {\n        title: 'New meeting confirmed!',\n        message: `You have a confirmed meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      }\n    },\n    'Scheduled': {\n      'Push': {\n        title: 'Upcoming meeting reminder',\n        body: `Reminder: Your meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} is starting soon at {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      },\n      'In-app': {\n        title: 'Upcoming meeting reminder',\n        message: `Reminder: Your meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} is starting soon at {{meeting.[Date]}}, {{meeting.[Time]}}.`\n      }\n    }\n  },\n  'Rejected': {\n    'Email': {\n      to: [\n        { email: \"{{bookedWith.[Email]}}\", name: \"{{bookedWith.[First Name]}} {{bookedWith.[Last Name]}}\", type: \"to\" }\n      ],\n      subject: \"Meeting request declined\",\n      html: `\u003Cp\u003E{{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} requested a meeting with you, but you have \u003Cstrong\u003Edeclined\u003C/strong\u003E the invitation.\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E\n\t\t\t\u003Cp\u003E\u003Cstrong\u003EReason:\u003C/strong\u003E {{meeting.[Reason]}}\u003C/p\u003E`\n    },\n    'Immediate': {\n      'Push': {\n        title: 'Meeting declined',\n        body: `You have declined the meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}}.`\n      },\n      'In-app': {\n        title: 'Meeting declined',\n        message: `You have declined the meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}}.`\n      }\n    }\n  },\n  'Deleted': {\n    'Email': {\n      to: [\n        { email: \"{{bookedWith.[Email]}}\", name: \"{{bookedWith.[First Name]}} {{bookedWith.[Last Name]}}\", type: \"to\" }\n      ],\n      subject: \"Meeting cancelled\",\n      html: `\u003Cp\u003EA meeting has been \u003Cstrong\u003Ecancelled\u003C/strong\u003E.\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E\n      \u003Cp\u003E\u003Cstrong\u003EReason:\u003C/strong\u003E {{meeting.[Reason]}}\u003C/p\u003E\n      \u003Cp\u003EThe meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} has been canceled.\u003C/p\u003E`\n    },\n    'Immediate': {\n      'Push': {\n        title: 'Meeting cancelled',\n        body: `Your meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}} has been cancelled.`\n      },\n      'In-app': {\n        title: 'Meeting cancelled',\n        message: `Your meeting with {{bookedBy.[First Name]}} {{bookedBy.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}} has been cancelled.`\n      }\n    }\n  }\n};\n\nsetEditMode(); //to show rejection modal in edit mode\n\nFliplet.Hooks.on('flListDataBeforeGetData', function(options){\n  return getUser().then(user =\u003E {\n    currentUser = user;\n    \n    options.config.getData = function() {\n      return Fliplet.DataSources.connectByName(DS.meetingsLogs).then(function(connection) {\n        return connection.find({\n          where: {\n            $or: [\n              { 'Booked by': user.Email },\n              { 'Booked with': user.Email }\n            ]\n          },\n          join: {\n            bookedWith: {\n              dataSourceName: DS.users,\n              on: {\n                'data.Booked with': 'data.Email'\n              }\n            }\n          }\n        });\n      });\n    };\n  });\n});\n\nFliplet.Hooks.on('flListDataAfterGetData', function(options){\n  allMeetings = options.records;\n  \n  // Collect unique emails from 'Booked by' and 'Booked with'\n  const emailsSet = new Set();\n  options.records.forEach(record =\u003E {\n    if (record.data['Booked by']) emailsSet.add(record.data['Booked by']);\n    if (record.data['Booked with']) emailsSet.add(record.data['Booked with']);\n    record.data['Requested by'] = record.data['Booked by'] === currentUser.Email ? 'Me' : 'Someone else'\n  });\n  \n  \n  const uniqueEmails = Array.from(emailsSet);\n\n  // Fetch all user records for these emails\n  return TimeConversion.getAppSetup().then(function(settings) {\n    appSettings = settings;\n    conversionRequired = appSettings && TimeConversion.checkIfConversionIsRequired(appSettings);\n    \n    if (conversionRequired) {\n      originalTimezone = appSettings.data['Event Timezone'];\n      userTimezone = TimeConversion.getCurrentUserTimezone();\n    }\n    \n    return Fliplet.DataSources.connectByName(DS.users);\n  }).then(function(connection) {\n    return connection.find({\n      where: { Email: { $in: uniqueEmails } }\n    });\n  }).then(function(users) {\n    // Map emails to user records for quick lookup\n    const userByEmail = {};\n    users.forEach(user =\u003E {\n      userByEmail[user.data.Email] = user;\n    });\n\n    // Attach Attendees object to each record\n    options.records.forEach(record =\u003E {\n      record.data.Attendees = {\n        'Booked with user': userByEmail[record.data['Booked with']] || null,\n        'Booked by user': userByEmail[record.data['Booked by']] || null\n      };\n      if (record.data.Status == 'Pending' && record.data['Booked by'] !== currentUser.Email){\n        record.data.showButtons = true;\n      }\n      if (record.data.Status === 'Accepted' && record.data['Booked by'] !== currentUser.Email) {\n        record.data.cancelMtg = true;\n      }\n      if (record.data['Booked by'] === currentUser.Email){\n        record.data['userCanDelete'] = true;\n      }\n      const bookedWithUserName = `${record.data.Attendees['Booked with user'].data['First Name']} ${record.data.Attendees['Booked with user'].data['Last Name']}`;\n      const bookedByUserName = `${record.data.Attendees['Booked by user'].data['First Name']} ${record.data.Attendees['Booked by user'].data['Last Name']}`;\n      \n      // Show who made the request - \"You\" if current user, otherwise their name\n      if (record.data['Booked by'] === currentUser.Email) {\n        record.data['Invited By'] = 'Invited by You';\n        record.data['Second Attendee'] = bookedWithUserName;\n      } else {\n        record.data['Invited By'] = `Invited by ${bookedByUserName}`;\n        record.data['Second Attendee'] = bookedByUserName;\n      }\n      \n      //record.data['Second Attendee Email'] = `${record.data['Booked with'] === currentUser.Email ? record.data.Attendees['Booked by user'].data['Email'] : record.data.Attendees['Booked with user'].data['Email']}`;\n\n      // Convert timezone if required\n      if (conversionRequired) {\n        const converted = TimeConversion.convertToUserTimezone(\n          record.data.Date,\n          record.data['Start Time'],\n          record.data['End Time'],\n          originalTimezone,\n          userTimezone\n        );\n\n        record.data._originalDate = record.data.Date;\n        record.data._originalStartTime = record.data['Start Time'];\n        record.data._originalEndTime = record.data['End Time'];\n        \n        record.data.Date = converted.date;\n        record.data['Start Time'] = converted.startTime;\n        record.data['End Time'] = converted.endTime;\n      }\n    });\n\n    if (conversionRequired) {\n      allMeetings = options.records;\n    }\n  });\n});\n\nFliplet.Hooks.on('flListDataBeforeRenderFilters', function(options){\n  console.log('flListDataBeforeRenderFilters', options.filters);\n});\n\n\n\n// Accept meeting handler\n$(document).on('click', '.accept', function() {\n  const meetingId = $(this).closest('.small-card-detail-wrapper').data('entry-id');\n  const meeting = allMeetings.find(m =\u003E m.id === meetingId);\n\n  // Prepare template data\n  const bookedByUser = meeting.data.Attendees['Booked by user'];\n  const bookedWithUser = meeting.data.Attendees['Booked with user'];\n\n  // Check for valid emails before proceeding\n  if (!bookedByUser || !bookedByUser.data.Email || !bookedWithUser || !bookedWithUser.data.Email) {\n    Fliplet.UI.Toast('Cannot send notifications: missing attendee email(s).');\n    return;\n  }\n\n  const date = meeting.data.Date;\n  const time = `${meeting.data['Start Time']} - ${meeting.data['End Time']}`;\n  const templateData = {\n    bookedBy: bookedByUser.data,\n    bookedWith: bookedWithUser.data,\n    meeting: {\n      Date: date,\n      Time: time\n    }\n  };\n\n  getNotificationPreferencesForEmails([bookedByUser.data.Email, bookedWithUser.data.Email]).then(prefs =\u003E {\n    const bookerPrefs = prefs[bookedByUser.data.Email] || [];\n    const bookeePrefs = prefs[bookedWithUser.data.Email] || [];\n\n    const bookerEmail = compileMessage(bookedByTemplate.Accepted.Email, templateData);\n    const bookeeEmail = compileMessage(bookedWithTemplates.Accepted.Email, templateData);\n    const icsContent = generateICS(meeting);\n    bookerEmail.attachments = [{\n      name: 'invite.ics',\n      type: 'text/calendar',\n      encoding: 'base64',\n      content: Fliplet.Encode.base64(icsContent),\n    }];\n    bookeeEmail.attachments = [{\n      name: 'invite.ics',\n      type: 'text/calendar',\n      encoding: 'base64',\n      content: Fliplet.Encode.base64(icsContent)\n    }];\n\n    const emailPromise = (bookerPrefs.includes('Email') || bookeePrefs.includes('Email'))\n      ? sendEmails(bookerEmail, bookeeEmail, bookerPrefs, bookeePrefs)\n      : Promise.resolve();\n\n    const pushPromise = (bookerPrefs.includes('Push') || bookerPrefs.includes('In-App') ||\n                         bookeePrefs.includes('Push') || bookeePrefs.includes('In-App'))\n      ? sendPushInapp(meeting, templateData, 'Accepted', bookerPrefs, bookeePrefs)\n      : Promise.resolve();\n\n      return emailPromise.then(() =\u003E {\n        console.log('Emails completed, now running push notifications');\n        return pushPromise.then(() =\u003E {\n          console.log('Push completed');\n          return Promise.resolve(true);\n        });\n      });\n  })\n  .then(() =\u003E {\n    // Update the meeting's status to 'Accepted' after all notifications were sent\n    return Fliplet.DataSources.connectByName(DS.meetingsLogs).then(function(connection) {\n      return connection.update(meeting.id, {\n        'Status': 'Accepted'\n      });\n    });\n  })\n  .then(() =\u003E {\n    Fliplet.UI.Toast('Meeting accepted successfully');\n    location.reload();\n  })\n  .catch((err) =\u003E {\n    console.error('Error processing meeting acceptance:', err);\n    Fliplet.UI.Toast('Error accepting meeting');\n  });\n});\n\n//close detailed view after Reject button is clicked to show modal\n$(document).on('click', '.reject, .cancel-button', function(e){\n  e.preventDefault();\n  \n  // Debug: Log which button was clicked and its context\n  const buttonClass = $(this).hasClass('reject') ? 'reject' : 'cancel-button';\n  console.log(`${buttonClass} button clicked`);\n  console.log('Button element:', this);\n  console.log('Button parent:', $(this).parent());\n  console.log('Closest wrapper search result:', $(this).closest('.small-card-detail-wrapper'));\n  \n  // Try multiple strategies to find the meeting ID\n  let meetingId = $(this).closest('.small-card-detail-wrapper').data('entry-id');\n  \n  // Fallback: if not found in closest wrapper, try other approaches\n  if (!meetingId) {\n    console.log('Meeting ID not found in closest wrapper, trying alternative methods...');\n    \n    // Try finding via data attribute on the button itself or its parents\n    meetingId = $(this).data('entry-id') || \n                $(this).closest('[data-entry-id]').data('entry-id') ||\n                $(this).parents('[data-entry-id]').first().data('entry-id');\n    \n    console.log('Alternative search result:', meetingId);\n  }\n  \n  // Final fallback: search document (original approach)\n  if (!meetingId) {\n    console.log('Still no meeting ID found, using document search fallback...');\n    meetingId = $(document).find('.small-card-detail-wrapper').data('entry-id');\n    console.log('Document search result:', meetingId);\n  }\n  \n  console.log('Final meeting ID:', meetingId);\n  console.assert(meetingId, 'Meeting ID should be found by one of the methods');\n  \n  $(document).find('.small-card-detail-overlay-close').trigger('click');\n  $(document).find('.confirm_rejection_btn').attr('data-entry-id', meetingId);\n  \n  console.log('Set data-entry-id on confirm_rejection_btn:', meetingId);\n});\n\n//rejection form change event\nFliplet.FormBuilder.get().then(function (Form) {\n  form = Form;\n  form.field(reasonFormField).change(function (val) {\n    form.field('Other reason').toggle(val === 'Other reason');\n    form.field('Other reason').instance.required = val === 'Other reason';\n  });\n});\n\n//clear selected reason when modal is closed \n$(\"#confirm_rejection\").on('hide.bs.modal', function(){\n  form.field(reasonFormField).set('');\n  form.field('Other reason').set('');\n});\n\n//when confirm button is clicked in modal -\u003E trigger form\n$(document).on('click', '.confirm_rejection_btn', function(e){\n  e.preventDefault();\n  form.instance.onSubmit();\n});\n\n//when rejection reason is confirmed\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  const meetingId = $(document).find('.confirm_rejection_btn').data('entry-id');\n  const meeting = allMeetings.find(m =\u003E m.id === meetingId);\n\tconsole.log(allMeetings);\n  console.log(meetingId);\n  // Prepare template data\n  const bookedByUser = meeting.data.Attendees['Booked by user'];\n  const bookedWithUser = meeting.data.Attendees['Booked with user'];\n  \n  // Check for valid emails before proceeding\n  if (!bookedByUser || !bookedByUser.data.Email || !bookedWithUser || !bookedWithUser.data.Email) {\n    Fliplet.UI.Toast('Cannot send notifications: missing attendee email(s).');\n    return Promise.reject('Missing attendee email(s).');\n  }\n\n  const date = meeting.data.Date;\n  const time = `${meeting.data['Start Time']} - ${meeting.data['End Time']}`;\n  const reasonDropdownValue = form.field(reasonFormField).get();\n  const reason = reasonDropdownValue == 'Other reason' ? form.field('Other reason').get() : reasonDropdownValue;\n  \n  const templateData = {\n    bookedBy: bookedByUser.data,\n    bookedWith: bookedWithUser.data,\n    meeting: {\n      Date: date,\n      Time: time,\n      Reason: reason\n    }\n  };\n\n  // Both reject and cancel buttons use the same 'Rejected' logic\n  const actionType = 'Rejected';\n  const toastSuccess = 'Meeting declined successfully';\n  const toastError = 'Error declining meeting';\n\n  return getNotificationPreferencesForEmails([bookedByUser.data.Email, bookedWithUser.data.Email]).then(prefs =\u003E {\n    const bookerPrefs = prefs[bookedByUser.data.Email] || [];\n    const bookeePrefs = prefs[bookedWithUser.data.Email] || [];\n\n    const bookerEmail = compileMessage(bookedByTemplate[actionType].Email, templateData);\n    const bookeeEmail = compileMessage(bookedWithTemplates[actionType].Email, templateData);\n\n    const emailPromise = (bookerPrefs.includes('Email') || bookeePrefs.includes('Email'))\n      ? sendEmails(bookerEmail, bookeeEmail, bookerPrefs, bookeePrefs)\n      : Promise.resolve();\n\n    const pushPromise = (bookerPrefs.includes('Push') || bookerPrefs.includes('In-App') ||\n                         bookeePrefs.includes('Push') || bookeePrefs.includes('In-App'))\n      ? sendPushInapp(meeting, templateData, actionType, bookerPrefs, bookeePrefs)\n      : Promise.resolve();\n\n      return emailPromise.then(() =\u003E {\n        console.log('Emails completed, now running push notifications');\n        return pushPromise.then(() =\u003E {\n          console.log('Push completed');\n          return Promise.resolve(true);\n        });\n      });\n  })\n  .then(() =\u003E {\n    // Update the meeting's status to 'Rejected' after all notifications were sent\n    return Fliplet.DataSources.connectByName(DS.meetingsLogs).then(function(connection) {\n      return connection.update(meeting.id, {\n        'Status': 'Rejected'\n      });\n    });\n  })\n  .then(() =\u003E {\n    Fliplet.UI.Toast(toastSuccess);\n    location.reload();\n  })\n  .catch((err) =\u003E {\n    console.error(`Error processing meeting ${actionType}:`, err);\n    Fliplet.UI.Toast(toastError);\n  });\n});\n\n// Generate ICS file content\nfunction generateICS(meeting) {\n  const date = meeting.data._originalDate || meeting.data.Date;\n  const startTime = meeting.data._originalStartTime || meeting.data['Start Time'];\n  const endTime = meeting.data._originalEndTime || meeting.data['End Time'];\n  \n  let startDateTime, endDateTime;\n  \n  if (conversionRequired) {\n    // Convert from app timezone to user's timezone\n    const timezone = appSettings.data['Event Timezone'];\n    startDateTime = moment.tz(`${date}T${startTime}`, timezone)\n      .tz(userTimezone)\n      .format('YYYYMMDDTHHmmss');\n    endDateTime = moment.tz(`${date}T${endTime}`, timezone)\n      .tz(userTimezone)\n      .format('YYYYMMDDTHHmmss');\n  } else {\n    // No conversion needed, use times as is\n    startDateTime = moment(`${date}T${startTime}`).format('YYYYMMDDTHHmmss');\n    endDateTime = moment(`${date}T${endTime}`).format('YYYYMMDDTHHmmss');\n  }\n\n  return `BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nUID:${meeting.id}\nDTSTAMP:${moment().utc().format('YYYYMMDDTHHmmss')}Z\nDTSTART:${startDateTime}\nDTEND:${endDateTime}\nSUMMARY:${meeting.data.Title || 'Untitled Meeting'}\nDESCRIPTION:${meeting.data.Description || ''}\nORGANIZER:mailto:${meeting.data['Booked by']}\nATTENDEE:mailto:${meeting.data['Booked with']}\nEND:VEVENT\nEND:VCALENDAR`;\n}\n\n// Separate function for compiling email templates\nfunction compileMessage(template, data) {\n  // Helper function to compile object values recursively\n  const compileTemplateObject = (obj, data) =\u003E {\n    return Object.entries(obj).reduce((acc, [key, value]) =\u003E {\n      if (typeof value === 'string') {\n        const template = Handlebars.compile(value);\n        const compiled = template(data);\n        acc[key] = compiled;\n      } else if (Array.isArray(value)) {\n        acc[key] = value.map(item =\u003E {\n          if (typeof item === 'object') {\n            return compileTemplateObject(item, data);\n          }\n          return item;\n        });\n      } else if (typeof value === 'object' && value !== null) {\n        acc[key] = compileTemplateObject(value, data);\n      } else {\n        acc[key] = value;\n      }\n      return acc;\n    }, {});\n  };\n\n  return compileTemplateObject(template, data);\n}\n\nfunction sendEmails(bookerEmail, recipientEmail, bookerPrefs, bookeePrefs){\n  const defaultOptions = {\n    from_name: Fliplet.Env.get('appName'),\n    headers: { \"Reply-To\": \"message.reply@example.com\" }\n  };\n  const emails = [];\n  if (bookerPrefs.includes('Email')) {\n    emails.push({\n      options: { ...bookerEmail, ...defaultOptions },\n      data: bookerEmail.attachments || []\n    });\n  }\n  if (bookeePrefs.includes('Email')) {\n    emails.push({\n      options: { ...recipientEmail, ...defaultOptions },\n      data: recipientEmail.attachments || []\n    });\n  }\n  if (!emails.length) return Promise.resolve();\n  return Fliplet.Communicate.batchSendEmail(emails);\n}\n\nfunction sendPushInapp(meeting, templateData, status, bookerPrefs, bookeePrefs) {\n  const notifications = [];\n  const nowUnix = moment().unix();\n  const bookedByUser = meeting.data.Attendees['Booked by user'];\n  const bookedWithUser = meeting.data.Attendees['Booked with user'];\n\n  // Handle booker notifications\n  if (bookerPrefs.includes('Push') && bookerPrefs.includes('In-App')) {\n    // Both Push and In-App: combine into one notification\n    const push = compileMessage(bookedByTemplate[status].Immediate.Push, templateData);\n    const inApp = compileMessage(bookedByTemplate[status].Immediate['In-app'], templateData);\n    notifications.push({\n      status: 'scheduled',\n      data: inApp,\n      orderAt: nowUnix,\n      pushNotification: { payload: push, delayUntilTimestamp: nowUnix },\n      scope: { Email: bookedByUser.data.Email }\n    });\n  } else {\n    // Send Push or In-App separately\n    if (bookerPrefs.includes('Push')) {\n      const push = compileMessage(bookedByTemplate[status].Immediate.Push, templateData);\n      notifications.push({\n        status: 'scheduled',\n        orderAt: nowUnix,\n        pushNotification: { payload: push, delayUntilTimestamp: nowUnix },\n        scope: { Email: bookedByUser.data.Email }\n      });\n    }\n    if (bookerPrefs.includes('In-App')) {\n      const inApp = compileMessage(bookedByTemplate[status].Immediate['In-app'], templateData);\n      notifications.push({\n        status: 'scheduled',\n        data: inApp,\n        orderAt: nowUnix,\n        scope: { Email: bookedByUser.data.Email }\n      });\n    }\n  }\n\n  // Handle bookee notifications\n  if (bookeePrefs.includes('Push') && bookeePrefs.includes('In-App')) {\n    // Both Push and In-App: combine into one notification\n    const push = compileMessage(bookedWithTemplates[status].Immediate.Push, templateData);\n    const inApp = compileMessage(bookedWithTemplates[status].Immediate['In-app'], templateData);\n    notifications.push({\n      status: 'scheduled',\n      data: inApp,\n      orderAt: nowUnix,\n      pushNotification: { payload: push, delayUntilTimestamp: nowUnix },\n      scope: { Email: bookedWithUser.data.Email }\n    });\n  } else {\n    // Send Push or In-App separately\n    if (bookeePrefs.includes('Push')) {\n      const push = compileMessage(bookedWithTemplates[status].Immediate.Push, templateData);\n      notifications.push({\n        status: 'scheduled',\n        orderAt: nowUnix,\n        pushNotification: { payload: push, delayUntilTimestamp: nowUnix },\n        scope: { Email: bookedWithUser.data.Email }\n      });\n    }\n    if (bookeePrefs.includes('In-App')) {\n      const inApp = compileMessage(bookedWithTemplates[status].Immediate['In-app'], templateData);\n      notifications.push({\n        status: 'scheduled',\n        data: inApp,\n        orderAt: nowUnix,\n        scope: { Email: bookedWithUser.data.Email }\n      });\n    }\n  }\n\n  if (!notifications.length) return Promise.resolve();\n  return instance.batchInsert(notifications);\n}\n\nfunction scheduleReminders(meeting, templateData, status) {\n  const bookedByUser = meeting.data.Attendees['Booked by user'];\n  const bookedWithUser = meeting.data.Attendees['Booked with user'];\n  const date = meeting.data._originalDate || meeting.data.Date;\n  const startTime = meeting.data._originalStartTime || meeting.data['Start Time'];\n  const reminderMinutesBeforeMeeting = 10; // Set your reminder offset here\n  const meetingDateTime = moment(`${date}T${startTime}`);\n  const notificationToBeSentAt = meetingDateTime.clone().subtract(reminderMinutesBeforeMeeting, 'minutes');\n  const unixTimestamp = notificationToBeSentAt.unix();\n\n  // Use correct templates for each user and status\n  const bookerPush = compileMessage(bookedByTemplate[status].Scheduled.Push, templateData);\n  const bookerInApp = compileMessage(bookedByTemplate[status].Scheduled['In-app'], templateData);\n  const bookeePush = compileMessage(bookedWithTemplates[status].Scheduled.Push, templateData);\n  const bookeeInApp = compileMessage(bookedWithTemplates[status].Scheduled['In-app'], templateData);\n\n  return instance.batchInsert([\n    {\n      status: 'scheduled',\n      data: bookerInApp,\n      orderAt: unixTimestamp,\n      pushNotification: {\n        payload: bookerPush,\n        delayUntilTimestamp: unixTimestamp\n      },\n      scope: {\n        Email: bookedByUser.data.Email\n      }\n    },\n    {\n      status: 'scheduled',\n      data: bookeeInApp,\n      orderAt: unixTimestamp,\n      pushNotification: {\n        payload: bookeePush,\n        delayUntilTimestamp: unixTimestamp\n      },\n      scope: {\n        Email: bookedWithUser.data.Email\n      }\n    }\n  ]);\n}\n\nfunction getNotificationPreferencesForEmails(emails) {\n  return Fliplet.DataSources.connectByName(DS.meetingsSlots).then(connection =\u003E {\n    return connection.find({\n      where: {\n        Email: { $in: emails },\n        [VARIABLES.notificationPreferences]: { $exists: true }\n      }\n    });\n  }).then(records =\u003E {\n    const prefs = {};\n    records.forEach(r =\u003E {\n      prefs[r.data.Email] = r.data[VARIABLES.notificationPreferences] || [];\n    });\n    return prefs;\n  });\n}",
        "customCSS": ".small-card-list-location.Pending{color:#345091 !important}.small-card-list-location.Accepted{color:green !important}.small-card-list-location.Rejected{color:red !important}.fl-form .form-html{display:block !important}.fl-page-content-wrapper.edit_mode .modal{position:initial;padding-top:55px;display:block}.fl-page-content-wrapper.edit_mode .modal.fade{opacity:1 !important}.btn-default{padding:8px 16px !important}.accept{background:green !important;color:white !important;border:none !important}.reject{margin-left:20px;background:red !important;color:white !important;border:none !important}.cancel-button{color:red;text-decoration:underline}.new-small-card-list-container .my-profile-container{display:none}\n",
        "customSCSS": ".small-card-list-location{\n  &.Pending{\n    color: #345091 !important;\n  }\n  &.Accepted{\n    color: green !important;\n  }\n  &.Rejected{\n    color: red !important;\n  }\n}\n.fl-form .form-html {\n  display: block !important;\n}\n.fl-page-content-wrapper.edit_mode{\n  .modal{\n    position: initial;\n    padding-top: 55px;\n    display: block;\n    &.fade{\n      opacity: 1 !important;\n    }\n  }\n}\n.btn-default{\n  padding: 8px 16px!important;\n}\n\n.accept{\n  background: green!important;\n  color: white!important;\n  border: none!important;\n}\n.reject{\n  margin-left: 20px;\n  background: red!important;\n  color: white!important;\n  border: none!important;\n}\n\n.cancel-button{\n  color: red;\n  text-decoration: underline;\n}\n\n.new-small-card-list-container .my-profile-container{\n  display: none;\n}",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951867, 30951868, 30951869, 30951870, 30951871, 30951872, 30951873, 30951874, 30951875, 30951876, 30951877, 30951878]
      },
      "updatedAt": "2025-07-02T16:49:35.903Z",
      "slug": "my-meetings-1l7md"
    },
    {
      "id": 1744593,
      "isLayout": false,
      "layout": "{{{widget 30951899}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1684431,
      "layoutOrder": 10,
      "order": 10,
      "sectionId": null,
      "title": "Meeting Settings",
      "settings": {
        "private": {
          "tags": [
            "Data Capture"
          ],
          "queries": [
            "Lists",
            "nested form",
            "sub form"
          ],
          "category": "Data Capture",
          "description": "Use this screen to display the information saved by the Nested form screen template"
        },
        "customJS": "let dataToSave = [];\nlet tableInitialized = false;\nlet columnName;\nlet nestedFormFields = [];\nlet dataSourceId = '';\nlet currentUserMeetingRecord = null; // Store the found record globally\nlet appSetupRecord = null; // Store the appSetup record globally\n\n// Get current user's email\nfunction getCurrentUserEmail() {\n  return getUser()\n    .then(function(user) {\n      if (!user) {\n        return Promise.reject('No user session found');\n      }\n\n      // Check for email in different possible properties\n      const email = user.Email || user.email;\n      \n      if (!email) {\n        return Promise.reject('No user email found');\n      }\n\n      return email;\n    });\n}\n\n// Load existing meeting slots data\nfunction loadExistingMeetingSlots() {\n  // Show loading toast with progress bar\n  Fliplet.UI.Toast({\n    message: 'Loading meeting slots...',\n    progress: true,\n    duration: 'none',\n    type: 'regular'\n  });\n\n  return getCurrentUserEmail()\n    .then(function(email) {\n      Fliplet.UI.Toast.setProgress(0.3);\n      return Fliplet.DataSources.connectByName(DS.meetingsSlots)\n        .then(function(connection) {\n          Fliplet.UI.Toast.setProgress(0.6);\n          return connection.findOne({\n            where: {\n              Email: email\n            }\n          });\n        });\n    })\n    .then(function(record) {\n      Fliplet.UI.Toast.setProgress(0.9);\n      currentUserMeetingRecord = record; // Store the found record\n      if (!record) {\n        Fliplet.UI.Toast.dismiss(); // Hide loading toast\n        return;\n      }\n\n      // Load form data\n      Fliplet.FormBuilder.get().then(function(form) {\n        const fields = form.fields.get();\n        const { nestedFields, columnName: foundColumnName } = findNestedFormFields(fields);\n\n        nestedFormFields = nestedFields;\n        columnName = foundColumnName;\n\n        // Set form field values\n        Object.keys(record.data).forEach(function(key) {\n          if (key !== 'Meeting days') {\n            form.field(key).set(record.data[key]);\n          }\n        });\n\n        // Load meeting slots into table\n        if (record.data['Meeting days'] && record.data['Meeting days'].length) {\n          dataToSave = record.data['Meeting days'];\n          tableInitialized = initializeTable(nestedFormFields, dataToSave);\n          initTableButtonClickEvents(form);\n        }\n        Fliplet.UI.Toast.setProgress(1);\n        Fliplet.UI.Toast.dismiss(); // Hide loading toast after rendering\n      });\n    })\n    .catch(function(error) {\n      Fliplet.UI.Toast.dismiss(); // Hide loading toast on error\n      console.error('Error loading meeting slots:', error);\n    });\n}\n\n// Initialize data loading\nloadExistingMeetingSlots();\n\n// Check if subform should be rendered based on appSetup\nfunction checkSubformVisibility() {\n  return getAppSettings().then(record =\u003E {\n    appSetupRecord = record; // Store the record globally\n    if (!record) {\n      return false;\n    }\n    return record.data[VARIABLES.meetingTimeslots] === VARIABLES.meetingTimeslotsOptions.individual;\n  }).catch(function(error) {\n    console.error('Error checking subform visibility:', error);\n    return false;\n  });\n}\n\n// Function to hide form fields between start and end markers\nfunction hideNestedFormFields() {\n  let isWithinNestedForm = false;\n  $('[data-form-field]').each(function() {\n    const $field = $(this);\n    const $startMarker = $field.find('.startNestedForm');\n    const $endMarker = $field.find('.endNestedForm');\n\n    if ($startMarker.length) {\n      isWithinNestedForm = true;\n      $field.hide();\n    } else if ($endMarker.length) {\n      isWithinNestedForm = false;\n      $field.hide();\n    } else if (isWithinNestedForm) {\n      $field.hide();\n    }\n  });\n}\n\n// Initialize subform visibility\ncheckSubformVisibility().then(function(shouldShow) {\n  if (!shouldShow) {\n    hideNestedFormFields();\n  }\n});\n\n//Handle edit mode\n\nFliplet.Widget.find({ package: 'com.fliplet.form-builder' }).then(function(instances) {\n  if (!instances && instances[0].dataSourceId) {\n    Fliplet.UI.Toast('No valid form found on the screen');\n    return;\n  }\n\n  dataSourceId = instances[0].dataSourceId;\n  console.log(dataSourceId);\n});\n\nfunction getColumnValue(value) {\n  if (!value) return '';\n  else if (typeof value === 'object') {\n    return `${value.start} - ${value.end}`;\n  } else if (typeof value === 'array') {\n    return value.join(', ');\n  } else if (typeof value === 'boolean') {\n    return value ? 'Yes' : 'No';\n  } else if (typeof value === 'number') {\n    return value.toFixed(2);\n  } else {\n    return value;\n  }\n}\n\n// Add these new functions at the top\nfunction findNestedFormFields(fields) {\n  let nestedFields = [];\n  let columnName;\n  let isWithinNestedForm = false;\n  let htmlObject;\n\n  _.forEach(fields, function(field) {\n    if (field._type == 'flParagraph') {\n      htmlObject = $(field.value);\n    }\n    if (htmlObject && htmlObject.hasClass('startNestedForm')) {\n      isWithinNestedForm = true;\n      columnName = $(htmlObject)\n        .data('columnname')\n        .trim();\n    }\n\n    if (isWithinNestedForm && field._type !== 'flParagraph' && field._type !== 'flCustomButton') {\n      nestedFields.push(field.name);\n      htmlObject.addClass('nested-form-field');\n    }\n\n    if (htmlObject && htmlObject.hasClass('endNestedForm')) {\n      isWithinNestedForm = false;\n    }\n  });\n\n  return { nestedFields, columnName };\n}\n\nfunction setNestedFormFields() {\n  checkSubformVisibility().then(function(shouldShow) {\n    if (!shouldShow) {\n      hideNestedFormFields();\n      return;\n    }\n\n    Fliplet.FormBuilder.get().then(function(form) {\n      const fields = form.fields.get();\n      let isWithinNestedForm = false;\n      let htmlObject;\n\n      _.forEach(fields, function(field) {\n        if (field._type == 'flParagraph') {\n          htmlObject = $(field.value);\n        }\n        if (htmlObject && htmlObject.hasClass('startNestedForm')) {\n          isWithinNestedForm = true;\n        }\n\n        if (isWithinNestedForm && field._type !== 'flParagraph' && field._type !== 'flCustomButton') {\n          let fieldContainer = $('[data-field=\"' + field.name + '\"]').addClass(\"nested-form-field\");\n        }\n\n        if (htmlObject && htmlObject.hasClass('endNestedForm')) {\n          isWithinNestedForm = false;\n        }\n      });\n    });\n  });\n}\n\nsetNestedFormFields()\n\nfunction initializeTable(fields, data = []) {\n  const tableHeaders = fields.map(fieldName =\u003E `\u003Cth\u003E${fieldName}\u003C/th\u003E`).join('');\n  const actionHeader = '\u003Cth\u003EActions\u003C/th\u003E';\n\n  $('.startNestedForm').html(`\n    \u003Ctable id=\"nestedFormTable\"\u003E\n      \u003Cthead\u003E\n        \u003Ctr\u003E${tableHeaders}${actionHeader}\u003C/tr\u003E\n      \u003C/thead\u003E\n      \u003Ctbody\u003E\n        \u003C!-- Rows will be dynamically added here --\u003E\n      \u003C/tbody\u003E\n    \u003C/table\u003E\n  `);\n\n  // Populate existing data if any\n  data.forEach((entry, index) =\u003E {\n    const rowHtml = fields\n      .map(fieldName =\u003E `\u003Ctd\u003E${getColumnValue(entry[fieldName])}\u003C/td\u003E`)\n      .join('');\n    const actionButtons = `\n      \u003Ctd\u003E\n        \u003Cspan class=\"edit-criteria\" id=\"edit\" data-entry='${JSON.stringify(\n          entry\n        )}' data-index=\"${index}\"\u003E\n          \u003Ci class=\"fa fa-pencil fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n        \u003C/span\u003E\n        \u003Cspan class=\"delete-criteria\" id=\"delete\" data-index=\"${index}\"\u003E\n          \u003Ci class=\"fa fa-trash fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n        \u003C/span\u003E\n      \u003C/td\u003E\n    `;\n    $('#nestedFormTable tbody').append(`\u003Ctr\u003E${rowHtml}${actionButtons}\u003C/tr\u003E`);\n  });\n\n  $('#nestedFormTable').show();\n  return true;\n}\n\n// Add this new function near the top with other functions\nfunction validateNestedFormFields(form, nestedFormFields) {\n  const missingFields = [];\n  const fields = form.fields.get();\n\n  nestedFormFields.forEach(fieldName =\u003E {\n    const field = _.find(fields, { name: fieldName });\n    const value = form.field(fieldName).get();\n    const type = form.field(fieldName);\n\n    if (field && field.required && !value) {\n      missingFields.push(field.label || fieldName);\n    }\n  });\n\n  return missingFields;\n}\n\n// Add this helper function near the top with other functions\nfunction isFieldInNestedForm(fieldName, nestedFormFields) {\n  return nestedFormFields.includes(fieldName);\n}\n\n// Helper function to parse 'HH:mm' string to minutes\nfunction parseTimeToMinutes(timeStr) {\n  const [hours, minutes] = timeStr.split(':').map(Number);\n  return hours * 60 + minutes;\n}\n\n// Helper to normalize date to YYYY-MM-DD\nfunction normalizeDate(dateStr) {\n  if (dateStr.includes('/')) {\n    const [day, month, year] = dateStr.split('/');\n    return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\n  }\n  return dateStr;\n}\n\n// Update the Fliplet.Navigate.registerFunction section\nFliplet.Navigate.registerFunction('subforms', function(options) {\n  return checkSubformVisibility().then(function(shouldShow) {\n    if (!shouldShow) {\n      Fliplet.UI.Toast('This feature is not available in the current configuration.');\n      return Promise.reject();\n    }\n\n    $('#nestedFormTable').show();\n    return Fliplet.FormBuilder.get().then(function(form) {\n      $(document)\n        .find('.nested-form-container')\n        .hide();\n      const fields = form.fields.get();\n      const { nestedFields, columnName: foundColumnName } = findNestedFormFields(fields);\n\n      // Set these values once\n      nestedFormFields = nestedFields;\n      columnName = foundColumnName;\n\n      // Add validation before processing the form data\n      const missingFields = validateNestedFormFields(form, nestedFormFields);\n      if (missingFields.length \u003E 0) {\n        Fliplet.UI.Toast(`The following fields are required: ${missingFields.join(', ')}`);\n        return Promise.reject(); // Exit the function if validation fails\n      }\n\n      // Validate meeting duration\n      const timeField = form.field('Times').get();\n      if (!timeField || !timeField.start || !timeField.end || !appSetupRecord) {\n        Fliplet.UI.Toast('Invalid time values or app setup configuration');\n        return Promise.reject();\n      }\n\n      // Parse 'HH:mm' strings to minutes\n      const startMinutes = parseTimeToMinutes(timeField.start);\n      const endMinutes = parseTimeToMinutes(timeField.end);\n      \n      // Check if start time equals end time\n      if (startMinutes === endMinutes) {\n        Fliplet.UI.Toast('Start time cannot be equal to end time');\n        return Promise.reject();\n      }\n      \n      const duration = endMinutes - startMinutes;\n      const meetingDuration = appSetupRecord.data[VARIABLES.meetingsDuration];\n\n      // Check if duration is less than meeting duration\n      if (duration \u003C meetingDuration) {\n        Fliplet.UI.Toast(`Time slot duration (${duration} minutes) must be at least ${meetingDuration} minutes`);\n        return Promise.reject();\n      }\n\n      // Check if duration is divisible by meeting duration without remainder\n      if (duration % meetingDuration !== 0) {\n        Fliplet.UI.Toast(`The time slot must be divisible by ${meetingDuration} minutes`);\n        // Keep the form values so user can edit them\n        return Promise.reject();\n      }\n\n      // Overlap validation\n      const dateField = form.field('Date').get();\n      if (!dateField) {\n        Fliplet.UI.Toast('Please select a date.');\n        return Promise.reject();\n      }\n      // Check for overlap with existing slots for the same date\n      const normalizedNewDate = normalizeDate(dateField);\n      const isOverlapping = dataToSave.some(function(entry) {\n        const normalizedEntryDate = normalizeDate(entry['Date']);\n        // Compare only if the date matches\n        if (normalizedEntryDate !== normalizedNewDate) return false;\n        const entryTimes = entry['Times'];\n        if (!entryTimes || !entryTimes.start || !entryTimes.end) return false;\n        const entryStart = parseTimeToMinutes(entryTimes.start);\n        const entryEnd = parseTimeToMinutes(entryTimes.end);\n        // Overlap if: start \u003C entryEnd && entryStart \u003C end\n        return startMinutes \u003C entryEnd && entryStart \u003C endMinutes;\n      });\n      if (isOverlapping) {\n        Fliplet.UI.Toast('This time slot overlaps with an existing slot for the same day.');\n        return Promise.reject();\n      }\n\n      if (!tableInitialized) {\n        tableInitialized = initializeTable(nestedFormFields);\n      }\n\n      // Adding a new nested form entry\n      const newEntry = {};\n      _.forEach(nestedFormFields, function(fieldName) {\n        const fieldValue = form.field(fieldName).get();\n        if (fieldName === 'Times' && fieldValue && typeof fieldValue === 'object' && fieldValue.start && fieldValue.end) {\n          // Clone Times object to avoid shared references\n          newEntry[fieldName] = { start: fieldValue.start, end: fieldValue.end };\n        } else if (fieldValue && typeof fieldValue === 'object' && ('start' in fieldValue || 'end' in fieldValue)) {\n          newEntry[fieldName] = fieldValue;\n        } else {\n          newEntry[fieldName] = fieldValue || '';\n        }\n      });\n\n      // Check if entry already exists in dataToSave\n      const existingIndex = dataToSave.findIndex(entry =\u003E\n        nestedFormFields.every(fieldName =\u003E entry[fieldName] === newEntry[fieldName])\n      );\n\n      if (existingIndex === -1) {\n        // Add the new entry to the dataToSave array\n        dataToSave.push(newEntry);\n\n        // Create a table row for the new entry\n        const rowHtml = nestedFormFields\n          .map(fieldName =\u003E `\u003Ctd\u003E${getColumnValue(newEntry[fieldName])}\u003C/td\u003E`)\n          .join('');\n        const actionButtons = `\n          \u003Ctd\u003E\n            \u003Cspan class=\"edit-criteria\" id=\"edit\" data-entry='${JSON.stringify(\n              newEntry\n            )}' data-index=\"${dataToSave.length - 1}\"\u003E\n              \u003Ci class=\"fa fa-pencil fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n            \u003C/span\u003E\n            \u003Cspan class=\"delete-criteria\" id=\"delete\" data-index=\"${dataToSave.length - 1}\"\u003E\n              \u003Ci class=\"fa fa-trash fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n            \u003C/span\u003E\n          \u003C/td\u003E\n        `;\n        $('#nestedFormTable tbody').append(`\u003Ctr\u003E${rowHtml}${actionButtons}\u003C/tr\u003E`);\n\n        // Clear input fields after adding using Form API\n        _.forEach(nestedFormFields, function(fieldName) {\n          if (fieldName === 'Times') {\n            form.field(fieldName).set({ start: '', end: '' });\n          } else {\n            form.field(fieldName).set('');\n          }\n        });\n        $(document).find('[data-field=\"Times\"] .fa-times').trigger('click');\n      } else {\n        alert('This entry already exists!');\n      }\n\n      initTableButtonClickEvents(form);\n    });\n  });\n});\n\nfunction initTableButtonClickEvents(form) {\n  // Remove existing event handlers to prevent duplicates\n  $(document).off('click', '.delete-criteria');\n  $(document).off('click', '.edit-criteria');\n\n  // Handle delete functionality\n  $(document).on('click', '.delete-criteria', function(e) {\n    e.stopPropagation();\n    const index = $(this).data('index');\n    dataToSave.splice(index, 1);\n    var table = $(this).closest('#nestedFormTable');\n    $(this)\n      .closest('tr')\n      .remove();\n\n    // Update the indices of remaining buttons\n    $('.delete-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n\n    $('.edit-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n\n    if (!dataToSave.length) {\n      table.hide();\n    }\n\n    console.log('Data to save after deletion:', dataToSave);\n  });\n\n  // Handle edit functionality\n  $(document).on('click', '.edit-criteria', function(e) {\n    const entryData = $(this).data('entry');\n    const index = $(this).data('index');\n\n    // Populate form fields with existing data\n    _.forEach(nestedFormFields, function(fieldName) {\n      if (fieldName === 'Times' && entryData[fieldName] && typeof entryData[fieldName] === 'object' && entryData[fieldName].start && entryData[fieldName].end) {\n        form.field(fieldName).set({ start: entryData[fieldName].start, end: entryData[fieldName].end });\n      } else {\n        form.field(fieldName).set(entryData[fieldName] || '');\n      }\n    });\n\n    var table = $(this).closest('#nestedFormTable');\n    // Remove the row and the corresponding entry for editing\n    $(this)\n      .closest('tr')\n      .remove();\n    dataToSave.splice(index, 1);\n\n    // Update the indices of remaining buttons\n    $('.delete-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n    $('.edit-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n\n    if (!dataToSave.length) {\n      table.hide();\n    }\n\n    console.log('Data to save after edit:', dataToSave);\n  });\n}\n\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  // Remove specific fields that shouldn't be saved\n  delete data['Times [Start]'];\n  delete data['Times [End]'];\n  delete data['Add Timeslot'];\n\n  return Fliplet.FormBuilder.get().then(form =\u003E {\n    const fields = form.fields.get();\n    const { nestedFields, columnName: foundColumnName } = findNestedFormFields(fields);\n\n    nestedFormFields = nestedFields;\n    var requiredNestedFields = [];\n    nestedFormFields.forEach(fieldName =\u003E {\n      const field = _.find(fields, { name: fieldName });\n      const value = form.field(fieldName).get();\n\n      if (field && field.required) {\n        requiredNestedFields.push(field);\n      }\n    });\n\n    if (requiredNestedFields.length && !dataToSave.length) {\n      Fliplet.UI.Toast(`At least one nested record is required.`);\n      return Promise.reject();\n    }\n\n    // First check if any nested form fields have values\n    const hasUnsubmittedValues = nestedFormFields.some(fieldName =\u003E {\n      return data[fieldName] && data[fieldName].toString().trim() !== '';\n    });\n\n    function finalizeSubmission() {\n      // Only here do we update or return data\n      if (columnName && dataToSave.length) {\n        data[columnName] = dataToSave;\n      }\n      if (typeof nestedFormFields !== 'undefined') {\n        nestedFormFields.forEach(fieldName =\u003E {\n          delete data[fieldName];\n        });\n      }\n      \n      return updateRecord(data);\n    }\n\n    if (hasUnsubmittedValues) {\n      // Show warning prompt to user\n      return Fliplet.Navigate.confirm({\n        title: 'Unsaved nested form data',\n        message:\n          \"You have filled in nested form fields but haven't added them to the table. Would you like to continue anyway?\",\n        labels: ['Continue', 'Go back']\n      }).then(function(result) {\n        if (!result) {\n          // User clicked \"Go back\"\n          return Promise.reject();\n        }\n        return finalizeSubmission();\n      });\n    }\n\n    // No unsaved nested form data - proceed with original logic\n    return finalizeSubmission();\n  });\n});\n\nfunction updateRecord(data){\n  if (currentUserMeetingRecord) {\n    return Fliplet.DataSources.connectByName(DS.meetingsSlots)\n      .then(function(connection) {\n      \n      data['Meeting days'] = data['Meeting days'] || [];\n      return connection.update(currentUserMeetingRecord.id, data).then(function() {\n        Fliplet.UI.Toast('Meeting slots have been updated.')\n        return Promise.reject('');\n      });\n    });\n  } else {\n    return Promise.resolve(data);\n  }\n}\n\n// Update the isFormInvalid hook\nFliplet.Hooks.on('isFormInvalid', function(invalidFields) {\n  // If there are no invalid fields, allow form submission\n  if (!invalidFields || !invalidFields.length) {\n    return Promise.resolve();\n  }\n\n  // Check if all invalid fields are within the nested form\n  const nonNestedInvalidFields = invalidFields.filter(\n    field =\u003E !isFieldInNestedForm(field.name, nestedFormFields)\n  );\n\n  if (nonNestedInvalidFields.length \u003E 0) {\n    // If there are invalid fields outside the nested form, prevent submission\n    const fieldLabels = nonNestedInvalidFields.map(field =\u003E field.label || field.name).join(', ');\n    Fliplet.UI.Toast(`Please fill in the following required fields: ${fieldLabels}`);\n    return Promise.reject(); // Changed from resolve(true) to reject()\n  }\n\n  const nestedInvalidFields = invalidFields.filter(field =\u003E\n    isFieldInNestedForm(field.name, nestedFormFields)\n  );\n\n  if (nestedInvalidFields.length && !dataToSave.length) {\n    Fliplet.UI.Toast(`At least one nested record is required.`);\n    return Promise.reject();\n  }\n\n  // If all invalid fields are within nested form, allow submission\n  return Promise.resolve();\n});\n\nFliplet.FormBuilder.get().then(form =\u003E {\n  if (Fliplet.Env.get('mode') == 'view') {\n    $(document)\n      .find('.nested-form-container')\n      .hide();\n  }\n});\n",
        "customCSS": "table{width:80%;max-width:80%;margin-bottom:1rem;background-color:transparent;border-collapse:collapse}table th,table td{padding:5px !important}.delete-criteria,.edit-criteria{text-decoration:none;margin:0;cursor:pointer;border-radius:6px !important;padding:5px !important;font-size:16px !important;display:inline-flex;align-items:center;line-height:24px !important;justify-content:center}.delete-criteria{color:#bb0c0c}.edit-criteria{color:#1E4A99}@media screen and (max-width: 640px){table th:last-child,table td:last-child{min-width:70px}}.nested-form-container{border:2px dashed #007bff;padding:15px;margin:10px 0;background-color:#f9f9f9}.nested-form-field{padding-left:15px !important}.nested-form-start,.nested-form-end{font-weight:bold;color:#007bff;margin-bottom:10px}#nestedFormTable{width:100%;max-width:100%;margin:0 auto;border-collapse:collapse;border:2px solid #ddd}#nestedFormTable th,#nestedFormTable td{padding:8px;text-align:left;word-wrap:break-word;max-width:200px;border:1px solid #ddd}#nestedFormTable th{background-color:#f5f5f5;font-weight:bold;border-bottom:2px solid #ddd}.startNestedForm{padding:0 15px;overflow-x:auto}.startNestedForm .edit-criteria,.startNestedForm .delete-criteria{cursor:pointer;margin:0 5px}.startNestedForm .edit-criteria:hover,.startNestedForm .delete-criteria:hover{opacity:0.7}.text-danger{display:none}[data-widget-package=\"com.fliplet.form-builder\"] .has-error .form-control,[data-widget-package=\"com.fliplet.form-builder\"] .has-error .select-proxy-display{border:none}[data-widget-package=\"com.fliplet.text\"].instructions{display:none !important;color:#3c763d !important;background-color:#dff0d8 !important;padding:15px !important;border-color:#d6e9c6;border:1px solid transparent;border-radius:4px}[data-widget-package=\"com.fliplet.text\"].instructions p,[data-widget-package=\"com.fliplet.text\"].instructions li{color:black !important}[data-widget-package=\"com.fliplet.text\"].danger{background-color:#f2dede !important}.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions{display:block !important}\n",
        "customSCSS": "/** @format */\ntable{\n  width: 80%;\n  max-width: 80%;\n  margin-bottom: 1rem;\n  background-color: transparent;\n  border-collapse: collapse;\n  th, td{\n    padding: 5px !important;\n  }\n}\n.delete-criteria, .edit-criteria {\n  text-decoration: none;\n  margin: 0;\n  cursor: pointer;\n  border-radius: 6px !important;\n  padding: 5px !important;\n  font-size: 16px !important;\n  display: inline-flex;\n  align-items: center;\n  line-height: 24px !important;\n  justify-content: center;\n}\n.delete-criteria{\n  color: #bb0c0c;\n}\n.edit-criteria{\n  color: #1E4A99;\n}\n@media screen and (max-width: 640px){\n  table th:last-child, table td:last-child{\n    min-width: 70px;\n  }\n}\n/* Style for nested form container */\n.nested-form-container {\n  border: 2px dashed #007bff;\n  padding: 15px;\n  margin: 10px 0;\n  background-color: #f9f9f9;\n}\n/* Style for nested form fields */\n.nested-form-field {\n  padding-left: 15px!important;\n}\n/* Optional: Style for start and end indicators */\n.nested-form-start,\n.nested-form-end {\n  font-weight: bold;\n  color: #007bff;\n  margin-bottom: 10px;\n}\n#nestedFormTable {\n  width: 100%;\n  max-width: 100%;\n  margin: 0 auto;\n  border-collapse: collapse;\n  border: 2px solid #ddd;\n  th, td {\n    padding: 8px;\n    text-align: left;\n    word-wrap: break-word;\n    max-width: 200px;\n    border: 1px solid #ddd;\n  }\n  th {\n    background-color: #f5f5f5;\n    font-weight: bold;\n    border-bottom: 2px solid #ddd;\n  }\n}\n.startNestedForm {\n  padding: 0 15px;\n  overflow-x: auto;\n  // Style for action buttons\n  .edit-criteria, .delete-criteria {\n    cursor: pointer;\n    margin: 0 5px;\n    &:hover {\n      opacity: 0.7;\n    }\n  }\n}\n.text-danger{\n  display: none;\n}\n[data-widget-package=\"com.fliplet.form-builder\"] .has-error .form-control, [data-widget-package=\"com.fliplet.form-builder\"] .has-error .select-proxy-display {\n  border: none;\n}\n\n\n//Hide instructions when on preview mode\n[data-widget-package=\"com.fliplet.text\"].instructions {\n  display:none !important;\n  color: #3c763d !important;\n  background-color: #dff0d8 !important;\n  padding: 15px !important;\n  border-color: #d6e9c6;\n  border: 1px solid transparent;\n  border-radius: 4px;\n}\n[data-widget-package=\"com.fliplet.text\"].instructions p, [data-widget-package=\"com.fliplet.text\"].instructions li {\n  color:black !important;\n}\n[data-widget-package=\"com.fliplet.text\"].danger {\n  background-color: #f2dede !important;\n}\n.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions {\n  display:block !important;\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951899, 30951900, 30951901]
      },
      "updatedAt": "2025-07-02T16:49:42.647Z",
      "slug": "meeting-settings-1l7mh"
    },
    {
      "id": 1744607,
      "isLayout": false,
      "layout": "{{{widget 30951960}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-communicate"
      ],
      "appId": 389751,
      "layoutId": 1683263,
      "layoutOrder": 11,
      "order": 11,
      "sectionId": null,
      "title": "Book a Meeting",
      "settings": {
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let groupedDatesTimes, loggedInUser, selectedUser, appSettings;\nlet availableTimeSlotsByDate = {};\nconst today = new Date().toISOString().split('T')[0];\nconst instance = Fliplet.Notifications.init({});\nlet loggedInUserNotificationPrefs = [];\nlet selectedUserNotificationPrefs = [];\nlet editRecord = null;\nlet isMeetingRescheduled = false;\nlet oldMeetingDateTime = null;\n\nconst bookedByTemplates = {\n  newMeeting: {\n    Email: {\n      to: [{ email: \"{{bookedBy.data.[Email]}}\", name: \"{{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}}\", type: \"to\" }],\n      subject: \"You have booked a new meeting!\",\n      html: `\u003Cp\u003EYou have successfully booked a meeting with {{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}}.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E`\n    },\n    Push: {\n      title: 'New meeting booked!',\n      body: `You have booked a new meeting with {{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}}.`\n    },\n    'In-app': {\n      title: 'New meeting booked!',\n      message: `You have booked a new meeting with {{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}}.`\n    }\n  },\n  editedAccepted: {\n    Email: {\n      to: [{ email: \"{{bookedBy.data.[Email]}}\", name: \"{{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}}\", type: \"to\" }],\n      subject: \"Meeting rescheduled - awaiting approval\",\n      html: `\u003Cp\u003EYour meeting with {{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}} has been \u003Cstrong\u003Erescheduled\u003C/strong\u003E to a new date and time.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003EOld Date/Time:\u003C/strong\u003E {{meeting.oldDate}} {{meeting.oldTime}}\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENew Date/Time:\u003C/strong\u003E {{meeting.Date}} {{meeting.Time}}\u003C/p\u003E\n\u003Cp\u003EThe new meeting time is pending approval from the other attendee.\u003C/p\u003E`\n    },\n    Push: {\n      title: 'Meeting rescheduled - awaiting approval',\n      body: `Your meeting with {{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}} has been rescheduled to {{meeting.Date}}, {{meeting.Time}}. The new meeting time is pending approval from the other attendee.`\n    },\n    'In-app': {\n      title: 'Meeting rescheduled - awaiting approval',\n      message: `Your meeting with {{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}} has been rescheduled to {{meeting.Date}}, {{meeting.Time}}. The new meeting time is pending approval from the other attendee.`\n    }\n  }\n};\n\nconst bookedWithTemplates = {\n  newMeeting: {\n    Email: {\n      to: [\n        { email: \"{{bookedWith.data.[Email]}}\", name: \"{{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}}\", type: \"to\" }\n      ],\n      subject: \"New meeting request: action required\",\n      html: `\u003Cp\u003E{{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}} has booked a meeting with you.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003EDate:\u003C/strong\u003E {{meeting.[Date]}}\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ETime:\u003C/strong\u003E {{meeting.[Time]}}\u003C/p\u003E\n\u003Cp\u003EPlease accept or reject this meeting request.\u003C/p\u003E`\n    },\n    Push: {\n      title: 'New meeting request!',\n      body: `You have a new meeting request from {{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}}. Please accept or reject.`\n    },\n    'In-app': {\n      title: 'New meeting request!',\n      message: `You have a new meeting request from {{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}} on {{meeting.[Date]}}, {{meeting.[Time]}}. Please accept or reject.`\n    }\n  },\n  editedAccepted: {\n    Email: {\n      to: [{ email: \"{{bookedWith.data.[Email]}}\", name: \"{{bookedWith.data.[First Name]}} {{bookedWith.data.[Last Name]}}\", type: \"to\" }],\n      subject: \"Meeting rescheduled - action required\",\n      html: `\u003Cp\u003E{{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}} has \u003Cstrong\u003Erescheduled\u003C/strong\u003E your meeting to a new date and time.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003EOld Date/Time:\u003C/strong\u003E {{meeting.oldDate}} {{meeting.oldTime}}\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENew Date/Time:\u003C/strong\u003E {{meeting.Date}} {{meeting.Time}}\u003C/p\u003E\n\u003Cp\u003EPlease accept or reject the new meeting time.\u003C/p\u003E`\n    },\n    Push: {\n      title: 'Meeting rescheduled - action required',\n      body: `{{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}} has rescheduled your meeting to {{meeting.Date}}, {{meeting.Time}}. Please accept or reject the new meeting time.`\n    },\n    'In-app': {\n      title: 'Meeting rescheduled - action required',\n      message: `{{bookedBy.data.[First Name]}} {{bookedBy.data.[Last Name]}} has rescheduled your meeting to {{meeting.Date}}, {{meeting.Time}}. Please accept or reject the new meeting time.`\n    }\n  }\n};\n\nfunction setupMeetingForm(form, secondAttendeeEmail, excludeId) {\n  return Fliplet.DataSources.connectByName(DS.users).then(connection =\u003E {\n    return connection.findOne({ where: { Email: secondAttendeeEmail }}).then(selected_user =\u003E {\n      selectedUser = selected_user;\n      setSelectedUser(form, selectedUser);\n      return getUser().then(logged_in_user =\u003E {  \n        loggedInUser = { data: logged_in_user };\n        form.field('Booked by').set(loggedInUser.data['Email']);\n\n        // Get app settings and then process available slots\n        return getAppSettings().then(appSetting =\u003E {\n          appSettings = appSetting;\n          // Now get and process available slots\n          return getAndProcessAvailableSlots(loggedInUser, selectedUser, excludeId).then(slots =\u003E {\n            availableTimeSlotsByDate = slots;\n            // Add change event to Date field (calendar type)\n            form.field('Date').change(function(selectedDate) {\n              const times = availableTimeSlotsByDate[selectedDate] || [];\n              const now = new Date();\n              const today = now.toISOString().split('T')[0];\n              \n              // Filter out past time slots if the selected date is today\n              const filteredTimes = times.filter(timeSlot =\u003E {\n                if (selectedDate === today) {\n                  const [startTime] = timeSlot.split(' - ');\n                  const slotDateTime = new Date(`${selectedDate}T${startTime}:00`);\n                  return slotDateTime \u003E now;\n                }\n                return true; // Keep all slots for future dates\n              });\n              \n              form.field('Time').options(filteredTimes);\n            });\n            // Optionally, set Time options for the initially selected date\n            const initialDate = form.field('Date').get();\n            if (initialDate && availableTimeSlotsByDate[initialDate]) {\n              form.field('Time').options(availableTimeSlotsByDate[initialDate]);\n            } else {\n              form.field('Time').options([]);\n            }\n            showAvailableMeetingSlots(availableTimeSlotsByDate);\n            hideMeetingSlotsLoadingBar();\n            return Promise.resolve(true);\n          });\n        });\n      });\n    });\n  });\n}\n\n// Register the afterFormEntryLoad hook at the top level\nFliplet.Hooks.on('afterFormEntryLoad', function (data) {\n  editRecord = data.entry;\n  return Promise.resolve(data);\n});\n\nFliplet.FormBuilder.get().then(function (form) {\n  // Show progress bar immediately\n  showMeetingSlotsLoadingBar();\n\n  if (Fliplet.Navigate.query.email) {\n    // CREATE MODE\n    setupMeetingForm(form, Fliplet.Navigate.query.email);\n  } else if (editRecord && editRecord.data && editRecord.data['Booked with']) {\n    // EDIT MODE\n    setupMeetingForm(form, editRecord.data['Booked with'], editRecord.id).then(function() {\n      form.field('Date').set(editRecord.data.Date);\n      const times = availableTimeSlotsByDate[editRecord.data.Date] || [];\n      const timeString = `${editRecord.data['Start Time']} - ${editRecord.data['End Time']}`;\n      if (times.includes(timeString)) {\n        form.field('Time').set(timeString);\n      }\n    });\n  } else {\n    setSelectedUser(form);\n  }\n});\n\n// Helper: Check if a specific time slot is still available (exact match version)\nfunction isTimeSlotAvailable(date, startTime, endTime, loggedInUserEmail, selectedUserEmail, excludeId) {\n  return Fliplet.DataSources.connectByName(DS.meetingsLogs).then(connection =\u003E {\n    return connection.find({\n      where: {\n        Date: date,\n        'Start Time': startTime,\n        'End Time': endTime,\n        Status: { $in: ['Pending', 'Accepted'] },\n        $or: [\n          { 'Booked with': { $in: [loggedInUserEmail, selectedUserEmail] } },\n          { 'Booked by': { $in: [loggedInUserEmail, selectedUserEmail] } }\n        ]\n      }\n    }).then(records =\u003E {\n      if (excludeId) {\n        records = records.filter(r =\u003E r.id !== excludeId);\n      }\n      // If any record exists, the slot is taken\n      return records.length === 0;\n    });\n  });\n}\n\nFliplet.Hooks.on('beforeFormSubmit', function(data) {  \n  const [startTime, endTime] = data['Time'].split(' - '); \n  delete data['Time'];\n  data['Start Time'] = startTime;\n  data['End Time'] = endTime;\n  data['Timestamp'] = `${data['Date']}T${startTime}:00.000Z`;\n\n  isMeetingRescheduled = false;\n  oldMeetingDateTime = null;\n\n  // Check for edit mode and reschedule\n  if (editRecord && editRecord.data && editRecord.data.Status === 'Accepted') {\n    const oldDate = editRecord.data.Date;\n    const oldStartTime = editRecord.data['Start Time'];\n    const oldEndTime = editRecord.data['End Time'];\n    const newDate = data['Date'];\n    const newStartTime = data['Start Time'];\n    const newEndTime = data['End Time'];\n    if (oldDate !== newDate || oldStartTime !== newStartTime || oldEndTime !== newEndTime) {\n      var options = {\n        title: 'Warning!',\n        message: 'Editing this accepted meeting will set it to pending and require approval for the new date/time. Continue?',\n        labels: ['Continue','Cancel'] // Native only (defaults to [OK,Cancel])\n      };\n\n      return Fliplet.Navigate.confirm(options)\n        .then(function(result) {\n        if (!result) {\n          return Promise.reject('Not confirmed!');\n        }\n        //editing of accepted meeting is confirmed\n        isMeetingRescheduled = true;\n        oldMeetingDateTime = {\n          Date: oldDate,\n          Time: `${oldStartTime} - ${oldEndTime}`\n        };\n        data['Status'] = 'Pending';\n      });\n    }\n  } else {\n    data['Status'] = 'Pending';\n  }\n\n  // Check if the selected time slot is still available\n  return isTimeSlotAvailable(\n    data['Date'], \n    data['Start Time'], \n    data['End Time'], \n    loggedInUser.data.Email, \n    selectedUser.data.Email, \n    editRecord ? editRecord.id : null\n  ).then(isAvailable =\u003E {\n    if (!isAvailable) {\n      Fliplet.UI.Toast('This time slot is no longer available. Please reload the page and select another time.');\n      return Promise.reject('Time slot not available');\n    }\n    return data;\n  });\n});\n\nFliplet.Hooks.on('afterFormSubmit', function(response) {\n  const createdAt = new Date(response.result.createdAt).getTime();\n  const updatedAt = new Date(response.result.updatedAt).getTime();\n  const isEdit = Math.abs(updatedAt - createdAt) \u003E 1000;\n  const isCreate = !isEdit;\n\n  // Prepare the data context from the form submission\n  const templateData = {\n    bookedBy: loggedInUser,\n    bookedWith: selectedUser,\n    meeting: {\n      Date: response.formData.Date,\n      Time: `${response.formData['Start Time']} - ${response.formData['End Time']}`,\n      oldDate: oldMeetingDateTime ? oldMeetingDateTime.Date : '',\n      oldTime: oldMeetingDateTime ? oldMeetingDateTime.Time : ''\n    }\n  };\n\n  // Check notification preferences\n  const byPrefs = loggedInUserNotificationPrefs;\n  const withPrefs = selectedUserNotificationPrefs;\n\n  const promises = [];\n  let bookerEmail, recipientEmail;\n\n  // Only send notifications if:\n  // - It's a new meeting (created)\n  // - OR it's a rescheduled meeting\n  if (isCreate || isMeetingRescheduled) {\n    // Use different templates for rescheduled\n    const byTemplates = isMeetingRescheduled ? bookedByTemplates.editedAccepted : bookedByTemplates.newMeeting;\n    const withTemplates = isMeetingRescheduled ? bookedWithTemplates.editedAccepted : bookedWithTemplates.newMeeting;\n\n    // EMAILS - only call if at least one attendee has Email preference\n    if (byPrefs.includes('Email') || withPrefs.includes('Email')) {\n      if (byPrefs.includes('Email')) {\n        bookerEmail = compileMessage(byTemplates.Email, templateData);\n      }\n      if (withPrefs.includes('Email')) {\n        recipientEmail = compileMessage(withTemplates.Email, templateData);\n      }\n      promises.push(sendEmails(bookerEmail, recipientEmail, loggedInUser, selectedUser));\n    }\n\n    // PUSH/IN-APP - only call if at least one attendee has Push or In-App preference\n    if (byPrefs.includes('Push') || byPrefs.includes('In-App') || withPrefs.includes('Push') || withPrefs.includes('In-App')) {\n      promises.push(sendPushInapp(loggedInUser, selectedUser, templateData, byPrefs, withPrefs, byTemplates, withTemplates));\n    }\n  }\n\n  if (promises.length === 0) {\n    return Promise.resolve(true);\n  }\n\n  return Promise.all(promises)\n    .then(() =\u003E {\n      Fliplet.UI.Toast('Notifications to recipient and booker were successfully sent');\n      return Promise.resolve(true);\n    })\n    .catch((err) =\u003E {\n      console.error('Error sending notifications:', err);\n      Fliplet.UI.Toast('Error sending notifications');\n    });\n});\n\nfunction setSelectedUser(form, selectedUser){\n  if (selectedUser){\n    form.field('Booked with').set(selectedUser.data.Email);\n  }\n}\n\nfunction calculateAvailableMeetings(meetingLogs) {\n  // Process all records to find available slots\n  const availableSlots = meetingLogs.reduce((slots, record) =\u003E {\n    const startTime = record['Start Time'];\n    const endTime = record['End Time'];\n    const duration = record['Duration']; // in minutes\n    const bookedMeetings = record['Booked Meetings'] || [];\n    \n    // Convert start and end time to minutes since midnight for easier calculation\n    const [startHour, startMinute] = startTime.split(':').map(Number);\n    const [endHour, endMinute] = endTime.split(':').map(Number);\n    const startMinutes = startHour * 60 + startMinute;\n    const endMinutes = endHour * 60 + endMinute;\n    \n    // Create array of all possible time slots\n    const timeSlots = [];\n    for (let time = startMinutes; time + duration \u003C= endMinutes; time += duration) {\n      \n      // Format times as HH:mm\n      const formatTime = (minutes) =\u003E {\n        const hours = Math.floor(minutes / 60);\n        const mins = minutes % 60;\n        return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;\n      };\n      \n      const timeSlot = `${formatTime(time)} - ${formatTime(time + duration)}`;\n      \n      // Check if this slot is booked\n      const isBooked = bookedMeetings.some(meeting =\u003E {\n        if (!meeting.data) return false;\n        const meetingStart = meeting.data['Start Time'];\n        const meetingEnd = meeting.data['End Time'];\n        \n        // Convert meeting times to minutes for comparison\n        const [mStartHour, mStartMin] = meetingStart.split(':').map(Number);\n        const [mEndHour, mEndMin] = meetingEnd.split(':').map(Number);\n        const meetingStartMins = mStartHour * 60 + mStartMin;\n        const meetingEndMins = mEndHour * 60 + mEndMin;\n        \n        // Check if there's any overlap between the slot and the meeting\n        return (time \u003C meetingEndMins && (time + duration) \u003E meetingStartMins);\n      });\n      \n      if (!isBooked) {\n        timeSlots.push(timeSlot);\n      }\n    }\n    \n    return [...slots, ...timeSlots];\n  }, []);\n  \n  // Remove duplicates and sort\n  return [...new Set(availableSlots)].sort();\n}\n\nfunction getMeetingSlotsRecords(meetingTimeslotsSetting, loggedInUserEmail, selectedUserEmail) {\n  return Fliplet.DataSources.connectByName(DS.meetingsSlots).then(connection =\u003E {\n    if (meetingTimeslotsSetting === VARIABLES.meetingTimeslotsOptions.universal) {\n      // Fetch the record with Email as empty string OR Email does not exist\n      return connection.find({\n        where: {\n          $or: [\n            { Email: '' },\n            { Email: { $exists: false } },\n            { Email: null },\n            { Email: loggedInUserEmail }, //we need to get all attendees notification preferences\n            { Email: selectedUserEmail }\n          ]\n        }\n      });\n    } else {\n      // Fetch both users' records\n      return connection.find({\n        where: {\n          Email: { $in: [loggedInUserEmail, selectedUserEmail] }\n        }\n      });\n    }\n  }).then(records =\u003E {\n    // Check for enough records\n    if (meetingTimeslotsSetting === VARIABLES.meetingTimeslotsOptions.universal) {\n      const generalMeetingsRecord = records.find(r =\u003E !r.data.Email);\n      const attendeesMeetingsRecords = records.find(r =\u003E r.data.Email);\n      \n      if (!records || !generalMeetingsRecord) { //it's ok if users don't have notification preferences\n        showNoAvailableMeetings();\n        return Promise.reject('Not enough records for universal slots');\n      } else {\n        // Always update notification preferences after fetching records\n        loggedInUserNotificationPrefs = getNotificationPreferences(records, loggedInUserEmail);\n        selectedUserNotificationPrefs = getNotificationPreferences(records, selectedUserEmail);\n        return Promise.resolve([generalMeetingsRecord]);\n      }\n    } else {\n      if (!records || records.length \u003C 2) {\n        showNoAvailableMeetings();\n        return Promise.reject('Not enough records for individual slots');\n      } else {\n        // Always update notification preferences after fetching records\n        loggedInUserNotificationPrefs = getNotificationPreferences(records, loggedInUserEmail);\n        selectedUserNotificationPrefs = getNotificationPreferences(records, selectedUserEmail);\n        return Promise.resolve(records);\n      }\n    }\n  });\n}\n\nfunction showNoAvailableMeetings() {\n  var $availableTimesEl = $('#available-times');\n  var $noAvailableTimesEl = $('#no-available-times');\n  $availableTimesEl.removeClass('visible');\n  $noAvailableTimesEl.addClass('visible');\n  $(document).find('form').remove();\n  hideMeetingSlotsLoadingBar();\n}\n\n// Helper: Fetch booked meetings for both users for a set of dates\nfunction getBookedMeetings(loggedInUserEmail, selectedUserEmail, dates, excludeId) {\n  return Fliplet.DataSources.connectByName(DS.meetingsLogs).then(connection =\u003E {\n    return connection.find({\n      where: {\n        Date: { $in: dates },\n        Status: { $in: ['Pending', 'Accepted'] },\n        $or: [\n          { 'Booked with': { $in: [loggedInUserEmail, selectedUserEmail] } },\n          { 'Booked by': { $in: [loggedInUserEmail, selectedUserEmail] } }\n        ]\n      }\n    }).then(records =\u003E {\n      if (excludeId) {\n        return records.filter(r =\u003E r.id !== excludeId);\n      }\n      return records;\n    });\n  });\n}\n\n// Helper: Divide periods by meeting duration\nfunction dividePeriodsByDuration(periodsByDate, duration) {\n  const slotsByDate = {};\n  Object.keys(periodsByDate).forEach(date =\u003E {\n    const periods = periodsByDate[date];\n    const slots = [];\n    periods.forEach(period =\u003E {\n      for (let t = period.start; t + duration \u003C= period.end; t += duration) {\n        const slotStart = t;\n        const slotEnd = t + duration;\n        slots.push(`${minutesToTime(slotStart)} - ${minutesToTime(slotEnd)}`);\n      }\n    });\n    if (slots.length) slotsByDate[date] = slots;\n  });\n  return slotsByDate;\n}\n\n// Main function to get and process available slots\nfunction getAndProcessAvailableSlots(loggedInUser, selectedUser, excludeId) {\n  // Use the already available appSettings variable\n  return getMeetingSlotsRecords(\n    appSettings.data[VARIABLES.meetingTimeslots],\n    loggedInUser.data.Email,\n    selectedUser.data.Email\n  ).then(meetingSlotsRecords =\u003E {\n    const availablePeriods = buildAvailablePeriods(meetingSlotsRecords);\n    if (!availablePeriods || Object.keys(availablePeriods).length === 0) {\n      showNoAvailableMeetings();\n      return Promise.reject('No available meetings');\n    }\n    // Get all relevant dates\n    const dates = Object.keys(availablePeriods);\n    return getBookedMeetings(loggedInUser.data.Email, selectedUser.data.Email, dates, excludeId).then(bookedMeetings =\u003E {\n      const freePeriods = excludeBookedMeetings(availablePeriods, bookedMeetings);\n      // Get meeting duration from appSettings\n      const meetingDuration = parseInt(appSettings.data[VARIABLES.meetingsDuration], 10);\n      const slots = dividePeriodsByDuration(freePeriods, meetingDuration);\n      if (!slots || Object.keys(slots).length === 0) {\n        showNoAvailableMeetings();\n        return Promise.reject('No available slots after exclusion');\n      }\n      return Promise.resolve(slots);\n    });\n  });\n}\n\n// Helper: Show available meeting slots or 'no available slots' message (jQuery version, final HTML structure with .buttons div)\nfunction showAvailableMeetingSlots(slotsByDate) {\n  var $availableTimesEl = $('#available-times');\n  var $noAvailableTimesEl = $('#no-available-times');\n  $availableTimesEl.removeClass('visible');\n  $noAvailableTimesEl.removeClass('visible');\n\n  var now = new Date();\n  var allSlots = [];\n  Object.entries(slotsByDate).forEach(function([date, times]) {\n    times.forEach(function(time) {\n      var start = time.split(' - ')[0];\n      var end = time.split(' - ')[1];\n      var slotDateTime = new Date(date + 'T' + start + ':00');\n      if (slotDateTime \u003E now) {\n        var dateObj = new Date(date);\n        var dateLabel = dateObj.toLocaleString('default', { month: 'short', day: 'numeric', year: 'numeric' });\n        var slotStartMinutes = slotDateTime.getTime();\n        allSlots.push({ date: date, dateLabel: dateLabel, time: time, start: start, end: end, dateObj: dateObj, slotStartMinutes: slotStartMinutes });\n      }\n    });\n  });\n  allSlots.sort(function(a, b) { return a.slotStartMinutes - b.slotStartMinutes; });\n  var slotsToShow = allSlots.slice(0, 3);\n\n  if (slotsToShow.length === 0) {\n    $noAvailableTimesEl.addClass('visible');\n    $availableTimesEl.removeClass('visible');\n    hideMeetingSlotsLoadingBar();\n    return;\n  }\n\n  var slotsByRenderDate = {};\n  slotsToShow.forEach(function(slot) {\n    if (!slotsByRenderDate[slot.dateLabel]) slotsByRenderDate[slot.dateLabel] = [];\n    slotsByRenderDate[slot.dateLabel].push(slot);\n  });\n\n  var html = '\u003Ch4\u003ESuggested Times\u003C/h4\u003E';\n  Object.keys(slotsByRenderDate).forEach(function(dateLabel) {\n    html += '\u003Cp class=\"date\"\u003E' + dateLabel + '\u003C/p\u003E';\n    var slots = slotsByRenderDate[dateLabel];\n    if (slots.length === 1) {\n      var s = slots[0];\n      html += '\u003Cbutton class=\"btn btn-primary focus-outline time\" data-date=\"' + s.date + '\" data-start=\"' + s.start + '\" data-end=\"' + s.end + '\"\u003E' + s.time + '\u003C/button\u003E';\n    } else if (slots.length \u003E 1) {\n      html += '\u003Cdiv class=\"buttons\"\u003E';\n      slots.forEach(function(s) {\n        html += '\u003Cbutton class=\"btn btn-primary focus-outline time\" data-date=\"' + s.date + '\" data-start=\"' + s.start + '\" data-end=\"' + s.end + '\"\u003E' + s.time + '\u003C/button\u003E';\n      });\n      html += '\u003C/div\u003E';\n    }\n  });\n  $availableTimesEl.html(html);\n  $availableTimesEl.addClass('visible');\n  $noAvailableTimesEl.removeClass('visible');\n\n  // Use delegated event binding for dynamically generated .time buttons\n  $(document).off('click', '.time').on('click', '.time', function() {\n    var date = $(this).data('date');\n    var start = $(this).data('start');\n    var end = $(this).data('end');\n    Fliplet.FormBuilder.get().then(function(form) {\n      // Set Date and wait for the change event to finish (which updates Time options)\n      form.field('Date').set(date).then(function() {\n        // Now set the Time value after options are updated\n        if (form.field('Time')) {\n          form.field('Time').set(start + ' - ' + end);\n        }\n      });\n    });\n  });\n}\n\n// Show loading bar before loading meeting slots\nfunction showMeetingSlotsLoadingBar() {\n  Fliplet.UI.Toast({\n    message: 'Loading meeting slots...',\n    progress: true,\n    duration: 'none',\n    type: 'regular'\n  });\n}\n\n// Hide loading bar\nfunction hideMeetingSlotsLoadingBar() {\n  Fliplet.UI.Toast.dismiss();\n}\n\n// Helper: Find overlapping periods for two users on a date\nfunction findOverlappingPeriods(periodsA, periodsB) {\n  const overlaps = [];\n  periodsA.forEach(a =\u003E {\n    periodsB.forEach(b =\u003E {\n      const startA = a.start;\n      const endA = a.end;\n      const startB = b.start;\n      const endB = b.end;\n      const overlapStart = startA \u003E startB ? startA : startB;\n      const overlapEnd = endA \u003C endB ? endA : endB;\n      if (overlapStart \u003C overlapEnd) {\n        overlaps.push({ start: overlapStart, end: overlapEnd });\n      }\n    });\n  });\n  return overlaps;\n}\n\n// Helper: Convert HH:mm to minutes\nfunction timeToMinutes(time) {\n  const [h, m] = time.split(':').map(Number);\n  return h * 60 + m;\n}\n// Helper: Convert minutes to HH:mm\nfunction minutesToTime(mins) {\n  return String(Math.floor(mins / 60)).padStart(2, '0') + ':' + String(mins % 60).padStart(2, '0');\n}\n\n// Helper: Build available periods object\nfunction buildAvailablePeriods(meetingSlotsRecords) {\n  const today = new Date().toISOString().split('T')[0];\n  if (meetingSlotsRecords.length === 1) {\n    // Universal: just collect all future periods\n    const periodsByDate = {};\n    (meetingSlotsRecords[0].data['Meeting days'] || []).forEach(day =\u003E {\n      if (day.Date \u003E= today) {\n        const start = timeToMinutes(day.Times.start);\n        const end = timeToMinutes(day.Times.end);\n        if (!periodsByDate[day.Date]) periodsByDate[day.Date] = [];\n        periodsByDate[day.Date].push({ start, end });\n      }\n    });\n    return periodsByDate;\n  } else if (meetingSlotsRecords.length === 2) {\n    // Per-user: build periods for each, then find common dates and overlaps\n    const periodsA = {};\n    const periodsB = {};\n    (meetingSlotsRecords[0].data['Meeting days'] || []).forEach(day =\u003E {\n      if (day.Date \u003E= today) {\n        const start = timeToMinutes(day.Times.start);\n        const end = timeToMinutes(day.Times.end);\n        if (!periodsA[day.Date]) periodsA[day.Date] = [];\n        periodsA[day.Date].push({ start, end });\n      }\n    });\n    \n    (meetingSlotsRecords[1].data['Meeting days'] || []).forEach(day =\u003E {\n      if (day.Date \u003E= today) {\n        const start = timeToMinutes(day.Times.start);\n        const end = timeToMinutes(day.Times.end);\n        if (!periodsB[day.Date]) periodsB[day.Date] = [];\n        periodsB[day.Date].push({ start, end });\n      }\n    });\n    // Find common dates\n    const commonDates = Object.keys(periodsA).filter(date =\u003E periodsB[date]);\n    if (!commonDates.length) return {};\n    // For each common date, find overlaps\n    const available = {};\n    commonDates.forEach(date =\u003E {\n      const overlaps = findOverlappingPeriods(periodsA[date], periodsB[date]);\n      if (overlaps.length) available[date] = overlaps;\n    });\n    return available;\n  }\n  return {};\n}\n\n// Helper: Exclude booked meetings from available periods\nfunction excludeBookedMeetings(periodsByDate, bookedMeetings) {\n  const result = {};\n  Object.keys(periodsByDate).forEach(date =\u003E {\n    let periods = periodsByDate[date];\n    // Only consider meetings with correct date and status\n    const bookings = bookedMeetings.filter(m =\u003E m.data && m.data[\"Date\"] === date && [\"Pending\", \"Accepted\"].includes(m.data[\"Status\"]));\n    bookings.forEach(b =\u003E {\n      const bookedStart = timeToMinutes(b.data[\"Start Time\"]);\n      const bookedEnd = timeToMinutes(b.data[\"End Time\"]);\n      periods = periods.flatMap(period =\u003E {\n        // If no overlap, keep as is\n        if (bookedEnd \u003C= period.start || bookedStart \u003E= period.end) return [period];\n        // If booking covers the whole period, remove\n        if (bookedStart \u003C= period.start && bookedEnd \u003E= period.end) return [];\n        // If booking is in the middle, split\n        if (bookedStart \u003E period.start && bookedEnd \u003C period.end) {\n          return [\n            { start: period.start, end: bookedStart },\n            { start: bookedEnd, end: period.end }\n          ];\n        }\n        // If booking overlaps start\n        if (bookedStart \u003C= period.start && bookedEnd \u003C period.end) {\n          return [{ start: bookedEnd, end: period.end }];\n        }\n        // If booking overlaps end\n        if (bookedStart \u003E period.start && bookedEnd \u003E= period.end) {\n          return [{ start: period.start, end: bookedStart }];\n        }\n        return [];\n      });\n    });\n    // Remove periods shorter than 1 minute (safety)\n    result[date] = periods.filter(p =\u003E p.end - p.start \u003E 0);\n  });\n  return result;\n}\n\n// Helper: Get notification preferences for a user from meetingSlotsRecords\nfunction getNotificationPreferences(meetingSlotsRecords, userEmail) {\n  const rec = meetingSlotsRecords.find(r =\u003E r.data.Email === userEmail);\n  return (rec && rec.data[VARIABLES.notificationPreferences]) || [];\n}\n\nfunction sendEmails(bookerEmail, recipientEmail, bookedByUser, bookedWithUser) {\n  const byPrefs = loggedInUserNotificationPrefs;\n  const withPrefs = selectedUserNotificationPrefs;\n\n  const emails = [];\n  if (byPrefs.includes('Email') && bookerEmail) {\n    emails.push({\n      options: {\n        ...bookerEmail,\n        from_name: Fliplet.Env.get('appName'),\n        headers: { \"Reply-To\": \"message.reply@example.com\" }\n      },\n      data: bookerEmail.attachments || []\n    });\n  }\n  if (withPrefs.includes('Email') && recipientEmail) {\n    emails.push({\n      options: {\n        ...recipientEmail,\n        from_name: Fliplet.Env.get('appName'),\n        headers: { \"Reply-To\": \"message.reply@example.com\" }\n      },\n      data: recipientEmail.attachments || []\n    });\n  }\n  if (emails.length === 0) return Promise.resolve();\n  return Fliplet.Communicate.batchSendEmail(emails);\n}\n\nfunction sendPushInapp(bookedByUser, bookedWithUser, templateData, byPrefs, withPrefs, byTemplates, withTemplates) {\n  const nowUnix = moment().unix();\n  const notifications = [];\n\n  const defaultNotification = {\n    status: 'scheduled',\n    orderAt: nowUnix,\n  };\n\n  // Handle booker (bookedBy) notifications\n  if (byPrefs.includes('Push') && byPrefs.includes('In-App')) {\n    // Both Push and In-App: combine into one notification\n    const bookerPush = compileMessage(byTemplates.Push, templateData);\n    const bookerInApp = compileMessage(byTemplates['In-app'], templateData);\n    const notification = { ...defaultNotification };\n    notification.data = bookerInApp;\n    notification.pushNotification = {\n      payload: bookerPush,\n      delayUntilTimestamp: nowUnix\n    };\n    notification.scope = { Email: bookedByUser.data.Email };\n    notifications.push(notification);\n  } else {\n    // Send Push or In-App separately\n    if (byPrefs.includes('Push')) {\n      const bookerPush = compileMessage(byTemplates.Push, templateData);\n      const notification = { ...defaultNotification };\n      notification.pushNotification = {\n        payload: bookerPush,\n        delayUntilTimestamp: nowUnix\n      };\n      notification.scope = { Email: bookedByUser.data.Email };\n      notifications.push(notification);\n    }\n    if (byPrefs.includes('In-App')) {\n      const bookerInApp = compileMessage(byTemplates['In-app'], templateData);\n      const notification = { ...defaultNotification };\n      notification.data = bookerInApp;\n      notification.scope = { Email: bookedByUser.data.Email };\n      notifications.push(notification);\n    }\n  }\n\n  // Handle bookee (bookedWith) notifications\n  if (withPrefs.includes('Push') && withPrefs.includes('In-App')) {\n    // Both Push and In-App: combine into one notification\n    const bookeePush = compileMessage(withTemplates.Push, templateData);\n    const bookeeInApp = compileMessage(withTemplates['In-app'], templateData);\n    const notification = { ...defaultNotification };\n    notification.data = bookeeInApp;\n    notification.pushNotification = {\n      payload: bookeePush,\n      delayUntilTimestamp: nowUnix\n    };\n    notification.scope = { Email: bookedWithUser.data.Email };\n    notifications.push(notification);\n  } else {\n    // Send Push or In-App separately\n    if (withPrefs.includes('Push')) {\n      const bookeePush = compileMessage(withTemplates.Push, templateData);\n      const notification = { ...defaultNotification };\n      notification.pushNotification = {\n        payload: bookeePush,\n        delayUntilTimestamp: nowUnix\n      };\n      notification.scope = { Email: bookedWithUser.data.Email };\n      notifications.push(notification);\n    }\n    if (withPrefs.includes('In-App')) {\n      const bookeeInApp = compileMessage(withTemplates['In-app'], templateData);\n      const notification = { ...defaultNotification };\n      notification.data = bookeeInApp;\n      notification.scope = { Email: bookedWithUser.data.Email };\n      notifications.push(notification);\n    }\n  }\n\n  if (notifications.length === 0) return Promise.resolve();\n  return instance.batchInsert(notifications);\n}",
        "customCSS": "#available-times,#no-available-times{display:none !important}#available-times.visible,#no-available-times.visible{display:flex !important}.buttons{display:flex;flex-wrap:wrap}.time{width:auto;margin-right:5px;margin-bottom:5px}\n",
        "customSCSS": "#available-times, #no-available-times{\n  display: none !important;\n  &.visible{\n    display: flex !important;\n  }\n}\n.buttons{\n  display: flex;\n  flex-wrap: wrap;\n}\n.time{\n  width: auto;\n  margin-right: 5px;\n  margin-bottom: 5px;\n}",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951959, 30951960, 30951961, 30951962, 30951963, 30951964]
      },
      "updatedAt": "2025-07-02T16:49:39.258Z",
      "slug": "book-a-meeting-1l7mv"
    },
    {
      "id": 1744591,
      "isLayout": false,
      "layout": "{{{widget 30951885}}}{{{widget 30951889}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-barcode"
      ],
      "appId": 389751,
      "layoutId": 378155,
      "layoutOrder": 12,
      "order": 12,
      "sectionId": null,
      "title": "Scan QR code",
      "settings": {
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let messageNotAllowed = 'You are not allowed to attend this session!';\nlet messageSuccessCheckin = 'You are successfully checked in to the session!';\nlet messageSuccessCheckout = 'You are successfully checked out from the session';\nlet messageOnWeb = 'Scanning QR code is not available on web';\nlet messageCanceledScanning = 'Scanning was canceled by user';\nlet alreadyCheckInMessage = 'Sorry, you have already checked in to this session. If you need further assistance, please contact someone from Support Team.';\nlet currentUser, originalTimezone, userTimezone, timeConversionIsRequired;\nconst userEmailField = 'Email';\n\nconsole.log(Fliplet.Navigate.query);\n\ngetUser().then(function(user){\n  if (!user) {\n    return; // user is not logged in\n  }\n  currentUser = user;\n  \n  // contains all columns found on the connected dataSource entry\n  if (Fliplet.Env.get('platform') === 'web') {  \n    scanningUnavailable();\n    \n  } else {\n    var isOnline = Fliplet.Navigator.isOnline();\n\n    if (isOnline) {\n      // device is online\n      return openScanner(currentUser.Email);\n    } else {\n      // device is offline\n      $('.loader-message').text('Device Offline');\n      setTimeout(function() {\n        failure();\n      }, 3000);\n    }\n  }\n});\n\n$('.scanAgain').click(function() {  \n  openScanner(currentUser.Email);\n});\n\nFliplet.Navigate.registerFunction('manual_check_in', function() {\n  const sessionID = Fliplet.Navigate.query.id;\n  if (sessionID){\n    Fliplet.Navigate.screen(SCREENS.manualCheckInForm, { query: `?id=${sessionID}`});\n  } else {\n    Fliplet.Navigate.screen(SCREENS.manualCheckInForm);\n  }\n});\n\n//open barcode scanner\nfunction openScanner(userEmail) {  \n  var options = {\n    preferFrontCamera: false, // iOS and Android\n    showFlipCameraButton: true, // iOS and Android\n    showTorchButton: true, // iOS and Android\n    torchOn: false, // Android, launch with the torch switched on (if available)\n    saveHistory: true, // Android, save scan history (default false)\n    prompt: 'Place a barcode inside the scan area' // Android\n  };\n\n  return Fliplet.Barcode.scan(options).then(function(result) {    \n    if (result.cancelled){\n      return Promise.resolve(true);\n    } else {   \n      var sessionID = getUrlParameter('sessionID', result.text);\n      \n      if (sessionID){        \n        return checkSession(sessionID, userEmail);\n      } else {\n        return failure();\n      }\n    }\n  }).catch(function(error) {\n    //alert(JSON.stringify(error));\n    return failure();\n  });\n}\n\nfunction checkSession(sessionID, userEmail){\n  return Fliplet.DataSources.connectByName(DS.attendingLogs).then(function(connection) {\n    return connection.findOne({\n      where: {\n        Email: userEmail,\n        'Session ID': sessionID\n      }\n    }).then(function(record){  \n      return TimeConversion.getAppSetup().then(function(appSettings){\n        if (!appSettings) {\n          return Promise.resolve(true);\n        }\n\n        if (TimeConversion.checkIfConversionIsRequired(appSettings)){   \n          timeConversionIsRequired = true;\n          originalTimezone = appSettings.data['Event Timezone'];\n          userTimezone = TimeConversion.getCurrentUserTimezone();\n        } else {\n          userTimezone = appSettings.data['Event Timezone'];\n        }\n\n        if (record){\n          let entryToUpdate = JSON.parse(JSON.stringify(record));\n\n          if ((!entryToUpdate.data.hasOwnProperty('Check in time') || !entryToUpdate.data['Check in time']) && (!entryToUpdate.data.hasOwnProperty('Check out time') || !entryToUpdate.data['Check out time'])) {\n            // Record exists but has no check-in/out times - check if user can check in\n            return handleCheckIn(sessionID, entryToUpdate.id);\n          } else if ((!entryToUpdate.data.hasOwnProperty('Check out time') || !entryToUpdate.data['Check out time']) && (entryToUpdate.data.hasOwnProperty('Check in time') && entryToUpdate.data['Check in time'])){\n            //user already checked in -\u003E check him out\n            return handleCheckOut(entryToUpdate);\n          } else {\n            //alert('already checked in and out');\n            //user already checked in and out\n            return alreadyCheckedIn();\n          }\n        } else {\n          //user is not checked in yet -\u003E check him in\n          return handleCheckIn(sessionID);\n        }\n      });\n    });\n  });\n}\n\nfunction handleCheckOut(entryToUpdate) {\n  //alert('handle check out');\n  entryToUpdate.data['Check out time'] = moment().tz(timeConversionIsRequired ? originalTimezone : userTimezone).format('YYYY-MM-DD HH:mm');\n  let checkInTime = moment(entryToUpdate.data['Check in time']);\n  let checkOutTime = moment(entryToUpdate.data['Check out time']);\n\n  //calculate the difference between check in and check out time\n  let diff = checkOutTime.diff(checkInTime, 'minutes');\n  entryToUpdate.data['Attendance in minutes'] = diff;\n\n  return Fliplet.DataSources.connectByName(DS.attendingLogs).then(function(connection) {\n    return connection.update(entryToUpdate.id, entryToUpdate.data).then(function(){\n      //successful check out\n      successCheckOut();\n      return Promise.resolve(true);\n    });\n  });\n}\n\nfunction handleCheckIn(sessionID, existingRecordId) {\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findOne({\n      where: {\n        'Session ID': sessionID\n      }\n    }).then(function(agenda){\n      if (!agenda) {\n        return Promise.resolve(true);\n      }\n\n      if (timeConversionIsRequired){\n        const converted = TimeConversion.convertToUserTimezone(\n          agenda.data['Date'],\n          agenda.data['Start Time'],\n          agenda.data['End Time'],\n          originalTimezone,\n          userTimezone\n        );\n\n        _.set(agenda, 'data[\"Date\"]', converted.date);\n        _.set(agenda, 'data[\"Start Time\"]', converted.startTime);\n        _.set(agenda, 'data[\"End Time\"]', converted.endTime);\n      }\n      \n      if (!checkIfAgendaIsNotOver(agenda)) {\n        return Promise.resolve(true);\n      }\n\n      if (agenda && agenda.data.hasOwnProperty('Optional') && agenda.data['Optional'] == 'Yes'){\n        if (agenda.data[VARIABLES.personalizedAgenda] && Array.isArray(agenda.data[VARIABLES.personalizedAgenda]) && agenda.data[VARIABLES.personalizedAgenda].includes(currentUser.Email)){\n          successCheckIn();\n          return createAndSaveCheckInRecord(sessionID, existingRecordId);\n        } else {\n          failure();\n          return Promise.reject('');\n        }\n      } else {\n        return createAndSaveCheckInRecord(sessionID, existingRecordId).then(() =\u003E {\n          successCheckIn();\n          return Promise.resolve(true);\n        });\n      }\n    });\n  });\n}\n\nfunction createAndSaveCheckInRecord(sessionID, existingRecordId) {\n  return createCheckInRecord(currentUser, sessionID, false, userTimezone).then(data =\u003E {\n    return Fliplet.DataSources.connectByName(DS.attendingLogs).then(function (connection) {\n      if (existingRecordId) {\n        return connection.update(existingRecordId, data);\n      } else {\n        return connection.insert(data);\n      }\n    });\n  });\n}\n\nfunction getUrlParameter(name, url) {\n  name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n  var regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n  var results = regex.exec(url);\n  return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n}\n\n/*display check*/\nfunction successCheckIn() {\n  $('.circle-loader').show();\n  $('.success-message').text(`${messageSuccessCheckin}`);\n  userFeedBack(true);\n  \n  // Navigate to agenda screen after 2 seconds\n  setTimeout(function() {\n    Fliplet.Navigate.screen(SCREENS.agenda);\n  }, 2000);\n}\n\nfunction successCheckOut() {\n  $('.circle-loader').show();\n  $('.success-message').text(`${messageSuccessCheckout}`);\n  userFeedBack(true);\n  \n  // Navigate to agenda screen after 2 seconds\n  setTimeout(function() {\n    Fliplet.Navigate.screen(SCREENS.agenda);\n  }, 2000);\n}\n\n/*display cross*/\nfunction failure() {\n  $('.circle-loader').removeClass('failmark load-complete');\n  $('.circle-loader').show();\n  $('.error-message').text(`${messageNotAllowed}`);\n  userFeedBack(false);\n}\n\nfunction alreadyCheckedIn(){\n  $('.circle-loader').hide();\n  $('.loader-message').hide();\n  $('.unavailable .message').text(`${alreadyCheckInMessage}`);\n}\n\nfunction scanningUnavailable() {\n  $('.circle-loader').hide();\n  $('.loader-message').hide();\n  $('.unavailable .message').text(`${messageOnWeb}`);\n}\n\nfunction scanAgain(){\n  $('.circle-loader').hide();\n  $('.loader-message').hide();\n  $('.unavailable .message').text(`${messageCanceledScanning}`);\n  $('.retry').show();\n}\n\n/*const testID = 'w1ci8vyw-ygmc-v2x2-59jh-a71tap2yyw2t';\ncheckSession(testID, 'user@email.com');*/\n",
        "customCSS": "img{width:100%}.loader-message{width:60px;text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.success,.alert-warning,.alert-danger,.retry{display:none}.retry,.success{width:100%}[data-field=\"Email\"],[data-field=\"Date\"]{display:none}.circle-loader{margin-top:3.5em;margin-bottom:3.5em;margin-left:auto;margin-right:auto;border:1px solid rgba(0,0,0,0.2);border-left-color:#0acda2;animation:loader-spin 1.2s infinite linear;position:relative;display:inline-block;vertical-align:top;border-radius:50%;width:7em;height:7em}.load-complete{-webkit-animation:none;animation:none;transition:border 500ms ease-out}.load-complete.checkmark{border-color:#0acda2}.load-complete.failmark{border-color:#cd0a58}.failmark\u003Ediv.draw{display:block}.failmark\u003Ediv.draw::before,.failmark\u003Ediv.draw::after{content:\"\";position:absolute;height:2.5em;width:2.5em;opacity:1;animation-duration:800ms;animation-timing-function:ease;animation-name:failmark}.failmark\u003Ediv.draw::before{transform-origin:left top;border-right:3px solid #cd0a58;border-top:3px solid #cd0a58;left:1.55em;top:1.8em;transform:scaleX(-1) rotate(135deg)}.failmark\u003Ediv.draw::after{transform-origin:left top;border-right:3px solid #cd0a58;border-top:3px solid #cd0a58;left:5.05em;top:5.15em;transform:scaleX(-1) rotate(314deg)}.checkmark\u003Ediv.draw{display:block}.checkmark\u003Ediv.draw:after{opacity:1;height:3.5em;width:1.75em;transform-origin:left top;border-right:3px solid #0acda2;border-top:3px solid #0acda2;content:\"\";left:1.75em;top:3.5em;position:absolute}.checkmark\u003Ediv.draw:after{animation-duration:800ms;animation-timing-function:ease;animation-name:checkmark;transform:scaleX(-1) rotate(135deg)}@keyframes loader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes failmark{0%{height:0;width:0;opacity:1}20%{height:0;width:2.5em;opacity:1}40%{height:2.5em;width:2.5em;opacity:1}100%{height:2.5em;width:2.5em;opacity:1}}@keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:1.75em;opacity:1}40%{height:3.5em;width:1.75em;opacity:1}100%{height:3.5em;width:1.75em;opacity:1}}\n",
        "customSCSS": "img {\n  width:100%;\n}\n.loader-message {\n  width:60px;\n  text-align: center;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n.success, .alert-warning, .alert-danger, .retry {\n  display:none;\n}\n.retry, .success {\n  width:100%;\n}\n[data-field=\"Email\"],[data-field=\"Date\"] {\n  display:none;\n}\n.circle-loader {\n  margin-top: 3.5em;\n  margin-bottom: 3.5em;\n  margin-left:auto;\n  margin-right:auto;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  border-left-color: #0acda2;\n  animation: loader-spin 1.2s infinite linear;\n  position: relative;\n  display: inline-block;\n  vertical-align: top;\n  border-radius: 50%;\n  width: 7em;\n  height: 7em;\n}\n.load-complete {\n  -webkit-animation: none;\n  animation: none;\n  transition: border 500ms ease-out;\n}\n.load-complete.checkmark {\n  border-color: #0acda2;\n}\n.load-complete.failmark {\n  border-color: #cd0a58;\n}\n.failmark \u003E div.draw {\n  display: block;\n  &::before, &::after{\n    content: \"\";\n    position: absolute;\n    height: 2.5em;\n  \twidth: 2.5em;\n    opacity: 1;\n    animation-duration: 800ms;\n    animation-timing-function: ease;\n  \tanimation-name: failmark;\n  }\n  &::before{\n    transform-origin: left top;\n    border-right: 3px solid #cd0a58;\n    border-top: 3px solid #cd0a58;\n    left: 1.55em;\n    top: 1.8em;\n    transform: scaleX(-1) rotate(135deg);\n  }\n  &::after{\n    transform-origin: left top;\n    border-right: 3px solid #cd0a58;\n    border-top: 3px solid #cd0a58;\n    left: 5.05em;\n    top: 5.15em;\n    transform: scaleX(-1) rotate(314deg);\n  }\n}\n.checkmark \u003E div.draw {\n  display: block;\n}\n.checkmark \u003E div.draw:after {\n  opacity: 1;\n  height: 3.5em;\n  width: 1.75em;\n  transform-origin: left top;\n  border-right: 3px solid #0acda2;\n  border-top: 3px solid #0acda2;\n  content: \"\";\n  left: 1.75em;\n  top: 3.5em;\n  position: absolute;\n}\n.checkmark \u003E div.draw:after {\n  animation-duration: 800ms;\n  animation-timing-function: ease;\n  animation-name: checkmark;\n  transform: scaleX(-1) rotate(135deg);\n}\n@keyframes loader-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n@keyframes failmark {\n  0% {\n    height: 0;\n    width: 0;\n    opacity: 1;\n  }\n  20% {\n    height: 0;\n    width: 2.5em;\n    opacity: 1;\n  }\n  40% {\n    height: 2.5em;\n    width: 2.5em;\n    opacity: 1;\n  }\n  100% {\n    height: 2.5em;\n    width: 2.5em;\n    opacity: 1;\n  }\n}\n@keyframes checkmark {\n  0% {\n    height: 0;\n    width: 0;\n    opacity: 1;\n  }\n  20% {\n    height: 0;\n    width: 1.75em;\n    opacity: 1;\n  }\n  40% {\n    height: 3.5em;\n    width: 1.75em;\n    opacity: 1;\n  }\n  100% {\n    height: 3.5em;\n    width: 1.75em;\n    opacity: 1;\n  }\n}",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951885, 30951886, 30951887, 30951888, 30951889, 30951890, 30951891, 30951892, 30951893, 30951894]
      },
      "updatedAt": "2025-07-02T16:49:35.452Z",
      "slug": "scan-qr-code-1l7mf"
    },
    {
      "id": 1744596,
      "isLayout": false,
      "layout": "{{{widget 30951915}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1680103,
      "layoutOrder": 13,
      "order": 13,
      "sectionId": null,
      "title": "Session Check-In",
      "settings": {
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let userEmail, currentUser, timeConversionIsRequired, allSessions, userTimezone;\nconst today = moment().format('YYYY-MM-DD');\nconst selectedSessionID = Fliplet.Navigate.query.id;\n\nFliplet.UI.Toast({\n  type: 'regular',\n  position: 'center',\n  backdrop: true,\n  tapToDismiss: false,\n  title: 'Please wait, the data is loading...',\n  progress: true\n});\n\ngetUser().then(function(user){\n  if (!user){\n    return Fliplet.Navigate.screen('Login');\n  } else {  \n    currentUser = user;\n    userEmail = user['Email'];\n    return Fliplet.DataSources.connectByName(DS.agenda).then(function (connection) {\n      //get all the sessions\n      return connection.find({ where: {\n        [VARIABLES.enableCheckIn]: VARIABLES.enableCheckInOptions.users,\n        'Date': { $gte: today }\n      }}).then(function(sessions){ \n        return TimeConversion.getAppSetup().then(function(appSettings){\n          if (appSettings){\n            if (TimeConversion.checkIfConversionIsRequired(appSettings)){   \n              timeConversionIsRequired = true;\n              const originalTimezone = appSettings.data['Event Timezone'];\n              userTimezone = TimeConversion.getCurrentUserTimezone();\n              \n              _.forEach(sessions, function(record){\n                const originalDate = record.data['Date'];\n                const originalStartTime = record.data['Start Time'];\n                const originalEndTime = record.data['End Time'];\n\n                const converted = TimeConversion.convertToUserTimezone(\n                  originalDate,\n                  originalStartTime,\n                  originalEndTime,\n                  originalTimezone,\n                  userTimezone\n                );\n\n                _.set(record, 'data[\"Date\"]', converted.date);\n                _.set(record, 'data[\"Start Time\"]', converted.startTime);\n                _.set(record, 'data[\"End Time\"]', converted.endTime);\n              });\n              allSessions = sessions;\n            } else {\n              userTimezone = appSettings.data['Event Timezone'];\n              allSessions = sessions;\n            }\n            \n            let optionalSessions = [];\n            let sessionsToShow = [];\n\n            _.forEach(allSessions, function(session){\n              if (session.data.Optional == 'Yes'){\n                optionalSessions.push(session);\n              } else {\n                sessionsToShow.push(session);\n              }\n            });\n\n            if (optionalSessions.length){\n              _.forEach(optionalSessions, function(optionalSession){            \n                if (optionalSession.data[VARIABLES.personalizedAgenda] && Array.isArray(optionalSession.data[VARIABLES.personalizedAgenda]) && optionalSession.data[VARIABLES.personalizedAgenda].includes(userEmail)){\n                  sessionsToShow.push(optionalSession);\n                }\n              });\n              return showSessions(sessionsToShow);\n            } else if (sessionsToShow.length){\n              return showSessions(sessionsToShow);\n            }\n            return Promise.resolve(true);\n          }\n        });\n      });\n    });\n  }\n});\n\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  data['Session ID'] = data['Session ID'][0];\n  \n  //user is not checked in yet, compare to check in codes\n  let selectedSession = _.find(allSessions, function(session){\n    return session.data['Session ID'] == data['Session ID'];\n  });\n  \n  if (selectedSession && selectedSession.data.hasOwnProperty(VARIABLES.manualCheckInCode) && selectedSession.data[VARIABLES.manualCheckInCode] == data['Check in code']){\n    return createCheckInRecord(currentUser, false, selectedSession, userTimezone).then(function(dataToCreate){\n      data = {\n        ...data,\n        ...dataToCreate\n      };\n      \n      // Find existing record and handle check-in\n      return Fliplet.DataSources.connectByName(DS.attendingLogs).then(function (connection) {\n        return connection.findOne({\n          where: {\n            'Email': userEmail,\n            'Session ID': data['Session ID']\n          }\n        }).then(function(existingRecord) {\n          if (existingRecord) {\n            // If record exists and has check-in time, show error\n            if (existingRecord.data['Check in time']) {\n              Fliplet.UI.Toast({\n                type: 'minimal',\n                title: 'Error:',\n                message: 'You are already checked in into the session'\n              });\n              return Promise.reject('');\n            }\n            // If record exists but no check-in time, update it\n            return connection.update(existingRecord.id, data);\n          } else {\n            // If no record exists, create new one\n            return connection.insert(data);\n          }\n        });\n      }).then(()=\u003E {\n        Fliplet.UI.Toast({\n          type: 'minimal',\n          title: 'Success:',\n          message: 'You have been checked in!'\n        });\n        //user will be taken to the Agenda screen in 2 seconds\n        setTimeout(function(){\n          Fliplet.Navigate.screen(SCREENS.agenda);\n          return Promise.reject('');\n        }, 2000);\n      });\n    });\n  } else {\n    Fliplet.UI.Toast({\n      type: 'minimal',\n      title: 'Error:',\n      message: 'The check in code is not correct'\n    });\n    return Promise.reject('');\n  }\n});\n\nfunction showSessions(listOfSessionsToShow){  \n  return Fliplet.FormBuilder.get().then(function (form) {\n   \tlet options = [];\n    _.forEach(listOfSessionsToShow, function(sessionsToShow){ \n      if (checkIfAgendaIsNotOver(sessionsToShow)){        \n        options.push({'label': `${sessionsToShow.data.Title} - ${sessionsToShow.data.Date} - ${sessionsToShow.data['Start Time']}`, 'id': sessionsToShow.data['Session ID']});\n      }\n    });\n    \n    return Fliplet.FormBuilder.get().then(function (form) {\n      form.field(\"Session ID\").options(options);\n      \n      if (selectedSessionID ){\n        const optionsIsFound = options.find(o =\u003E o.id === selectedSessionID);\n        if (optionsIsFound){\n          form.field(\"Session ID\").set([selectedSessionID]);\n        }\n      }\n      return Fliplet.UI.Toast.dismiss();\n    });\t\n  });\n}",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951914, 30951915, 30951916]
      },
      "updatedAt": "2025-07-02T16:49:37.496Z",
      "slug": "session-check-in-1l7mk"
    },
    {
      "id": 1744585,
      "isLayout": false,
      "layout": "{{{widget 30951772}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-datasources"
      ],
      "appId": 389751,
      "layoutId": 47844,
      "layoutOrder": 14,
      "order": 14,
      "sectionId": null,
      "title": "Session Survey",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows users to complete a session-specific survey. You can easily adjust the form settings and fields to customize the survey content. To enable this screen for a session, it must be linked through the session settings in the Agenda screen.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is only accessible for sessions where the \"Session Survey\" option has been enabled in the session settings.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen allows users to complete a survey for a specific session. It can be accessed by clicking \"Survey\" within a session in the Agenda screen.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins can link this screen to a session through the session settings, enabling a survey link for that specific session.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n\n// pvKey - pv name of the survey screen\n// formFieldName - Field ID of the session name field\n\n// formFieldName - Field ID of the user email field\n\nloadSessionName('surveySessionTitle-' + Fliplet.Env.get('pageId'), 'Session');\n//loadUserEmail('UserEmail');\n\nvar screenId = 49213; // Change this with the screen ID where the form is\n\n// CHANGE\n// \"surveySessionTitle-\"\n// \"questionsSessionTitle\"\n// \"pollSessionTitle-\"\n// Use one below\nFliplet.App.Storage.get('surveySessionTitle-' + screenId).then(function (data) {\n\tif (!data) {\n\t\treturn;\n\t}\n\n\t// Change: \"layout-type\" with the name of the LFD type\n\tFliplet.App.Storage.set('flDynamicListQuery:agenda', {\n\t\topen: {\n\t\t\tid: data.id\n\t\t}\n\t});\n});\n",
        "customCSS": "[data-field=\"UserEmail\"]{display:none}[data-field=\"Session\"]{display:none}\n",
        "customSCSS": "[data-field=\"UserEmail\"] {\n  display: none;\n}\n[data-field=\"Session\"] {\n  display: none;\n}\n",
        "widgetInstancesInUse": [30951771, 30951772, 30951773, 30951774]
      },
      "updatedAt": "2025-07-02T16:49:48.093Z",
      "slug": "session-survey-1l7m9"
    },
    {
      "id": 1744564,
      "isLayout": false,
      "layout": "{{{widget 30951677}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-datasources"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 15,
      "order": 15,
      "sectionId": null,
      "title": "Session Questions",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows users to submit questions for a specific session. You can easily adjust the form settings and fields to customize how questions are collected. To enable this screen for a session, it must be linked through the session settings in the Agenda screen.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is only accessible for sessions where the \"Questions\" option has been enabled in the session settings in Preview mode.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen allows users to submit questions related to a specific session. It can be accessed by clicking \"Questions\" within a session in the Agenda screen.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins can link this screen to a session through the session settings, enabling a question for that specific session.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n\n// pvKey - pv name of the questions screen\n// formFieldName - Field ID of the session name field\n\n// formFieldName - Field ID of the user email field\n\nloadSessionName(\n\t'questionsSessionTitle-' + Fliplet.Env.get('pageId'),\n\t'Session'\n);\nconsole.log(Fliplet.Navigate.query)\nvar screenId = 49194; // Change this with the screen ID where the form is\n\n// CHANGE\n// \"surveySessionTitle-\"\n// \"questionsSessionTitle\"\n// \"pollSessionTitle-\"\n// Use one below\nFliplet.App.Storage.get('questionsSessionTitle-' + screenId).then(function (\n\tdata\n) {\n\tif (!data) {\n\t\treturn;\n\t}\n\n\t// Change: \"layout-type\" with the name of the LFD type\n\tFliplet.App.Storage.set('flDynamicListQuery:agenda', {\n\t\topen: {\n\t\t\tid: data.id\n\t\t}\n\t});\n});\n\n$(document).on('click', 'a.btn-primary', resetSessionData);\n\nfunction resetSessionData() {\n\tloadSessionName(\n\t\t'questionsSessionTitle-' + Fliplet.Env.get('pageId'),\n\t\t'Session'\n\t);\n}\n",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951676, 30951677, 30951678, 30951679]
      },
      "updatedAt": "2025-07-02T16:49:50.744Z",
      "slug": "session-questions-1l7lk"
    },
    {
      "id": 1744597,
      "isLayout": false,
      "layout": "\u003Cdiv class=\"alert alert-info\" style=\"display: none;\"\u003E\n  Device offline.\u003Cbr\u003EPolls can only be submitted online.\n\u003C/div\u003E\n{{{widget 30951922}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174199,
      "layoutOrder": 16,
      "order": 16,
      "sectionId": null,
      "title": "Poll",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is custom and cannot be edited. It is automatically linked to from the Agenda screen when a session includes a poll. No modifications can be made to the layout or functionality of this screen in the editor.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is only accessible when a session with a poll is selected in the Agenda screen.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen displays the poll for a specific session. It can only be accessed by clicking on the \"Poll\" option in a session that has an associated poll in the Agenda screen.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E The poll configuration is completed when the agenda session is set up. App admins should ensure that poll data is properly added during the agenda session setup process.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n\n//check if device is online\nvar isOnline = Fliplet.Navigator.isOnline();\nif (!isOnline) {\n  $('.title').hide();\n  $('.submitMessage').hide();\n  $('#pageTitle').hide();\n  $('.questionOne').hide();\n  $('.questionTwo').hide();\n  $('.adminOptions').hide();\n  $('.alert.alert-info').show();\n  return;\n}\n\nvar editMiode = Fliplet.Env.get('interact');\nvar query = Fliplet.Navigate.query;\nvar userEmail = '';\nvar sessionID = Fliplet.Navigate.query.sessionID;\nvar previousPollOne = '';\nvar previousPollTwo = '';\nvar url = '';\nvar resultsQuery = '';\nvar pollOneDict = []; // create an empty array\nvar pollTwoDict = [];\n\nif (sessionID !== undefined) {\n  var urlObject = getUrlVars();\n  sessionID = urlObject.sessionID.trim();\n  resultsQuery = urlObject.result;\n\n  if (sessionID.includes('?sessionID')) {\n    sessionID = sessionID.split('?sessionID')[0];\n  }\n  if (Fliplet.Env.is('web')) {\n    url = Fliplet.Page.getPublicSlug() + '&result=true&title=' + encodeURI(query.title);\n  } else {\n\t\t$(\".fa-globe\").hide();\n    $(\".copyResult\").hide();\n  }\n}\nconsole.log('url', url);\n\nif (resultsQuery === 'true') {\n  $('.screenTitle').append('\u003Ch1\u003E' + query.title + '\u003C/h1\u003E');\n  $('input[value=\"Back\"]').hide();\n  $('.chartOne').show();\n  $('.chartOneTitle').show();\n  $('#pageTitle').remove();\n  $('.questionOne').remove();\n  $('.questionTwo').remove();\n  $('.adminOptions').remove();\n  $('[data-name=\"Bottom icon bar\"]').remove();\n  $('.btn.btn-secondary').remove();\n  $('.submitMessage').remove();\n  pollTwoexists().then(function(exists) {\n    //console.log('poll 2', exists);\n    if (exists) {\n      $('.chartTwo').show();\n      $('.chartTwoTitle').show();\n    }\n  });\n}\n\nFliplet.User.getCachedSession()\n  .then(function onCachedSessionRetrieved(session) {\n    userEmail = _.get(session, 'entries.dataSource.data.Email');\n    return userEmail;\n  })\n  .then(function(userEmail) {\n    var query = {\n      Session: sessionID\n    };\n    if (userEmail) {\n      query.UserEmail = userEmail;\n    }\n    return Fliplet.DataSources.connectByName(DS.poll).then(function(connection) {\n      return connection\n        .find({\n          where: query\n        })\n        .then(function(record) {\n          console.log('previous submission: ', record);\n          if (record.length !== 0) {\n            //console.log(record[0]);\n            previousPollOne = record[0].data['Poll - session 1'];\n            previousPollTwo = record[0].data['Poll - session 2'];\n          }\n        });\n    });\n  })\n  .then(function(data) {\n    return Fliplet.DataSources.connectByName(DS.agenda)\n      .then(function(connection) {\n        return connection.find({\n          where: {\n            'Session ID': sessionID\n          }\n        });\n      })\n      .then(function(record) {\n        if (record.length) {\n          $('#pageTitle').text(record[0].data.Title);\n        }\n        pollOneDict = [];\n        pollTwoDict = [];\n        _.forEach(record[0].data['Poll 1 Answer'].split('\\n'), function(value) {\n          pollOneDict.push({\n            id: value\n          });\n        });\n        _.forEach(record[0].data['Poll 2 Answer'].split('\\n'), function(value) {\n          pollTwoDict.push({\n            id: value\n          });\n        });\n        if (record[0].data['Poll 1 Question']) {\n          //console.log('poll 1 question:' + record[0].data['Poll 1 Question']);\n          $('.chartOneTitle').text(record[0].data['Poll 1 Question']);\n\n          Fliplet.FormBuilder.get('Poll1').then(function(form) {\n            form.fields.set([\n              {\n                _type: 'flRadio',\n                name: 'Poll - session 1',\n                label: record[0].data['Poll 1 Question'],\n                options: pollOneDict,\n                value: previousPollOne\n              },\n              {\n                _type: 'flButtons',\n                name: 'Submit',\n                label: 'Submit'\n              }\n            ]);\n          });\n        }\n        if (record[0].data['Poll 2 Question']) {\n          // console.log(record[0].data['Poll 2 Question']);\n          $('.questionTwo').show();\n\n          $('.chartTwoTitle').text(record[0].data['Poll 2 Question']);\n          Fliplet.FormBuilder.get('Poll2').then(function(form) {\n            form.fields.set([\n              {\n                _type: 'flRadio',\n                name: 'Poll - session 2',\n                label: record[0].data['Poll 2 Question'],\n                options: pollTwoDict,\n                value: previousPollTwo\n              },\n              {\n                _type: 'flButtons',\n                name: 'Submit',\n                label: 'Submit'\n              }\n            ]);\n          });\n        }\n      })\n      .then(function() {\n        setTimeout(function() {\n          $(document)\n            .find(`input[value=\"${previousPollTwo || pollTwoDict[0]}\"]`)\n            .trigger('click');\n          $(document)\n            .find(`input[value=\"${previousPollOne || pollOneDict[0]}\"]`)\n            .trigger('click');\n        }, 400);\n      });\n  });\n\nfunction getEntryID() {\n  return Fliplet.DataSources.connectByName(DS.poll).then(function(connection) {\n    return connection\n      .find({\n        where: {\n          Session: { $eq: sessionID },\n          UserEmail: { $eq: userEmail }\n        }\n      })\n      .then(function(record) {\n        if (record.length !== 0) {\n          userID = record[0].id;\n          return userID;\n        }\n      });\n  });\n}\n\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  return getEntryID().then(function(entryID) {\n    return Fliplet.DataSources.connectByName(DS.poll).then(function(connection) {\n      var now = moment().format('YYYY-MM-DD h:mm:ss');\n      if (entryID === undefined) {\n        if (data['Poll - session 1']) {\n          return connection.insert({\n            UserEmail: userEmail,\n            Session: sessionID,\n            'Poll - session 1': data['Poll - session 1'],\n            'Date and Time': now\n          });\n        } else {\n          return connection.insert({\n            UserEmail: userEmail,\n            Session: sessionID,\n            'Poll - session 2': data['Poll - session 2'],\n            'Date and Time': now\n          });\n        }\n      } else {\n        if (data['Poll - session 1']) {\n          return connection.update(entryID, {\n            'Poll - session 1': data['Poll - session 1'],\n            'Date and Time': now\n          });\n        } else {\n          return connection.update(entryID, {\n            'Poll - session 2': data['Poll - session 2'],\n            'Date and Time': now\n          });\n        }\n      }\n    });\n  });\n});\n\nfunction pollTwoexists() {\n  return Fliplet.DataSources.connectByName(DS.agenda)\n    .then(function(connection) {\n      return connection.find({\n        where: {\n          'Session ID': { $eq: sessionID }\n        }\n      });\n    })\n    .then(function(record) {\n      //console.log(record);\n      if (record[0].data['Poll 2 Question']) {\n        return true;\n      } else {\n        return false;\n      }\n    });\n}\n\n//for results mode\n\nfunction getUrlVars() {\n  var vars = {};\n  var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {\n    if (!Object.keys(vars).includes(key)) {\n      vars[key] = value;\n    }\n  });\n  return vars;\n}\n\n\n//speaker options\n\nfunction speakerStatus() {\n  return Fliplet.User.getCachedSession().then(function onCachedSessionRetrieved(session) {\n    //console.log(session);\n    if (\n      session.entries.dataSource.data.Type.includes('Speaker') ||\n      session.entries.dataSource.data.Admin === 'Yes'\n    ) {\n      return true;\n    }\n  });\n}\n\nfunction removeCharts() {\n  $('.chartOne').remove();\n}\n\nspeakerStatus().then(function(speakerStatus) {\n  if (speakerStatus && resultsQuery !== 'true') {\n    $('.adminOptions').show();\n  } else {\n    //removeCharts();\n    $('.adminOptions').hide();\n  }\n});\n\n//hide and show the bottom nav bar\n$('.fullScreenMode').click(function() {\n  $('[data-name=\"Bottom icon bar\"]').toggle();\n});\n\n//Copy result in speaker options\n$('.copyResult').click(function() {\n  Fliplet.App.get().then(function(app) {\n    if (app.id) {\n      const el = document.createElement('textarea');\n      el.value = url;\n      el.setAttribute('readonly', '');\n      el.style.position = 'absolute';\n      el.style.left = '-9999px';\n      document.body.appendChild(el);\n      el.select();\n      document.execCommand('copy');\n      document.body.removeChild(el);\n      Fliplet.UI.Toast('Results URL copied!');\n    } else {\n      Fliplet.UI.Toast('Please publish the app to use this feature.');\n    }\n  });\n});\n//show charts\n$('.showResults').click(function() {\n  $('.chartOne').toggle();\n  pollTwoexists().then(function(exists) {\n    if (exists) {\n      $('.chartTwo').toggle();\n      $('.chartTwoTitle').toggle();\n    }\n  });\n\n  $('.questionOne').toggle();\n  $('.questionTwo').toggle();\n  $('.chartOneTitle').toggle();\n});\n\n//delete poll responses\n$('.clearPoll').click(function() {\n  var options = {\n    title: 'Delete Poll responses',\n    message:\n      'Are you sure you want to delete all your poll responses? this action cannot be undone',\n    labels: ['Confirm', 'No'] // Native only (defaults to [OK,Cancel])\n  };\n\n  var deleteIds = [];\n  Fliplet.Navigate.confirm(options).then(function(result) {\n    if (!result) {\n      //console.log('Not confirmed!');\n      return Promise.reject();\n    }\n    //console.log('Confirmed!');\n    return Fliplet.DataSources.connectByName(DS.poll).then(function(connection) {\n      return connection\n        .find({\n          where: {\n            Session: { $eq: sessionID }\n          }\n        })\n        .then(function(records) {\n          _.forEach(records, function(value) {\n            deleteIds.push(value.id);\n          });\n          return deleteIds;\n        })\n        .then(function(ids) {\n          /*_.forEach(ids, function(value) {\n            Fliplet.DataSources.connectByName(DS.poll).then(function(connection) {\n              connection.removeById(value);\n            });\n          });*/\n          return connection\n            .commit({\n              entries: [],\n              delete: ids,\n              // ensure existing entries are unaffected\n              append: true\n            })\n            .then(function() {\n              return Fliplet.UI.Toast('Poll responses successfully deleted');\n            });\n        });\n    });\n  });\n});\n\n//filter chart to only show users data\nFliplet.Hooks.on('afterChartQuery', function(options) {\n  _.remove(options.records.dataSourceEntries, function(record) {\n    if (record.Session !== sessionID) {\n      return record.Session;\n    }\n  });\n});\n\nFliplet.Hooks.on('afterFormSubmit', function(response) {\n  if (response.formData['Poll - session 1']) {\n    $('.chartOne').show();\n  } else {\n    $('.chartTwo').show();\n  }\n});\n",
        "customCSS": "[data-field='UserEmail']{display:none}[data-field='Session']{display:none}.btn.btn-secondary.pull-right{display:none}.adminOptions{font-size:14px;margin-bottom:20px;width:100%;color:#345091;display:none}.adminOptions span{cursor:pointer}.showResults,.copyResult,.clearPoll{text-decoration:underline}.showResults,.copyResult{margin-right:9px}.fullScreenMode{text-align:right;font-size:12px;text-decoration:underline}.navigationMessage{margin-left:5px}.chartOneTitle,.chartTwoTitle{text-align:center;font-weight:bold}.simple-layout-column{max-width:100vw}.questionOne,.questionTwo,.chartOne,.chartTwo{width:100%}\n",
        "customSCSS": "/** @format */\n[data-field='UserEmail'] {\n  display: none;\n}\n[data-field='Session'] {\n  display: none;\n}\n.btn.btn-secondary.pull-right {\n  display: none;\n}\n.adminOptions {\n  font-size: 14px;\n  margin-bottom: 20px;\n  width: 100%;\n  color: $linkColor;\n  display: none;\n}\n.adminOptions span{\n  cursor: pointer;\n}\n.showResults,\n.copyResult,\n.clearPoll {\n  text-decoration: underline;\n}\n.showResults,\n.copyResult {\n  margin-right: 9px;\n}\n.fullScreenMode {\n  text-align: right;\n  font-size: 12px;\n  text-decoration: underline;\n}\n.navigationMessage {\n  margin-left: 5px;\n}\n.chartOneTitle,\n.chartTwoTitle {\n  text-align: center;\n  font-weight: bold;\n}\n.simple-layout-column {\n  max-width: 100vw;\n}\n.questionOne,\n.questionTwo,\n.chartOne,\n.chartTwo {\n  width: 100%;\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951917, 30951918, 30951919, 30951920, 30951921, 30951922, 30951923]
      },
      "updatedAt": "2025-07-02T16:49:37.202Z",
      "slug": "poll-1l7ml"
    },
    {
      "id": 1744584,
      "isLayout": false,
      "layout": "{{{widget 30951770}}}\n{{{widget 30951769}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 101140,
      "layoutOrder": 17,
      "order": 17,
      "sectionId": null,
      "title": "Interactive floorplan",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows you to upload an image of your event's floorplan and place interactive markers for different locations. You can position the markers to represent key areas or rooms. If you do not want to use this feature, you can simply remove it from the menu options.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E The markers you place here can be linked to sessions through the \"Location in the room (venue)\" field in the session settings.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen displays an interactive floorplan where users can view different locations within the event venue. Sessions can be linked to specific locations on the floorplan via markers.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins must ensure the marker name exactly matches the \"Location in the room (venue)\" field when creating or editing a session to properly link the session to the floorplan. If the floorplan is not being used, leave this field empty for each session.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n\nFliplet.Hooks.on('flInteractiveGraphicsBeforeRender', function () {\n\tvar entryName = Fliplet.Navigate.query.entryName;\n\n\treturn { markerName: entryName };\n});\n\nvar agendaScreenName = 'Agenda';\nvar exhibitorScreenName = 'Exhibitors';\nvar directoryNameField = 'Location';\nvar exhibitorBoothField = 'Booth';\n\nFliplet.Hooks.on(\n\t'flInteractiveGraphicsLabelClick',\n\tfunction onLabelClick(data) {\n\t\t//If the Marker starts with 'Booth' open the Exhibitors screen, otherwise open the Agenda screen\n\t\tif (data.selectedMarker.name.startsWith('Exhibitor')) {\n\t\t\treturn Fliplet.Navigate.screen(exhibitorScreenName, {\n\t\t\t\tquery:\n\t\t\t\t\t'?dynamicListFilterColumn=' +\n\t\t\t\t\tencodeURIComponent(exhibitorBoothField) +\n\t\t\t\t\t'&dynamicListFilterValue=' +\n\t\t\t\t\tencodeURIComponent(data.selectedMarker.name) +\n\t\t\t\t\t'&dynamicListPrefilterLogic=contains&openDetailedIfOneRecord=true'\n\t\t\t}).catch(function (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t});\n\t\t} else {\n\t\t\t// Open by column and value\n\t\t\treturn Fliplet.Navigate.screen(agendaScreenName, {\n\t\t\t\tquery:\n\t\t\t\t\t'?dynamicListFilterColumn=' +\n\t\t\t\t\tencodeURIComponent(directoryNameField) +\n\t\t\t\t\t'&dynamicListFilterValue=' +\n\t\t\t\t\tencodeURIComponent(data.selectedMarker.name) +\n\t\t\t\t\t'&dynamicListPrefilterLogic=contains&openDetailedIfOneRecord=true'\n\t\t\t}).catch(function (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t});\n\t\t}\n\t}\n);\n",
        "customCSS": ".interactive-map-label-wrapper{left:auto;right:10px}.interactive-map-label-wrapper.active{top:10px}@media (min-width: 600px){.maps-button{bottom:15px;left:15px}.interactive-map-search-icon{bottom:15px;right:15px}.fl-zoom-in,.fl-zoom-out{right:15px}.interactive-map-component-wrapper.with-search .fl-zoom-out{bottom:65px}.interactive-map-component-wrapper.with-search .fl-zoom-in{bottom:115px}}\n",
        "customSCSS": ".interactive-map-label-wrapper{\n  left: auto;\n  right: 10px;\n}\n\n.interactive-map-label-wrapper.active{\n  top: 10px;\n}\n\n@media (min-width: 600px) {\n  \n  .maps-button {\n    bottom: 15px;\n    left: 15px;\n  }\n  .interactive-map-search-icon {\n    bottom: 15px;\n    right: 15px;\n  }\n  .fl-zoom-in, .fl-zoom-out {\n    right: 15px;\n  }\n  .interactive-map-component-wrapper.with-search .fl-zoom-out {\n    bottom: 65px;\n  }\n  .interactive-map-component-wrapper.with-search .fl-zoom-in {\n    bottom: 115px;\n  }\n}\n/*[data-widget-package=\"com.fliplet.primary-button\"] .btn.btn-primary{\n\twidth: 100px;\n  margin: 5%;\n  position: fixed;\n  padding-top: 5px;\n  padding-bottom: 5px;\n}\n@media (min-width: 640px) {\n  [data-widget-package=\"com.fliplet.primary-button\"] .btn.btn-primary{\n    width: 150px;\n  }\n}*/\n",
        "widgetInstancesInUse": [30951769, 30951770]
      },
      "updatedAt": "2025-07-02T16:49:47.363Z",
      "slug": "interactive-floorplan-1l7m8"
    },
    {
      "id": 1744586,
      "isLayout": false,
      "layout": "{{{widget 30951780}}}",
      "dependencies": [],
      "appId": 389751,
      "layoutId": 108257,
      "layoutOrder": 18,
      "order": 18,
      "sectionId": null,
      "title": "Materials",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows you to display a list of materials related to the event. You can edit the layout using the List from Data Source component, which pulls in the materials added. If you do not want to use this feature, you can simply remove it from the menu options.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E The content for materials should be added or adjusted through Preview mode by app admins.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen displays a list of materials, with featured items marked as popular appearing at the top. Users can view relevant materials based on their session selections.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins can mark materials as popular when adding or editing them via the admin menu. When adding or editing materials, app admins must also select the \"Associated Sessions\" for each piece of material they want linked to one or more sessions. Sessions must be added first for this linking to work.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n\n//if navigated from \"Agenda\" entry, find the related materials\nvar query = Fliplet.Navigate.query;\nvar entryId;\nif (query && query.sessionTitle) {\n  $('.popular').toggle(false);\n  //$('.popular').style('display:none!important');\n\tFliplet.Hooks.on('flListDataAfterGetData', function (options) {\n\t\t_.forEach(options.records, function (record) {\n\t\t\t//entryId = record.id;\n\t\t\t//\t_.set(record, 'data.flClasses', 'filtered-card');\n\t\t});\n\t});\n}\n",
        "customCSS": ".new-news-feed-list-container .news-feed-list-wrapper{display:flex;flex-wrap:wrap;justify-content:space-between}.new-news-feed-list-container .news-feed-list-item{width:48%}h2{font-size:14px}.new-news-feed-list-container .slide-over .news-feed-item-inner-content .news-feed-date-category,.news-feed-detail-overlay .news-feed-item-inner-content .news-feed-date-category{font-size:10px}.new-news-feed-list-container .news-feed-list-item .slide-over{background-color:white}.filtered-card{width:80% !important;margin:auto}.custom-link{margin-top:15px !important;width:60px;margin:0 20px 0 0;display:flex;flex-direction:column;align-items:center;justify-content:center}.custom-link a{display:flex;flex-flow:column;justify-content:center}.custom-link a i{font-size:36px}.small-h-card-list-detail-buttons-wrapper{margin:20px 0;display:flex;align-items:center}.popular{max-width:100%}\n",
        "customSCSS": "\n\n.new-news-feed-list-container .news-feed-list-wrapper {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n}\n.new-news-feed-list-container .news-feed-list-item {\n  width: 48%;\n}\nh2 {\n  font-size: 14px;\n}\n.new-news-feed-list-container .slide-over .news-feed-item-inner-content .news-feed-date-category, .news-feed-detail-overlay .news-feed-item-inner-content .news-feed-date-category {\n  font-size: 10px;\n}\n.new-news-feed-list-container .news-feed-list-item .slide-over {\n  background-color: white;\n}\n.filtered-card {\n  width: 80% !important;\n  margin: auto;\n}\n.custom-link {\n  margin-top: 15px !important;\n  width: 60px;\n    margin: 0 20px 0 0;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n  a {\n    display: flex;\n    flex-flow: column;\n    justify-content: center;\n    \n    i {\n      font-size: 36px;\n    }\n  }\n}\n.small-h-card-list-detail-buttons-wrapper {\n  margin: 20px 0;\n    display: flex;\n    align-items: center;\n}\n\n.popular{\n  max-width: 100%;\n}\n\n  ",
        "widgetInstancesInUse": [30951775, 30951776, 30951777, 30951778, 30951779, 30951780]
      },
      "updatedAt": "2025-07-02T16:49:48.814Z",
      "slug": "materials-1l7ma"
    },
    {
      "id": 1744595,
      "isLayout": false,
      "layout": "{{{widget 30951912}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 49201,
      "layoutOrder": 19,
      "order": 19,
      "sectionId": null,
      "title": "Discussion",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EBy default, any user can add a new topic, and admins can add/edit/delete any discussion but this behavior can be adjusted in the List from Data Source options. Additionally, any user can comment on posts and report inappropriate comments.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is linked to the Discussions data source and the Manage Discussion screen.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen serves as a public forum where users can add topics, comment on posts, and report inappropriate comments. All discussions are visible to users.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins can manage inappropriate reports through the admin menu. They can also add, edit, or delete discussion topics in this screen.\u003C/p\u003E"
        },
        "customJS": "/**\n * Gets a list of app publishers for this app\n * @return Promise\u003CArray\u003E\n */\nfunction getAppPublishersEmails() {\n  var appId = Fliplet.Env.get('masterAppId');\n  return Fliplet.API.request('v1/apps/' + appId + '/users').then(function (response) {\n    return _.filter(response.users, function (user) {\n      return user.appUser && user.appUser.appRoleId === 1;\n    });\n  });\n}\n/**\n * Report a content by sending its details to all app publishers\n * @param options - Object containing \"subject\" and \"content\"\n * @return Promise\n */\nfunction reportContent(data) {\n  if (typeof data !== 'object') {\n          throw new Error('An object is required');\n  }\n  if (!confirm('Do you want to report this content?')) {\n          return Promise.resolve();\n  }\n  return Fliplet.UI.Toast({\n    duration: false,\n    message: 'Reporting this content...',\n    progress: true\n  }).then(function (toast) {\n    toast.setProgress(0.3);\n    return getAppPublishersEmails().then(function (appPublishers) {\n      if (!appPublishers.length) {\n        throw new Error('No app publishers have neen found to report this content to');\n      }\n      toast.setProgress(0.99);\n      return Fliplet.Profile.get('email').then(function (userEmail) {\n        userEmail = userEmail || 'Guest user';\n        var options = {\n          to: appPublishers.map(function (appPublisher) {\n            return {\n              type: 'to',\n              email: appPublisher.email,\n              name: appPublisher.fullName\n            };\n          }),\n          html: '\u003Cp\u003E ' + data.content + '\u003C/p\u003E\u003Chr /\u003E\u003Cp\u003EReported by ' + userEmail + '\u003C/p\u003E',\n          subject: data.subject\n        };\n              return Fliplet.Communicate.sendEmail(options);\n      });\n    }).then(function () {\n      toast.dismiss();\n      Fliplet.UI.Toast('Your report has been sent.');\n    }).catch(function (err) {\n      toast.dismiss();\n      Fliplet.UI.Toast.error(err, { message: 'Error submitting the report' });\n    });\n  });\n}\n// Report a comment\n$('body').on('click', '[data-report-comment]', function (e) {\n  e.preventDefault();\n  var $el = $(this);\n  var $comment = $el.closest('.fl-individual-comment');\n  var text = $comment.find('.fl-comment-value').text();\n  var $author = $comment.find('.fl-comment-user').clone();\n  $author.find('span').remove();\n  var author = $author.text();\n  var postTitle = $('.news-feed-detail-wrapper .news-feed-item-title').text();\n  reportContent({\n    subject: 'A comment has been reported',\n    content: 'The comment with text \"' + text + '\" posted by ' + author + ' on \"' + postTitle + '\" has been reported.'\n  });\n});\n// Hook to add \"report comment\" link to comments\nFliplet.Hooks.on('flListDataBeforeShowComments', function (data) {\n  var $comment = $('\u003Cdiv\u003E\u003C/div\u003E').html(data.html);\n  $comment.find('.fl-comment-info-holder').append('\u003Ca href=\"#\" data-report-comment\u003EReport comment\u003C/a\u003E');\n  data.html = $comment.html();\n});\nvar userEmail = '';\nFliplet.User.getCachedSession()\n    .then(function onCachedSessionRetrieved(session) {\n      var user = _.get(session, 'entries.dataSource.data');\n      userEmail = user.Email;\n     setVisitTime(userEmail);\n  //getVisitTime(userEmail)\n})",
        "customCSS": "@media screen and (min-width: 700px){.dynamic-list-add-item{right:calc(50vw - 350px)}}.news-feed-share-holder,.news-feed-share-holder:hover{position:relative;top:1px;padding-left:10px;font-size:21.3333px}\n",
        "customSCSS": "@media screen and (min-width: 700px) {\n .dynamic-list-add-item {\n   right: calc(50vw - 350px);\n  }\n}  \n.news-feed-share-holder, .news-feed-share-holder:hover{\n\tposition: relative;\n  top: 1px;\n  padding-left: 10px;\n  font-size: 21.3333px;\n}\n\n\n\n",
        "widgetInstancesInUse": [30951911, 30951912, 30951913]
      },
      "updatedAt": "2025-07-02T16:49:36.674Z",
      "slug": "discussion-1l7mj"
    },
    {
      "id": 1744602,
      "isLayout": false,
      "layout": "{{{widget 30951938}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 49202,
      "layoutOrder": 20,
      "order": 20,
      "sectionId": null,
      "title": "Manage Discussion",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows you to manage the fields for discussion topics. If you make any adjustments to the fields, you'll also need to update the List from Data Source settings in the Discussion screen to ensure they correspond correctly.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is tied to the Discussions data source, and can only be accessed through the Discussion screen which controls the flow of discussion topics and comments.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen is where users can add a new discussion topic or edit their existing ones. Social sharing options are available, allowing users to share links to discussions on social media platforms.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E Any changes made here will appear on the main Discussion screen for users to interact with.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951937, 30951938, 30951939, 30951940]
      },
      "updatedAt": "2025-07-02T16:49:42.734Z",
      "slug": "manage-discussion-1l7mq"
    },
    {
      "id": 1744574,
      "isLayout": false,
      "layout": "{{{widget 30951734}}}\n",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174209,
      "layoutOrder": 21,
      "order": 21,
      "sectionId": null,
      "title": "Exhibitors",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays a list of companies exhibiting at the event. You can manage the layout and functionality using the standard List from Data Source options. However, the \"Request a Meeting\" button is custom and must be adjusted in the component's HTML if any changes are needed. Content for exhibitors can be added or adjusted by app admins through the admin menu.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is tied to the Exhibitors data source, which manages exhibitor details.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen shows the list of companies exhibiting at the event. Attendees can click on an exhibitor and use the \"Request a Meeting\" button to schedule a meeting with that exhibitor. The \"Meeting Requests\" button at the top of the screen is only visible to exhibitors and opens the Exhibitor Meeting Request screen, where they can view and manage meeting requests from attendees for their specific company.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins can add or edit exhibitor content through the admin menu. Exhibitors must manage meeting requests through the app using the Exhibitor Meeting List screen.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Lists",
            "No code"
          ],
          "category": "Lists",
          "description": "Add a searchable directory to your app. List items expand to full screen views."
        },
        "customJS": "/** @format */\n\n//listener which navigates to the request a meeting screen\n//target: .request-meeting\n$(document).on('click', '.request-meeting', function(event) {\n  var id = $(this).attr('id');\n  return Fliplet.Navigate.screen(SCREENS.requestMeeting, {\n    query: '?entryID=' + id\n  });\n});\n\n//listener which navigates to the floorpanscreen\n//target: .floorplan-button\n$(document).on('click', '.floorplan-button', function(event) {\n  event.preventDefault();\n  var locationID = this.id;\n  console.log(locationID);\n  Fliplet.DataSources.connectByName(DS.exhibitors).then(function(connection) {\n    connection.findById(locationID).then(function(record) {\n      Fliplet.Navigate.screen(SCREENS.floorplan, {\n        query: '?entryName=' + encodeURIComponent(record.data.Booth)\n      });\n    });\n  });\n});\n\n//set exhibitor bookmark id\nFliplet.Hooks.on('flListDataBeforeGetData', function(options) {\n  options.config.dataPrimaryKey = 'Exhibitor ID';\n});\n\n//get the exhibitor status\nfunction exhibitorStatus() {\n  return Fliplet.User.getCachedSession().then(function onCachedSessionRetrieved(session) {\n    if (!session.entries || !session.entries.dataSource) {\n      return false;\n    }\n    return Fliplet.DataSources.connectByName(DS.exhibitors).then(function(connection) {\n      //Sponsors\n      return connection\n        .find({\n          where: {\n            'Email(s)': { $iLike: session.entries.dataSource.data.Email }\n          }\n        })\n        .then(function(value) {\n          if (!value.length) {\n            return false;\n          }\n          return true;\n        });\n    });\n  });\n}\n\nexhibitorStatus().then(function(exhibitorStatus) {\n  if (exhibitorStatus) {\n    $('.meeting-requests').show();\n  }\n});\n\n//show detailed view if only one record is present\nFliplet.Hooks.on('flListDataAfterRenderList', checkRecordsNum);\nfunction checkRecordsNum(options) {\n  if (Fliplet.Navigate.query.openDetailedIfOneRecord && options.records.length === 1) {\n    $('.small-card-list-item').click();\n  }\n}\n",
        "customCSS": ".new-small-card-list-container .small-card-list-detail-image-wrapper,.small-card-detail-wrapper .small-card-list-detail-image-wrapper{background-color:white}.new-small-h-card-list-container .small-h-card-list-detail-name,.new-small-card-list-container .small-card-list-name{color:#345091}.new-small-card-list-container .small-card-list-detail-close-btn,.new-small-h-card-list-container .small-h-card-list-detail-close-btn.open{color:#333}.small-card-list-text-wrapper{width:70% !important}.small-card-list-image{width:30% !important}.small-card-list-detail-image{background-repeat:no-repeat;padding:10px 15px}.mode-interact #sponsor-admin{display:block}.small-card-detail-overlay .small-card-list-detail-button-image,.small-card-detail-overlay .small-card-list-detail-button-text{color:inherit}.small-card-detail-overlay .small-card-list-detail-buttons-wrapper{margin-top:0}.small-card-list-detail-button{flex-direction:row !important;width:fit-content !important;margin-right:25px !important}.request-meeting{cursor:pointer;margin-top:15px;color:#345091}.floorplan-button{cursor:pointer;color:#345091}.meeting-requests{margin:auto;display:none}.small-card-list-detail-button-text{max-width:50px}.small-card-detail-overlay-panel .small-card-list-detail-image-wrapper{transform:translate(0px, -90px)}\n",
        "customSCSS": "/*.new-small-card-list-container .small-card-list-detail-image, .small-card-detail-wrapper .small-card-list-detail-image{\n  background-size: contain;\n}*/\n.new-small-card-list-container .small-card-list-detail-image-wrapper, .small-card-detail-wrapper .small-card-list-detail-image-wrapper{\n  background-color: white;\n}\n\n.new-small-h-card-list-container .small-h-card-list-detail-name, \n.new-small-card-list-container .small-card-list-name {\n  color: $headingTwoColor;\n}\n.new-small-card-list-container .small-card-list-detail-close-btn,\n.new-small-h-card-list-container .small-h-card-list-detail-close-btn.open{\n  color: #333;\n}\n.small-card-list-text-wrapper{\n  width:70%!important;\n}\n.small-card-list-image {\n  width:30%!important;\n}\n.small-card-list-detail-image{\n  background-repeat: no-repeat;\n  padding: 10px 15px;\n}\n.mode-interact #sponsor-admin {\n  display: block;\n}\n.small-card-detail-overlay .small-card-list-detail-button-image, .small-card-detail-overlay .small-card-list-detail-button-text{\n  color: inherit;\n}\n.small-card-detail-overlay .small-card-list-detail-buttons-wrapper{\n  margin-top: 0;\n}\n.small-card-list-detail-button{\n  flex-direction: row !important;\n  width: fit-content !important;\n  margin-right: 25px !important;\n}\n.request-meeting {\n  cursor: pointer;\n  margin-top: 15px;\n  color: $linkColor;\n}\n.floorplan-button{\n  cursor: pointer;\n  color: $linkColor;\n}\n.meeting-requests {\n  margin: auto;\n  display: none;\n}\n.small-card-list-detail-button-text{\n  max-width: 50px;\n}\n//move up the logo image in the detailed view\n.small-card-detail-overlay-panel .small-card-list-detail-image-wrapper {\n  transform: translate(0px, -90px);\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951731, 30951732, 30951733, 30951734]
      },
      "updatedAt": "2025-07-02T16:49:42.115Z",
      "slug": "exhibitors-1l7lu"
    },
    {
      "id": 1744599,
      "isLayout": false,
      "layout": "{{{widget 30951928}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174209,
      "layoutOrder": 22,
      "order": 22,
      "sectionId": null,
      "title": "Exhibitor Meeting List",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays a list of meeting requests filtered for the logged-in exhibitor user. It uses standard List from Data Source options but is configured to show data only if the logged-in user's email is listed in the \"Meeting Email(s)\" field in the Exhibitors data.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is connected to the Exhibitor Meeting Requests data source and can be accessed from the \"Meeting Requests\" button on the Exhibitors screen.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen shows a list of meeting requests specific to the logged-in exhibitor. It only displays meeting requests if the exhibitor&rsquo;s email is listed in the \"Meeting Email(s)\" field in the Exhibitors data source.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins must ensure they add the appropriate user emails to the \"Meeting Email(s)\" field when adding or editing exhibitors via the admin menu. This screen is accessed from the \"Meeting Requests\" button on the Exhibitors screen which is only visible to exhibitor users.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Lists",
            "No code"
          ],
          "category": "Lists",
          "description": "Add a searchable directory to your app. List items expand to full screen views."
        },
        "customJS": "/** @format */\n\n/*Fliplet.Hooks.on('flListDataBeforeGetData', function (options) {\n\treturn Fliplet.User.getCachedSession().then(function onCachedSessionRetrieved(\n\t\tsession\n\t) {\n\t\tvar reg = new RegExp(\n\t\t\t'' + escapeRegExp(session.entries.dataSource.data.Email) + ''\n\t\t);\n\n\t\toptions.config.dataQuery = {\n\t\t\twhere: {\n\t\t\t\t'Sponsor Emails': {\n\t\t\t\t\t$regex: reg,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t});\n});*/\n\nFliplet.Hooks.on('flListDataBeforeGetData', function(options) {\n  return Fliplet.User.getCachedSession().then(function(session) {\n    var user = _.get(session, 'entries.dataSource.data');\n    options.config.dataQuery = {\n      where: {\n        'Sponsor Emails': { $iLike: user.Email }\n      }\n    };\n  });\n});\n\nfunction escapeRegExp(string) {\n\treturn string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951928, 30951929, 30951930, 30951931]
      },
      "updatedAt": "2025-07-02T16:49:43.523Z",
      "slug": "exhibitor-meeting-list-1l7mn"
    },
    {
      "id": 1744580,
      "isLayout": false,
      "layout": "{{{widget 30951755}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174199,
      "layoutOrder": 23,
      "order": 23,
      "sectionId": null,
      "title": "Request a Meeting",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows users to request a meeting with an exhibitor. It is accessed through the Exhibitors screen by clicking the \"Request a Meeting\" button for any exhibitor. You can edit this screen as a standard form, but if any fields are adjusted, corresponding adjustments must also be made in the List from Data Source component on the Exhibitor Meeting List screen.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E This screen is tied to the Exhibitor Meeting Requests data source. Some fields are hidden and automatically populated with data from the logged-in user and the exhibitor they select. These fields can only be modified with custom code.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen allows users to request a meeting with a specific exhibitor. It is accessed by clicking \"Request a Meeting\" from the Exhibitors screen.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E Hidden fields automatically pull data from the logged-in user and the selected exhibitor, sending the request details directly to the exhibitor.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Blank",
            "No code"
          ],
          "category": "Blank screen",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "/** @format */\n\nvar query = Fliplet.Navigate.query;\nvar sponsorName = '';\nvar sponsorEmails = '';\n//var exhibitorID = '';\nvar attendeeName;\nvar attendeeEmail;\nvar attendeeCompany;\nvar sponsorID;\n\n//get sponsors data by entry id passed via query\nif (query.entryID) {\n\tsponsorID = query.entryID;\n\tFliplet.DataSources.connectByName(DS.exhibitors).then(function (connection) {\n\t\treturn connection.findById(query.entryID).then(function (record) {\n\t\t\tif (!record) {\n\t\t\t\tconsole.log('no sponsor found');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// records is the found object\n\t\t\tsponsorName = record.data['Name'];\n\t\t\tsponsorEmails = record.data['Email(s)'];\n\t\t\treturn getAttendeeDetails();\n\t\t});\n\t});\n}\n\n//add sponsor data to the record\nFliplet.Hooks.on('beforeFormSubmit', function (data) {\n\t//console.log(data);\n\tdata['Sponsor Name'] = sponsorName;\n\tdata['Sponsor Emails'] = sponsorEmails;\n\t//data['Sponsor ID'] = exhibitorID;\n});\n\n//populate form data\nfunction populateFormFields() {\n\treturn Fliplet.FormBuilder.get().then(function (form) {\n\t\tform.field('Attendee Name').set(attendeeName);\n\t\tform.field('Attendee Email').set(attendeeEmail);\n\t\tform.field('Attendee Company').set(attendeeCompany);\n\t\tform.field('Sponsor Name').set(sponsorName);\n\t\tform.field('Sponsor Emails').set(sponsorEmails);\n\t\t//form.field('Sponsor ID').set(sponsorID);\n\t});\n}\n\n//retrieve attendee details\nfunction getAttendeeDetails() {\n\treturn Fliplet.Session.get().then(function onCachedSessionRetrieved(\n\t\tsession\n\t) {\n\t\tif (!session && !session.entries) {\n\t\t\tconsole.log('no attendee found');\n\t\t\treturn;\n\t\t}\n\t\tattendeeName =\n\t\t\tsession.entries.dataSource.data['First Name'] +\n\t\t\t' ' +\n\t\t\tsession.entries.dataSource.data['Last Name'];\n\t\tattendeeEmail = session.entries.dataSource.data['Email'];\n\t\tattendeeCompany = session.entries.dataSource.data['Company'];\n\t\treturn populateFormFields();\n\t});\n}\n",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951755, 30951756, 30951757, 30951758]
      },
      "updatedAt": "2025-07-02T16:49:45.778Z",
      "slug": "request-a-meeting-1l7m4"
    },
    {
      "id": 1744600,
      "isLayout": false,
      "layout": "{{{widget 30951932}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 4337,
      "layoutOrder": 24,
      "order": 24,
      "sectionId": null,
      "title": "Chat",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows users to engage in private one-on-one or group chats. You can configure it using the standard chat component, which enables basic settings and layout options.&nbsp;\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E All chats are encrypted and cannot be accessed or viewed. The screen is connected to the Attendees &amp; User List data source to display and manage user details.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen enables users to participate in private one-on-one or group chats. Users can initiate conversations with others in the app.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E All chats are encrypted, ensuring that they remain private and cannot be accessed by anyone, including app admins.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951932]
      },
      "updatedAt": "2025-07-02T16:49:49.636Z",
      "slug": "chat-1l7mo"
    },
    {
      "id": 1744567,
      "isLayout": false,
      "layout": "{{{widget 30951694}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 25,
      "order": 25,
      "sectionId": null,
      "title": "Notifications",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays notifications sent by admins to users. It can be configured using the standard notification component.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E Notifications are tied to the app&rsquo;s communication system. You can send and test notifications in the Publish section of Studio.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen shows alerts and notifications sent by app admins to users. Notifications are used to share important updates or announcements with the user base.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins can send notifications through the admin menu in the \"Manage Communications\" section.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951694, 30951695, 30951696]
      },
      "updatedAt": "2025-07-02T16:49:51.252Z",
      "slug": "notifications-1l7ln"
    },
    {
      "id": 1744581,
      "isLayout": false,
      "layout": "{{{widget 30951760}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 26,
      "order": 26,
      "sectionId": null,
      "title": "Settings",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen provides a simple sub-menu that links to various settings options, including the \"Edit Profile\" screen and an \"About This App\" overlay. You can edit this screen as a standard list, configuring the menu items as needed. This screen is tied to the Edit Profile screen, allowing users to easily access and update their personal information.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen serves as a settings menu, giving users quick access to the \"Edit Profile\" screen and an overlay with information about the app.\u003C/p\u003E"
        },
        "customJS": "$(document).on('click', 'a:contains(\"Logout\")', function() {\n  var options = {\n    title: 'Logout',\n    message: 'Are you sure you want to logout?',\n    labels: ['Yes', 'No'] \n  };\n\n  Fliplet.Navigate.confirm(options).then(function(result) {\n    if (!result) {\n      return console.log('Not confirmed!');\n    }\n    logOut();\n  });\n});\n\nfunction logOut() {\n  Fliplet.Session.logout()\n    .then(function onSessionDestroyed() {\n      // user has been logged out\n    })\n    .then(function() {\n      Fliplet.Navigate.screen(SCREENS.login);\n    });\n}\n",
        "customCSS": ".my-qr-btn{width:100%;max-width:300px;margin:auto;margin-top:25px}.my-qr-btn i{padding-right:5px}\n",
        "customSCSS": ".my-qr-btn{\n  width: 100%;\n  max-width: 300px;\n  margin: auto;\n  margin-top: 25px;\n  i{\n    padding-right: 5px;\n  }\n}",
        "widgetInstancesInUse": [30951759, 30951760, 30951761]
      },
      "updatedAt": "2025-07-02T16:49:47.792Z",
      "slug": "settings-1l7m5"
    },
    {
      "id": 1744560,
      "isLayout": false,
      "layout": "{{{widget 30951654}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 47814,
      "layoutOrder": 27,
      "order": 27,
      "sectionId": null,
      "title": "Edit profile",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows users to edit their own profile data, which is displayed on the Attendees &amp; Speakers screen. You can configure the fields using the standard form settings, allowing adjustments to most profile information. However, the email field should not be adjusted or editable by users.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E If you do not want to allow users to edit their own profile, you can simply remove the link to this screen from the Settings screen menu.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen lets users update their personal information, which will be reflected on the Attendees &amp; Speakers screen. It is accessed through the Settings screen.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951653, 30951654, 30951655, 30951656]
      },
      "updatedAt": "2025-07-02T16:49:49.394Z",
      "slug": "edit-profile-1l7lg"
    },
    {
      "id": 1744590,
      "isLayout": false,
      "layout": "{{{widget 30951883}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174199,
      "layoutOrder": 28,
      "order": 28,
      "sectionId": null,
      "title": "Awards",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is fully custom and \u003Cstrong\u003Ecannot\u003C/strong\u003E be edited in Edit mode. No layout or content adjustments can be made directly from the editor.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E All settings related to awards, including appearance, titles, and how they are given, must be managed by app admins in the admin menu via Preview mode.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen showcases awards that users can earn by completing various actions in the app, such as starting a discussion post, bookmarking a session, or subscribing to notifications. Each award is associated with points, and users with the highest points, as well as those with the most comments, are displayed on the leaderboard.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins can adjust the appearance, titles, and criteria for earning awards through the admin menu.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Blank",
            "No code"
          ],
          "category": "Blank screen",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "/** @format */\n\n//disables tabs when editing screen\n$('.mode-interact [data-toggle=\"tab\"]').on('click', function() {\n  return false;\n});\nvar editMode = Fliplet.Env.get('interact');\n\nvar rank = 0;\nvar commentRank = 0;\n\n//show option to reset awards for admin users\nFliplet.User.getCachedSession().then(function(session) {\n  var user = _.get(session, 'entries.dataSource.data');\n\n  if (!user) {\n    return; // user is not logged in\n  }\n  if (user.Admin === 'Yes') {\n    $('.resetAward').show();\n  }\n});\n\n//generate awards from a data source\nif (!editMode) {\n  Fliplet.DataSources.connectByName(DS.awards).then(function(connection) {\n    return connection.find().then(function(records) {\n      if (records) {\n        records = _.sortBy(records, [\n          function(a) {\n            return a.data['Award Title'];\n          }\n        ]);\n        var sortedAwards = _.sortBy(records, [\n          function(a) {\n            return parseInt(a.data.Order);\n          }\n        ]);\n        $('.awards').empty();\n        sortedAwards.forEach(function(award) {\n          var html =\n            '\u003Cdiv class=\"award\" id=\"' +\n            award.data['award-id'] +\n            '\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"bottom\" data-title=\"' +\n            award.data['Award Title'] +\n            '\" data-content=\"' +\n            award.data['How to achieve this award'] +\n            '\" data-trigger=\"focus\" tabindex=\"0\"\u003E \u003Cspan class=\"fa-stack fa-lg\"\u003E \u003Cdiv  style=\"background: radial-gradient(ellipse at center, #' +\n            award.data['First color'] +\n            ', #' +\n            award.data['Second color'] +\n            ');    display: flex;justify-content: center;align-items: center;width: 100%;height: 100%;border-radius: 50%;\"\u003E\u003Ci class=\"award-icon fa ' +\n            award.data['Icon'] +\n            '  fa-inverse\"\u003E\u003C/i\u003E \u003C/div\u003E \u003C/span\u003E \u003Cp class=\"awards-text\"\u003E ' +\n            award.data['Award Title'] +\n            '\u003C/p\u003E \u003C/div\u003E';\n          $('.awards').append(html);\n          $('[data-toggle=\"popover\"]').popover();\n        });\n\n        return App.gameEngine.getUser({ forceUpdate: true }).then(function(options) {\n          var contributorScore = 0;\n          var commentScore = 0;\n          _.forEach(options.data.logs, function(log) {\n            if (!log.id.includes('comment')) {\n              contributorScore = contributorScore + parseInt(log.points);\n            } else {\n              commentScore = commentScore + parseInt(log.points);\n            }\n          });\n          $('.contributorScore').text('Your contributor score: ' + contributorScore);\n          $('.commentScore').text('Your comment score: ' + commentScore);\n          _.forEach(options.data.achievements, function(log) {\n            $('.award').each(function(value, index) {\n              if ($(this).attr('id') === log.id) {\n                $(this).css('opacity', '1');\n                $(this)\n                  .children('span')\n                  .css('opacity', '1');\n              }\n            });\n          });\n\n          //open accordion if there are awards left to collect\n          if (options.data.achievements.length \u003C sortedAwards.length) {\n            $('.panel-title').click();\n          }\n        });\n      }\n    });\n  });\n} else {\n  $('.awards').html(\n    '\u003Cdiv class=\"award-sample\" data-container=\"body\" data-toggle=\"popover\" data-placement=\"bottom\" tabindex=\"0\"\u003E \u003Cspan class=\"fa-stack fa-lg\"\u003E \u003Ci class=\"fa fa-circle fa-stack-2x\"\u003E\u003C/i\u003E \u003Ci class=\"fa fa-trophy fa-stack-1x fa-inverse\"\u003E\u003C/i\u003E \u003C/span\u003E \u003Cp class=\"awards-text\"\u003EAward example\u003C/p\u003E\u003C/div\u003E'\n  );\n}\n\n//populate users with the score\nvar contributorsPassed = false;\nFliplet.Hooks.on('flListDataBeforeRenderList', function(options) {\n  /*\n\tif (!contributorsPassed) {\n\t\treturn (options.records = options.records.sort(function (a, b) {\n\t\t\tcontributorsPassed = true;\n\t\t\treturn a.data.contributorScore - b.data.contributorScore;\n\t\t}));\n\t} else {\n\t\treturn (options.records = options.records.sort(function (a, b) {\n\t\t\treturn b.data.commentScore - a.data.commentScore;\n\t\t}));\n\t}\n  */\n});\n\nFliplet.Hooks.on('flListDataAfterGetData', function(options) {\n  return Fliplet.DataSources.connectByName(DS.awardLogs).then(function(connection) {\n    return connection.find().then(function(records) {\n      var achievementsLength = 0;\n      _.forEach(options.records, function(value) {\n        var temp = _.find(records, function(o) {\n          if (value.data.Email) {\n            achievementsLength = o.data.achievements.length;\n            return o.data.user.toLowerCase() === value.data.Email.toLowerCase();\n          }\n        });\n        if (temp !== undefined) {\n          var points = 0;\n          var commentPoints = 0;\n          _.forEach(temp.data.logs, function(record) {\n            if (!record.id.includes('comment')) {\n              points = points + parseInt(record.points);\n            } else {\n              commentPoints = commentPoints + parseInt(record.points);\n            }\n          });\n          _.set(value, 'data.achievementsLength', achievementsLength);\n          _.set(value, 'data.contributorScore', points);\n          _.set(value, 'data.commentScore', commentPoints);\n        } else {\n          _.set(value, 'data.achievementsLength', 0);\n          _.set(value, 'data.contributorScore', 0);\n          _.set(value, 'data.commentScore', 0);\n        }\n      });\n      options.records = options.records.sort(function(b, a) {\n        return a.data.achievementsLength - b.data.achievementsLength;\n      });\n    });\n  });\n});\n\n//toggle LFD's\n$('.dont').click(function() {\n  $('.commentLFD').show();\n  $('.contributorLFD').hide();\n});\n$('.do').click(function() {\n  $('.commentLFD').hide();\n  $('.contributorLFD').show();\n});\n\n//reset award listener\n$('.resetAward').click(function() {\n  App.gameEngine.resetUser();\n  Fliplet.UI.Toast('Awards reset');\n});\n\n//stop the lfd from opening the detailed view\nFliplet.Hooks.on('flListDataBeforeGetData', function(options) {\n  options.config.beforeOpen = function(data) {\n    return Promise.reject();\n  };\n});\nif (!editMode) {\n  $('.commentLFD').hide();\n} else {\n  $('.commentLFD').show();\n}\n\n//redirect to the user's profile\n$(document).on('click', '.small-card-list-item', redirectToProfile);\n$('.small-card-list-item').click(redirectToProfile);\n\nfunction redirectToProfile() {\n  var profile = $(this).attr('data-entry-id');\n  if (!profile) return;\n  return Fliplet.Navigate.screen(SCREENS.speakers, {\n    query: '?dynamicListOpenId=' + parseInt(profile) + '&dynamicListPreviousScreen=true'\n  });\n}\n\nHandlebars.registerHelper('rank', function() {\n  rank = rank + 1;\n  return new Handlebars.SafeString(rank);\n});\n\nHandlebars.registerHelper('commentRank', function() {\n  commentRank = commentRank + 1;\n  return new Handlebars.SafeString(commentRank);\n});\n",
        "customCSS": ".nav-tabs{margin-top:15px;margin-left:15px;border-bottom:none}.mode-interact .tab-pane{display:block !important;border:1px solid purple;width:100%}.nav-tabs\u003Eli{width:150px}.nav-tabs\u003Eli.active\u003Ea,.nav-tabs\u003Eli.active\u003Ea:hover,.nav-tabs\u003Eli.active\u003Ea:focus{background-color:#939393;border-radius:10px}.nav-tabs\u003Eli.active\u003Ea,.nav-tabs\u003Eli.active\u003Ea:hover,.nav-tabs\u003Eli.active\u003Ea:focus{color:white;border-radius:10px}a{color:#939393}a:hover,a:focus,a:active:hover,a:active:focus{color:#939393;border-radius:10px !important;border:1px solid #939393 !important}.tab-content{width:90%;margin:auto}.fa-lg{font-size:20px}.small-card-list-detail-button .list-icon-phone{position:absolute;top:0;right:15px;font-size:20px;padding:10px;padding-top:6px;opacity:0.3}.small-card-list-detail-button .list-icon-email{width:40px;position:absolute;top:20px;right:45px;padding:10px;padding-top:6px;font-size:20px;opacity:0.8;background-color:#313679;color:gold;border-radius:50px;height:40px;text-align:center}.small-card-list-name{padding-right:80px}.share-results,.save-results{margin-left:10px;display:inline-block}.fa-times-thin::before{content:'\\00d7'}.fa-stack.fa-lg{font-size:30px}.award{display:inline-block;text-align:center;padding:8px;opacity:0.7;width:31%;vertical-align:top}.award span{opacity:0.3}.award:focus{outline:none}.award-text{position:absolute;font-size:20px;padding-left:150px}#toast{float:left;font-size:40px}.awards-text{font-size:12px;margin:0}.awards{text-align:center}.contributorScore,.commentScore{width:100%;text-align:left}.btn-link{padding:0}.btn.btn-link{color:black;font-size:12px}.award-icon{font-size:25px}.limit-entries-text{display:none}@media (min-width: 768px) and (max-width: 1024px){.awards,.nav-tabs{margin:auto}}@media (min-width: 1281px){.awards,.nav-tabs{margin:auto}}\n",
        "customSCSS": "/** @format */\n//for tabs\n.nav-tabs {\n  margin-top: 15px;\n  margin-left: 15px;\n  border-bottom: none;\n}\n/*creates the edit boxes for the do/don't content*/\n.mode-interact .tab-pane {\n  display: block !important;\n  border: 1px solid purple;\n  width: 100%;\n}\n/*sets the width of the tabs*/\n.nav-tabs \u003E li {\n  width: 150px;\n}\n/*changes the colour of the tabs when active*/\n.nav-tabs \u003E li.active \u003E a,\n.nav-tabs \u003E li.active \u003E a:hover,\n.nav-tabs \u003E li.active \u003E a:focus {\n  background-color: #939393;\n  border-radius: 10px;\n}\n/*changes the font colour of the tabs when active*/\n.nav-tabs \u003E li.active \u003E a,\n.nav-tabs \u003E li.active \u003E a:hover,\n.nav-tabs \u003E li.active \u003E a:focus {\n  color: white;\n  border-radius: 10px;\n}\n/*changes font colour of tabs when not active*/\na {\n  color: #939393;\n}\na:hover,\na:focus,\na:active:hover,\na:active:focus {\n  color: #939393;\n  border-radius: 10px !important;\n  border: 1px solid #939393 !important;\n}\n.tab-content {\n  width: 90%;\n  margin: auto;\n}\n.fa-lg {\n  font-size: 20px;\n}\n.small-card-list-detail-button .list-icon-phone {\n  position: absolute;\n  top: 0;\n  right: 15px;\n  font-size: 20px;\n  padding: 10px;\n  padding-top: 6px;\n  opacity: 0.3;\n}\n.small-card-list-detail-button .list-icon-email {\n  width: 40px;\n  position: absolute;\n  top: 20px;\n  right: 45px;\n  padding: 10px;\n  padding-top: 6px;\n  font-size: 20px;\n  opacity: 0.8;\n  background-color: #313679;\n  color: gold;\n  border-radius: 50px;\n  height: 40px;\n  text-align: center;\n}\n.small-card-list-name {\n  padding-right: 80px;\n}\n.share-results,\n.save-results {\n  margin-left: 10px;\n  display: inline-block;\n}\n.fa-times-thin::before {\n  content: '\\00d7';\n}\n.fa-stack.fa-lg {\n  font-size: 30px;\n}\n.award {\n  display: inline-block;\n  text-align: center;\n  padding: 8px;\n  opacity: 0.7;\n  width: 31%;\n  vertical-align: top;\n}\n.award span {\n  opacity: 0.3;\n}\n.award:focus {\n  outline: none;\n}\n.award-text {\n  position: absolute;\n  font-size: 20px;\n  padding-left: 150px;\n}\n#toast {\n  float: left;\n  font-size: 40px;\n}\n.awards-text {\n  font-size: 12px;\n  margin: 0;\n}\n.awards {\n  text-align: center;\n}\n.contributorScore,\n.commentScore {\n  width: 100%;\n  text-align: left;\n}\n.btn-link {\n  padding: 0;\n}\n.btn.btn-link {\n  color: black;\n  font-size: 12px;\n}\n.award-icon {\n  font-size: 25px;\n}\n.limit-entries-text {\n  display: none;\n}\n@media (min-width: 768px) and (max-width: 1024px) {\n  .awards,\n  .nav-tabs {\n    margin: auto;\n  }\n}\n@media (min-width: 1281px) {\n  .awards,\n  .nav-tabs {\n    margin: auto;\n  }\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951879, 30951880, 30951881, 30951882, 30951883, 30951884]
      },
      "updatedAt": "2025-07-02T16:49:36.219Z",
      "slug": "awards-1l7me"
    },
    {
      "id": 1744609,
      "isLayout": false,
      "layout": "{{{widget 30951970}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 29,
      "order": 29,
      "sectionId": null,
      "title": "Event feedback",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows users to provide feedback for the entire event. It can be configured as a standard form, allowing adjustments to most fields. However, the \"User email\" field should not be edited and must remain fixed.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen is intended for collecting feedback from users about the entire event. It is accessed via the bottom menu bar.\u003C/p\u003E\n\u003Cp\u003E\u003Cstrong\u003ENote:\u003C/strong\u003E App admins should send a notification to users when the event is over, encouraging them to leave feedback, with a link to this screen.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n",
        "customCSS": "[data-field=\"UserEmail\"]{display:none}[data-field=\"Session\"]{display:none}\n",
        "customSCSS": "[data-field=\"UserEmail\"] {\n  display: none;\n}\n[data-field=\"Session\"] {\n  display: none;\n}\n",
        "widgetInstancesInUse": [30951969, 30951970, 30951971]
      },
      "updatedAt": "2025-07-02T16:49:43.989Z",
      "slug": "event-feedback-1l7n1"
    },
    {
      "id": 1744558,
      "isLayout": false,
      "layout": "{{{widget 30951627}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174199,
      "layoutOrder": 30,
      "order": 30,
      "sectionId": null,
      "title": "-== Admin Pages Below ==-",
      "settings": {
        "private": {
          "tags": [
            "Blank",
            "No code"
          ],
          "category": "Blank screen",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951627]
      },
      "updatedAt": "2025-07-02T16:49:40.818Z",
      "slug": "-admin-pages-below--1l7le"
    },
    {
      "id": 1744562,
      "isLayout": false,
      "layout": "{{{widget 30951671}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 64310,
      "layoutOrder": 31,
      "order": 31,
      "sectionId": null,
      "title": "Admin Menu",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen serves as the admin menu for managing events, providing options to set up, edit, and delete items related to events. It is a standard list component that can be edited to adjust links.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis admin menu is accessible only when logged in as an admin, allowing for efficient management of event-related tasks. This functionality is essential for maintaining the organization and effectiveness of event management within the app.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951669, 30951670, 30951671]
      },
      "updatedAt": "2025-07-02T16:49:41.678Z",
      "slug": "admin-menu-1l7li"
    },
    {
      "id": 1744608,
      "isLayout": false,
      "layout": "{{{widget 30951966}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 48166,
      "layoutOrder": 32,
      "order": 32,
      "sectionId": null,
      "title": "Admin - User List",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays the admin user list, showing all attendees and speakers, and allows the admin to add, edit, or delete user entries. It utilizes a standard List from Data Source (LFD) component, which can be edited to include additional fields as necessary.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThe admin user list enables efficient management of user information, ensuring that all participants involved in events are accurately recorded and easily accessible for updates.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": ".new-small-card-list-container .small-card-list-image.no-image{display:block}\n",
        "customSCSS": ".new-small-card-list-container .small-card-list-image.no-image{\n  display: block;\n}",
        "widgetInstancesInUse": [30951965, 30951966, 30951967, 30951968]
      },
      "updatedAt": "2025-07-02T16:49:50.193Z",
      "slug": "admin-user-list-1l7n0"
    },
    {
      "id": 1744592,
      "isLayout": false,
      "layout": "{{{widget 30951895}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-csv"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 33,
      "order": 33,
      "sectionId": null,
      "title": "Admin - Import Users",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows for bulk importing of users via a specially formatted CSV sheet and should not be edited.\u003C/p\u003E",
          "preview": "\u003Cp\u003ETo get started, download the template linked on this screen and fill it out with the required user information. Ensure that the data is formatted correctly according to the template guidelines to facilitate a smooth import process. Once completed, you can upload the CSV file to import the users efficiently.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n\nvar dataSourceId = 'Event - Attendees & User List';\n\n//do we need Fliplet.FormBuilder.get() ?\n// Import CSV on form submit\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  if (!Fliplet.CSV) {\n    return handleError('Please add the \"fliplet-csv\" dependancy to this screen');\n  }\n\n  if (!data.csv.length) {\n    return handleError('Please add CSV data');\n  }\n\n  return importCSV(data);\n});\n\n//proccess a file and import to the dat source\nfunction importCSV(data) {\n  var numberOfCommits;\n  var file = data.csv.pop();\n  console.log('file', file);\n  /*\tif (!file.type.includes('csv') && !file.type.includes('excel')) {\n\t\treturn handleError('Please upload a CSV file');\n\t}*/\n  return Fliplet.UI.Toast({\n    backdrop: true,\n    tapToDismiss: false,\n    duration: false,\n    type: 'regular',\n    position: 'center',\n    title: 'Import data from CSV',\n    message: 'Reading file...',\n    progress: true\n  }).then(function(toast) {\n    toast.setProgress(0.1);\n\n    return new Promise(function(resolve, reject) {\n      var reader = new FileReader();\n\n      reader.onload = function() {\n        // Decode CSV into JSON\n        var result = Fliplet.CSV.decode(reader.result, {\n          header: true,\n          dynamicTyping: true\n        });\n\n        var entries = result.data;\n        console.log('entries', entries);\n\n        if (!entries.length) {\n          toast.dismiss();\n          return reject('No entries found in CSV file');\n        }\n\n        toast.setProgress(0.2);\n\n        function cleanupEmail(email) {\n          return typeof email === 'string' ? email.toLowerCase().trim() : '';\n        }\n\n        var connection;\n\n        return Fliplet.DataSources.connectByName(dataSourceId)\n          .then(function(c) {\n            connection = c;\n            return connection.find();\n          })\n          .then(function(existingEntries) {\n            toast.setProgress(0.5);\n            //console.log('existingEntries', existingEntries);\n            var commits = [];\n\n            entries.map(function(entry) {\n              if(!entry.Email) { return }\n              //compare the keys of the Data Source and File. Delete Extra from entries which will be uploaded\n              entry.Email = cleanupEmail(entry.Email);\n              // Find whether this entry exists already\n              var existing = _.find(existingEntries, function(e) {\n                return cleanupEmail(entry.Email) === cleanupEmail(e.data.Email);\n              });\n\n              if (existing) {\n                entry.Password = existing.data.Password;\n\n                if (!entry.Password) {\n                  entry.Password = generateRandomPassword(8);\n                }\n                commits.push({ id: existing.id, data: entry });\n              } else {\n                if (!entry.Password) {\n                  entry.Password = generateRandomPassword(8);\n                }\n                commits.push({ data: entry });\n              }\n            });\n            toast.setProgress(0.7);\n            numberOfCommits = commits.length;\n            console.log('commits', commits);\n            return connection\n              .commit({\n                entries: commits,\n\n                // ensure existing entries are unaffected\n                append: true\n              })\n              .then(function() {\n                Fliplet.UI.Toast(parseInt(numberOfCommits) + ' entries have been inserted/updated');\n\n                // Allow UI notifications to be seen before continuing\n                setTimeout(resolve, 1500);\n              });\n          });\n      };\n\n      // Read the input file as a text (since it's CSV)\n      reader.readAsText(file);\n    });\n  });\n}\n\n//generate password if entry does not have it\nfunction generateRandomPassword(length) {\n  var alphabet = 'abcdefghijklmnopqrstuvwxyz!#$%&*-ABCDEFGHIJKLMNOP1234567890';\n  var password = '';\n\n  for (var x = 0; x \u003C length; x++) {\n    password += alphabet.charAt(Math.floor(Math.random() * alphabet.length));\n  }\n\n  return password;\n}\n\nfunction handleError(msg) {\n  return Promise.reject(msg);\n}\n/**/\n",
        "customCSS": "",
        "customSCSS": "",
        "isBlockedScreen": false,
        "widgetInstancesInUse": [30951895, 30951896, 30951897, 30951898]
      },
      "updatedAt": "2025-07-02T16:49:46.208Z",
      "slug": "admin-import-users-1l7mg"
    },
    {
      "id": 1744575,
      "isLayout": false,
      "layout": "{{{widget 30951737}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 64371,
      "layoutOrder": 34,
      "order": 34,
      "sectionId": null,
      "title": "Admin - Manage Users",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen provides a form for adding and editing user profiles and access information. It can be edited as a standard form, but certain fields, such as user type and personalized agenda, are custom and should not be modified.\u003C/p\u003E",
          "preview": "\u003Cp\u003ETo manage users, fill out the form with the necessary details, ensuring that all information is accurate and complete. Be cautious not to alter the restricted fields. Once the form is filled out, you can save the changes to update user profiles effectively.\u003C/p\u003E"
        },
        "customJS": "var sendEmail;\nvar data = [];\nlet query = Fliplet.Navigate.query;\n\nFliplet.Hooks.on('beforeFormSubmit', function (data) {\n\tsendEmail = !!data.sendEmail.length;\n\tdelete data.sendEmail;\n\t// when admin changes this user's password\n\tif (data._Password) {\n\t\tdata.Password = data._Password;\n\t\tdelete data._Password;\n\t}\n\treturn data;\n});\n\nFliplet.Hooks.on('afterFormSubmit', function (result) {\n\tif (sendEmail) {\n\t\treturn sendNewPasswordEmail(result.formData);\n\t}\n});",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951735, 30951736, 30951737, 30951738]
      },
      "updatedAt": "2025-07-02T16:49:51.373Z",
      "slug": "admin-manage-users-1l7lv"
    },
    {
      "id": 1744579,
      "isLayout": false,
      "layout": "{{{widget 30951752}}}\n\n\u003Cdiv class=\"loadingIcon\"\u003E\n  \u003Clord-icon src=\"https://cdn.lordicon.com/ppwsfvnn.json\" trigger=\"hover\" colors=\"primary:#000000,secondary:#ffffff\" style=\"width:250px;height:250px\"\u003E\u003C/lord-icon\u003E\n  \u003Cdiv class=\"loadingText\"\u003EGenerating Image...\u003C/div\u003E\n\u003C/div\u003E",
      "dependencies": [
        "bootstrap-css",
        {
          "url": "https://cdn.fliplet.com/apps/185878/dependencies/image-picker-45e2b9c83a0d730a018b35e9207c78ce.css",
          "name": "image-picker",
          "path": "apps/185878/dependencies/image-picker-45e2b9c83a0d730a018b35e9207c78ce.css",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/image-picker/0.3.1/image-picker.css",
          "updatedAt": 1706572886
        },
        {
          "url": "https://cdn.fliplet.com/apps/185878/dependencies/image-pickermin-f5d7292fe8fbd5906bc8858488357d2b.js",
          "name": "image-picker.min",
          "path": "apps/185878/dependencies/image-pickermin-f5d7292fe8fbd5906bc8858488357d2b.js",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/image-picker/0.3.1/image-picker.min.js",
          "updatedAt": 1706572886
        },
        {
          "url": "https://cdn.fliplet.com/apps/185878/dependencies/lordicon-6c630af480160e733c2c11fda0a93a7e.js",
          "name": "lordicon",
          "path": "apps/185878/dependencies/lordicon-6c630af480160e733c2c11fda0a93a7e.js",
          "latest": "https://cdn.lordicon.com/lordicon.js",
          "updatedAt": 1706572886
        }
      ],
      "appId": 389751,
      "layoutId": 64364,
      "layoutOrder": 35,
      "order": 35,
      "sectionId": null,
      "title": "Admin - Manage Event Info",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen can be edited as a standard form component to add or modify fields, but adjustments may need to be made to the Event Info screen List from Data Source (LFD) to reflect any changes.\u003C/p\u003E",
          "preview": "\u003Cp\u003ETo manage event information, such as including news, updates, and venue details, fill out the form with the necessary details. After making edits, remember to check the Event Info LFD to ensure that it aligns with the updated event details.\u003C/p\u003E"
        },
        "customJS": "//Image Gen\nvar palette = 'natural';\nvar style = 'photorealistic';\n\nasync function getAiImagePrompt(obj) {\n  let prompt = `Generate a detailed ai image generation prompt using as much of the following json data as appropriate for an event app. Ensure the image does not include any text. Only return the prompt as text. Do not explain your answer. Style:${style} palette:${palette}\u003Cjson data\u003E ${JSON.stringify(\n    obj\n  )} \u003C/json data\u003E`;\n\n  const result = Fliplet.AI().ask(prompt);\n  console.log(result);\n  return result;\n}\n\nasync function getAiImages(prompt) {\n  const result = await Fliplet.AI.generateImage({\n    prompt: prompt,\n    n: 1,\n    response_format: 'b64_json',\n    model: 'dall-e-3'\n  });\n  return Promise.resolve(result);\n}\n\nfunction resizeBase64Img(base64, width, height, callback) {\n  // Create an Image object\n  var img = new Image();\n\n  // Specify what to do once the image has loaded\n  img.onload = function() {\n    // Create a canvas with the desired dimensions\n    var canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n\n    // Get the drawing context of the canvas\n    var ctx = canvas.getContext('2d');\n\n    // Draw the image onto the canvas with the new dimensions\n    ctx.drawImage(img, 0, 0, width, height);\n\n    // Get the base64 string from the canvas, maintaining the image type\n    var dataUrl = canvas.toDataURL('image/jpeg');\n\n    // Call the callback function with the new base64 string\n    callback(dataUrl);\n  };\n\n  // Set the source of the image to your base64 string\n  img.src = base64;\n}\n\nFliplet.FormBuilder.get().then(function (form) {\n  var fieldValidated = false;\n  form.field('Image').change(function (val) {\n    console.log(val)\n    if (val.length == 1){\n      $('[id=\"Image\"]').prop('disabled', true);\n    }\n    if (val.length == 0){\n      $('[id=\"Image\"]').prop('disabled', false);\n    }\n  }, false);\n});\n\n\n$(document).on('click', '.btn.btn-secondary.generateImage', function() {\n  //$(this).unbind();\n  var formThis = $(this);\n  Fliplet.FormBuilder.get().then(function(form) {\n    if (form.field('Image').get().length \u003E 0){\n      Fliplet.UI.Toast(\"Only one image allowed. Delete existing image and try again.\")\n      return\n    }\n    if (formThis.attr('class').includes('regenerate')) {\n      /*var options = {\n        progress: true,\n        type: 'regular',\n        message: 'Generating Image...'\n      };\n      var loading = Fliplet.UI.Toast(options);\n      loading.then(function() {\n        Fliplet.UI.Toast.setProgress(0.5);\n      });*/\n      $('.loadingIcon').css('visibility', 'visible');\n      var prompt = form.field('Image prompt').get();\n      return getAiImages(prompt).then(function(result) {\n        console.log('data:image/jpeg;base64,' + result.data[0].b64_json);\n        return resizeBase64Img(\n          'data:image/jpeg;base64,' + result.data[0].b64_json,\n          512,\n          512,\n          function(resizedBase64) {\n            console.log(resizedBase64);\n            console.log(result.data[0].b64_json);\n            form.field('Image').set(['data:image/jpeg;base64,' + result.data[0].b64_json]);\n            //Fliplet.UI.Toast.dismiss();\n            $('.loadingIcon').css('visibility', 'hidden');\n            return;\n          }\n        );\n      });\n    } else {\n      /*var options = {\n        progress: true,\n        type: 'regular',\n        message: 'Generating Image...'\n      };\n      var loading = Fliplet.UI.Toast(options);\n      loading.then(function() {\n        Fliplet.UI.Toast.setProgress(0.5);\n      });*/\n      $('.loadingIcon').css('visibility', 'visible');\n      let formObj = {};\n      formObj.Title = form.field('Title').get();\n      formObj.Content = form.field('Content').get();\n      return getAiImagePrompt(formObj).then(function(imagePrompt) {\n        console.log(imagePrompt);\n        form.field('Image prompt').instance.isHidden = false;\n        form.field('Image prompt').set(imagePrompt);\n        return getAiImages(imagePrompt).then(function(result) {\n          return resizeBase64Img(\n            'data:image/jpeg;base64,' + result.data[0].b64_json,\n            512,\n            512,\n            function(resizedBase64) {\n              console.log(result.data[0].b64_json);\n              console.log(resizedBase64);\n              form.field('Image').set([resizedBase64]);\n              $('.loadingIcon').css('visibility', 'hidden');\n             // loading.then(function() {\n                $('.btn.btn-secondary.generateImage').html(\n                  '\u003Ci class=\"fa fa-magic\" aria-hidden=\"true\"\u003E\u003C/i\u003ERegenerate Image'\n                );\n                $('.btn.btn-secondary.generateImage').addClass('regenerate');\n                $('.loadingIcon').css('visibility', 'hidden');\n                //Fliplet.UI.Toast.setProgress(1);\n                //Fliplet.UI.Toast.dismiss();\n              //});\n            }\n          );\n        });\n      });\n    }\n  });\n});\n\n//Content gen\n$(document).on('click', '.btn.btn-primary.generateContent', function() {\n  debugger;\n  Fliplet.FormBuilder.get().then(async function(form) {\n    form.field('Content').set('');\n    var data = {\n      Title: form.field('Title').get()\n    };\n    const prompt = `Please generate a 2 paragraph engaging description of information about the topic below in the JSON data for inside an event app. Information may include specific venue location, transportation options, or more info that is appropriate to attendees going to an event. Do not include what is in the JSON data. The output must be in HTML format and only include paragraph tags. No other formatting is allowed. ### below\n###\n${JSON.stringify(data)}\n###`;\n    const chat = Fliplet.AI({ temperature: 0.6, stream: true }); //0.3\n    var options = {\n      type: 'regular',\n      backdrop: true,\n      tapToDismiss: false,\n      progress: true,\n      message: 'Generating Content...'\n    };\n    Fliplet.UI.Toast(options);\n    Fliplet.UI.Toast.setProgress(0.5);\n    var result;\n    Fliplet.UI.Toast('Generating...');\n    try {\n      result = await chat\n        .ask(prompt)\n        .stream(function onChunk(text) {\n          if (text.choices[0].delta.content) {\n            form.field('Content').set(form.field('Content').get() + text.choices[0].delta.content);\n          }\n        })\n        .then(function onComplete() {\n          Fliplet.UI.Toast('Generation complete');\n        });\n    } catch (err) {\n      Fliplet.UI.Toast(err);\n    }\n  });\n});\n\n\n",
        "customCSS": ".generateImage .fa,.generateContent .fa{padding-right:5px}.canvas-holder{width:350px;height:350px}.fileUpload .canvas-holder canvas{height:350px;width:350px}.loadingIcon{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;flex-direction:column;visibility:hidden}.loadingText{margin-top:20px;color:#ffffff;font-size:20px;text-align:center}\n",
        "customSCSS": ".generateImage .fa, .generateContent .fa{\n  padding-right: 5px;\n  //margin-top: 10px;\n}\n.canvas-holder{\n  width: 350px;\n  height: 350px;\n}\n.fileUpload .canvas-holder canvas {\n  height: 350px;\n  width: 350px;\n}\n\n\n.loadingIcon{\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  visibility: hidden;\n}\n.loadingText {\n  margin-top: 20px;\n  /* Spacing between the icon and the text */\n  color: #ffffff;\n  /* Color of the text */\n  font-size: 20px;\n  /* Size of the text */\n  text-align: center;\n  /* Center align the text */\n}",
        "widgetInstancesInUse": [30951751, 30951752, 30951753, 30951754]
      },
      "updatedAt": "2025-07-02T16:49:47.180Z",
      "slug": "admin-manage-event-info-1l7m3"
    },
    {
      "id": 1744601,
      "isLayout": false,
      "layout": "{{{widget 30951933}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 378155,
      "layoutOrder": 36,
      "order": 36,
      "sectionId": null,
      "title": "Admin - Manage Timezone Settings",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows for adjusting the times for agenda sessions to either reflect your set timezone or change to each user's device. It is a custom screen and should not be edited.\u003C/p\u003E",
          "preview": "\u003Cp\u003ETo manage timezone settings, select the desired option for displaying agenda times.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "isBlockedScreen": false,
        "widgetInstancesInUse": [30951933, 30951934, 30951935, 30951936]
      },
      "updatedAt": "2025-07-02T16:49:42.249Z",
      "slug": "admin-manage-timezone-settings-1l7mp"
    },
    {
      "id": 1744561,
      "isLayout": false,
      "layout": "{{{widget 30951665}}}\n{{{widget 30951660}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1726009,
      "layoutOrder": 37,
      "order": 37,
      "sectionId": null,
      "title": "Admin - Check-In",
      "settings": {
        "private": {
          "tags": [
            "Content page",
            "No code",
            "Popular"
          ],
          "category": "Content page",
          "description": "A beautiful article format that looks good on desktop and mobile."
        },
        "customJS": "// Set the filter criteria based on the query parameter or default to 'pending'\nlet filterBy = Fliplet.Navigate.query.filterBy || 'pending';\nlet sessionFilter = Fliplet.Navigate.query.sessionFilter || 'event';\n\n// Define column names for attended status and event ID\nconst attendedColumnName = 'Attended';\nlet allSessions = [];\nlet allUsers = [];\nlet timeConversionIsRequired, userTimezone, originalTimezone;\n\n// Define filter configurations for different states\nconst filters = {\n  PENDING: {\n    queryParameter: 'pending', // Query parameter for pending status\n    additionalQueryType: '$or', // Type of additional query\n    additionalQuery: [ // Conditions for pending status\n      { [attendedColumnName]: { $exists: false }}, // No attendance record\n      { [attendedColumnName]: '' } // Attendance record is empty\n    ],\n    btnClass: 'pending', // CSS class for pending button\n    btnSelector: $(document).find('.pending'), // jQuery selector for pending button\n    countKey: 'emptyAttended' // Key for counting empty attended records\n  },\n  CHECKED_IN: {\n    queryParameter: 'ckechedIn', // Query parameter for checked-in status\n    additionalQueryType: '$and', // Type of additional query\n    additionalQuery: [ // Conditions for checked-in status\n      { [attendedColumnName]: { $exists: true }}, // Attendance record exists\n      { [attendedColumnName]: { $ne: '' }} // Attendance record is not empty\n    ],\n    btnClass: 'checked_in', // CSS class for checked-in button\n    btnSelector: $(document).find('.checked_in'), // jQuery selector for checked-in button\n    countKey: 'nonEmptyAttended' // Key for counting non-empty attended records\n  },\n  ALL: {\n    queryParameter: 'all', // Query parameter for all records\n    btnSelector: $(document).find('.all'), // jQuery selector for all button\n    btnClass: 'all', // CSS class for all button\n    countKey: 'totalAttendees' // Key for counting total attendees\n  }\n};\n\n// Hook to modify data before fetching\nFliplet.Hooks.on('flListDataBeforeGetData', function(options) {\n  options.config.beforeOpen = function(entry) {    \n    // Prevent opening if check-in or check-out buttons are clicked\n    if (\n      entry.event.target.className.indexOf('check_in_button') \u003E -1 ||\n      entry.event.target.className.indexOf('check_out_button') \u003E -1\n    ) {\n      return Promise.reject(''); // Reject the promise to prevent action\n    }\n  };\n  \n  let query = {\n    where: {}\n  };\n\n  // Apply session filter only if sessionFilter is 'event'\n  if (sessionFilter === 'event') {\n    $('#walk_in_container').addClass('visible');\n    // Apply additional filters based on the selected filter type\n    if (filterBy == filters.PENDING.queryParameter || filterBy == filters.CHECKED_IN.queryParameter){\n      let filter = filterBy == filters.PENDING.queryParameter ? 'PENDING' : 'CHECKED_IN';\n      query.where[filters[filter].additionalQueryType] = filters[filter].additionalQuery; // Add additional query conditions\n    }\n    return (options.config.dataQuery = query); // Set the data query\n  } else {\n    options.config.dataQuery = {\n      join: {\n        Attendance: {\n          dataSourceName: DS.attendingLogs,\n          where: {\n            'Session ID': sessionFilter\n          },\n          on: {\n            'data.Email': 'data.Email'\n          }\n        }\n      }\n    };\n  }\n});\n\n// Hook to modify data after fetching\nFliplet.Hooks.on('flListDataAfterGetData', function(options) {\n  allUsers = options.records;\n  \n  // Only run aggregate query if sessionFilter is 'event'\n  if (sessionFilter !== 'event') {\n    return findFilteredUsers(options.records, sessionFilter).then(result =\u003E {\n      \n      _.remove(options.records, function(record) {\n        if (filterBy === filters.PENDING.queryParameter){\n          return !result.users.toCheckIn.includes(record.id);\n        } else if (filterBy === filters.CHECKED_IN.queryParameter){\n          return !result.users.toCheckOut.includes(record.id);\n        } else if (filterBy === filters.ALL.queryParameter){\n          return !result.users.all.includes(record.id);\n        }\n      });\n      renderAttendanceNumbers([result.stats]);\n      // Update records to show check-in/check-out buttons\n      options.records.forEach((record, key) =\u003E {\n        if (result.users.toCheckIn.includes(record.id)){\n          record.data.showCheckInButton = true; // Show check-in button\n        } else if (result.users.toCheckOut.includes(record.id)){\n          record.data.showCheckOutButton = true; // Show check-out button\n        } else if (!result.users.toCheckIn.includes(record.id) && !result.users.toCheckOut.includes(record.id)){\n          record.data.showVisitedButton = true; // Show visited text\n        }\n      });\n      \n      return Promise.resolve(options.records);\n    });\n  } else {\n    return Fliplet.DataSources.connectByName(DS.users).then(connection =\u003E {\n      return connection.find({\n        aggregate: [ // Aggregate data to count attendees\n          {\n            $facet: {\n              totalAttendees: [ // Count total attendees\n                { $count: \"count\" }\n              ],\n              emptyAttended: [ // Count empty attended records\n                { $match: { \n                  $or: [{ [`data.${attendedColumnName}`]: null }, { [`data.${attendedColumnName}`]: \"\" }] \n                }},\n                { $count: \"count\" }\n              ],\n              nonEmptyAttended: [ // Count non-empty attended records\n                { $match: { \n                  $and: [{ [`data.${attendedColumnName}`]: { $ne: null }}, { [`data.${attendedColumnName}`]: { $ne: \"\" }}] \n                }},\n                { $count: \"count\" }\n              ]\n            }\n          }\n        ]\n      }).then(result =\u003E {\n        // Update records to show check-in/check-out buttons\n        options.records.forEach((record, key) =\u003E {\n          if (record.data.hasOwnProperty(attendedColumnName) && (record.data[attendedColumnName] == 'Walk in' || record.data[attendedColumnName] == 'Attended')){\n            record.data.showCheckOutButton = true; // Show check-out button\n          } else {\n            record.data.showCheckInButton = true; // Show check-in button\n          }\n        });\n        \n        renderAttendanceNumbers(result)\n        return Promise.resolve(true); // Resolve the promise\n      });\n    });\n  }\n});\n\n// Refresh the page when the refresh button is clicked\n$(document).on('click', '.refresh', function(event) {\n  window.location.reload(); // Reload the current page\n});\n\n// Handle tab button clicks to filter data\n$('.tabs .btn').click(function(e) {\n  e.preventDefault(); // Prevent default button action\n  let $btnParent = $(this).closest('.tab'); // Get the closest tab\n  let currentPageId = Fliplet.Env.get('pageId'); // Get the current page ID\n  let clickedButtonFilter; // Variable to hold the clicked button filter\n  \n  // Determine which filter button was clicked\n  if ($btnParent.hasClass(filters.PENDING.btnClass)) clickedButtonFilter = 'PENDING';\n  if ($btnParent.hasClass(filters.CHECKED_IN.btnClass)) clickedButtonFilter = 'CHECKED_IN';\n  if ($btnParent.hasClass(filters.ALL.btnClass)) clickedButtonFilter = 'ALL';\n\n  const currentQueryParams = Fliplet.Navigate.query;\n  \n  // Navigate to the current page with both filter parameters\n  Fliplet.Navigate.screen(currentPageId, { \n    query: `?filterBy=${filters[clickedButtonFilter].queryParameter}&sessionFilter=${currentQueryParams.sessionFilter || 'event'}`\n  });  \n});\n\n// Handle scan QR code button click\n$(document).on('click', '.scan_qr_code', function() {\n  if (!sessionFilter) {\n    Fliplet.UI.Toast('Session/Event is not selected');\n    return;\n  }\n\n  Fliplet.Navigate.screen(SCREENS.adminScanQRCode, {\n    query: `?event=${sessionFilter}`\n  });\n});\n\n// Handle check-in and check-out buttons clicks\n$(document).on('click', '.check_in_button, .check_out_button', function(e) {\n  e.preventDefault(); // Prevent default button action\n  const buttonWrapper = $(this).closest('.small-card-list-item').length ? $(this).closest('.small-card-list-item') : $(this).closest('.small-card-detail-wrapper').length ? $(this).closest('.small-card-detail-wrapper') : ''; // Get the closest wrapper\n  if (buttonWrapper) {\n    const entryID = buttonWrapper.attr('data-entry-id'); // Get the entry ID\n    const isCheckIn = $(this).hasClass('check_in_button');\n    \n    if (sessionFilter === 'event') {\n      // Handle event check-in/out\n      let recordToUpdate = {};\n      if (isCheckIn) {\n        recordToUpdate = { [attendedColumnName]: 'Attended' }; // Set status to 'Attended' for check-in\n      } else {\n        recordToUpdate = { [attendedColumnName]: '' }; // Clear status for check-out\n      }\n      \n      // Connect to the data source and update the attendance status\n      Fliplet.DataSources.connectByName(DS.users).then(connection =\u003E {\n        return connection.update(entryID, recordToUpdate).then(() =\u003E {\n          handleNavigationAfterUpdate();\n        });\n      });\n    } else {\n      // Handle session check-in/out\n      const user = allUsers.find(u =\u003E u.id === +entryID);\n      if (!user) {\n        console.error('User not found');\n        return;\n      }\n\n      const attendance = user.joins && user.joins.Attendance && user.joins.Attendance[0];\n      const currentTime = moment().tz(timeConversionIsRequired ? originalTimezone : userTimezone).format('YYYY-MM-DD HH:mm');\n      \n      const attendanceData = {\n        'Session ID': sessionFilter,\n        'Email': user.data.Email\n      };\n\n      if (isCheckIn){\n        attendanceData['Check in time'] = currentTime;\n      } else {\n        attendanceData['Check out time'] = currentTime;\n        const checkInTime = moment(attendance.data['Check in time']);\n        //calculate the difference between check in and check out time\n        const diff = moment(attendanceData['Check out time']).diff(checkInTime, 'minutes');\n        attendanceData['Attendance in minutes'] = diff;\n      }\n\n      // Connect to the attendance logs data source\n      Fliplet.DataSources.connectByName(DS.attendingLogs).then(connection =\u003E {\n        if (attendance) {\n          // Update existing record\n          return connection.update(attendance.id, attendanceData).then(() =\u003E {\n            handleNavigationAfterUpdate();\n          });\n        } else if (isCheckIn) {\n          // Create new record only for check-in\n          return connection.insert(attendanceData).then(() =\u003E {\n            handleNavigationAfterUpdate();\n          });\n        }\n      });\n    }\n  }\n});\n\n// Helper function to handle navigation after update\nfunction handleNavigationAfterUpdate() {\n  const currentQueryParams = Fliplet.Navigate.query;\n  \n  // Check if the query parameters contain 'dynamicListOpenId'\n  if (currentQueryParams.hasOwnProperty('dynamicListOpenId')) {\n    // Get the current screen ID (page ID)\n    const currentScreenID = Fliplet.Env.get('pageId');\n    // Navigate to the current screen with both filter parameters\n    Fliplet.Navigate.screen(currentScreenID, { \n      query: `?filterBy=${currentQueryParams.filterBy}&sessionFilter=${currentQueryParams.sessionFilter || 'event'}`\n    });\n  } else {\n    // If 'dynamicListOpenId' is not present, reload the page to reflect changes\n    window.location.reload();\n  }\n}\n\nFliplet.FormBuilder.get().then(function (form) {\n  return getSessions().then((sessions)=\u003E {\n    // Create array of options\n    const options = [\n      { id: 'event', label: 'Event' }\n    ];\n    \n    const notOverSessions = sessions.filter(s =\u003E checkIfAgendaIsNotOver(s));\n\n    // Add session options to array\n    notOverSessions.forEach(record =\u003E {\n      options.push({\n        id: record.data['Session ID'],\n        label: record.data.Title\n      });\n    });\n\n    form.field('Sessions and Event').options(options);\n\n    if (sessionFilter == 'event'){\n      form.field('Sessions and Event').set('event');\n    } else {\n      form.field('Sessions and Event').set(sessionFilter);\n    }\n\n    // Add change event handler\n    form.field('Sessions and Event').change(function(value) {\n      sessionFilter = value;\n      const currentPageId = Fliplet.Env.get('pageId');\n      const currentQueryParams = Fliplet.Navigate.query;\n      \n      if (value && value !== currentQueryParams.sessionFilter){\n        // Navigate to the current page with updated session filter\n        Fliplet.Navigate.screen(currentPageId, {\n          query: `?filterBy=${currentQueryParams.filterBy || 'pending'}&sessionFilter=${value}`\n        });\n      }\n    }, false);\n  }).then(()=\u003E {\n    return TimeConversion.getAppSetup().then(function(appSettings){\n      if (!appSettings) {\n        return Promise.resolve(true);\n      }\n\n      if (TimeConversion.checkIfConversionIsRequired(appSettings)){   \n        timeConversionIsRequired = true;\n        originalTimezone = appSettings.data['Event Timezone'];\n        userTimezone = TimeConversion.getCurrentUserTimezone();\n      } else {\n        userTimezone = appSettings.data['Event Timezone'];\n      }\n    });\n  });\n});\n\nfunction renderAttendanceNumbers(result){\n  let currentFilter = getCurrentFilter(); // Get the current filter\n\n  // Update button text and active state based on counts\n  Object.entries(filters).forEach(([key, value]) =\u003E {\n    let btnCurrentText = value.btnSelector.find('input').val(); // Get current button text\n    let btnUpdatedText = replaceTextInParentheses(btnCurrentText, result[0][value.countKey].count); // Update button text with count\n    value.btnSelector.find('input').val(btnUpdatedText); // Set updated button text\n    key == currentFilter ? value.btnSelector.addClass('active') : value.btnSelector.removeClass('active'); // Set active class\n  });\n}\n\n// Function to get the current filter based on the filterBy variable\nfunction getCurrentFilter() {\n  if (filterBy == filters.PENDING.queryParameter) return 'PENDING'; // Return 'PENDING' if filter is pending\n  if (filterBy == filters.CHECKED_IN.queryParameter) return 'CHECKED_IN'; // Return 'CHECKED_IN' if filter is checked in\n  return 'ALL'; // Return 'ALL' if no specific filter is set\n}\n\n// Function to replace text in parentheses with the number of attendees\nfunction replaceTextInParentheses(buttonText, numberOfAttendees) {\n  return buttonText.replace(/\\(.*?\\)/, `(${numberOfAttendees})`); // Replace text in parentheses with the count\n}\n\nfunction getSessions() {\n  // Fetch sessions from Agenda data source\n  return Fliplet.DataSources.connectByName(DS.agenda).then(connection =\u003E {\n    return connection.find({\n      where: {\n      \t[VARIABLES.enableCheckIn]: VARIABLES.enableCheckInOptions.admins\n      }\n    }).then(records =\u003E {\n      allSessions = JSON.parse(JSON.stringify(records));\n      return Promise.resolve(records);\n    });\n  });\n}\n\nfunction findFilteredUsers(records, sessionFilter){\n  let usersFilteredBySession;\n\n  return new Promise((resolve, reject)=\u003E {\n    if (!allSessions.length){\n      return getSessions().then(()=\u003E {\n        return resolve(true);\n      });\n    }\n\n    resolve(true);\n  }).then(()=\u003E {\n    //find session\n    const session = allSessions.find(s =\u003E s.data['Session ID'] == sessionFilter);\n    if (session.data.hasOwnProperty('Optional') && session.data.Optional && session.data.Optional === 'Yes'){\n      usersFilteredBySession = records.filter(record =\u003E session.data[VARIABLES.personalizedAgenda].includes(record.data.Email));\n    } else {\n      usersFilteredBySession = records;\n    }\n\n    let canCheckIn = 0;\n    let canCheckOut = 0;\n    let total = usersFilteredBySession.length;\n    let usersToShow = [];\n    let usersToCheckIn = [];\n    let usersToCheckOut = [];\n\n    // Filter users based on attendance status and selected tab\n    usersFilteredBySession.filter(record =\u003E {\n      const attendance = record.joins && record.joins.Attendance && record.joins.Attendance[0];\n      \n      // Check attendance status\n      const isCheckedIn = attendance && attendance.data['Check in time'] && !attendance.data['Check out time'];\n      const isNotCheckedIn = !attendance || !attendance.data['Check in time'];\n      \n      if (isNotCheckedIn) {\n        usersToCheckIn.push(record.id);\n        canCheckIn++;\n      }\n      if (isCheckedIn) {\n        usersToCheckOut.push(record.id);\n        canCheckOut++;\n      }\n\n      // Apply filter based on filterBy parameter\n      switch (filterBy) {\n        case filters.PENDING.queryParameter:\n          usersToShow.push(record.id);\n          return isNotCheckedIn;\n        case filters.CHECKED_IN.queryParameter:\n          usersToShow.push(record.id);\n          return isCheckedIn;\n        case filters.ALL.queryParameter:\n          usersToShow.push(record.id);\n          return true;\n      }\n    });\n    return Promise.resolve({\n      users: {\n        toCheckIn: usersToCheckIn,\n        toCheckOut: usersToCheckOut,\n        all: usersToShow\n      },\n      stats: {\n        emptyAttended: {count: canCheckIn},\n        nonEmptyAttended: {count: canCheckOut},\n        totalAttendees: {count: total}\n      }\n    });\n  });\n}",
        "customCSS": ".check_in_button,.check_out_button{margin:10px 0px;min-width:100px;width:auto !important;text-align:center;position:absolute;font-size:14px;right:10px}.refresh{cursor:pointer}.active .btn{background:#345091 !important;color:#ffff !important}.fl-page-content-wrapper{padding-bottom:175px !important}#walk_in_container{display:none !important}#walk_in_container.visible{display:flex !important}\n",
        "customSCSS": ".check_in_button, .check_out_button {\n  margin: 10px 0px;\n  min-width: 100px;\n  width: auto !important;\n  text-align: center;\n  position: absolute;\n  font-size: 14px;\n  right: 10px;\n}\n.new-small-card-list-container .small-card-list-item {\n  //height: auto;\n}\n.refresh{\n  cursor: pointer;\n}\n.active{\n  .btn{\n    background: $highlightColor !important;\n    color: #ffff !important;\n  }\n}\n.fl-page-content-wrapper {\n    padding-bottom: 175px !important;\n}\n#walk_in_container{\n  display: none !important;\n  &.visible{\n    display: flex !important;\n  }\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951657, 30951658, 30951659, 30951660, 30951661, 30951662, 30951663, 30951664, 30951665, 30951666, 30951667, 30951668]
      },
      "updatedAt": "2025-07-02T16:49:34.089Z",
      "slug": "admin-check-in-1l7lh"
    },
    {
      "id": 1744594,
      "isLayout": false,
      "layout": "{{{widget 30951903}}}{{{widget 30951906}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-barcode"
      ],
      "appId": 389751,
      "layoutId": 1712717,
      "layoutOrder": 38,
      "order": 38,
      "sectionId": null,
      "title": "Admin - Scan QR code",
      "settings": {
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let messageNotAllowed = 'You are not allowed to attend this session!';\nlet messageSuccessCheckin = 'Successfully checked in to {type}!';\nlet messageSuccessCheckout = 'Successfully checked out from {type}!';\nlet messageOnWeb = 'Scanning QR code is not available on web';\nlet messageCanceledScanning = 'Scanning was canceled by user';\nlet alreadyCheckInMessage = 'Sorry, you have already checked in to this {type}. If you need further assistance, please contact someone from Support Team.';\nlet messageEventRequired = 'Event parameter is required to scan QR code';\nlet messageUserNotFound = 'User not found. Please make sure the QR code is valid.';\nlet messageSessionNotFound = 'Session not found. Please try again later.';\nlet messageSessionOver = 'This session has already ended.';\nlet messageInvalidQR = 'Invalid QR code format. Please try again.';\nlet messageOffline = 'Device is offline. Please check your internet connection.';\nlet originalTimezone, userTimezone, timeConversionIsRequired;\nconst isOnline = Fliplet.Navigator.isOnline();\nconst attendedColumnName = 'Attended';\n\n// TimeConversion utility object\nconst TimeConversion = {\n  getAppSetup: function() {\n    return Fliplet.DataSources.connectByName('App Setup').then(function(connection) {\n      return connection.findOne();\n    });\n  },\n  \n  checkIfConversionIsRequired: function(appSettings) {\n    return appSettings && appSettings.data && appSettings.data['Event Timezone'] && \n           appSettings.data['Event Timezone'] !== moment.tz.guess();\n  },\n  \n  getCurrentUserTimezone: function() {\n    return moment.tz.guess();\n  }\n};\n\n// VARIABLES object for dynamic field names\nconst VARIABLES = {\n  personalizedAgenda: 'Personalized Agenda'\n};\n\n// Data Sources object\nconst DS = {\n  users: 'Users',\n  agenda: 'Agenda',\n  attendingLogs: 'Attending Logs'\n};\n\n// Screens object\nconst SCREENS = {\n  adminManageAttendees: 'Admin - Manage Attendees'\n};\n\n// Check if event parameter is present\nlet eventParam = Fliplet.Navigate.query.event;\n\n//manual_check_in\nFliplet.Navigate.registerFunction('manual_check_in', function() {\n  Fliplet.Navigate.screen(SCREENS.adminManageAttendees, { query: `?filterBy=pending&sessionFilter=${eventParam}`});\n});\n\nif (!eventParam) {\n  clearMessages();\n  $('.circle-loader').hide();\n  $('.loader-message').hide();\n  $('.unavailable .message').text(messageEventRequired).show();\n  return;\n}\n  \nif (Fliplet.Env.get('platform') === 'web') {  \n  clearMessages();\n  scanningUnavailable();\n  return;\n}\n\n$(document).on('click', '.scanAgain', function() { \n  clearMessages();\n  $('.circle-loader').hide();\n  $('.loader-message').hide();\n  $('.scanAgain').removeClass('visible');\n  openScanner();\n});\n\nif (isOnline) {\n  return openScanner();\n} else {\n  clearMessages();\n  $('.loader-message').text('Device Offline');\n  setTimeout(function() {\n    failure('offline');\n  }, 3000);\n}\n\n//open barcode scanner\nfunction openScanner() { \n  var options = {\n    preferFrontCamera: false,\n    showFlipCameraButton: true,\n    showTorchButton: true,\n    torchOn: false,\n    saveHistory: true,\n    prompt: 'Place a barcode inside the scan area'\n  };\n\n  return Fliplet.Barcode.scan(options).then(function(result) {    \n    if (result.cancelled){\n      clearMessages();\n      $('.circle-loader').hide();\n      $('.loader-message').hide();\n      $('.unavailable .message').text(messageCanceledScanning).show();\n      $('.scanAgain').addClass('visible');\n      return Promise.resolve(true);\n    } else { \n      var userEmail = getUrlParameter('email', result.text);\n      if (userEmail){        \n        return processCheckInOut(userEmail);\n      } else {\n        return failure('invalidQR');\n      }\n    }\n  }).catch(function(error) {\n    return failure('invalidQR');\n  });\n}\n\nfunction processCheckInOut(userEmail) {\n  // Find the user by Email\n  return Fliplet.DataSources.connectByName(DS.users).then(function(connection) {\n    return connection.findOne({\n      where: { Email: userEmail }\n    }).then(function(user) {\n      if (!user) {\n        return failure('userNotFound');\n      }\n\n      // For event, allow all users to check in/out\n      if (eventParam === 'event') {\n        return processAttendance(user, eventParam);\n      }\n      \n      // For session, check permissions and session status\n      return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n        return connection.findOne({\n          where: { 'Session ID': eventParam }\n        }).then(function(agenda) {\n          if (!agenda) {\n            return failure('sessionNotFound');\n          }\n          // Check if session is optional and user is allowed to attend\n          if (agenda.data.hasOwnProperty('Optional') && agenda.data.Optional === 'Yes') {\n            if (!agenda.data[VARIABLES.personalizedAgenda] ||\n                !Array.isArray(agenda.data[VARIABLES.personalizedAgenda]) ||\n                !agenda.data[VARIABLES.personalizedAgenda].includes(user.data.Email)) {\n              return failure('notAllowed');\n            }\n          }\n          // Check if session is not over\n          if (!checkIfAgendaIsNotOver(agenda)) {\n            return failure('sessionOver');\n          }\n          return processAttendance(user, eventParam);\n        });\n      });\n    });\n  });\n}\n\nfunction processAttendance(user, eventOrSessionId) {\n  return TimeConversion.getAppSetup().then(function(appSettings) {\n    if (!appSettings) {\n      return Promise.resolve(true);\n    }\n    if (TimeConversion.checkIfConversionIsRequired(appSettings)) {   \n      timeConversionIsRequired = true;\n      originalTimezone = appSettings.data['Event Timezone'];\n      userTimezone = TimeConversion.getCurrentUserTimezone();\n    } else {\n      userTimezone = appSettings.data['Event Timezone'];\n    }\n    \n    const type = eventOrSessionId === 'event' ? 'event' : 'session';\n    if (eventOrSessionId === 'event') {\n      // Handle event check-in/out\n      return Fliplet.DataSources.connectByName(DS.users).then(function(connection) {\n        const recordToUpdate = {\n          [attendedColumnName]: user.data[attendedColumnName] ? '' : 'Attended'\n        };\n        return connection.update(user.id, recordToUpdate).then(function() {\n          if (recordToUpdate[attendedColumnName]) {\n            successCheckIn(type);\n          } else {\n            successCheckOut(type);\n          }\n        });\n      });\n    } else {\n      // Handle session check-in/out\n      return Fliplet.DataSources.connectByName(DS.attendingLogs).then(function(connection) {\n        return connection.findOne({\n          where: {\n            Email: user.data.Email,\n            'Session ID': eventOrSessionId\n          }\n        }).then(function(record) {\n          if (!record) {\n            // 1. No record found: Insert new check-in record\n            return createCheckInRecord(user, eventOrSessionId, false, userTimezone).then(data =\u003E {\n              return connection.insert({\n                ...data,\n                Email: user.data.Email,\n                'First Name': user.data['First Name'],\n                'Last Name': user.data['Last Name']\n              }).then(() =\u003E {\n                successCheckIn(type);\n              });\n            });\n          } else if (!record.data['Check in time']) {\n            // 2. Record found, no check-in time: Set check-in time\n            return createCheckInRecord(user, eventOrSessionId, false, userTimezone).then(data =\u003E {\n              // Update the existing record with check-in data\n              return connection.update(record.id, {\n                ...record.data,\n                ...data\n              }).then(() =\u003E {\n                successCheckIn(type);\n              });\n            });\n          } else if (!record.data['Check out time']) {\n            // 3. Record found, has check-in time, no check-out time: Set check-out time\n            record.data['Check out time'] = moment().tz(timeConversionIsRequired ? originalTimezone : userTimezone).format('YYYY-MM-DD HH:mm');\n            const checkInTime = moment(record.data['Check in time']);\n            const checkOutTime = moment(record.data['Check out time']);\n            const diff = checkOutTime.diff(checkInTime, 'minutes');\n            record.data['Attendance in minutes'] = diff;\n            return connection.update(record.id, record.data).then(function() {\n              successCheckOut(type);\n            });\n          } else {\n            // 4. Record found, has both check-in and check-out times: Show already checked in message\n            return alreadyCheckedIn(type);\n          }\n        });\n      });\n    }\n  });\n}\n\n// Helper function to check if agenda/session is not over\nfunction checkIfAgendaIsNotOver(agenda) {\n  if (!agenda.data['End Time']) {\n    return true; // If no end time is set, assume it's not over\n  }\n  \n  const endTime = moment(agenda.data['End Time'], 'YYYY-MM-DD HH:mm');\n  const currentTime = moment();\n  \n  return currentTime.isBefore(endTime);\n}\n\n// User feedback function for visual feedback\nfunction userFeedBack(success) {\n  if (success) {\n    $('.circle-loader').addClass('load-complete');\n    $('.circle-loader').find('.checkmark').show();\n  } else {\n    $('.circle-loader').addClass('failmark');\n    $('.circle-loader').find('.cross').show();\n  }\n}\n\n// Helper to clear all messages\nfunction clearMessages() {\n  $('.success-message').hide();\n  $('.error-message').hide();\n  $('.unavailable .message').hide();\n  $('.manual-error').hide();\n}\n\nfunction getUrlParameter(name, url) {\n  name = name.replace(/[[\\]]/g, '\\\\$&');\n  var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');\n  var results = regex.exec(url);\n  return results === null ? '' : decodeURIComponent(results[1].replace(/\\+/g, ' '));\n}\n\n/*display check*/\nfunction successCheckIn(type) {\n  clearMessages();\n  $('.circle-loader').show();\n  $('.success-message').text(formatMessage(messageSuccessCheckin, type)).show();\n  userFeedBack(true);\n  $('.scanAgain').addClass('visible');\n}\n\nfunction successCheckOut(type) {\n  clearMessages();\n  $('.circle-loader').show();\n  $('.success-message').text(formatMessage(messageSuccessCheckout, type)).show();\n  userFeedBack(true);\n  $('.scanAgain').addClass('visible');\n}\n\n/*display cross*/\nfunction failure(reason) {\n  clearMessages();\n  $('.circle-loader').removeClass('failmark load-complete');\n  $('.circle-loader').show();\n  let message;\n  switch(reason) {\n    case 'userNotFound':\n      message = messageUserNotFound;\n      break;\n    case 'sessionNotFound':\n      message = messageSessionNotFound;\n      break;\n    case 'notAllowed':\n      message = messageNotAllowed;\n      break;\n    case 'sessionOver':\n      message = messageSessionOver;\n      break;\n    case 'invalidQR':\n      message = messageInvalidQR;\n      break;\n    case 'offline':\n      message = messageOffline;\n      break;\n    default:\n      message = messageNotAllowed;\n  }\n  $('.error-message').text(message).show();\n  userFeedBack(false);\n  $('.scanAgain').addClass('visible');\n}\n\n// Helper to format messages\nfunction formatMessage(message, type) {\n  return message.replace('{type}', type);\n}\n\nfunction alreadyCheckedIn(type) {\n  clearMessages();\n  $('.circle-loader').hide();\n  $('.loader-message').hide();\n  $('.unavailable .message').text(formatMessage(alreadyCheckInMessage, type)).show();\n  $('.scanAgain').addClass('visible');\n}\n\nfunction scanningUnavailable() {\n  clearMessages();\n  $('.circle-loader').hide();\n  $('.loader-message').hide();\n  $('.unavailable .message').text(messageOnWeb).show();\n}",
        "customCSS": "img{width:100%}.loader-message{width:60px;text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%)}.success,.alert-warning,.alert-danger{display:none}.scanAgain{cursor:pointer;margin:10px auto 0;display:none}.scanAgain.visible{display:block}.success{width:100%}[data-field=\"Email\"],[data-field=\"Date\"]{display:none}.circle-loader{margin-top:3.5em;margin-bottom:3.5em;margin-left:auto;margin-right:auto;border:1px solid rgba(0,0,0,0.2);border-left-color:#0acda2;animation:loader-spin 1.2s infinite linear;position:relative;display:inline-block;vertical-align:top;border-radius:50%;width:7em;height:7em}.load-complete{-webkit-animation:none;animation:none;transition:border 500ms ease-out}.load-complete.checkmark{border-color:#0acda2}.load-complete.failmark{border-color:#cd0a58}.failmark\u003Ediv.draw{display:block}.failmark\u003Ediv.draw::before,.failmark\u003Ediv.draw::after{content:\"\";position:absolute;height:2.5em;width:2.5em;opacity:1;animation-duration:800ms;animation-timing-function:ease;animation-name:failmark}.failmark\u003Ediv.draw::before{transform-origin:left top;border-right:3px solid #cd0a58;border-top:3px solid #cd0a58;left:1.55em;top:1.8em;transform:scaleX(-1) rotate(135deg)}.failmark\u003Ediv.draw::after{transform-origin:left top;border-right:3px solid #cd0a58;border-top:3px solid #cd0a58;left:5.05em;top:5.15em;transform:scaleX(-1) rotate(314deg)}.checkmark\u003Ediv.draw{display:block}.checkmark\u003Ediv.draw:after{opacity:1;height:3.5em;width:1.75em;transform-origin:left top;border-right:3px solid #0acda2;border-top:3px solid #0acda2;content:\"\";left:1.75em;top:3.5em;position:absolute}.checkmark\u003Ediv.draw:after{animation-duration:800ms;animation-timing-function:ease;animation-name:checkmark;transform:scaleX(-1) rotate(135deg)}@keyframes loader-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes failmark{0%{height:0;width:0;opacity:1}20%{height:0;width:2.5em;opacity:1}40%{height:2.5em;width:2.5em;opacity:1}100%{height:2.5em;width:2.5em;opacity:1}}@keyframes checkmark{0%{height:0;width:0;opacity:1}20%{height:0;width:1.75em;opacity:1}40%{height:3.5em;width:1.75em;opacity:1}100%{height:3.5em;width:1.75em;opacity:1}}\n",
        "customSCSS": "img {\n  width:100%;\n}\n.loader-message {\n  width:60px;\n  text-align: center;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n.success, .alert-warning, .alert-danger {\n  display: none;\n}\n.scanAgain{\n  cursor: pointer;\n  margin: 10px auto 0;\n  display: none;\n\t&.visible{\n    display: block;\n  }\n}\n\n.success {\n  width: 100%;\n}\n[data-field=\"Email\"],[data-field=\"Date\"] {\n  display:none;\n}\n.circle-loader {\n  margin-top: 3.5em;\n  margin-bottom: 3.5em;\n  margin-left:auto;\n  margin-right:auto;\n  border: 1px solid rgba(0, 0, 0, 0.2);\n  border-left-color: #0acda2;\n  animation: loader-spin 1.2s infinite linear;\n  position: relative;\n  display: inline-block;\n  vertical-align: top;\n  border-radius: 50%;\n  width: 7em;\n  height: 7em;\n}\n.load-complete {\n  -webkit-animation: none;\n  animation: none;\n  transition: border 500ms ease-out;\n}\n.load-complete.checkmark {\n  border-color: #0acda2;\n}\n.load-complete.failmark {\n  border-color: #cd0a58;\n}\n.failmark \u003E div.draw {\n  display: block;\n  &::before, &::after{\n    content: \"\";\n    position: absolute;\n    height: 2.5em;\n  \twidth: 2.5em;\n    opacity: 1;\n    animation-duration: 800ms;\n    animation-timing-function: ease;\n  \tanimation-name: failmark;\n  }\n  &::before{\n    transform-origin: left top;\n    border-right: 3px solid #cd0a58;\n    border-top: 3px solid #cd0a58;\n    left: 1.55em;\n    top: 1.8em;\n    transform: scaleX(-1) rotate(135deg);\n  }\n  &::after{\n    transform-origin: left top;\n    border-right: 3px solid #cd0a58;\n    border-top: 3px solid #cd0a58;\n    left: 5.05em;\n    top: 5.15em;\n    transform: scaleX(-1) rotate(314deg);\n  }\n}\n.checkmark \u003E div.draw {\n  display: block;\n}\n.checkmark \u003E div.draw:after {\n  opacity: 1;\n  height: 3.5em;\n  width: 1.75em;\n  transform-origin: left top;\n  border-right: 3px solid #0acda2;\n  border-top: 3px solid #0acda2;\n  content: \"\";\n  left: 1.75em;\n  top: 3.5em;\n  position: absolute;\n}\n.checkmark \u003E div.draw:after {\n  animation-duration: 800ms;\n  animation-timing-function: ease;\n  animation-name: checkmark;\n  transform: scaleX(-1) rotate(135deg);\n}\n@keyframes loader-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n@keyframes failmark {\n  0% {\n    height: 0;\n    width: 0;\n    opacity: 1;\n  }\n  20% {\n    height: 0;\n    width: 2.5em;\n    opacity: 1;\n  }\n  40% {\n    height: 2.5em;\n    width: 2.5em;\n    opacity: 1;\n  }\n  100% {\n    height: 2.5em;\n    width: 2.5em;\n    opacity: 1;\n  }\n}\n@keyframes checkmark {\n  0% {\n    height: 0;\n    width: 0;\n    opacity: 1;\n  }\n  20% {\n    height: 0;\n    width: 1.75em;\n    opacity: 1;\n  }\n  40% {\n    height: 3.5em;\n    width: 1.75em;\n    opacity: 1;\n  }\n  100% {\n    height: 3.5em;\n    width: 1.75em;\n    opacity: 1;\n  }\n}",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951902, 30951903, 30951904, 30951905, 30951906, 30951907, 30951908, 30951909, 30951910]
      },
      "updatedAt": "2025-07-02T16:49:43.101Z",
      "slug": "admin-scan-qr-code-1l7mi"
    },
    {
      "id": 1744576,
      "isLayout": false,
      "layout": "{{{widget 30951741}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1554506,
      "layoutOrder": 39,
      "order": 39,
      "sectionId": null,
      "title": "Admin - Add Walk-In",
      "settings": {
        "private": {
          "tags": [
            "Intro / Login",
            "No code"
          ],
          "queries": [
            "Registration",
            "register"
          ],
          "category": "Intro / Login",
          "description": "Let new users automatically sign up to your app. Add additional fields to capture more data."
        },
        "customJS": "// Hook into the form submission process before it is submitted\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  // Connect to the data source for attendees by its name\n  return Fliplet.DataSources.connectByName(DS.users).then(connection =\u003E {\n    // Search for existing users with the same email address and event ID\n    return connection.find({\n      where: {\n        'Email': data['Email'] // Check the email address\n      }\n    }).then(userExists =\u003E {\n      // If a user with the same Email exists, reject the promise\n      if (userExists.length) {\n        return Promise.reject(`User with email ${data['Email']} already exists in \"${DS.users}\" data source!`);\n      } else {\n        // If no user exists, resolve the promise with the form data\n        return Promise.resolve(data);\n      }\n    });\n  });\n});",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951739, 30951740, 30951741, 30951742, 30951743]
      },
      "updatedAt": "2025-07-02T16:49:43.976Z",
      "slug": "admin-add-walk-in-1l7m0"
    },
    {
      "id": 1744604,
      "isLayout": false,
      "layout": "\u003Cdiv class=\"spinner-holder\"\u003E\n  \u003Cdiv class=\"spinner-overlay\"\u003ELoading...\u003C/div\u003E\n  \u003Cp\u003ELoading...\u003C/p\u003E\n\u003C/div\u003E\n{{{widget 30951944}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1714134,
      "layoutOrder": 40,
      "order": 40,
      "sectionId": null,
      "title": "Admin - Meeting Settings",
      "settings": {
        "private": {
          "tags": [
            "Data Capture"
          ],
          "queries": [
            "Lists",
            "nested form",
            "sub form"
          ],
          "category": "Data Capture",
          "description": "Use this screen to display the information saved by the Nested form screen template"
        },
        "customJS": "// Show spinner\n$('.spinner-holder').addClass('animated');\n\nvar settingsRecord = null;\nvar settingsConnection = null;\n\n// Get the first form instance\nFliplet.FormBuilder.get().then(function(form) {\n  // Connect to DS.appSetup data source using connectByName\n  Fliplet.DataSources.connectByName(DS.appSetup).then(function(connection) {\n    settingsConnection = connection;\n    // Find one record with Meeting Timeslots or Meetings Duration\n    return connection\n      .findOne()\n      .then(function(record) {\n        if (record) {\n          settingsRecord = record;\n          // Load the matching record into the form\n          form\n            .load(function() {\n              return Promise.resolve(record);\n            })\n            .then(function() {\n              // Hide spinner when form is loaded\n              $('.spinner-holder').removeClass('animated');\n            });\n        } else {\n          // No matching records found\n          $('.spinner-holder').removeClass('animated');\n          Fliplet.UI.Toast('No meeting settings found');\n        }\n      })\n      .catch(function(error) {\n        // Handle any errors\n        $('.spinner-holder').removeClass('animated');\n        Fliplet.UI.Toast('Error loading meeting settings');\n        console.error(error);\n      });\n  });\n});\n\n// Set up beforeFormSubmit hook to update the record\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  if (settingsRecord && settingsConnection) {\n    // Update the record and reject the promise if needed\n    return settingsConnection.update(settingsRecord.id, data);\n  }\n  // If no record, reject\n  return Promise.reject(new Error('No settings record to update'));\n});\n",
        "customCSS": "table{width:80%;max-width:80%;margin-bottom:1rem;background-color:transparent;border-collapse:collapse}table th,table td{padding:5px !important}.delete-criteria,.edit-criteria{text-decoration:none;margin:0;cursor:pointer;border-radius:6px !important;padding:5px !important;font-size:16px !important;display:inline-flex;align-items:center;line-height:24px !important;justify-content:center}.delete-criteria{color:#bb0c0c}.edit-criteria{color:#1E4A99}@media screen and (max-width: 640px){table th:last-child,table td:last-child{min-width:70px}}.nested-form-container{border:2px dashed #007bff;padding:15px;margin:10px 0;background-color:#f9f9f9;display:none}.nested-form-field{padding-left:15px !important}.nested-form-start,.nested-form-end{font-weight:bold;color:#007bff;margin-bottom:10px}#nestedFormTable{width:100%;max-width:100%;margin:0 auto;border-collapse:collapse;border:2px solid #ddd}#nestedFormTable th,#nestedFormTable td{padding:8px;text-align:left;word-wrap:break-word;max-width:200px;border:1px solid #ddd}#nestedFormTable th{background-color:#f5f5f5;font-weight:bold;border-bottom:2px solid #ddd}.startNestedForm{padding:0 15px;overflow-x:auto}.startNestedForm .edit-criteria,.startNestedForm .delete-criteria{cursor:pointer;margin:0 5px}.startNestedForm .edit-criteria:hover,.startNestedForm .delete-criteria:hover{opacity:0.7}.text-danger{display:none}[data-widget-package=\"com.fliplet.form-builder\"] .has-error .form-control,[data-widget-package=\"com.fliplet.form-builder\"] .has-error .select-proxy-display{border:none}[data-widget-package=\"com.fliplet.text\"].instructions{display:none !important;color:#3c763d !important;background-color:#dff0d8 !important;padding:15px !important;border-color:#d6e9c6;border:1px solid transparent;border-radius:4px}[data-widget-package=\"com.fliplet.text\"].instructions p,[data-widget-package=\"com.fliplet.text\"].instructions li{color:black !important}[data-widget-package=\"com.fliplet.text\"].danger{background-color:#f2dede !important}.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions{display:block !important}.spinner-holder{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:9999;justify-content:center;align-items:center;flex-direction:column}.spinner-holder.animated{display:flex}.spinner-holder .spinner-overlay{display:none}.spinner-holder p{color:white;font-size:1.2rem}.spinner-holder::before{content:'';display:block;width:40px;height:40px;margin-bottom:10px;border:4px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}\n",
        "customSCSS": "/** @format */\ntable{\n  width: 80%;\n  max-width: 80%;\n  margin-bottom: 1rem;\n  background-color: transparent;\n  border-collapse: collapse;\n  th, td{\n    padding: 5px !important;\n  }\n}\n.delete-criteria, .edit-criteria {\n  text-decoration: none;\n  margin: 0;\n  cursor: pointer;\n  border-radius: 6px !important;\n  padding: 5px !important;\n  font-size: 16px !important;\n  display: inline-flex;\n  align-items: center;\n  line-height: 24px !important;\n  justify-content: center;\n}\n.delete-criteria{\n  color: #bb0c0c;\n}\n.edit-criteria{\n  color: #1E4A99;\n}\n@media screen and (max-width: 640px){\n  table th:last-child, table td:last-child{\n    min-width: 70px;\n  }\n}\n/* Style for nested form container */\n.nested-form-container {\n  border: 2px dashed #007bff;\n  padding: 15px;\n  margin: 10px 0;\n  background-color: #f9f9f9;\n  display: none;\n}\n/* Style for nested form fields */\n.nested-form-field {\n  padding-left: 15px!important;\n}\n/* Optional: Style for start and end indicators */\n.nested-form-start,\n.nested-form-end {\n  font-weight: bold;\n  color: #007bff;\n  margin-bottom: 10px;\n}\n#nestedFormTable {\n  width: 100%;\n  max-width: 100%;\n  margin: 0 auto;\n  border-collapse: collapse;\n  border: 2px solid #ddd;\n  th, td {\n    padding: 8px;\n    text-align: left;\n    word-wrap: break-word;\n    max-width: 200px;\n    border: 1px solid #ddd;\n  }\n  th {\n    background-color: #f5f5f5;\n    font-weight: bold;\n    border-bottom: 2px solid #ddd;\n  }\n}\n.startNestedForm {\n  padding: 0 15px;\n  overflow-x: auto;\n  // Style for action buttons\n  .edit-criteria, .delete-criteria {\n    cursor: pointer;\n    margin: 0 5px;\n    &:hover {\n      opacity: 0.7;\n    }\n  }\n}\n.text-danger{\n  display: none;\n}\n[data-widget-package=\"com.fliplet.form-builder\"] .has-error .form-control, [data-widget-package=\"com.fliplet.form-builder\"] .has-error .select-proxy-display {\n  border: none;\n}\n//Hide instructions when on preview mode\n[data-widget-package=\"com.fliplet.text\"].instructions {\n  display:none !important;\n  color: #3c763d !important;\n  background-color: #dff0d8 !important;\n  padding: 15px !important;\n  border-color: #d6e9c6;\n  border: 1px solid transparent;\n  border-radius: 4px;\n}\n[data-widget-package=\"com.fliplet.text\"].instructions p, [data-widget-package=\"com.fliplet.text\"].instructions li {\n  color:black !important;\n}\n[data-widget-package=\"com.fliplet.text\"].danger {\n  background-color: #f2dede !important;\n}\n.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions {\n  display:block !important;\n}\n\n.spinner-holder {\n  display: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 9999;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n\n  &.animated {\n    display: flex;\n  }\n\n  .spinner-overlay {\n    display: none;\n  }\n\n  p {\n    color: white;\n    font-size: 1.2rem;\n  }\n\n  &::before {\n    content: '';\n    display: block;\n    width: 40px;\n    height: 40px;\n    margin-bottom: 10px;\n    border: 4px solid rgba(255, 255, 255, 0.3);\n    border-top-color: white;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n  }\n}\n\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951944, 30951945, 30951946]
      },
      "updatedAt": "2025-07-02T16:49:38.554Z",
      "slug": "admin-meeting-settings-1l7ms"
    },
    {
      "id": 1744606,
      "isLayout": false,
      "layout": "{{{widget 30951951}}}\n{{{widget 30951957}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1714137,
      "layoutOrder": 41,
      "order": 41,
      "sectionId": null,
      "title": "Admin - Set Meeting Times",
      "settings": {
        "private": {
          "tags": [
            "Data Capture"
          ],
          "queries": [
            "Lists",
            "nested form",
            "sub form"
          ],
          "category": "Data Capture",
          "description": "Use this screen to display the information saved by the Nested form screen template"
        },
        "customJS": "let dataToSave = [];\nlet tableInitialized = false;\nlet columnName;\nlet nestedFormFields = [];\nlet dataSourceId = '';\nlet generalMeetingRecord = null; // Store the found record globally\nlet appSetupRecord = null; // Store the appSetup record globally\n\n// Load existing meeting slots data\nfunction loadExistingMeetingSlots() {\n  return Fliplet.DataSources.connectByName(DS.meetingsSlots)\n    .then(function(connection) {\n      return connection.findOne({\n        where: {\n          $or: [\n            { Email: '' },\n            { Email: { $exists: false } }\n          ]\n        }\n      });\n    })\n    .then(function(record) {\n      generalMeetingRecord = record; // Store the found record\n    \n      if (!record) {\n        return;\n      }\n\n      // Load form data\n      return Fliplet.FormBuilder.get().then(function(form) {\n        const fields = form.fields.get();\n        const { nestedFields, columnName: foundColumnName } = findNestedFormFields(fields);\n\n        nestedFormFields = nestedFields;\n        columnName = foundColumnName;\n\n        // Set form field values\n        Object.keys(record.data).forEach(function(key) {\n          if (key !== 'Meeting days') {\n            form.field(key).set(record.data[key]);\n          }\n        });\n\n        // Load meeting slots into table\n        if (record.data['Meeting days'] && record.data['Meeting days'].length) {\n          dataToSave = record.data['Meeting days'];\n          tableInitialized = initializeTable(nestedFormFields, dataToSave);\n          initTableButtonClickEvents(form);\n        }\n      });\n    })\n    .catch(function(error) {\n      console.error('Error loading meeting slots:', error);\n    });\n}\n\n// Check if subform should be rendered based on appSetup\nfunction checkAdminFormVisibility() {\n  return Fliplet.DataSources.connectByName(DS.appSetup)\n    .then(function(connection) {\n      return connection.findOne();\n    })\n    .then(function(record) {\n      appSetupRecord = record; // Store the record globally\n      if (!record) {\n        return false;\n      }\n      return record.data[VARIABLES.meetingTimeslots] !== VARIABLES.meetingTimeslotsOptions.individual;\n    })\n    .catch(function(error) {\n      console.error('Error checking subform visibility:', error);\n      return false;\n    });\n}\n\n// Function to hide form fields between start and end markers\nfunction hideNestedFormFields(isUniversal) {\n  if (isUniversal) {\n    $('.individual-meetings-allowed').remove();\n    $('.general-meetings-allowed').show();\n    // Optionally, load universal slots here\n  } else {\n    $('.general-meetings-allowed').remove();\n    $('.individual-meetings-allowed').show();\n  }\n}\n\n//Handle edit mode\nFliplet.Widget.find({ package: 'com.fliplet.form-builder' }).then(function(instances) {\n  if (!instances && instances[0].dataSourceId) {\n    Fliplet.UI.Toast('No valid form found on the screen');\n    return;\n  }\n\n  dataSourceId = instances[0].dataSourceId;\n});\n\nfunction getColumnValue(value) {\n  if (!value) return '';\n  else if (typeof value === 'object') {\n    return `${value.start} - ${value.end}`;\n  } else if (typeof value === 'array') {\n    return value.join(', ');\n  } else if (typeof value === 'boolean') {\n    return value ? 'Yes' : 'No';\n  } else if (typeof value === 'number') {\n    return value.toFixed(2);\n  } else {\n    return value;\n  }\n}\n\n// Add these new functions at the top\nfunction findNestedFormFields(fields) {\n  let nestedFields = [];\n  let columnName;\n  let isWithinNestedForm = false;\n  let htmlObject;\n\n  _.forEach(fields, function(field) {\n    if (field._type == 'flParagraph') {\n      htmlObject = $(field.value);\n    }\n    if (htmlObject && htmlObject.hasClass('startNestedForm')) {\n      isWithinNestedForm = true;\n      columnName = $(htmlObject)\n        .data('columnname')\n        .trim();\n    }\n\n    if (isWithinNestedForm && field._type !== 'flParagraph' && field._type !== 'flCustomButton') {\n      nestedFields.push(field.name);\n      htmlObject.addClass('nested-form-field');\n    }\n\n    if (htmlObject && htmlObject.hasClass('endNestedForm')) {\n      isWithinNestedForm = false;\n    }\n  });\n\n  return { nestedFields, columnName };\n}\n\nfunction setNestedFormFields() {\n  checkAdminFormVisibility().then(function(isUniversal) {\n    hideNestedFormFields(isUniversal);\n    if (!isUniversal) {\n      return;\n    }\n\n    return Fliplet.FormBuilder.get().then(function(form) {\n      const fields = form.fields.get();\n      let isWithinNestedForm = false;\n      let htmlObject;\n\n      _.forEach(fields, function(field) {\n        if (field._type == 'flParagraph') {\n          htmlObject = $(field.value);\n        }\n        if (htmlObject && htmlObject.hasClass('startNestedForm')) {\n          isWithinNestedForm = true;\n        }\n\n        if (isWithinNestedForm && field._type !== 'flParagraph' && field._type !== 'flCustomButton') {\n          let fieldContainer = $('[data-field=\"' + field.name + '\"]').addClass(\"nested-form-field\");\n        }\n\n        if (htmlObject && htmlObject.hasClass('endNestedForm')) {\n          isWithinNestedForm = false;\n        }\n      });\n    }).then(()=\u003E {\n      // Initialize data loading\n      return loadExistingMeetingSlots();\n    });\n  });\n}\n\nsetNestedFormFields();\n\nfunction initializeTable(fields, data = []) {\n  const tableHeaders = fields.map(fieldName =\u003E `\u003Cth\u003E${fieldName}\u003C/th\u003E`).join('');\n  const actionHeader = '\u003Cth\u003EActions\u003C/th\u003E';\n\n  $('.startNestedForm').html(`\n    \u003Ctable id=\"nestedFormTable\"\u003E\n      \u003Cthead\u003E\n        \u003Ctr\u003E${tableHeaders}${actionHeader}\u003C/tr\u003E\n      \u003C/thead\u003E\n      \u003Ctbody\u003E\n        \u003C!-- Rows will be dynamically added here --\u003E\n      \u003C/tbody\u003E\n    \u003C/table\u003E\n  `);\n\n  // Populate existing data if any\n  data.forEach((entry, index) =\u003E {\n    const rowHtml = fields\n      .map(fieldName =\u003E `\u003Ctd\u003E${getColumnValue(entry[fieldName])}\u003C/td\u003E`)\n      .join('');\n    const actionButtons = `\n      \u003Ctd\u003E\n        \u003Cspan class=\"edit-criteria\" id=\"edit\" data-entry='${JSON.stringify(\n          entry\n        )}' data-index=\"${index}\"\u003E\n          \u003Ci class=\"fa fa-pencil fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n        \u003C/span\u003E\n        \u003Cspan class=\"delete-criteria\" id=\"delete\" data-index=\"${index}\"\u003E\n          \u003Ci class=\"fa fa-trash fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n        \u003C/span\u003E\n      \u003C/td\u003E\n    `;\n    $('#nestedFormTable tbody').append(`\u003Ctr\u003E${rowHtml}${actionButtons}\u003C/tr\u003E`);\n  });\n\n  $('#nestedFormTable').show();\n  return true;\n}\n\n// Add this new function near the top with other functions\nfunction validateNestedFormFields(form, nestedFormFields) {\n  const missingFields = [];\n  const fields = form.fields.get();\n\n  nestedFormFields.forEach(fieldName =\u003E {\n    const field = _.find(fields, { name: fieldName });\n    const value = form.field(fieldName).get();\n    const type = form.field(fieldName);\n\n    if (field && field.required && !value) {\n      missingFields.push(field.label || fieldName);\n    }\n  });\n\n  return missingFields;\n}\n\n// Add this helper function near the top with other functions\nfunction isFieldInNestedForm(fieldName, nestedFormFields) {\n  return nestedFormFields.includes(fieldName);\n}\n\n// Helper function to parse 'HH:mm' string to minutes\nfunction parseTimeToMinutes(timeStr) {\n  const [hours, minutes] = timeStr.split(':').map(Number);\n  return hours * 60 + minutes;\n}\n\n// Helper to normalize date to YYYY-MM-DD\nfunction normalizeDate(dateStr) {\n  if (dateStr.includes('/')) {\n    const [day, month, year] = dateStr.split('/');\n    return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;\n  }\n  return dateStr;\n}\n\n// Update the Fliplet.Navigate.registerFunction section\nFliplet.Navigate.registerFunction('subforms', function(options) {\n  return checkSubformVisibility().then(function(shouldShow) {\n    if (!shouldShow) {\n      Fliplet.UI.Toast('This feature is not available in the current configuration.');\n      return Promise.reject();\n    }\n\n    $('#nestedFormTable').show();\n    return Fliplet.FormBuilder.get().then(function(form) {\n      $(document)\n        .find('.nested-form-container')\n        .hide();\n      const fields = form.fields.get();\n      const { nestedFields, columnName: foundColumnName } = findNestedFormFields(fields);\n\n      // Set these values once\n      nestedFormFields = nestedFields;\n      columnName = foundColumnName;\n\n      // Add validation before processing the form data\n      const missingFields = validateNestedFormFields(form, nestedFormFields);\n      if (missingFields.length \u003E 0) {\n        Fliplet.UI.Toast(`The following fields are required: ${missingFields.join(', ')}`);\n        return Promise.reject(); // Exit the function if validation fails\n      }\n\n      // Validate meeting duration\n      const timeField = form.field('Times').get();\n      if (!timeField || !timeField.start || !timeField.end || !appSetupRecord) {\n        Fliplet.UI.Toast('Invalid time values or app setup configuration');\n        return Promise.reject();\n      }\n\n      // Parse 'HH:mm' strings to minutes\n      const startMinutes = parseTimeToMinutes(timeField.start);\n      const endMinutes = parseTimeToMinutes(timeField.end);\n      const duration = endMinutes - startMinutes;\n      const meetingDuration = appSetupRecord.data[VARIABLES.meetingsDuration];\n\n      if (startMinutes === endMinutes) {\n        Fliplet.UI.Toast('Start time cannot be equal to end time');\n        return Promise.reject();\n      }\n\n      // Check if duration is less than meeting duration\n      if (duration \u003C meetingDuration) {\n        Fliplet.UI.Toast(`Time slot duration (${duration} minutes) must be at least ${meetingDuration} minutes`);\n        return Promise.reject();\n      }\n\n      // Check if duration is divisible by meeting duration without remainder\n      if (duration % meetingDuration !== 0) {\n        Fliplet.UI.Toast(`The time slot must be divisible by ${meetingDuration} minutes`);\n        // Keep the form values so user can edit them\n        return Promise.reject();\n      }\n\n      // Overlap validation\n      const dateField = form.field('Date').get();\n      if (!dateField) {\n        Fliplet.UI.Toast('Please select a date.');\n        return Promise.reject();\n      }\n      \n      // Check for overlap with existing slots for the same date\n      const normalizedNewDate = normalizeDate(dateField);\n      const isOverlapping = dataToSave.some(function(entry) {\n        const normalizedEntryDate = normalizeDate(entry['Date']);\n        // Compare only if the date matches\n        if (normalizedEntryDate !== normalizedNewDate) return false;\n        const entryTimes = entry['Times'];\n        if (!entryTimes || !entryTimes.start || !entryTimes.end) return false;\n        const entryStart = parseTimeToMinutes(entryTimes.start);\n        const entryEnd = parseTimeToMinutes(entryTimes.end);\n        // Overlap if: start \u003C entryEnd && entryStart \u003C end\n        return startMinutes \u003C entryEnd && entryStart \u003C endMinutes;\n      });\n      if (isOverlapping) {\n        Fliplet.UI.Toast('This time slot overlaps with an existing slot for the same day.');\n        return Promise.reject();\n      }\n\n      if (!tableInitialized) {\n        tableInitialized = initializeTable(nestedFormFields);\n      }\n\n      // Adding a new nested form entry\n      const newEntry = {};\n      _.forEach(nestedFormFields, function(fieldName) {\n        const fieldValue = form.field(fieldName).get();\n        if (fieldName === 'Times' && fieldValue && typeof fieldValue === 'object' && fieldValue.start && fieldValue.end) {\n          // Clone Times object to avoid shared references\n          newEntry[fieldName] = { start: fieldValue.start, end: fieldValue.end };\n        } else if (fieldValue && typeof fieldValue === 'object' && ('start' in fieldValue || 'end' in fieldValue)) {\n          newEntry[fieldName] = fieldValue;\n        } else {\n          newEntry[fieldName] = fieldValue || '';\n        }\n      });\n\n      // Check if entry already exists in dataToSave\n      const existingIndex = dataToSave.findIndex(entry =\u003E\n        nestedFormFields.every(fieldName =\u003E entry[fieldName] === newEntry[fieldName])\n      );\n\n      if (existingIndex === -1) {\n        // Add the new entry to the dataToSave array\n        dataToSave.push(newEntry);\n        // Create a table row for the new entry\n        const rowHtml = nestedFormFields\n          .map(fieldName =\u003E `\u003Ctd\u003E${getColumnValue(newEntry[fieldName])}\u003C/td\u003E`)\n          .join('');\n        const actionButtons = `\n          \u003Ctd\u003E\n            \u003Cspan class=\"edit-criteria\" id=\"edit\" data-entry='${JSON.stringify(\n              newEntry\n            )}' data-index=\"${dataToSave.length - 1}\"\u003E\n              \u003Ci class=\"fa fa-pencil fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n            \u003C/span\u003E\n            \u003Cspan class=\"delete-criteria\" id=\"delete\" data-index=\"${dataToSave.length - 1}\"\u003E\n              \u003Ci class=\"fa fa-trash fa-lg\" aria-hidden=\"true\"\u003E\u003C/i\u003E\n            \u003C/span\u003E\n          \u003C/td\u003E\n        `;\n        $('#nestedFormTable tbody').append(`\u003Ctr\u003E${rowHtml}${actionButtons}\u003C/tr\u003E`);\n\n        // Clear input fields after adding using Form API\n        _.forEach(nestedFormFields, function(fieldName) {\n          if (fieldName === 'Times') {\n            form.field(fieldName).set({ start: '', end: '' });\n          } else {\n            form.field(fieldName).set('');\n          }\n          $(document).find('[data-field=\"Times\"] .fa-times').trigger('click');\n        });\n      } else {\n        alert('This entry already exists!');\n      }\n\n      initTableButtonClickEvents(form);\n    });\n  });\n});\n\n// Check if subform should be rendered based on appSetup\nfunction checkSubformVisibility() {\n  return getAppSettings().then(record =\u003E {\n    appSetupRecord = record; // Store the record globally\n    if (!record) {\n      return false;\n    }\n    return record.data[VARIABLES.meetingTimeslots] === VARIABLES.meetingTimeslotsOptions.universal;\n  }).catch(function(error) {\n    console.error('Error checking subform visibility:', error);\n    return false;\n  });\n}\n\nfunction initTableButtonClickEvents(form) {\n  // Remove existing event handlers to prevent duplicates\n  $(document).off('click', '.delete-criteria');\n  $(document).off('click', '.edit-criteria');\n\n  // Handle delete functionality\n  $(document).on('click', '.delete-criteria', function(e) {\n    e.stopPropagation();\n    const index = $(this).data('index');\n    dataToSave.splice(index, 1);\n    var table = $(this).closest('#nestedFormTable');\n    $(this)\n      .closest('tr')\n      .remove();\n\n    // Update the indices of remaining buttons\n    $('.delete-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n\n    $('.edit-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n\n    if (!dataToSave.length) {\n      table.hide();\n    }\n  });\n\n  // Handle edit functionality\n  $(document).on('click', '.edit-criteria', function(e) {\n    const entryData = $(this).data('entry');\n    const index = $(this).data('index');\n\n    // Populate form fields with existing data\n    _.forEach(nestedFormFields, function(fieldName) {\n      if (fieldName === 'Times' && entryData[fieldName] && typeof entryData[fieldName] === 'object' && entryData[fieldName].start && entryData[fieldName].end) {\n        form.field(fieldName).set({ start: entryData[fieldName].start, end: entryData[fieldName].end });\n      } else {\n        form.field(fieldName).set(entryData[fieldName] || '');\n      }\n    });\n\n    var table = $(this).closest('#nestedFormTable');\n    // Remove the row and the corresponding entry for editing\n    $(this)\n      .closest('tr')\n      .remove();\n    dataToSave.splice(index, 1);\n\n    // Update the indices of remaining buttons\n    $('.delete-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n    $('.edit-criteria').each(function(idx) {\n      $(this).data('index', idx);\n    });\n\n    if (!dataToSave.length) {\n      table.hide();\n    }\n  });\n}\n\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  // Remove specific fields that shouldn't be saved\n  delete data['Times [Start]'];\n  delete data['Times [End]'];\n  delete data['Add Timeslot'];\n\n  return Fliplet.FormBuilder.get().then(form =\u003E {\n    const fields = form.fields.get();\n    const { nestedFields, columnName: foundColumnName } = findNestedFormFields(fields);\n\n    nestedFormFields = nestedFields;\n    var requiredNestedFields = [];\n    nestedFormFields.forEach(fieldName =\u003E {\n      const field = _.find(fields, { name: fieldName });\n      const value = form.field(fieldName).get();\n\n      if (field && field.required) {\n        requiredNestedFields.push(field);\n      }\n    });\n\n    if (requiredNestedFields.length && !dataToSave.length) {\n      Fliplet.UI.Toast(`At least one nested record is required.`);\n      return Promise.reject();\n    }\n\n    // First check if any nested form fields have values\n    const hasUnsubmittedValues = nestedFormFields.some(fieldName =\u003E {\n      return data[fieldName] && data[fieldName].toString().trim() !== '';\n    });\n\n    function finalizeSubmission() {\n      // Only here do we update or return data\n      if (columnName && dataToSave.length) {\n        data[columnName] = dataToSave;\n      }\n      if (typeof nestedFormFields !== 'undefined') {\n        nestedFormFields.forEach(fieldName =\u003E {\n          delete data[fieldName];\n        });\n      }\n\t\t\treturn updateRecord(data);\n    }\n\n    if (hasUnsubmittedValues) {\n      // Show warning prompt to user\n      return Fliplet.Navigate.confirm({\n        title: 'Unsaved nested form data',\n        message:\n          \"You have filled in nested form fields but haven't added them to the table. Would you like to continue anyway?\",\n        labels: ['Continue', 'Go back']\n      }).then(function(result) {\n        if (!result) {\n          // User clicked \"Go back\"\n          return Promise.reject();\n        }\n        return finalizeSubmission();\n      });\n    }\n\n    // No unsaved nested form data - proceed with original logic\n    return finalizeSubmission();\n  });\n});\n\nfunction updateRecord(data){\n  if (generalMeetingRecord) {\n    return Fliplet.DataSources.connectByName(DS.meetingsSlots)\n      .then(function(connection) {\n      \n      data['Meeting days'] = data['Meeting days'] || [];\n      return connection.update(generalMeetingRecord.id, data);\n    });\n  } else {\n    return Promise.resolve(data);\n  }\n}\n\n// Update the isFormInvalid hook\nFliplet.Hooks.on('isFormInvalid', function(invalidFields) {\n  // If there are no invalid fields, allow form submission\n  if (!invalidFields || !invalidFields.length) {\n    return Promise.resolve();\n  }\n\n  // Check if all invalid fields are within the nested form\n  const nonNestedInvalidFields = invalidFields.filter(\n    field =\u003E !isFieldInNestedForm(field.name, nestedFormFields)\n  );\n\n  if (nonNestedInvalidFields.length \u003E 0) {\n    // If there are invalid fields outside the nested form, prevent submission\n    const fieldLabels = nonNestedInvalidFields.map(field =\u003E field.label || field.name).join(', ');\n    Fliplet.UI.Toast(`Please fill in the following required fields: ${fieldLabels}`);\n    return Promise.reject(); // Changed from resolve(true) to reject()\n  }\n\n  const nestedInvalidFields = invalidFields.filter(field =\u003E\n    isFieldInNestedForm(field.name, nestedFormFields)\n  );\n\n  if (nestedInvalidFields.length && !dataToSave.length) {\n    Fliplet.UI.Toast(`At least one nested record is required.`);\n    return Promise.reject();\n  }\n\n  // If all invalid fields are within nested form, allow submission\n  return Promise.resolve();\n});\n\nFliplet.FormBuilder.get().then(form =\u003E {\n  if (Fliplet.Env.get('mode') == 'view') {\n    $(document)\n      .find('.nested-form-container')\n      .hide();\n  }\n});",
        "customCSS": ".individual-meetings,.general-meetings{display:none !important}.individual-meetings.visible,.general-meetings.visible{display:block !important}table{width:80%;max-width:80%;margin-bottom:1rem;background-color:transparent;border-collapse:collapse}table th,table td{padding:5px !important}.delete-criteria,.edit-criteria{text-decoration:none;margin:0;cursor:pointer;border-radius:6px !important;padding:5px !important;font-size:16px !important;display:inline-flex;align-items:center;line-height:24px !important;justify-content:center}.delete-criteria{color:#bb0c0c}.edit-criteria{color:#1E4A99}@media screen and (max-width: 640px){table th:last-child,table td:last-child{min-width:70px}}.nested-form-container{border:2px dashed #007bff;padding:15px;margin:10px 0;background-color:#f9f9f9;display:none}.nested-form-field{padding-left:15px !important}.nested-form-start,.nested-form-end{font-weight:bold;color:#007bff;margin-bottom:10px}#nestedFormTable{width:100%;max-width:100%;margin:0 auto;border-collapse:collapse;border:2px solid #ddd}#nestedFormTable th,#nestedFormTable td{padding:8px;text-align:left;word-wrap:break-word;max-width:200px;border:1px solid #ddd}#nestedFormTable th{background-color:#f5f5f5;font-weight:bold;border-bottom:2px solid #ddd}.startNestedForm{padding:0 15px;overflow-x:auto}.startNestedForm .edit-criteria,.startNestedForm .delete-criteria{cursor:pointer;margin:0 5px}.startNestedForm .edit-criteria:hover,.startNestedForm .delete-criteria:hover{opacity:0.7}.text-danger{display:none}[data-widget-package=\"com.fliplet.form-builder\"] .has-error .form-control,[data-widget-package=\"com.fliplet.form-builder\"] .has-error .select-proxy-display{border:none}[data-widget-package=\"com.fliplet.text\"].instructions{display:none !important;color:#3c763d !important;background-color:#dff0d8 !important;padding:15px !important;border-color:#d6e9c6;border:1px solid transparent;border-radius:4px}[data-widget-package=\"com.fliplet.text\"].instructions p,[data-widget-package=\"com.fliplet.text\"].instructions li{color:black !important}[data-widget-package=\"com.fliplet.text\"].danger{background-color:#f2dede !important}.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions{display:block !important}\n",
        "customSCSS": "/** @format */\n.individual-meetings, .general-meetings{\n  display: none !important;\n  &.visible{\n    display: block !important;\n  }\n}\ntable{\n  width: 80%;\n  max-width: 80%;\n  margin-bottom: 1rem;\n  background-color: transparent;\n  border-collapse: collapse;\n  th, td{\n    padding: 5px !important;\n  }\n}\n.delete-criteria, .edit-criteria {\n  text-decoration: none;\n  margin: 0;\n  cursor: pointer;\n  border-radius: 6px !important;\n  padding: 5px !important;\n  font-size: 16px !important;\n  display: inline-flex;\n  align-items: center;\n  line-height: 24px !important;\n  justify-content: center;\n}\n.delete-criteria{\n  color: #bb0c0c;\n}\n.edit-criteria{\n  color: #1E4A99;\n}\n@media screen and (max-width: 640px){\n  table th:last-child, table td:last-child{\n    min-width: 70px;\n  }\n}\n/* Style for nested form container */\n.nested-form-container {\n  border: 2px dashed #007bff;\n  padding: 15px;\n  margin: 10px 0;\n  background-color: #f9f9f9;\n  display: none;\n}\n/* Style for nested form fields */\n.nested-form-field {\n  padding-left: 15px!important;\n}\n/* Optional: Style for start and end indicators */\n.nested-form-start,\n.nested-form-end {\n  font-weight: bold;\n  color: #007bff;\n  margin-bottom: 10px;\n}\n#nestedFormTable {\n  width: 100%;\n  max-width: 100%;\n  margin: 0 auto;\n  border-collapse: collapse;\n  border: 2px solid #ddd;\n  th, td {\n    padding: 8px;\n    text-align: left;\n    word-wrap: break-word;\n    max-width: 200px;\n    border: 1px solid #ddd;\n  }\n  th {\n    background-color: #f5f5f5;\n    font-weight: bold;\n    border-bottom: 2px solid #ddd;\n  }\n}\n.startNestedForm {\n  padding: 0 15px;\n  overflow-x: auto;\n  // Style for action buttons\n  .edit-criteria, .delete-criteria {\n    cursor: pointer;\n    margin: 0 5px;\n    &:hover {\n      opacity: 0.7;\n    }\n  }\n}\n.text-danger{\n  display: none;\n}\n[data-widget-package=\"com.fliplet.form-builder\"] .has-error .form-control, [data-widget-package=\"com.fliplet.form-builder\"] .has-error .select-proxy-display {\n  border: none;\n}\n\n\n//Hide instructions when on preview mode\n[data-widget-package=\"com.fliplet.text\"].instructions {\n  display:none !important;\n  color: #3c763d !important;\n  background-color: #dff0d8 !important;\n  padding: 15px !important;\n  border-color: #d6e9c6;\n  border: 1px solid transparent;\n  border-radius: 4px;\n}\n[data-widget-package=\"com.fliplet.text\"].instructions p, [data-widget-package=\"com.fliplet.text\"].instructions li {\n  color:black !important;\n}\n[data-widget-package=\"com.fliplet.text\"].danger {\n  background-color: #f2dede !important;\n}\n.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions {\n  display:block !important;\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951951, 30951952, 30951953, 30951954, 30951955, 30951956, 30951957, 30951958]
      },
      "updatedAt": "2025-07-02T16:49:39.739Z",
      "slug": "admin-set-meeting-times-1l7mu"
    },
    {
      "id": 1744572,
      "isLayout": false,
      "layout": "{{{widget 30951725}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1679819,
      "layoutOrder": 42,
      "order": 42,
      "sectionId": null,
      "title": "Admin - Agenda",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays the admin agenda, showing every session, including private sessions, and allows for adding, editing, and deleting entries. It is a List from Data Source (LFD) screen with some custom fields, meaning that while most of it can be edited, not all fields are modifiable.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can view the complete list of sessions and manage them as needed. This includes the ability to add new sessions, edit existing ones, or delete sessions that are no longer relevant.\u003C/p\u003E"
        },
        "customJS": "const unlimitedCapacityText = 'Unlimited';//'&infin;'; //inifinity symbol\nconst fullCapacityText = 'Capacity: Full';\nconst fullCapacityColor = 'red';\nlet initialAgendaWasChanged = false;\nlet changeEventAttached = false;\nlet entryId, loggedInUser;\nlet initialValue = '';\n\nconst confirmDisableCheckInOptions = {\n  title: 'Confirm disabling check-in process',\n  message: 'Disabling check-in will deactivate the unique code for this session. Re-enabling this feature later will create a new code',\n  labels: ['Confirm', 'Cancel']\n};\n\n// add a speakers to the agenda\nFliplet.Hooks.on('flListDataBeforeGetData', function(data) {\n  data.config.beforeOpen = function(entry) {\n    if ($(entry.event.target).closest('.printqr-button').length) {\n      let sessionID = entry.entry.data['Session ID'];\n      Fliplet.Navigate.screen(SCREENS.adminQRCode, { query: '?sessionID=' + sessionID });\n      return Promise.reject('');\n    }\n  };\n  \n  data.config.beforeShowDetails = function(options) {\n    if (\n      options.data.originalData.Speakers == undefined ||\n      options.data.originalData.Speakers.length === 0\n    ) {\n      return;\n    }\n\n    var speakerEmails = _.map(_.split(_.get(options, 'data.originalData.Speakers'), ','), function(\n      item\n    ) {\n      return item.trim();\n    });\n    var loadTimeout = setTimeout(function() {\n      Fliplet.UI.Toast({\n        message: 'Loading...',\n        duration: false\n      });\n    }, 500);\n    var slowTimeout = setTimeout(function() {\n      Fliplet.UI.Toast({\n        message: 'Loading... The internet appears to be slow...',\n        duration: false\n      });\n    }, 2000);\n\n    if (!speakerEmails.length) {\n      return Promise.resolve();\n    }\n\n    return Fliplet.DataSources.connectByName(DS.users)\n      .then(function(connection) {\n        return connection.find({\n          where: {\n            $or: _.map(speakerEmails, function(email) {\n              return { Email: { $iLike: email } };\n            })\n          }\n        });\n      })\n      .then(function(records) {\n      records.sort(function(a, b){  \n        return speakerEmails.indexOf(a.data.Email) - speakerEmails.indexOf(b.data.Email);\n      });\n      \n        _.set(\n          options.data,\n          'originalData.SpeakerProfiles',\n          _.map(records, function(record) {\n            if (!_.isArray(record.data.Image)) {\n              record.data.Image = [record.data.Image];\n            }\n            if (record.data.Image[0] === undefined || !record.data.Image.length) {\n              record.data.Image[0] =\n                'https://us.api.fliplet.com/v1/media/files/102358/contents/placeholder_image.png';\n            }\n\n            return record.data;\n          })\n        );\n        console.log(options.data);\n        clearTimeout(loadTimeout);\n        clearTimeout(slowTimeout);\n        Fliplet.UI.Toast.dismiss();\n      })\n      .catch(function(error) {\n        clearTimeout(loadTimeout);\n        clearTimeout(slowTimeout);\n        Fliplet.UI.Toast.error(error, {\n          message: 'Error loading details'\n        });\n      });\n  };\n  \n  data.config.afterShowDetails = function(options) {\n    \n    Fliplet.DataSources.connectByName(DS.attendingLogs).then(function(connection) {\n      return connection\n        .find({\n          where: {\n            'Session ID': options.data.originalData['Session ID'],\n            'RSVP Status': 'Going'\n          },\n          join: {\n            Users: {\n              dataSourceName: DS.users,\n              on: {\n                'data.Email': 'data.Email'\n              }\n            }\n          }\n        })\n        .then(records =\u003E {\n          if (!records.length) {\n            $('.capacity').hide();\n            $('.capacity-text').hide();\n            return;\n          }\n          var result = `\n      \t\t\t\u003Ctable\u003E\n              \u003Cthead\u003E\n              \u003Ctr\u003E\n                \u003Ctd\u003E\u003Ch4\u003E#\u003C/h4\u003E\u003C/td\u003E\n                \u003Ctd\u003E\u003Ch4\u003EName\u003C/h4\u003E\u003C/td\u003E\n                \u003Ctd\u003E\u003Ch4\u003ERSVP time\u003C/h4\u003E\u003C/td\u003E\n              \u003C/tr\u003E\n              \u003C/thead\u003E\n              \u003Ctbody\u003E`;\n        \n        \tconst sortedRecords = records.sort((a, b) =\u003E new Date(a.data['RSVP Timestamp']) - new Date(b.data['RSVP Timestamp']));\n\n          sortedRecords.forEach((el, ind) =\u003E {\n            let currentUser = records[ind].joins.Users[0].data;\n            if (options.data.originalData[VARIABLES.capacity] \u003C ind + 1) {\n              result += `\u003Ctr class=\"red-text\"\u003E`;\n            } else {\n              result += `\u003Ctr\u003E`;\n            }\n            result += `\n\t\t\t\t\t\t\t\t\t\t\t\u003Ctd\u003E${ind + 1}\u003C/td\u003E\n  \t\t\t\t\t\t\t\t\t\t\u003Ctd\u003E${currentUser['First Name']} ${currentUser['Last Name']}\u003C/td\u003E\n\t\t\t\t\t\t\t\t\t\t\t\u003Ctd\u003E${moment(el.data['RSVP Timestamp']).format('D MMMM YYYY HH:mm')}\u003C/td\u003E\n\t\t\t\t\t\t\t\t\t\t\u003C/tr\u003E`;\n          });\n\n          result += `\u003C/tbody\u003E\u003C/table\u003E`;\n\n          $('.registrants').html(result);\n          // $('.capacity').html(\n          //   `${records.length} going out of ${\n          //     options.data.originalData[VARIABLES.capacity] ? options.data.originalData[VARIABLES.capacity] : unlimitedCapacityText\n          //   } spaces`\n          // );\n        });\n    }).then(()=\u003E {\n      entryId = options.data.id;\n\t   $('.addForm').append(`\u003Chr\u003E`);\n      $('.addForm').append($('.fl-widget-instance.detailView'));\n      return Fliplet.FormBuilder.get().then(function(form) {\n        form.fields.set([\n          {\n            _type: 'flRadio',\n            name: VARIABLES.enableCheckIn,\n            label: VARIABLES.enableCheckIn,\n            description: `Choose how attendees will check in for this session. Select \"Admin scans user QR code\" if staff will scan attendee codes, \"User scans posted QR code\" to display a QR code for users to scan themselves, or \"Off\" to disable check-in.`,\n            options: [{ \"label\": VARIABLES.enableCheckInOptions.admins }, { \"label\": VARIABLES.enableCheckInOptions.users }, {\"label\": VARIABLES.enableCheckInOptions.off }]\n          }\n        ]);\n        return form\n      }).then(function(form){      \n        if (options.data.originalData.hasOwnProperty(VARIABLES.enableCheckIn) && options.data.originalData[VARIABLES.enableCheckIn]){\n          form.field(VARIABLES.enableCheckIn).set(options.data.originalData[VARIABLES.enableCheckIn]);\n          initialValue = options.data.originalData[VARIABLES.enableCheckIn];\n        } else {\n          form.field(VARIABLES.enableCheckIn).set('');\n          initialValue = '';\n        }\n\n        if (!changeEventAttached){        \n          form.field(VARIABLES.enableCheckIn).change(function (val) {\n            changeEventAttached = true;\n            if (val && initialValue !== val){\n              // Only show confirmation when changing FROM \"User scans posted QR code\" TO something else\n              // This is when the check-in process is being disabled\n              if (initialValue === VARIABLES.enableCheckInOptions.users && val !== VARIABLES.enableCheckInOptions.users){\n                Fliplet.Navigate.confirm(confirmDisableCheckInOptions).then(function(result) {\n                  if (!result) {\n                    return console.log('Not confirmed!');\n                  } else {\n                    return updateSession(options, val);\n                  }\n                });\n              } else {\n                return updateSession(options, val);\n              }\n            }\n          });\n        }      \n      });\n    }).then(()=\u003E {\n      if (!options.data.originalData[VARIABLES.rsvp] || !options.data.originalData[VARIABLES.rsvp].length) {\n        $('.capacity').hide();\n        $('.capacity-text').hide();\n        return;\n      }\n    });\n  };\n});\n\nfunction generateCapacityMessage(record, attendeeCount) {\n  // Check if capacity is enforced\n  const isCapacityEnforced = record.data[VARIABLES.enforceCapacity] === VARIABLES.enforceCapacityOptions.yes;\n  \n  let capacity;\n  if (!isCapacityEnforced) {\n    // Capacity not enforced - show unlimited\n    capacity = unlimitedCapacityText;\n  } else {\n    // Capacity enforced - get actual capacity\n    capacity = record.data[VARIABLES.capacity];\n    if (capacity === null || capacity === undefined || String(capacity).trim() === '' || String(capacity).toLowerCase() === 'unlimited') {\n      capacity = unlimitedCapacityText;\n    } else {\n      capacity = parseInt(capacity, 10);\n      if (isNaN(capacity)) {\n        capacity = unlimitedCapacityText;\n      }\n    }\n  }\n\n  // Return object with capacity information\n  let capacityMessage;\n\n  // Generate capacity message based on logic\n  if (capacity === unlimitedCapacityText) {\n    // Unlimited capacity\n    capacityMessage = `\u003Cspan class=\"capacity_message\"\u003ECapacity: ${attendeeCount}/${unlimitedCapacityText} \u003C/span\u003E`;\n  } else if (attendeeCount \u003E= capacity) {\n    // Maximum capacity reached or exceeded\n    capacityMessage = `\u003Cspan class=\"capacity_message\" style=\"color: ${fullCapacityColor}\"\u003E${fullCapacityText}\u003C/span\u003E`;\n  } else {\n    // Capacity not reached\n    capacityMessage = `\u003Cspan class=\"capacity_message\"\u003ECapacity: ${attendeeCount}/${capacity}\u003C/span\u003E`;\n  }\n\n  return capacityMessage;\n}\n\nFliplet.Hooks.on('flListDataAfterGetData', function(options) {\n  return Fliplet.Session.get().then(function(session) {\n    loggedInUser = _.get(session, 'entries.dataSource.data');\n  }).then(function(){\n    return TimeConversion.getAppSetup().then(function(appSettings){\n      if (appSettings){\n        if (TimeConversion.checkIfConversionIsRequired(appSettings)){   \n          const originalTimezone = appSettings.data['Event Timezone'];\n          const userTimezone = TimeConversion.getCurrentUserTimezone();\n\n          _.forEach(options.records, function(record){\n            const originalDate = record.data['Date'];\n            const originalStartTime = record.data['Start Time'];\n            const originalEndTime = record.data['End Time'];\n\n            const converted = TimeConversion.convertToUserTimezone(\n              originalDate,\n              originalStartTime,\n              originalEndTime,\n              originalTimezone,\n              userTimezone\n            );\n        \n            _.set(record, 'data[\"Date\"]', converted.date);\n            _.set(record, 'data[\"Start Time\"]', converted.startTime);\n            _.set(record, 'data[\"End Time\"]', converted.endTime);\n          });\n        }\n      }  \n      return Promise.resolve(true);\n    });\n  }).then(() =\u003E {\n    // Collect Session IDs only from sessions with RSVP enabled (not meetings)\n    const sessionIdsWithRSVP = [];\n    options.records.forEach(record =\u003E {\n      if (record.data.Title && !record.data.Status && \n          record.data[VARIABLES.rsvp] && \n          Array.isArray(record.data[VARIABLES.rsvp]) && \n          record.data[VARIABLES.rsvp].includes(VARIABLES.rsvpEnabled)) {\n        sessionIdsWithRSVP.push(record.data['Session ID']);\n      }\n    });\n    \n    return new Promise((resolve, reject) =\u003E {\n      if (sessionIdsWithRSVP && sessionIdsWithRSVP.length){\n        return Fliplet.DataSources.connectByName(DS.attendingLogs).then(function(connection) {\n          return connection.find({\n            aggregate: [\n            {\n              $match: {\n                'data.Session ID': { $in: sessionIdsWithRSVP },\n                'data.RSVP Status': 'Going'\n              }\n            },\n            {\n              $group: {\n                _id: '$data.Session ID',\n                count: { $sum: 1 }\n              }\n            }\n          ]\n        }).then(records =\u003E {\n            resolve(records);\n        });\n       });\n    \t}\n      resolve([]);\n    }).then(attendanceCounts =\u003E {\n      // Create attendance count map by session ID\n      const attendanceMap = {};\n      attendanceCounts.forEach(item =\u003E {\n        attendanceMap[item._id] = item.count;\n      });\n\n      _.forEach(options.records, function(record){\n        if (record.data[VARIABLES.enableCheckIn] == VARIABLES.enableCheckInOptions.users){\n          record.data.CheckInEnabled = true;\n        }\n\n        // Check if this is a session with RSVP enabled\n        const isSession = record.data.Title && !record.data.Status;\n        const isRSVPEnabled = record.data[VARIABLES.rsvp] && \n              Array.isArray(record.data[VARIABLES.rsvp]) && \n              record.data[VARIABLES.rsvp].includes(VARIABLES.rsvpEnabled);\n\n        if (isSession && isRSVPEnabled) {\n          // Get attendee count from aggregated data\n          const sessionId = record.data['Session ID'];\n          const attendeeCount = attendanceMap[sessionId] || 0;\n\n          // Generate capacity message\n          const capacityMessage = generateCapacityMessage(record, attendeeCount);\n          record.data.capacityMessage = capacityMessage;\n        }\n      });\n    });\n  });\n});\n\n//show detailed view if only one record is present\nFliplet.Hooks.on('flListDataAfterRenderList', checkRecordsNum);\n\n//listener which redirects to the relevant speaker at the speakers screen\n//target:  .media\n$(document).on('click', '.media', function() {\n  var speakerEmail = $(this).data('name');\n  Fliplet.Navigate.screen(SCREENS.speakers, {\n    query:\n      '?dynamicListOpenColumn=Email&dynamicListOpenValue=' +\n      speakerEmail +\n      '&dynamicListPreviousScreen=true'\n  });\n});\n\n//listener which redirects to the materials screen\n//target:  .materials-button\n$(document).on('click', '.materials-button', function() {\n  var entryId = $(this).attr('id');\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findById(entryId).then(function(record) {\n      var session = record.data['Session ID'];\n      var query =\n        '?sessionTitle=true&dynamicListPrefilterColumn=Associated%20Session&dynamicListPrefilterValue=' +\n        encodeURIComponent(session) +\n        '&dynamicListPrefilterLogic=%3D%3D';\n      return Fliplet.Navigate.screen(SCREENS.materials, { query: query });\n    });\n  });\n});\n\n$(document).on('click', '.floorplan-button', function(event) {\n  event.preventDefault();\n  var locationID = this.id;\n  Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findById(locationID).then(function(record) {\n      Fliplet.Navigate.screen(SCREENS.floorplan, {\n        query: '?entryName=' + encodeURIComponent(record.data.Location)\n      });\n    });\n  });\n});\n\n//listener which redirects to the poll screen\n//target:  .go-to-poll\n$(document).on('click', '.go-to-poll', function() {\n  console.log('poll');\n  var entryId = $(this)\n    .parents('.agenda-item-inner-content')\n    .data('entry-id');\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findById(entryId).then(function(record) {\n      return Fliplet.Navigate.screen(SCREENS.poll, {\n        query:\n          '?sessionID=' +\n          encodeURIComponent(record.data['Session ID']) +\n          '&title=' +\n          encodeURIComponent(record.data['Title'])\n      });\n    });\n  });\n});\n\n$(document).on('click', '.agenda-detail-overlay-close', function() {\n  Fliplet.FormBuilder.get().then(function(form) {\n    form.fields.set([]);\n  });\n  $('.formDiv').append($('.fl-widget-instance.detailView'));\n  if (initialAgendaWasChanged){\n    initialAgendaWasChanged = false;\n    location.reload();\n  }\n});\n    \nfunction updateSession(options, val){\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function (connection) {\n    return connection.update(entryId, {\n      [VARIABLES.enableCheckIn]: val,\n      [VARIABLES.manualCheckInCode]: val == VARIABLES.enableCheckInOptions.users ? options.data.originalData[VARIABLES.manualCheckInCode] || generateCode() : ''\n    }).then(function(){\n      // Update the initial value after successful update so subsequent changes are detected\n      initialValue = val;\n      initialAgendaWasChanged = true;\n      return Fliplet.UI.Toast('Agenda was updated');\n    });\n  });\n}\n\nfunction checkRecordsNum(options) {\n  if (Fliplet.Navigate.query.openDetailedIfOneRecord && options.records.length === 1) {\n    $('.small-card-list-item').click();\n  }\n}\n\nHandlebars.registerHelper('getName', function(options) {\n  if (Array.isArray(options)) {\n    var res = options[0].split('/');\n    var fileid = res[6];\n\n    var index = options[0].lastIndexOf('/');\n    var fileName = options[0].substr(index + 1);\n\n    return new Handlebars.SafeString(decodeURI(fileName));\n  } else {\n    var res = options.split('/');\n    var fileid = res[6];\n\n    var index = options.lastIndexOf('/');\n    var fileName = options.substr(index + 1);\n\n    return new Handlebars.SafeString(decodeURI(fileName));\n  }\n});\n\nHandlebars.registerHelper('eachString', function(string, options) {\n  var array = string ? string.split(',') : [];\n  array.forEach(function(string, index) {\n    array[index] = string.trim();\n  });\n\n  if (!array || array.length === 0) {\n    return options.inverse(this);\n  }\n\n  var data;\n  if (options.data) {\n    data = Handlebars.createFrame(options.data);\n  }\n\n  var result = [];\n  for (var i = 0; i \u003C array.length; ++i) {\n    if (data) {\n      data.index = i;\n    }\n    result.push(options.fn(array[i], { data: data }));\n  }\n\n  return result.join('');\n});\n\nHandlebars.registerHelper('addForm', function() {\n  return '\u003Cdiv class=\"addForm\"\u003E\u003C/div\u003E';\n});",
        "customCSS": ".new-agenda-list-container .agenda-list-item:not(.open) .agenda-item-bookmark-holder{top:0;height:25px}.session-container{background-color:#fff !important}.printqr-button{position:relative;display:flex;align-items:center;justify-content:center;width:calc(100% - 30px);margin:0 auto 15px;color:white;min-height:40px;border-radius:10px;font-size:20px;overflow:hidden;background-color:#8fa7df}.printqr-button p{font-size:18px;margin:0 0 2px 10px;z-index:2}.printqr-button i{z-index:2}.rsvp-not-attend.selected,.rsvp-attend.selected{color:#999 !important;cursor:not-allowed !important}.rsvp-not-attend.selected *,.rsvp-attend.selected *{color:#999 !important}.award{display:inline-block;text-align:center;padding:8px;width:31%;vertical-align:top}.agenda-item-bookmark.more-buttons{align-items:center;flex-wrap:wrap}.session-button,.agenda-item-bookmark.more-buttons .agenda-item-bookmark-holder{margin:5px !important;width:56px}.agenda-detail-overlay .bookmark-wrapper{color:#8fa7df}.agenda-detail-overlay .bookmarked .bookmark-wrapper.btn-bookmarked{color:#345091}.agenda-detail-overlay .bookmark-wrapper{margin:0}.media-left img{width:100%;height:100%;object-fit:cover;border-radius:8px 0 0 8px}.media{display:flex;flex-direction:row;align-items:stretch;padding:0;width:100%;border:1px solid #eee;border-radius:8px;margin-bottom:15px;box-shadow:0 2px 5px rgba(0,0,0,0.05);max-height:80px;overflow:hidden}.media-body,.media-left,.media-right{display:block;vertical-align:top;color:#333;padding:0}.media-left{width:80px;flex-shrink:0}.media-body{flex-grow:1;padding:10px 15px;position:relative;display:flex;flex-direction:column;justify-content:center}.media-heading{font-size:15px;color:#345091;margin-bottom:2px}.title-name{font-size:13px;color:#555}.company-name{font-size:13px;color:#777}.right-chevron{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:1.2em;color:#ccc}@media (min-width: 640px){.media{margin-top:0}.media-container{display:flex;justify-content:flex-start;flex-wrap:wrap}}\n",
        "customSCSS": ".new-agenda-list-container .agenda-list-item:not(.open) .agenda-item-bookmark-holder{\n  top: 0;\n  height: 25px;\n}\n\n.session-container{\n  background-color: #fff !important;\n}\n.printqr-button{\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: calc(100% - 30px);\n  margin: 0 auto 15px;\n  color: white;\n  min-height: 40px;\n  border-radius: 10px;\n  font-size: 20px;\n  overflow: hidden;\n  background-color: $secondaryColor;\n  p {\n    font-size: 18px;\n    margin: 0 0 2px 10px;\n    z-index: 2;\n  }\n  i{\n    z-index: 2;\n  }\n}\n\n.rsvp-not-attend, .rsvp-attend {\n  &.selected {\n    color: #999 !important;\n    cursor: not-allowed !important;\n    * {\n      color: #999 !important;\n    }\n  }\n}\n.award{\n  display:inline-block;\n  text-align: center;\n  padding: 8px;\n  width: 31%;\n  vertical-align: top;\n}\n.agenda-item-bookmark.more-buttons{\n  align-items: center;\n  flex-wrap: wrap;\n}\n.session-button, .agenda-item-bookmark.more-buttons .agenda-item-bookmark-holder{\n  margin: 5px!important;\n  width: 56px;\n}\n.agenda-detail-overlay .bookmark-wrapper{\n  color: $agendaBookmarkIconColor;\n}\n\n.agenda-detail-overlay .bookmarked .bookmark-wrapper.btn-bookmarked{\n color: $agendaBookmarkIconActiveColor;\n}\n.agenda-detail-overlay .bookmark-wrapper{\n  margin: 0;\n}\n.media-left img{\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  border-radius: 8px 0 0 8px;\n}\n.media {\n  display: flex;\n  flex-direction: row;\n  align-items: stretch;\n  padding: 0;\n  width: 100%;\n  border: 1px solid #eee;\n  border-radius: 8px;\n  margin-bottom: 15px;\n  box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n  max-height: 80px;\n  overflow: hidden;\n}\n/* Create three equal columns that sits next to each other */\n.media-body, .media-left, .media-right {\n  display: block;\n  vertical-align: top;\n  color: $bodyTextColor;\n  padding: 0;\n}\n.media-left {\n  width: 80px;\n  flex-shrink: 0;\n}\n.media-body {\n  flex-grow: 1;\n  padding: 10px 15px;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.media-heading{\n  font-size: 15px;\n  color: $headingFourColor;\n  margin-bottom: 2px;\n}\n.title-name{\n  font-size: 13px;\n  color: #555;\n}\n.company-name{\n  font-size: 13px;\n  color: #777;\n}\n.right-chevron{\n  position: absolute;\n  right: 10px;\n  top: 50%;\n  transform: translateY(-50%);\n  font-size: 1.2em;\n  color: #ccc;\n}\n.media-object {\n}\n\n@media (min-width: 640px) {\n  .media {\n    margin-top: 0;\n  }\n  .media-container {\n    display: flex;\n    justify-content: flex-start;\n    flex-wrap: wrap;\n  }\n}\n@media (max-width: 640px) {\n}",
        "widgetInstancesInUse": [30951723, 30951724, 30951725, 30951726]
      },
      "updatedAt": "2025-07-02T16:49:35.363Z",
      "slug": "admin-agenda-1l7ls"
    },
    {
      "id": 1744612,
      "isLayout": false,
      "layout": "{{{widget 30951984}}}",
      "dependencies": [
        "bootstrap-css",
        "fliplet-ui-typeahead"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 43,
      "order": 43,
      "sectionId": null,
      "title": "Admin - Manage Agenda",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen provides a form for managing agenda sessions, allowing for the addition and editing of sessions as well as linked items such as polls, questions, surveys, floorplan locations, and speakers. Many fields are custom and should not be edited, but additional form fields can be added.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can use this form to create or modify session details and link relevant items to enhance the agenda, including linking speakers' profiles.\u003C/p\u003E"
        },
        "customJS": "let agendaToEdit;\n\nFliplet.Hooks.on('afterFormEntryLoad', function (data) {\n  agendaToEdit = data.entry || '';\n  return Promise.resolve(data);\n});\n\nFliplet.FormBuilder.get()\n  .then(function (form) {\n  // registers a callback to be fired whenever the field value changes\n  form.field('Optional').change(function (val) {\n    form.field(VARIABLES.personalizedAgenda).toggle((!val || val !== 'Yes') ? false : true);\n    form.field(VARIABLES.personalizedAgenda).instance.required = (!val || val !== 'Yes') ? false : true;\n  });\n  \n  form.field(VARIABLES.enableCheckIn).change(function (val) {\n    const visibility = !val || val === VARIABLES.enableCheckInOptions.off || val === VARIABLES.enableCheckInOptions.admins ? false : true;\n    form.field(VARIABLES.manualCheckInCode).toggle(visibility, false);\n  });\n  \n  form.field(VARIABLES.rsvp).change(function (val) {\n    const visibility = !val || val[0] !== VARIABLES.rsvpEnabled ? false : true;\n    \n    if (visibility && (!agendaToEdit || !agendaToEdit.data[VARIABLES.capacity])){\n      form.field(VARIABLES.capacity).set('');\n    }\n    \n    if (!val || !val[0]){\n      form.field(VARIABLES.capacity).toggle(visibility);\n    \tform.field(VARIABLES.capacity).instance.required = visibility;\n    }\n\n    //Enforce capacity form field is visible and required if RSVP is enabled\n    form.field(VARIABLES.enforceCapacity).toggle(visibility);\n    form.field(VARIABLES.enforceCapacity).instance.required = visibility;\n    //Show RSVP'ed attendees form field is visible and required if RSVP is enabled\n    form.field(VARIABLES.showAttendees).toggle(visibility);\n    form.field(VARIABLES.showAttendees).instance.required = visibility;\n  });\n  \n  form.field(VARIABLES.enforceCapacity).change(function (val) {\n    const visibility = !val || val === VARIABLES.enforceCapacityOptions.no ? false : true;\n    form.field(VARIABLES.capacity).toggle(visibility);\n    form.field(VARIABLES.capacity).instance.required = visibility;\n  });\n  \n  //get all users to show as attendees of optional agenda\n  return Fliplet.DataSources.connectByName(DS.users).then(function(connection){\n    return connection.find({ attributes: ['Email', 'Last Name', 'First Name']}).then(allUsers =\u003E {\n      const personalizedAgendaOptions = allUsers.map(user =\u003E ({ \n        label: `${user.data['First Name']} ${user.data['Last Name']} (${user.data['Email']})`, \n        id: user.data['Email']\n      }));\n      \n      // Set options first\n      //form.field(VARIABLES.personalizedAgenda).options(personalizedAgendaOptions);\n      \n      if (agendaToEdit && agendaToEdit.data[VARIABLES.personalizedAgenda] && Array.isArray(agendaToEdit.data[VARIABLES.personalizedAgenda]) && agendaToEdit.data[VARIABLES.personalizedAgenda].length){\n        form.field(VARIABLES.personalizedAgenda).set(agendaToEdit.data[VARIABLES.personalizedAgenda]);\n        \n        console.log('value: ', agendaToEdit.data[VARIABLES.personalizedAgenda]);\n        console.log('get: ', form.field(VARIABLES.personalizedAgenda).get());\n        \n       }\n    });\n  });\n});\n\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  let editMode = Fliplet.Navigate.query.dataSourceEntryId;\n  \n  if (data[VARIABLES.enableCheckIn] === VARIABLES.enableCheckInOptions.users && !data[VARIABLES.manualCheckInCode]){\n    if (!editMode){\n      //if manual check in code is not provided by the admin in create mode\n      data[VARIABLES.manualCheckInCode] = generateCode();\n    } else {\n      //if manual check in code is not provided by the admin in edit mode and agenda doesn't have code yet\n      data[VARIABLES.manualCheckInCode] = agendaToEdit.data[VARIABLES.manualCheckInCode] ? agendaToEdit.data[VARIABLES.manualCheckInCode] : generateCode();\n    }\n  }\n  \n  return data;\n});",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951982, 30951983, 30951984, 30951985]
      },
      "updatedAt": "2025-07-02T16:49:40.544Z",
      "slug": "admin-manage-agenda-1l7n4"
    },
    {
      "id": 1744571,
      "isLayout": false,
      "layout": "{{{widget 30951722}}}\n\u003Cdiv class=\"clone\"\u003E\u003C/div\u003E",
      "dependencies": [
        {
          "url": "https://cdn.fliplet.com/apps/366553/dependencies/html2canvasmin-aa8e67a8a6d1c556381c7f7316415473.js",
          "name": "html2canvas.min",
          "path": "apps/366553/dependencies/html2canvasmin-aa8e67a8a6d1c556381c7f7316415473.js",
          "latest": "https://html2canvas.hertzen.com/dist/html2canvas.min.js",
          "updatedAt": 1746200556
        },
        {
          "url": "https://cdn.fliplet.com/apps/366553/dependencies/FileSavermin-c2c52f53b7835de45e3e65adfb341b45.js",
          "name": "FileSaver.min",
          "path": "apps/366553/dependencies/FileSavermin-c2c52f53b7835de45e3e65adfb341b45.js",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js",
          "updatedAt": 1746200556
        },
        "bootstrap-css",
        "fliplet-barcode"
      ],
      "appId": 389751,
      "layoutId": 378155,
      "layoutOrder": 44,
      "order": 44,
      "sectionId": null,
      "title": "Admin - Generate QR Code",
      "settings": {
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let emailOptions = {\n  html: \"\u003Cp\u003EPlease find the QR Code attached.\u003C/p\u003E\",\n  subject: \"QR Code\",\n  from_name: \"QR Code App\",\n  headers: {\n    \"Reply-To\": \"message.reply@example.com\"\n  }\n};\n\nvar error, barcode, sessionName;\nvar sessionID = Fliplet.Navigate.query.sessionID;\n\nif (!sessionID) {\n  error = 'Session is not set. Please visit this screen via the Admin - Agenda screen.';\n  $(document).find('.error').show();\n} else {\n  $(document).find('.error').hide();\n}\n\n//hide download button on native\nif (Fliplet.Env.is('native')) {\n  $(document).find('.download').addClass('hidden');\n}\n\n//print page\n$(document).on('click', '.download', function(e) {\n  e.preventDefault();\n  \n  Fliplet.UI.Toast({\n    type: 'regular',\n    position: 'center',\n    backdrop: true,\n    tapToDismiss: false,\n    title: 'Please wait, the data is loading...',\n    progress: true\n  });\n  \n  $(document).find('#qr-code-content .hide-from-canvas').each(function(){\n    $(this).addClass('hidden');\n  });\n  \n  return html2canvas(document.querySelector('#qr-code-content')).then(canvas =\u003E {\n    document.body.appendChild(canvas);\n    canvas.toBlob(function(blob) {      \n      window.saveAs(blob, `${sessionName} - QR code.jpg`);\n      $(document).find('#qr-code-content .hide-from-canvas').each(function(){\n        $(this).removeClass('hidden');\n      });\n    });\n    Fliplet.UI.Toast.dismiss();\n    return Promise.resolve(true);\n  });\n});\n\n//send email\n$(document).on('click', '.send', function(e) {\n  e.preventDefault();\n  \n  return getUser().then(function(user){\n    if (!user){\n      return;\n    }\n    var options = {\n      title: 'Send email to',\n      message: 'Please provide an email of a person you want to send this QR code to',\n      labels: ['Send','Cancel'],\n      default: user['Email']\n    };\n    \n    const validateEmail = (email) =\u003E {\n      return email.match(\n        /^(([^\u003C\u003E()[\\]\\\\.,;:\\s@\\\"]+(\\.[^\u003C\u003E()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\n      );\n    };\n    \n    return Fliplet.Navigate.prompt(options).then(function(input) {\n      if (!input || !input.trim()) {\n        return Promise.reject('');\n      } else {\n        input = input.trim();\n        let recipients = [];\n        \n        if (input.indexOf(',') \u003E -1){\n          //multiple emails are provided\n          _.forEach(input.split(','), function(email){  \n            email = email.trim();\n            if (validateEmail(email)){\n              recipients.push({ email: email, type: \"to\" });\n            }\n          });\n        } else if (validateEmail(input)){\n          recipients.push({ email: input, type: \"to\" });\n        }\n        \n        $(document).find('#qr-code-content .hide-from-canvas').each(function(){\n          $(this).addClass('hidden');\n        });\n        \n        return html2canvas(document.querySelector('#qr-code-content')).then(canvas =\u003E {\n          var image = canvas.toDataURL('image/jpeg').split(',')[1];       \n\n          emailOptions.to = recipients;\n          emailOptions.attachments = [\n            {\n              type: \"image/jpeg\",\n              name: `${sessionName} - QR code.jpeg`,\n              encoding: 'base64',\n              content: image\n            }\n          ];\n\n          // Returns a promise\n          return Fliplet.Communicate.sendEmail(emailOptions);\n        }).then(function(){\n          $(document).find('#qr-code-content .hide-from-canvas').each(function(){\n            $(this).removeClass('hidden');\n          });\n        });\n      }\n    });\n  });\n});\n\nif (!Fliplet.Env.get('interact') && !error && sessionID) {\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection.findOne({\n      where: {\n        'Session ID': { $eq: sessionID }\n      }\n    }).then(function(session){      \n      return Fliplet.App.get().then(function(app) {\n        if (app.productionAppId || app.id) {                    \n          if (!Fliplet.Env.get('interact')) { \n            if (Fliplet.Env.get('appSlug')){\n              const {\n                Title: sessionName,\n                Date: sessionDate,\n                'Start Time': sessionTime,\n                [VARIABLES.manualCheckInCode]: checkInCode\n              } = session.data;\n\n              $('.checkin-name .session-name').text(`\"${sessionName}\"`);\n              $('.checkin-name .session-date').text(sessionDate);\n              $('.checkin-name .session-time').text(sessionTime);\n              \n              $('.manual_check_in_code').text($('.manual_check_in_code').text().replace('[Manual check in code]', checkInCode));\n              /*$('.manual_check_out_code').text($('.manual_check_out_code').text().replace('[Manual check out code]', checkOutCode));*/\n              $('.appName').text(Fliplet.Env.get('appName')); \n              \n              let appURL = Fliplet.App.getPublicSlug();\n              barcode = appURL + '?sessionID=' + encodeURIComponent(sessionID);\n\n              if (barcode) {\n                return Fliplet.Barcode.encode(barcode).then(function(data) {\n                  $('.qr-code').html('\u003Cimg src=\"' + data + '\" title=\"QR code\" /\u003E');\n                });\n              }\n            } else {\n              error = 'Please publish the web app via the Publish settings in Fliplet Studio.';\n              $('.error').text(error).show();\n            }\n          }\n        } else {\n          error = 'Please publish the web app via the Publish settings in Fliplet Studio.';\n          $('.error').text(error).show();\n        }\n        return Promise.resolve(true);\n      });\n    });\n  });\n} else {\n  $('.error').text(error).show();\n}",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951713, 30951714, 30951715, 30951716, 30951717, 30951718, 30951719, 30951720, 30951721, 30951722]
      },
      "updatedAt": "2025-07-02T16:49:44.546Z",
      "slug": "admin-generate-qr-code-1l7lr"
    },
    {
      "id": 1744570,
      "isLayout": false,
      "layout": "{{{widget 30951710}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174199,
      "layoutOrder": 45,
      "order": 45,
      "sectionId": null,
      "title": "Admin - Manage Exhibitors",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen provides a form for managing exhibitors, allowing for the addition and editing of exhibitor companies. Additional fields can be added to the form component.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can use this form to input or modify details about exhibitor companies, ensuring that all relevant information is captured.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Blank",
            "No code"
          ],
          "category": "Blank screen",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951709, 30951710, 30951711, 30951712]
      },
      "updatedAt": "2025-07-02T16:49:34.801Z",
      "slug": "admin-manage-exhibitors-1l7lq"
    },
    {
      "id": 1744563,
      "isLayout": false,
      "layout": "{{{widget 30951672}}}",
      "dependencies": [
        "bootstrap-css",
        {
          "url": "https://cdn.fliplet.com/apps/11455/dependencies/85c64951322c9300829a8f1309da879f.css",
          "name": "selectize.bootstrap4",
          "path": "apps/11455/dependencies/85c64951322c9300829a8f1309da879f.css",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/css/selectize.bootstrap4.css",
          "updatedAt": 1621031077
        },
        {
          "url": "https://cdn.fliplet.com/apps/11455/dependencies/e50863a992d35144634fa3dc816136a1.js",
          "name": "selectize.min",
          "path": "apps/11455/dependencies/e50863a992d35144634fa3dc816136a1.js",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/js/standalone/selectize.min.js",
          "updatedAt": 1621031077
        }
      ],
      "appId": 389751,
      "layoutId": 163904,
      "layoutOrder": 46,
      "order": 46,
      "sectionId": null,
      "title": "Admin - Manage Materials",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows for managing materials by adding documents or links that may or may not be associated with specific agenda sessions. It is a standard form component, and additional fields can be added.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can use this form to upload relevant documents or links, ensuring that all necessary materials are accessible for users.\u003C/p\u003E"
        },
        "customJS": "var query = Fliplet.Navigate.query;\nvar $select;\n\n//render mmultiselect field with sessions\n$(document).ready(function () {\n  var multiselect =\n    '\u003Cselect id=\"select-to\" class=\"contacts selectized\" placeholder=\"Pick associated session(s)...\" multiple=\"multiple\" tabindex=\"-1\" style=\"display: none;\"\u003E\u003C/select\u003E';\n  var data = [];\n\n  var agendas;\n  \n  return Fliplet.DataSources.connectByName('Event - Agenda').then(function (\n\t\tconnection\n\t) { return connection.find({\n    \twhere: {\n        Materials: { $exists: 'Yes' }\n      }\n    })\n    .then(function (res) {\n      agendas = res;\n      \n      $('div.form-group[data-field=\"Associated Session\"]')\n        .find('.form-control')\n        .replaceWith(multiselect);\n\n      agendas.forEach(function (record) {\n        //console.log(record.data.Title);\n        data.push({\n          id: record.id,\n          value: record.data['Session ID'],\n          text:\n            record.data.Title\n        });\n      });\n\n      if (query && query.dataSourceEntryId) {\n        return Fliplet.DataSources.connectByName('Event - Materials').then(function (\n          connection\n        ) {\n          return connection\n            .findById(query.dataSourceEntryId)\n            .then(function (record) {\n              $select = $('#select-to').selectize({\n                persist: false,\n                maxItems: null,\n                valueField: 'value',\n                labelField: 'text',\n                searchField: ['text'],\n                options: data\n              });\n              if (\n                record &&\n                record.data['Associated Session'] &&\n                record.data['Associated Session'].length\n              ) {\n                $select[0].selectize.setValue(\n                  record.data['Associated Session']\n                );\n              }\n            });\n        });\n      } else {\n        $select = $('#select-to').selectize({\n          persist: false,\n          maxItems: null,\n          valueField: 'value',\n          labelField: 'text',\n          searchField: ['text'],\n          options: data\n        });\n      }\n\n    });\n   });\n});\n\n\nFliplet.Hooks.on('beforeFormSubmit', function (data) {\n\tdata['Associated Session'] = [];\n  var agenda = $select[0].selectize.getValue();\n\n  if (agenda && agenda.length) {\n    agenda.forEach(function (item) {\n     // console.log(item);\n      //data['Associated Session'].push(parseInt(item));\n      data['Associated Session'].push(item);\n    });\n  }\n\n});",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951672, 30951673, 30951674, 30951675]
      },
      "updatedAt": "2025-07-02T16:49:43.525Z",
      "slug": "admin-manage-materials-1l7lj"
    },
    {
      "id": 1744566,
      "isLayout": false,
      "layout": "\u003Cdiv class=\"page-wrapper\"\u003E\n  {{{widget 30951691}}}\n  \u003Cp class=\"loading\" style=\"display: none;\"\u003ELoading...\u003C/p\u003E\n  \u003Cdiv class=\"form\" style=\"\"\u003E{{{widget 30951693}}}\u003C/div\u003E\n  \u003Csection data-fl-edit=\"\" style=\"display: none;\"\u003E\n    {{{widget 30951692}}}\n    \u003Cp\u003E\u003C/p\u003E\n  \u003C/section\u003E\n\u003C/div\u003E",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 1195381,
      "layoutOrder": 47,
      "order": 47,
      "sectionId": null,
      "title": "Admin - Manage Comments",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen allows admins to manage comments by reviewing and potentially removing any comments reported as inappropriate. It is fully custom and cannot be edited.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can use this screen to monitor comments and take necessary actions on those that violate guidelines or are deemed inappropriate.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Popular",
            "Admin"
          ],
          "queries": [
            "Spam manager",
            "Spam filter",
            "report comments"
          ],
          "category": "Admin",
          "previews": {
            "web": {
              "id": 7254082,
              "url": "https://cdn.fliplet.com/organizations/2647/manage-comments-web-876-847-0705.png",
              "name": "manage comments web.png",
              "path": "organizations/2647/manage-comments-web-876-847-0705.png",
              "size": [1280, 800],
              "appId": null,
              "userId": 379269,
              "metadata": {
                "av": {
                  "status": "queued"
                },
                "size": 114424,
                "checksum": "dd1623fa48422949a18004a15db7d8d5"
              },
              "versions": {

              },
              "createdAt": "2023-11-24T13:13:28.929Z",
              "deletedAt": null,
              "thumbnail": "https://cdn.api.fliplet.com/v1/media/files/7254082/thumb/preview.jpg",
              "updatedAt": "2023-11-24T13:13:28.929Z",
              "contentType": "image/png",
              "isEncrypted": null,
              "mediaFolderId": null,
              "dataTrackingId": null,
              "organizationId": 2647,
              "dataSourceEntryId": null,
              "masterMediaFileId": null,
              "isOrganizationMedia": false
            },
            "mobile": {
              "id": 7254081,
              "url": "https://cdn.fliplet.com/organizations/2647/Manage-comments-mobile-867-948-1066.png",
              "name": "Manage comments mobile.png",
              "path": "organizations/2647/Manage-comments-mobile-867-948-1066.png",
              "size": [430, 873],
              "appId": null,
              "userId": 379269,
              "metadata": {
                "av": {
                  "status": "queued"
                },
                "size": 122036,
                "checksum": "4c9935fcdfe27b99b4bfee7c01fad81b"
              },
              "versions": {

              },
              "createdAt": "2023-11-24T13:13:28.861Z",
              "deletedAt": null,
              "thumbnail": "https://cdn.api.fliplet.com/v1/media/files/7254081/thumb/preview.jpg",
              "updatedAt": "2023-11-24T13:13:28.861Z",
              "contentType": "image/png",
              "isEncrypted": null,
              "mediaFolderId": null,
              "dataTrackingId": null,
              "organizationId": 2647,
              "dataSourceEntryId": null,
              "masterMediaFileId": null,
              "isOrganizationMedia": false
            },
            "tablet": {
              "id": 7254080,
              "url": "https://cdn.fliplet.com/organizations/2647/manage-comments-tablet-755-209-5509.png",
              "name": "manage comments tablet.png",
              "path": "organizations/2647/manage-comments-tablet-755-209-5509.png",
              "size": [768, 1024],
              "appId": null,
              "userId": 379269,
              "metadata": {
                "av": {
                  "status": "queued"
                },
                "size": 139147,
                "checksum": "718ddcb5d2f23cf9156c3c49ce129a18"
              },
              "versions": {

              },
              "createdAt": "2023-11-24T13:13:28.842Z",
              "deletedAt": null,
              "thumbnail": "https://cdn.api.fliplet.com/v1/media/files/7254080/thumb/preview.jpg",
              "updatedAt": "2023-11-24T13:13:28.842Z",
              "contentType": "image/png",
              "isEncrypted": null,
              "mediaFolderId": null,
              "dataTrackingId": null,
              "organizationId": 2647,
              "dataSourceEntryId": null,
              "masterMediaFileId": null,
              "isOrganizationMedia": false
            }
          },
          "description": "Manage and remove unwanted comments with the manage comments screen template."
        },
        "customJS": "$('.form').hide();\n$('section').hide();\nconst DataSourcesNames = [];\n\nFliplet.DataSources.get({\n  attributes: ['id', 'name'],\n  appId: Fliplet.Env.get('masterAppId'),\n  includeInUse: true\n}).then(function(dataSources) {\n  var values = dataSources\n    .map(el =\u003E (el['name'].indexOf('Comments') !== -1 ? el['name'] : ''))\n    .filter(el =\u003E el);\n\n  return Fliplet.FormBuilder.get().then(function(form) {\n    form.field('CommentsDS').options(values);\n    if (Fliplet.Navigate.query.CommentDS) {\n      form.field('CommentsDS').set(Fliplet.Navigate.query.CommentDS);\n    }\n    $('.loading').hide();\n    $('.form').show();\n  });\n});\n\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  return Fliplet.Navigate.screen(Fliplet.Env.get('pageId'), {\n    query: '?CommentDS=' + encodeURIComponent(data.CommentsDS)\n  });\n});\n\nif (Fliplet.Navigate.query.CommentDS) {\n  $('section').show();\n  Fliplet.Hooks.on('flListDataBeforeGetData', function(lfdoptions) {\n    return Fliplet.DataSources.connectByName(Fliplet.Navigate.query.CommentDS).then(function(\n      connection\n    ) {\n      return connection.find().then(function(records) {\n        //    console.log(records);\n        lfdoptions.config.getData = function() {\n          if (records.length) {\n            //   $('.form').hide();\n            return Promise.resolve(records);\n          } else {\n            Fliplet.UI.Toast('No Comments');\n            return Promise.resolve([]);\n          }\n        };\n      });\n    });\n  });\n}\n\n$(document).on('click', '#del', function() {\n  const Itemid = $(this).attr('data-entry-id');\n  var options = {\n    title: 'Please Confirm',\n    message: 'Are you sure you want to delete this comment?',\n    labels: ['Agree', 'No'] // Native only (defaults to [OK,Cancel])\n  };\n  return Fliplet.Navigate.confirm(options).then(function(result) {\n    if (!result) {\n      return console.log('Not confirmed!');\n    }\n\n    return Fliplet.DataSources.connect(Fliplet.Navigate.query.CommentDS).then(function(connection) {\n      return connection.removeById(Itemid).then(function onRemove() {\n        $('.close-icon').click();\n        return location.reload();\n      });\n    });\n  });\n});\n",
        "customCSS": "[data-widget-package=\"com.fliplet.text\"].instructions{display:none !important;color:#3c763d !important;background-color:#dff0d8 !important;padding:15px !important;border-color:#d6e9c6;border:1px solid transparent;border-radius:4px}[data-widget-package=\"com.fliplet.text\"].instructions p,[data-widget-package=\"com.fliplet.text\"].instructions li{color:black !important}[data-widget-package=\"com.fliplet.text\"].danger{background-color:#f2dede !important}.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions{display:block !important}.page-wrapper{max-width:600px;margin:0 auto;padding:20px 15px}@media screen and (min-width: 700px){.dynamic-list-add-item{right:calc(50vw - 350px)}}.new-news-feed-list-container .slide-over .news-feed-item-inner-content h2.news-feed-item-title,.new-news-feed-list-container .slide-over .news-feed-item-inner-content h2.news-feed-item-title{font-size:20px}.new-news-feed-list-container .slide-over .news-feed-item-inner-content,.news-feed-list-container .slide-over .news-feed-item-inner-content{color:#333}.new-news-feed-list-container .slide-over .news-feed-item-inner-content .news-feed-item-description,.news-feed-detail-overlay .news-feed-item-inner-content .news-feed-item-description{color:#333}.delete-item button{color:#fff;background-color:#d9534f;border:none}.delete-item:hover button{color:#fff;background-color:#c9302c;border-color:#ac2925}.form{margin-bottom:20px}.ready{display:block !important}\n",
        "customSCSS": "/* hide instructions, only show when in edit mode */\n[data-widget-package=\"com.fliplet.text\"].instructions {\n  display:none !important;\n  color: #3c763d !important;\n  background-color: #dff0d8 !important;\n  padding: 15px !important;\n  border-color: #d6e9c6;\n  border: 1px solid transparent;\n  border-radius: 4px;\n}\n[data-widget-package=\"com.fliplet.text\"].instructions p, [data-widget-package=\"com.fliplet.text\"].instructions li {\n  color:black !important;\n}\n[data-widget-package=\"com.fliplet.text\"].danger {\n  background-color: #f2dede !important;\n}\n.mode-interact [data-widget-package=\"com.fliplet.text\"].instructions {\n  display:block !important;\n}\n.page-wrapper {\n  max-width: 600px;\n  margin: 0 auto;\n  padding: 20px 15px;\n}\n@media screen and (min-width: 700px) {\n  .dynamic-list-add-item {\n    right: calc(50vw - 350px);\n  }\n}\n.new-news-feed-list-container .slide-over .news-feed-item-inner-content h2.news-feed-item-title, .new-news-feed-list-container .slide-over .news-feed-item-inner-content h2.news-feed-item-title, {\n  font-size: 20px;\n}\n.new-news-feed-list-container .slide-over .news-feed-item-inner-content, .news-feed-list-container .slide-over .news-feed-item-inner-content {\n  color: $bodyTextColor;\n}\n.new-news-feed-list-container .slide-over .news-feed-item-inner-content .news-feed-item-description, .news-feed-detail-overlay .news-feed-item-inner-content .news-feed-item-description {\n  color: $bodyTextColor;\n}\n.delete-item button{\n  color: #fff;\n  background-color: #d9534f;\n  border:none;\n}\n.delete-item:hover button{\n  color: #fff;\n  background-color: #c9302c;\n  border-color: #ac2925;\n}\n.form{\n  margin-bottom:20px;\n}\n.ready{\n  display:block !important;\n}\n",
        "interactVersion": "3.0",
        "isBlockedScreen": true,
        "widgetInstancesInUse": [30951691, 30951692, 30951693]
      },
      "updatedAt": "2025-07-02T16:49:34.073Z",
      "slug": "admin-manage-comments-1l7lm"
    },
    {
      "id": 1744582,
      "isLayout": false,
      "layout": "{{{widget 30951763}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 347045,
      "layoutOrder": 48,
      "order": 48,
      "sectionId": null,
      "title": "Admin - Awards",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen displays a list of all awards in the app that are given to users for completing certain interactions. It is a custom screen and cannot be edited.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can view the complete list of awards and have the ability to add, edit, or delete awards as necessary to ensure that the awards system remains up-to-date and relevant for users.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Blank",
            "No code"
          ],
          "category": "Blank screen",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "Handlebars.registerHelper('award-icon', function(data) {\n  return new Handlebars.SafeString(\n    '\u003Cdiv class=\"award-container\"\u003E\u003Cdiv class=\"award\"\u003E ' +\n      '\u003Cspan class=\"fa-stack fa-lg\"\u003E' +\n      '\u003Ci class=\"fa fa-circle fa-stack-2x\" style=\"color:#' +\n      data.data.root.originalData['First color'] +\n      ';background: radial-gradient(ellipse at center, #' +\n      data.data.root.originalData['First color'] +\n      ',#' +\n      data.data.root.originalData['Second color'] +\n      ');-webkit-background-clip: text; -webkit-text-fill-color: transparent;\"\u003E\u003C/i\u003E' +\n      ' \u003Ci class=\"fa ' +\n      data.data.root.originalData['Icon'] +\n      ' fa-stack-1x fa-inverse\"\u003E\u003C/i\u003E \u003C/span\u003E \u003C/div\u003E\u003C/div\u003E'\n  );\n});\n\nHandlebars.registerHelper('colors', function(firstColor, secondColor) {\n  return new Handlebars.SafeString(\n    '\u003Cdiv class=\"colors-container\"\u003E\u003Cdiv class=\"color\"\u003EFirst color: \u003Cspan style=\"background-color:#' +\n      firstColor +\n      '\"\u003E\u003C/span\u003E\u003C/div\u003E\u003Cdiv class=\"color\" \u003ESecond color:\u003Cspan style=\"background-color:#' +\n      secondColor +\n      '\"\u003E\u003C/span\u003E\u003C/div\u003E\u003C/div\u003E'\n  );\n});\n",
        "customCSS": ".colors-container{margin-right:30px;display:flex;justify-content:space-between}.colors-container .color span{width:120px;height:30px;display:block}.small-card-detail-overlay.ready .small-card-detail-wrapper .small-card-list-detail-content-wrapper{top:30px;padding-top:20px}.award{display:inline-block;text-align:center;width:31%;vertical-align:top;transform:scale(1.5);margin-top:15px}.award-container{position:relative;top:20px;display:flex;justify-content:center}\n",
        "customSCSS": ".colors-container {\n  margin-right: 30px;\n  display: flex;\n  justify-content: space-between;\n  .color {\n    span {\n      width: 120px;\n      height: 30px;\n      display: block;\n    }\n  }\n}\n\n.small-card-detail-overlay.ready .small-card-detail-wrapper .small-card-list-detail-content-wrapper{\n  top: 30px;\n  padding-top: 20px;\n}\n\n.award {\n  display:inline-block;\n  text-align: center;\n  width: 31%;\n  vertical-align: top;\n  transform: scale(1.5);\n  margin-top: 15px;\n}\n.award-container {\n  position: relative;\n  top: 20px;\n  display: flex;\n  justify-content: center;\n}\n",
        "interactVersion": "3.0",
        "widgetInstancesInUse": [30951762, 30951763, 30951764]
      },
      "updatedAt": "2025-07-02T16:49:46.712Z",
      "slug": "admin-awards-1l7m6"
    },
    {
      "id": 1744613,
      "isLayout": false,
      "layout": "{{{widget 30951988}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 174199,
      "layoutOrder": 49,
      "order": 49,
      "sectionId": null,
      "title": "Admin - Manage Awards",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is custom and cannot be edited. It allows admins to manage awards by adding and editing award details, such as the criteria for users to complete an award, the message sent to them, and the point value of each award.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can input or modify the specifics of each award, ensuring that the awards system is clear and engaging for users. This includes defining what actions are required to earn an award and customizing the notification messages that users receive upon completion.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Blank",
            "No code"
          ],
          "category": "Blank screen",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "let query = Fliplet.Navigate.query.dataSourceEntryId;\n\nFliplet.FormBuilder.get().then(function (form) {\n\tvar pages = Fliplet.Env.get('appPages');\n\tvar options = pages.map(function (page) {\n\t\treturn page.title;\n\t});\n\n\tform.field('Screen name').options(options);\n  if (query){\n    return Fliplet.DataSources.connectByName(DS.awards).then(function (\n      connection\n    ) {\n      return connection\n        .findById(Fliplet.Navigate.query.dataSourceEntryId)\n        .then(function (record) {\n          if (record) {\n            form.field('Screen name').set(record.data['Screen name']);\n            form.field('Trigger').set(record.data['Trigger']);\n          }\n        });\n    });\n  }\n  return Promise.resolve(true);\n});\n\nFliplet.Hooks.on('beforeFormSubmit', function (data) {\n\tdata['award-id'] = (\n\t\tdata['Screen name'].split(' ').join('-') +\n\t\t'-' +\n\t\tdata['Trigger'].split(' ').join('-')\n\t).toLowerCase();\n});",
        "customCSS": "",
        "customSCSS": "",
        "interactVersion": "3.0",
        "isBlockedScreen": true,
        "widgetInstancesInUse": [30951986, 30951987, 30951988, 30951989]
      },
      "updatedAt": "2025-07-02T16:49:46.297Z",
      "slug": "admin-manage-awards-1l7n5"
    },
    {
      "id": 1744578,
      "isLayout": false,
      "layout": "{{{widget 30951748}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 283866,
      "layoutOrder": 50,
      "order": 50,
      "sectionId": null,
      "title": "Admin - Communications",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is custom and cannot be edited. It displays communications that have been sent or saved as drafts, including notifications sent from the app via push or email.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can view the list of communications, allowing them to manage and track notifications effectively. This includes both completed messages and those that are still in draft form, ensuring that all communications are organized and accessible.\u003C/p\u003E"
        },
        "customJS": "/** @format */\n\n//redirect to edit communication screen\n$(document).on('click', '.dynamic-list-duplicate-item', function () {\n\tvar status = $('.small-card-list-detail-role').text();\n\tif (status !== 'Sent') {\n\t\treturn Fliplet.Navigate.screen(SCREENS.editCommunication, {\n\t\t\tquery: '?recordId=' + $(this).attr('id')\n\t\t});\n\t}\n});\n",
        "customCSS": ".pushStatus{display:none;padding-bottom:10px}.btn.dynamic-list-duplicate-item{font-size:0.9em;border:1px solid #8fa7df}\n",
        "customSCSS": ".pushStatus {\n  display:none;\n  padding-bottom:10px;\n}\n.btn.dynamic-list-duplicate-item {\n  font-size: 0.9em;\n  border: 1px solid $secondaryColor;\n  //background-color: #F9F8F8;\n  //color: rgba(102,102,102,0.5);\n}\n",
        "isBlockedScreen": true,
        "widgetInstancesInUse": [30951748, 30951749, 30951750]
      },
      "updatedAt": "2025-07-02T16:49:46.622Z",
      "slug": "admin-communications-1l7m2"
    },
    {
      "id": 1744577,
      "isLayout": false,
      "layout": "{{{widget 30951747}}}\n",
      "dependencies": [
        "bootstrap-css",
        "fliplet-media",
        {
          "url": "https://fliplet-production.s3.eu-west-1.amazonaws.com/apps/11455/dependencies/a15b240c1953fcad6dadf6c38ffa1c64.css",
          "name": "selectize.bootstrap4",
          "path": "apps/11455/dependencies/a15b240c1953fcad6dadf6c38ffa1c64.css",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/css/selectize.bootstrap4.css",
          "updatedAt": 1654615895
        },
        {
          "url": "https://fliplet-production.s3.eu-west-1.amazonaws.com/apps/11455/dependencies/b3dcad04ae7baf949eb327334f502a98.js",
          "name": "selectize.min",
          "path": "apps/11455/dependencies/b3dcad04ae7baf949eb327334f502a98.js",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/js/standalone/selectize.min.js",
          "updatedAt": 1654615895
        }
      ],
      "appId": 389751,
      "layoutId": 286863,
      "layoutOrder": 51,
      "order": 51,
      "sectionId": null,
      "title": "Admin - Manage Communications",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is custom and cannot be edited. It provides a form where admins can send a new communication to all users or segment the recipients based on their profile information. Notifications can be sent immediately as push notifications, emails, or both.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can utilize this form to effectively reach out to users, ensuring that important information is communicated promptly and tailored to specific user groups as needed.\u003C/p\u003E"
        },
        "customJS": "/***********************************************************************\n   Global scope variables\n************************************************************************/\nvar userEmail;\nvar loggedUser;\nvar filterColumn = 'Expertize';\nvar toInsert = [];\n\n/* Remember to update the userDB variable or amend the global DS object to add the correct name for the target environment User Data Source */\n//var userDB = 'V&E Event Portal - User list';\nvar userDB = DS.users;\n\nvar logsDB = 'Event - Sent Communications';\nvar communicationsDB = 'Event - Communication Templates';\nvar sendToUserBtn = 'Send to users';\nvar sendTestbtn = 'Send a test';\nvar parseCondition = 'Parse Condition';\nvar DSColumns = ['Email', 'First Name', 'Last Name', 'flPushSubscriptionId', [filterColumn]];\nvar loginErrorMessage = 'Please log in to send a test message.';\nvar userData = [];\nvar query = Fliplet.Navigate.query;\nvar appId = Fliplet.Env.get('appId');\nvar ignoreUserSettings = false;\nvar instance = Fliplet.Notifications.init({});\nvar userDsId;\n\n// List of column names to remove from the User Profile column list\nvar DSColumnsToExclude = [\n  'flUserId',\n  'flUserToken',\n  'flSubscriptionId',\n  'code',\n  'verifiedAt',\n  'codeCreatedAt',\n  'flPushSubscriptionId',\n  'Password',\n  // Added image to the list of columns to be removed as the only comparison that would make sense would be\n  // is an image present or not, the other search types aren't really valid in this context\n  'Image',\n  // Also added Password and sendEmail\n  'Password',\n  'sendEmail'\n];\n\nvar action;\nvar password = generateRandomPassword();\n\nconst targetSelectizeFormControl = 'Optional Session';\nconst DEBUG = false;\n/***********************************************************************\n   End of Global scope\n************************************************************************/\n\n// populate the Optional Session dropdown with the optional sessions\npopulateOptionalSessionDD();\n\n// populate the ProfileDD with the list of visible profile fields that can be searched on\npopulateProfileDD();\n\n//get the list of users and logged in user email\nFliplet.User.getCachedSession().then(function(session) {\n  if (session && session.entries) {\n    // check if the user is connected to a dataSource login\n    if (session.entries.dataSource) {\n      loggedUser = _.get(session, 'entries.dataSource.data');\n    }\n    userEmail = loggedUser['Email'];\n    console.log('Logged in user:', userEmail);\n  }\n  return Fliplet.DataSources.connectByName(userDB).then(function(connection) {\n    return connection\n      .find({\n        attributes: DSColumns\n        /*where: {\n          [targetAppColumnn]: 'x'\n        }*/\n      })\n      .then(function(records) {\n        userDsId = records[0].dataSourceId;\n        var expertize = [];\n        _.forEach(records, function(value) {\n          if (JSON.stringify(value.data) !== '{}') {\n            userData.push(value.data);\n            expertize.push(value.data[filterColumn] ? value.data[filterColumn] : null);\n          }\n        });\n        populateFilter(_.uniq(expertize));\n        console.log('users', userData);\n      })\n      .then(function() {\n        Fliplet.FormBuilder.get().then(function(form) {\n          // hide form fields depending on user choices\n          form.field('Communication type').change(function(val) {\n            if (val.includes('Email')) {\n              form.field('Paragraph').toggle(true);\n              form.field('Email subject').toggle(true);\n              form.field('Paragraph-3').toggle(true);\n              form.field('Email content').toggle(true);\n            }\n            if (!val.includes('Email')) {\n              form.field('Paragraph').toggle(false);\n              form.field('Email subject').toggle(false);\n              form.field('Paragraph-3').toggle(false);\n              form.field('Email content').toggle(false);\n            }\n            if (val.includes('Push')) {\n              form.field('Paragraph-1').toggle(true);\n              form.field('Message title').toggle(true);\n              form.field('Message content').toggle(true);\n            }\n            if (!val.includes('Push')) {\n              form.field('Paragraph-1').toggle(false);\n              form.field('Message title').toggle(false);\n              form.field('Message content').toggle(false);\n            }\n          }, false);\n\n          // Setup an onChange event handler for the Condition control to update the value description\n          form.field('Condition').change(function() {\n            var fieldName = form.field('Profile Field').get();\n            var val = form.field('Condition').get();\n            updateValueDescription(fieldName, val);\n          });\n\n          // Setup an onChange event handler for the Profile Field control to update the value description\n          form.field('Profile Field').change(function() {\n            var fieldName = form.field('Profile Field').get();\n            var val = form.field('Condition').get();\n            updateValueDescription(fieldName, val);\n          });\n\n          //populate form fields if there is a record duplicated\n          if (query.recordId) {\n            return Fliplet.DataSources.connectByName(communicationsDB).then(function(connection) {\n              return connection.findById(query.recordId).then(function(record) {\n                console.log('Duplicated record', record);\n                form.field('Communication name').set(record.data['Communication name']);\n                form.field('Communication type').set(record.data['Communication type']);\n                form.field(filterColumn).set(record.data[filterColumn]);\n\n                if (record.data['Communication type'].includes('Email')) {\n                  form.field('Email subject').set(record.data['Email subject']);\n                  form.field('Email content').set(record.data['Email content']);\n                }\n\n                if (record.data['Communication type'].includes('Push')) {\n                  form.field('Message title').set(record.data['Message title']);\n                  form.field('Message content').set(record.data['Message content']);\n                }\n              });\n            });\n          }\n\n          /***********************************************************************\n     Function: updateValueDescription\n      Purpose: Updates the value description on the Profile Field search\n              filter based on the selected condition type.\n\n        Note: If the description messages need to be updated for the \n              Value text input field please amend the var MESSAGES json \n              object in the global JavaScript module.\n  ************************************************************************/\n          function updateValueDescription(fieldName, val) {            \n            if (val === 'Is empty' || val === 'Is not empty') {\n              form.field('Value').toggle(false);\n            } else if (val === 'Equals' || val === 'Not equal') {\n              form.field('Value').toggle(true);\n              var el = $('[_type=\"flInput\"] [name=\"Value\"]');\n              if (el.length \u003E 0 && el[0].previousElementSibling && val === 'Equals') {\n                el[0].previousElementSibling.innerHTML = MESSAGES.equals.replace(\n                  '{{fieldName}}',\n                  `\"${fieldName}\"`\n                );\n              } else if (el.length \u003E 0 && el[0].previousElementSibling && val === 'Is not one of') {\n                el[0].previousElementSibling.innerHTML = MESSAGES.notequal.replace(\n                  '{{fieldName}}',\n                  `\"${fieldName}\"`\n                );\n              }\n            } else if (val === 'Is one of' || val === 'Is not one of') {\n              form.field('Value').toggle(true);\n              var el = $('[_type=\"flInput\"] [name=\"Value\"]');\n              if (el.length \u003E 0 && el[0].previousElementSibling && val === 'Is one of') {\n                el[0].previousElementSibling.innerHTML = MESSAGES.isoneof.replace(\n                  '{{fieldName}}',\n                  `\"${fieldName}\"`\n                );\n              } else if (el.length \u003E 0 && el[0].previousElementSibling && val === 'Is not one of') {\n                el[0].previousElementSibling.innerHTML = MESSAGES.isnotoneof.replace(\n                  '{{fieldName}}',\n                  `\"${fieldName}\"`\n                );\n              }\n            } else if (val === 'Text contains' || val === 'Text does not contain') {\n              var el = $('[_type=\"flInput\"] [name=\"Value\"]');\n              if (el.length \u003E 0 && el[0].previousElementSibling && val === 'Text contains') {\n                el[0].previousElementSibling.innerHTML = MESSAGES.textcontains.replace(\n                  '{{fieldName}}',\n                  `\"${fieldName}\"`\n                );\n              } else if (\n                el.length \u003E 0 &&\n                el[0].previousElementSibling &&\n                val === 'Text does not contain'\n              ) {\n                el[0].previousElementSibling.innerHTML = MESSAGES.textdoesnotcontain.replace(\n                  '{{fieldName}}',\n                  `\"${fieldName}\"`\n                );\n              }\n            } else {\n              form.field('Value').toggle(true);\n\n              // reset the Value text input description to default\n              var el = $('[_type=\"flInput\"] [name=\"Value\"]');\n              if (el && el.length \u003E 0) {\n                el[0].previousElementSibling.innerHTML = MESSAGES.default;\n              }\n            }\n          }\n        });\n      });\n  });\n});\n/***********************************************************************\n   End of Calls that need to execute on form load\n************************************************************************/\n\n/***********************************************************************\n Fliplet Event Hooks\n***********************************************************************/\nFliplet.Hooks.on('beforeFormSubmit', function(data) {\n  data['Last edited'] = moment().format('YYYY-MM-DD hh:mm');\n  //console.log('data', data);\n  //console.log('action', action);\n  if (action === sendToUserBtn) {\n    data['Sent by'] = userEmail;\n    data['Sent Timestamp'] = moment().format('YYYY-MM-DD hh:mm');\n    //return send(data);\n    return sendTargetedData(data);\n  }\n  if (action === sendTestbtn) {\n    return sendTest(null, data);\n  }\n  if (action === parseCondition) {\n    return sendTargetedData(data);\n  }\n});\n/***********************************************************************\nEnd of Fliplet Event Hooks\n***********************************************************************/\n\n/***********************************************************************\n DOM Event Hooks\n***********************************************************************/\n$(document).on('click', \"button[type='submit']\", function() {\n  action = $(this).text();\n});\n\n$(document).ready(function() {\n  // hide the Parse Condition button\n  //$('div[data-field=\"Form buttons-4\"]').hide();\n\n  var multiSelect =\n    '\u003Cselect id=\"select-to\" class=\"sessions selectized\" placeholder=\"Pick one or more sessions...\" multiple=\"multiple\" tabindex=\"-1\" style=\"display: none;\"\u003E\u003C/select\u003E';\n  // var singleSelect =\n  //     '\u003Cselect id=\"select-to\" class=\"sessions selectized\" placeholder=\"Pick personalized agenda...\" tabindex=\"-1\" style=\"display: none;\"\u003E\u003C/select\u003E';\n  var sessions;\n\n  // Step 1 - Get Agenda Session Data and filter by Optional = 'Yes'\n  return Fliplet.DataSources.connectByName(DS.agenda).then(function(connection) {\n    return connection\n      .find({\n        where: {\n          Optional: 'Yes'\n        }\n      })\n      .then(function(sessions) {\n        // Step 2 - Find Text Box for target control and replace the HTML as required\n        $('div.form-group[data-field=\"' + targetSelectizeFormControl + '\"]')\n          .find('.form-control')\n          .replaceWith(multiSelect);\n\n        // Step 3 - Generate a JSON object containing an array of Sessions including id, Value and Label,\n        // where label concatenates the Title, Location and Start Time together.\n        var optionalSessionData = _.map(sessions, session =\u003E ({\n          id: session.id,\n          value: session.id,\n          label: `${session.data.Title} - ${session.data.Location}`\n        }));\n\n        //if (DEBUG) { console.log(`DEBUG -\u003E OptionalSessionData: ${JSON.stringify(optionalSessionData)}`); }\n\n        // Step 4 - Bind the optionalSessionData to the selectize'd text input control\n        $select = $('#select-to').selectize({\n          persist: false,\n          maxItems: null,\n          valueField: 'value',\n          labelField: 'label',\n          searchfield: 'label',\n          options: optionalSessionData\n        });\n      });\n  });\n});\n/***********************************************************************\n End of DOM Event Hooks\n***********************************************************************/\n\n/***********************************************************************\n Functions used by this screen\n***********************************************************************/\n\n/***********************************************************************\n   Function: populconvertStringArrayToIntArrayateProfileDD\n    Purpose: Converts an array of numbers represented as strings to an\n             array of integer numbers.\n************************************************************************/\nfunction convertStringArrayToIntArray(strArr) {\n  var intArray = [];\n  var length = strArr.items.length;\n\n  for (var i = 0; i \u003C length; i++) {\n    var number = parseInt(strArr.items[i], 10);\n    intArray.push(number);\n  }\n\n  return intArray;\n}\n\n/***********************************************************************\n   Function: buildWhereClause\n    Purpose: Will construct a sift.js where clause from the filter \n             criteria supplied as the parameter object.\n************************************************************************/\nfunction buildWhereClause(filterCriteria) {\n  var filters = {};\n  var optionalSessionClause = {};\n  var profileFieldsClause = {};\n\n  /*\n    Are any optional sessions selected, if so base the user list on the selected sessions\n    --\n    We carry out some validation checks on the optionalSessions control to make sure it's\n    populated with data as expected, if not it will gracefully fall back to the Profile \n    Fields.\n  */\n  if (\n    filterCriteria.optionalSessions &&\n    filterCriteria.optionalSessions.length \u003E 0 &&\n    filterCriteria.optionalSessions[0].selectize.items.length \u003E 0\n  ) {\n    var optionalSessions = filterCriteria.optionalSessions[0].selectize;\n\n    if (optionalSessions.items.length \u003E 0) {\n      // this is required to convert the session values that are stored as strings on the page to numbers (which will match what is stored in the data source)\n      var sessionArray = convertStringArrayToIntArray(optionalSessions);\n      optionalSessionClause = { 'Personalized Agenda': { $in: sessionArray } };\n    }\n  }\n\n  if (filterCriteria.profileField && filterCriteria.filterValue) {\n    /*\n    As no optional sessions are selected, base the user list selected filter criteria\n  */\n\n    // Get the selected profile field and the filter value\n    var profileField = filterCriteria.profileField;\n    var filterValue = filterCriteria.filterValue;\n    // Get the filter condition selection\n    var conditionOp = filterCriteria.conditionOp;\n\n    // Only reject this if the search filter uses a condition that requires a search value\n    if (\n      conditionOp !== '' &&\n      !(conditionOp === 'Is empty' || conditionOp === 'Is not empty') &&\n      filterValue.length == 0\n    ) {\n      return Promise.reject('Please enter a search value!');\n    } else {\n      profileFieldsClause = {};\n\n      switch (conditionOp) {\n        case 'Equals':\n          profileFieldsClause[profileField] = { $eq: filterValue };\n          break;\n\n        case 'Not equal':\n          profileFieldsClause[profileField] = { $not: { $eq: filterValue } };\n          break;\n\n        case 'Is one of':\n          // Assumes one or more comma separated values can be entered and exact match on case\n          var values = filterValue.split(',');\n          profileFieldsClause[profileField] = { $in: values };\n          break;\n\n        case 'Is not one of':\n          // Assumes one or more comma separated values can be entered and exact match on case\n          var values = filterValue.split(',');\n          profileFieldsClause[profileField] = { $nin: values };\n          break;\n\n        case 'Text contains':\n          profileFieldsClause[profileField] = { $iLike: filterValue };\n          break;\n\n        case 'Text does not contain':\n          profileFieldsClause[profileField] = { $not: { $iLike: filterValue } };\n          break;\n\n        case 'Is empty':\n          profileFieldsClause[profileField] = { $in: ['', null] };\n          break;\n\n        case 'Is not empty':\n          profileFieldsClause[profileField] = { $nin: ['', null] };\n          break;\n\n        default:\n          // Ideally this should never get executed, however if someone adds a new condition or amends an existing\n          // condition value and it doesn't match with the above, this will at least give you a heads up.\n          if (DEBUG) {\n            console.warn('Unable to determine Condition operator to use in User Profile filter');\n          }\n          break;\n      }\n    }\n  }\n\n  if (optionalSessionClause && profileFieldsClause) {\n    filters = {\n      optionalSession: optionalSessionClause,\n      profileField: profileFieldsClause\n    };\n  }\n\n  if (optionalSessionClause && !profileFieldsClause) {\n    filters = {\n      optionalSession: optionalSessionClause,\n      profileField: null\n    };\n  }\n\n  if (!optionalSessionClause && profileFieldsClause) {\n    filters = {\n      optionalSession: null,\n      profileField: profileFieldsClause\n    };\n  }\n\n  if (DEBUG) {\n    console.log('Filters: ', filters);\n  }\n\n  return filters;\n}\n\n/***********************************************************************\n   Function: populateOptionalSessionDD\n    Purpose: Pulls all of the sessions from the Event Agenda data source \n             where the Optional column is set to 'Yes' and adds each \n             session into the dropdown list using the display values, \n             Title, Location and Start Time with session ID being used as\n             the ID value.\n************************************************************************/\nfunction populateOptionalSessionDD() {\n  Fliplet.DataSources.connectByName(DS.agenda, {\n    attributes: ['Title', 'Location', 'Start Time']\n  }).then(function(connection) {\n    connection\n      .find({\n        where: {\n          Optional: 'Yes'\n        }\n      })\n      .then(function(records) {\n        Fliplet.FormBuilder.get().then(function(form) {\n          var options = _.map(records, item =\u003E ({\n            id: item.id,\n            value: item.id,\n            label: `${item.data.Title} - ${item.data.Location} - ${item.data['Start Time']}`\n          }));\n          form.field('Optional Session').options(options);\n        });\n      });\n  });\n}\n\n/***********************************************************************\n Function: populateProfileDD\n  Purpose: Pulls all of the column names from the User Profile DS,\n            removing the system columns and/or other columns that should\n            not be shown and then assigns the result to the Profile Field\n            dropdown control.\n***********************************************************************/\nfunction populateProfileDD() {\n  Fliplet.DataSources.getById(userDB, {\n    attributes: ['columns']\n  }).then(function(dataSource) {\n    // Lodash call to remove the Fliplet System fields\n    var profileFields = _.without(dataSource.columns, ...DSColumnsToExclude);\n\n    // Lodash call to remove any App ID field that starts with 'APP:'.  Dealing with this seperately as\n    // additional applications may be added/removed as required and this requires no code update to deal\n    // new apps being added or old apps being removed.\n    profileFields = _.remove(profileFields, function(cn) {\n      return !cn.startsWith('APP:');\n    });\n\n    // Sort the list of column names by lowercase to ensure proper order, irrespective of case.\n    profileFields = _.sortBy(profileFields, [column =\u003E column.toLowerCase()]);\n\n    return Fliplet.FormBuilder.get().then(function(form) {\n      form.field('Profile Field').options(profileFields);\n    });\n  });\n}\n\n/***********************************************************************\n   Function: generateRandomPassword\n    Purpose: Generates a random 8 character password\n************************************************************************/\nfunction generateRandomPassword() {\n  return Math.random()\n    .toString(36)\n    .substr(2, 8);\n}\n\n/***********************************************************************\n   Function: generateHtml\n    Purpose: takes an array of entries and user data and carries out a\n             bulk replacement of handlebar references with user data \n       \n       Note: If no match is found for the handlebar reference it will \n             remain in the returned object.\n************************************************************************/\nfunction generateHtml(data, fieldName, userData) {\n  return data[fieldName]\n    .replace('{{Password}}', password) // a password value is randomly generated each time this script runs\n    .replace('{{Email}}', userData['Email'])\n    .replace('{{First name}}', userData['First Name'])\n    .replace('{{Last name}}', userData['Last Name']);\n}\n\n/***********************************************************************\n   Function: sendTargetedData\n    Purpose: Sends an email and/or push notification to a targetted list\n             of users.\n             The target list of users is determined by either;\n\n             a) One of more optional sessions that have been selected or\n             b) A User Profile field, condition and value have been \n                entered which is used to identify users \n\n             Once the target list of users has been created, an email \n             and/or push notification will be sent out using the \n             email/notification content entered into the form. \n************************************************************************/\nfunction sendTargetedData(data) {\n  var users;\n\n  if (DEBUG) {\n    console.log('DEBUG -\u003E data', data);\n  }\n\n  return Fliplet.FormBuilder.get()\n    .then(function(form) {\n      // Build a simple object containing the parameters required to identify the users.\n      var filterCriteria = {\n        optionalSessions: $('#select-to').selectize(),\n        profileField: form.field('Profile Field').get(),\n        filterValue: form.field('Value').get(),\n        conditionOp: form.field('Condition').get()\n      };\n\n      // Create an empty where clause object which will be populated while processing the condition type\n      return buildWhereClause(filterCriteria);\n    })\n    .then(function(filters) {\n      var optionalSessionUsers;\n      var profileFieldsUsers;\n\n      return Fliplet.DataSources.connectByName(userDB)\n        .then(function(connection) {\n          var filter = { where: {} };\n          if (JSON.stringify(filters['profileField']) !== '{}') {\n            filter['where'] = filters['profileField'];\n            console.log('Filtering profile fields using: ', filter);\n          }\n          if (filters['optionalSession'].hasOwnProperty('Personalized Agenda')) {\n            filter.where['Personalized Agenda'] = filters['optionalSession']['Personalized Agenda'];\n          }\n          return connection.find(filter);\n        })\n        .then(function(users) {\n          if (users.length == 0) {\n            return Promise.reject('No records found matching criteria!');\n          } else {\n            return _.map(users, 'data');\n          }\n        })\n        .then(function(users) {\n          console.log('Users: ', users);\n          return send(users, data).then(() =\u003E {\n            return Promise.resolve();\n          });\n        });\n    })\n    .catch(function(err) {\n      Fliplet.UI.Actions({\n        title: err,\n        labels: [\n          {\n            label: 'Ok'\n          }\n        ],\n        cancel: false\n      });\n\n      // Cancels the default form submission in the event of an error.\n      return Promise.reject();\n    });\n}\n\n/***********************************************************************\n   Function: authUsers\n    Purpose: Identify authorised users based on a matching value stored \n              in User Profile referred to as 'filterColumn'.\n              'filterColumn' is a global variable which is currently set\n              to \"Expertize\".\n\n              The return object is an array of users which match column\n              value.\n************************************************************************/\nfunction authUsers(usersArr, formData) {\n  //console.log(usersArr);\n  console.log(formData);\n  var recipients = [];\n  usersArr.forEach(function(user) {\n    let valid = true;\n    if (\n      formData[filterColumn] &&\n      formData[filterColumn].length &&\n      formData[filterColumn] !== user[filterColumn]\n    ) {\n      valid = false;\n    }\n    if (valid) {\n      recipients.push(user);\n    }\n  });\n  return recipients;\n}\n\n/***********************************************************************\n   Function: generateEntry\n    Purpose: Generates the template HTML code for an email incorporating\n              the formData provided\n************************************************************************/\nfunction generateEntry(content, email, messageBody, formData, pushId) {\n  var recordEntry = {\n    Timestamp: moment().format('YYYY-MM-DD hh:mm')\n  };\n  //set up entry for eamil\n  recordEntry['Communication name'] = formData['Communication name'];\n  recordEntry['Communication type'] = formData['Communication type'];\n  recordEntry['emailTo'] = email;\n  if (formData['Communication type'].includes('Email')) {\n    recordEntry['Email subject'] = formData['Email subject'];\n    recordEntry['Email content'] = content;\n  }\n  //set up entry for Push\n  if (formData['Communication type'].includes('Push')) {\n    recordEntry['Message content'] = messageBody;\n    recordEntry['Message title'] = formData['Message title'];\n    recordEntry['App ID'] = Fliplet.Env.get('appId');\n    // recordEntry.flPushSubscriptionId = pushId;\n    recordEntry.userDsId = userDsId;\n    recordEntry['pushTo'] = email;\n  }\n  return recordEntry;\n}\n\n/***********************************************************************\n   Function: send\n    Purpose: Sends an email and/or push notification to a targetted list\n             of users.\n************************************************************************/\nfunction send(users, data) {\n  //const users = authUsers(userData, data);\n  console.log('users', users);\n  var entries = [];\n\n  users.forEach(function(user) {\n    let html;\n    let messageBody;\n\n    if (data['Communication type'].includes('Email')) {\n      html = generateHtml(data, 'Email content', user);\n    }\n\n    if (data['Communication type'].includes('Push')) {\n      messageBody = generateHtml(data, 'Message content', user);\n    }\n\n    entries.push(generateEntry(html, user['Email'], messageBody, data, user.flPushSubscriptionId));\n  });\n  /*entries = entries.map(el =\u003E {\n    if (!el.flPushSubscriptionId) {\n      delete el.pushTo;\n      delete el.flPushSubscriptionId;\n      delete el['Message title'];\n      delete el['Message content'];\n    }\n    return el;\n  });*/\n  // entries = entries.filter(el =\u003E el['Email content'] || el.flPushSubscriptionId);\n  console.log('entries', entries);\n  if (!entries.length) {\n    return Fliplet.UI.Toast('No matching users found.');\n  }\n  var options = {\n    title: 'Send communication message',\n    message: 'Are you sure you want to send it? Total number of recipients: ' + entries.length,\n    labels: ['OK', 'Cancel']\n  };\n  return Fliplet.Navigate.confirm(options).then(function(result) {\n    if (result) {\n      data['Status'] = 'Sent';\n      toInsert = [];\n      // user pressed yes\n      var notifications = [];\n      var emails = [];\n      var smses = [];\n      entries.forEach(el =\u003E {\n        var types = [];\n        if (el['Message title'] && el['Message content']) {\n          types.push('Push');\n        }\n        if (el['Email content'] && el['Email subject']) {\n          types.push('Email');\n        }\n        toInsert.push({\n          Timestamp: el.Timestamp,\n          Email: el.emailTo,\n          Type: types\n        });\n        if (el['Message title'] && el['Message content'] && el.emailTo) {\n          notifications.push({\n            type: 'push',\n            status: 'published',\n            data: {\n              title: el['Message title'],\n              message: el['Message content']\n            },\n            pushNotification: {\n              payload: {\n                title: el['Message title'],\n                body: el['Message content']\n              }\n            },\n            scope: {\n              Email: el.emailTo\n            }\n          });\n        }\n        if (el.emailTo && el['Email content'] && el['Email subject']) {\n          emails.push({\n            options: {\n              to: [{ email: el.emailTo, name: '', type: 'to' }],\n              html: el['Email content'],\n              subject: el['Email subject'],\n              from_name: ''\n            }\n          });\n        }\n        if (el.PhoneNumber && el.SMSBody) {\n          smses.push({\n            data: {\n              to: el.PhoneNumber,\n              body: el.SMSBody\n            }\n          });\n        }\n      });\n      if (notifications.length) {\n        instance.batchInsert(notifications);\n      }\n      if (emails.length) {\n        Fliplet.Communicate.batchSendEmail(emails);\n      }\n      if (smses.length) {\n        Fliplet.Communicate.batchSendSMS(smses);\n      }\n      return Fliplet.DataSources.connectByName(logsDB).then(function(connection) {\n        if (entries.length) {\n          //take a snapshot of recipients\n          console.log(`Adding ${toInsert.length} entries to 'Sent Communications' data source`);\n          return connection.append(toInsert).then(function onComplete() {\n            //reset entries array\n\n            // This was the original line of code, but I think it should be referring\n            // to entries.\n            //entry = [];\n\n            // Clears all array items\n            entries.length = 0;\n          });\n        }\n      });\n    } else {\n      console.log(`User cancelled out of sending notifications to [${entries.length}] recipients!`);\n\n      // Clears all array items\n      entries.length = 0;\n    }\n  });\n}\n\n/***********************************************************************\n   Function: populateFilter\n    Purpose: Populates a Fliplet control with a options list of values.\n             Used primarily for dropdown controls, radio button and \n             checkbox groups.\n       Note: Includes a sort by ascending order by default.\n************************************************************************/\nfunction populateFilter(options) {\n  Fliplet.FormBuilder.get().then(function(form) {\n    // Validate that the field required exists on the form\n    let field = _.filter(form.fields.get(), { name: filterColumn });\n\n    if (field && field.length \u003E 0) {\n      form.field(filterColumn).options(options.sort());\n    } else {\n      console.warn(`Field [${filterColumn}] was not found on the form!`);\n    }\n  });\n}\n\n/***********************************************************************\n   Function: sendTest\n    Purpose: Sends an email and/or push notification to the currently\n             logged on user.\n\n       Note: Used for testing only\n************************************************************************/\nfunction sendTest(users = [], data) {\n  if (!userEmail) {\n    var options = {\n      title: 'User is not logged in.',\n      message: loginErrorMessage\n    };\n    return Fliplet.Navigate.popup(options);\n  }\n\n  // Check users object and populate it with authorized logged on user if empty\n  if (!users || users.length == 0) {\n    users = authUsers([loggedUser], data);\n\n    console.log('users', users);\n    if (!users || !users.length) {\n      return Fliplet.UI.Toast('No matching users found.');\n    }\n  }\n  var notifications = [];\n  var emails = [];\n\n  //send a test email for logged in user\n  if (data['Communication type'].includes('Email')) {\n    var html = generateHtml(data, 'Email content', loggedUser);\n    emails.push({\n      options: {\n        to: [{ email: loggedUser['Email'], type: 'to' }],\n        html: html,\n        subject: data['Email subject'],\n        from_name: ''\n      }\n    });\n    if (emails.length) {\n      Fliplet.Communicate.batchSendEmail(emails);\n    }\n  }\n  if (\n    data['Communication type'].includes('Push')\n  ) {\n    notifications.push({\n      type: 'push',\n      status: 'published',\n      data: {\n        title: data['Message title'],\n        message: data['Message content']\n      },\n      pushNotification: {\n        payload: {\n          title: data['Message title'],\n          body: data['Message content']\n        }\n      },\n      scope: {\n        Email: loggedUser['Email']\n      }\n    });\n\n    if (notifications.length) {\n      instance.batchInsert(notifications);\n    }\n  }\n}\n",
        "customCSS": "[data-field=\"Status\"],[data-field=\"Last edited\"]{display:none}.pushStatus{display:none;padding-bottom:10px}[data-field=\"Form buttons-3\"] button{background-color:#fc0 !important}.btn.btn-secondary{padding:10px 16px 10px 16px}@media only screen and (min-width: 600px){[_type=\"flButtons\"]{width:auto;display:inline-table;margin:10px;text-align:center}}\n",
        "customSCSS": "[data-field=\"Status\"],[data-field=\"Last edited\"] {\n  display:none;\n}\n.pushStatus {\n  display:none;\n  padding-bottom:10px;\n}\n[data-field=\"Form buttons-3\"] button{\n  background-color: #FFCC00!important;\n}\n.btn.btn-secondary{\n  padding: 10px 16px 10px 16px;\n}\n@media only screen and (min-width: 600px) {\n  [_type=\"flButtons\"] {\n    width: auto;\n    display: inline-table;\n    margin: 10px;\n    text-align: center;\n  }\n}\n",
        "isBlockedScreen": true,
        "widgetInstancesInUse": [30951744, 30951745, 30951746, 30951747]
      },
      "updatedAt": "2025-07-02T16:49:44.505Z",
      "slug": "admin-manage-communications-1l7m1"
    },
    {
      "id": 1744603,
      "isLayout": false,
      "layout": "{{{widget 30951942}}}",
      "dependencies": [
        "handlebars",
        "fliplet-datasources",
        "moment",
        "lodash",
        "animate-css",
        "fliplet-like:0.1",
        "mixitup"
      ],
      "appId": 389751,
      "layoutId": 64361,
      "layoutOrder": 52,
      "order": 52,
      "sectionId": null,
      "title": "Admin - User Feedback",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen can be edited as a standard list component. It allows admins to manage user feedback by linking to screens that display session feedback, session questions, and overall event feedback.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can utilize this editable list to organize and access various types of user feedback efficiently, facilitating better analysis and response to user input.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951941, 30951942, 30951943]
      },
      "updatedAt": "2025-07-02T16:49:38.839Z",
      "slug": "admin-user-feedback-1l7mr"
    },
    {
      "id": 1744605,
      "isLayout": false,
      "layout": "{{{widget 30951948}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 53,
      "order": 53,
      "sectionId": null,
      "title": "Admin - Session Survey Results",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is custom and cannot be edited. It displays each score a user gave to each event session, providing a detailed overview of user feedback on session performance.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can use this screen to analyze the survey results, helping to assess the effectiveness of each session and identify areas for improvement based on user ratings.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951947, 30951948, 30951949, 30951950]
      },
      "updatedAt": "2025-07-02T16:49:41.272Z",
      "slug": "admin-session-survey-results-1l7mt"
    },
    {
      "id": 1744569,
      "isLayout": false,
      "layout": "{{{widget 30951705}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 54,
      "order": 54,
      "sectionId": null,
      "title": "Admin - Session Questions",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is custom and cannot be edited. It displays any questions users have asked during a session, providing insights into user inquiries and engagement.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can review the questions submitted by users, which can help in understanding user interests and improving future sessions based on feedback.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951705, 30951706, 30951707, 30951708]
      },
      "updatedAt": "2025-07-02T16:49:34.804Z",
      "slug": "admin-session-questions-1l7lp"
    },
    {
      "id": 1744598,
      "isLayout": false,
      "layout": "{{{widget 30951924}}}",
      "dependencies": [
        "bootstrap-css"
      ],
      "appId": 389751,
      "layoutId": 124,
      "layoutOrder": 55,
      "order": 55,
      "sectionId": null,
      "title": "Admin - Event Feedback Results",
      "settings": {
        "notes": {
          "edit": "\u003Cp\u003EThis screen is custom and cannot be edited. It displays the scores of the overall event feedback, providing a summary of user ratings and evaluations for the event.\u003C/p\u003E",
          "preview": "\u003Cp\u003EAdmins can use this screen to assess the overall success of the event based on participant feedback, helping to identify strengths and areas for improvement.\u003C/p\u003E"
        },
        "customJS": "",
        "customCSS": "",
        "customSCSS": "",
        "widgetInstancesInUse": [30951924, 30951925, 30951926, 30951927]
      },
      "updatedAt": "2025-07-02T16:49:38.211Z",
      "slug": "admin-event-feedback-results-1l7mm"
    },
    {
      "id": 1744588,
      "isLayout": false,
      "layout": "\u003Cdiv class=\"step-container active\" data-step=\"0\"\u003E\n  {{{widget 30951804}}}\n\u003C/div\u003E\n\n\u003Cdiv class=\"step-container hidden\" data-step=\"1\"\u003E\n  {{{widget 30951844}}}{{{widget 30951803}}}\n\u003C/div\u003E\n\u003Cdiv class=\"step-container hidden\" data-step=\"2\"\u003E\n  {{{widget 30951838}}}{{{widget 30951851}}}\n\u003C/div\u003E\n\n\u003Cdiv class=\"step-container hidden\" data-step=\"3\"\u003E\n  {{{widget 30951865}}}{{{widget 30951813}}}\n\u003C/div\u003E\n\u003C!--\n\u003Cdiv class=\"step-container hidden\" data-step=\"4\"\u003E\u003Cfl-container cid=\"29151745\"\u003E\u003Cfl-text cid=\"29151744\"\u003E\n      \u003Ch1\u003ESetup Complete!\u003C/h1\u003E\n      \u003Cp\u003E\n        The app setup is now complete. This screen will now be hidden so you can preview your full app. You can make additional adjustments by changing to Edit mode.\n      \u003C/p\u003E\n    \u003C/fl-text\u003E\n    \u003Cfl-button cid=\"29166570\" class=\"next-btn\" data-next=\"finish\"\u003E\u003C/fl-button\u003E\u003C/fl-container\u003E\u003C/div\u003E\n--\u003E",
      "dependencies": [
        "bootstrap-css",
        {
          "url": "https://cdn.fliplet.com/apps/175086/dependencies/selectizebootstrap4-cdd54da496413e21f7e91df5dc085ee2.css",
          "name": "selectize.bootstrap4",
          "path": "apps/175086/dependencies/selectizebootstrap4-cdd54da496413e21f7e91df5dc085ee2.css",
          "latest": "https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/css/selectize.bootstrap4.css",
          "updatedAt": 1699268029
        },
        {
          "url": "https://cdn.fliplet.com/apps/175086/dependencies/spectrummin-71af3f7385c4304695b8f9e08bad5ab6.js",
          "name": "spectrum.min",
          "path": "apps/175086/dependencies/spectrummin-71af3f7385c4304695b8f9e08bad5ab6.js",
          "latest": "https://cdn.jsdelivr.net/npm/spectrum-colorpicker2/dist/spectrum.min.js",
          "updatedAt": 1699268029
        }
      ],
      "appId": 389751,
      "layoutId": 1202989,
      "layoutOrder": 56,
      "order": 56,
      "sectionId": null,
      "title": "App Setup",
      "settings": {
        "notes": {
          "edit": "\u003Ch4\u003EDo not edit this screen.\u003C/h4\u003E\n\u003Cp\u003EIt is highly recommend to&nbsp;\u003Cstrong\u003Euse this screen in Preview mode\u003C/strong\u003E&nbsp;as it will help you setup this app, then move itself to the bottom of the screen list. If you don't want to use this screen delete it or drag and drop it down in the screen list.\u003Cbr\u003E\u003Cbr\u003EIf you want to run this screen again go to the 'App Setup' data source and reset the 'Setup Phase' to 0.\u003C/p\u003E",
          "preview": "\u003Cp\u003EThis screen helps you set up your app for the first time. It will generate sample data for the agenda based on the details you enter. After use it will move so the Onboarding screen becomes the first screen in the app.\u003C/p\u003E"
        },
        "private": {
          "tags": [
            "Basic screens",
            "Popular",
            "No code"
          ],
          "queries": [
            "Empty",
            "blank"
          ],
          "category": "Basic screens",
          "description": "An empty screen for you to add your components to."
        },
        "customJS": "/*AI generating content based on 1st screen input\nCreate a series of example agenda sessions for a [Event Type] called [Event Name]. The event starts [Event Dates][0] at [Event Time][0] and ends [Event Dates][1] at [Event Time][1]. The sessions should have the following  values: Title, Content (HTML text including \u003Cp\u003E tags), Date, Start Time, End Time, Location. Output into JSON with those exact titles.\n*/\n\nFliplet.Studio.emit('toggle-app-security', false);\nFliplet.Studio.emit('toggle-preview-sidebar', true);\nFliplet.Studio.emit('set-device-category', 'web');\nFliplet.Studio.emit('set-device-zoom', 100);\n\n// product endpoints\nvar dsSetupName = 'Event Setup';\nvar dsSetupId = null;\nvar appId = Fliplet.Env.get('appId');\nvar dsToInsertData = 'Event - Agenda';\nvar formData = {};\n\nvar highlightColors = [\n  'highlightColor',\n  'headingFourColor',\n  'headingSixColor',\n  'headingFiveColor',\n  'headingThreeColor',\n  'headingTwoColor',\n  'headingOneColor',\n  'menuBottomBarBackgroundColor',\n  'primaryButtonColor',\n  'secondaryButtonTextColor',\n  'secondaryButtonBorderColor',\n  'secondaryButtonHoverTextColor',\n  'secondaryButtonHoverBorderColor',\n  'linkColor',\n  'titleColor',\n  'listSmallTitleColor',\n  'listLargeTitleColor',\n  'loginButtonColor',\n  'onboardingPaginationChevronsColor',\n  'onboardingPaginationBulletColorActive',\n  'rssTitleColor',\n  'lfdFontColor',\n  'newsFeedTitleFontColor',\n  'agendaTitleFontColor',\n  'smallHCardTitleFontColor',\n  'simpleListTitleFontColor',\n  'smallCardDetailTitleFontColor',\n  'newsFeedDetailTitleFontColor',\n  'agendaDetailTitleFontColor',\n  'smallHCardDetailTitleFontColor',\n  //'lfdOverlayBackgroundColor',\n  //'newsFeedFiltersOverlayBackground',\n  //'agendaListDetailOverlayBackground',\n  //'simpleListFiltersOverlayBackground',\n  'smallCardAddButtonBackground',\n  'newsFeedAddButtonBackground',\n  'agendaAddButtonBackground',\n  'simpleListAddButtonBackground',\n  'lfdAgendaTopTextActiveColor',\n  'markerLabelBackground',\n  'mapLabelBackground',\n  'controlsBackground',\n  'mapSearchOverlayText',\n  'formInputBorderFocusColor',\n  'formToggleActiveBackgroundColor',\n  'formSelectArrowBackground',\n  'formStarRating',\n  'newsFeedFilterIconActiveColor',\n  'newsFeedBookmarkIconActiveColor',\n  'newsFeedLikeIconActiveColor',\n  'agendaItemTimeFontColor',\n  'agendaFilterIconActiveColor',\n  'agendaBookmarkIconActiveColor',\n  'smallCardFilterIconActiveColor',\n  'smallCardBookmarkIConActiveColor'\n];\nvar secondaryColors = [\n  'secondaryColor',\n  'menuBottomBarActiveFontColor',\n  'listSeparatorColor',\n  'listChevronColor',\n  'listSmallIconColor',\n  'listSmallChevronColor',\n  'listSmallSeparatorColor',\n  'listLargeSeparatorColor',\n  'listLargeChevronColor',\n  'listLargeIconColor',\n  'rssSeparatorColor',\n  'rssChevronColor',\n  'smallCardListDetailOverlayLineUnderTitleColor',\n  'newsFeedListDetailOverlayLineUnderTitleColor',\n  'agendaListDetailOverlayLineUnderTitleColor',\n  'smallHCardListDetailOverlayLineUnderTitleColor',\n  'smallCardListDetailOverlayIconsColor',\n  'agendaListDetailOverlayIconsColor',\n  'smallHCardListDetailOverlayIconsColor',\n  'simpleListDetailOverlayIconsColor',\n  'smallCardFilterIconColor',\n  'newsFeedFilterIconColor',\n  'agendaFilterIconColor',\n  'simpleListFilterIconColor',\n  'smallCardSearchIconColor',\n  'newsFeedSearchIconColor',\n  'agendaSearchIconColor',\n  'simpleListSearchIconColor',\n  'smallCardSearchFieldBorderColor',\n  'newsFeedSearchFieldBorderColor',\n  'agendaSearchFieldBorderColor',\n  'simpleListSearchFieldBorderColor',\n  'smallCardBookmarkIconColor',\n  'newsFeedBookmarkIconColor',\n  'agendaBookmarkIconColor',\n  'simpleListBookmarkIconColor',\n  'smallCardSortIconColor',\n  'newsFeedSortIconColor',\n  'simpleListSortIconColor',\n  'newsFeedLikeIconColor',\n  'simpleListLikeIconColor',\n  'formTypeaheadBackgroundColor'\n];\nvar paragraphTextColors = [\n  'quickTextColor',\n  'newsFeedDetailTextFontColor',\n  'descriptionColor',\n  'newsFeedDescriptionFontColor',\n  'listSmallDescriptionColor',\n  'listLargeDescriptionColor',\n  'onboardingTextColor',\n  'rssDescriptionColor',\n  'smallCardDescriptionFontColor',\n  'newsFeedDescriptionFontColor',\n  'agendaDescriptionFontColor',\n  'simpleListDescriptionFontColor',\n  'smallCardSecondDescriptionFontColor',\n  'newsFeedSecondDescriptionFontColor',\n  'simpleListSecondDescriptionFontColor',\n  'smallCardDetailDescriptionFontColor',\n  'newsFeedDetailDescriptionFontColor',\n  'agendaDetailDescriptionFontColor',\n  'smallHCardDetailDescriptionFontColor',\n  'smallCardDetailSecondDescriptionFontColor',\n  'agendaDetailSecondDescriptionFontColor',\n  'smallHCardDetailSecondDescriptionFontColor',\n  'lfdDetailFontColor',\n  'newsFeedDetailSecondDescriptionFontColor',\n  'agendaDetailTextFontColor',\n  'smallHCardDetailTextFontColor',\n  'simpleListDetailTextFontColor',\n  'lfdOverlayFontColor',\n  'newsFeedOverlayFontColor',\n  'agendaOverlayFontColor',\n  'simpleListOverlayFontColor',\n  'lfdCommentsFontColor',\n  'simpleListCommentsFontColor',\n  'lfdAgendaTopTextColor',\n  'lfdAgendaDatesFontColor',\n  'formLabelColor',\n  'formRequiredColor'\n];\n\nfunction initStep() {\n  Fliplet.DataSources.connectByName('Event Setup')\n  .then(function(connection) {\n    return connection.findOne();\n  })\n  .then(record =\u003E {\n    dsSetupId = record.dataSourceId;\n\n    if (record.data['Skipped'] === 'true') {\n      Fliplet.Navigate.screen('Onboarding', { query: '?enableSecurity=true' });\n    }\n\n    var currentStep = record.data['Setup Phase'];\n\n    showStepContainer(currentStep);\n\n    if (!Fliplet.Env.get('interact')) {\n      attachEventListeners();\n    }\n  });\n}\n\nfunction finishSetup() {\n  Fliplet.Studio.emit('track-event', {\n    category: 'app_setup',\n    action: 'complete',\n    template: 'Event'\n  });\n\n  return setAppearance()\n    .then(function() {\n      Fliplet.Studio.emit('track-event', {\n        category: 'app_solution_setup',\n        action: 'appearance_set'\n      });\n\n      if (!Fliplet.Env.get('appTemplate')) {\n        return Fliplet.Pages.get()\n          .then(function(appPages) {\n            var appSetupPage = appPages.find(el =\u003E el.title == 'App Setup');\n            var onboardingPage = appPages.find(el =\u003E el.title == 'Onboarding');\n    \n            appPages = appPages.filter(el =\u003E el.title != 'App Setup' && el.title != 'Onboarding');\n    \n            var pageOrder = [onboardingPage, ...appPages, appSetupPage];\n            var pages = {};\n    \n            pageOrder.forEach((el, index) =\u003E {\n              pages[el.id] = index;\n            });\n    \n            return Fliplet.Pages.sort(pages);\n          })\n          .then(function() {\n            Fliplet.Navigate.screen('Onboarding', { query: '?enableSecurity=true' });\n          });\n      } else {\n        Fliplet.Navigate.screen('Onboarding', { query: '?enableSecurity=true' });\n      }\n    });\n}\n\nasync function getAiContent(form) {\n  const eventInfo = {\n    description: form['Event Description'],\n    type: form['Event Type'],\n    name: form['Event Title'],\n    start: `${form['Event Dates [Start]']} at ${form['Event Time [Start]']}`,\n    end: `${form['Event Dates [End]']} at ${form['Event Time [End]']}`\n  };\n\n  const content = `You will create a JSON object with multiple example sessions for an event mobile app based on the provided information. Follow these instructions:\n    1. Match the example output JSON format when providing your response\n    2. Only return valid JSON. Do not provide any text or explanation, only output valid JSON\n    3. You must provide at least 5 example sessions in your output based on the event information I provide. You may provide more if it is relevant based on te event type (eg a multi day conference could have 20-30 sessions)\n    4. Use the Event Information provided when generating example sessions.\n    5. Use the Session Information JSON to understand the Example Output JSON and valid values. Only use values \n\n    \u003Cevent information\u003E\n    Name: ${eventInfo.name}\n    Event type: ${eventInfo.type}\n    Description: ${eventInfo.description}\n    The event starts ${eventInfo.start} and ends ${eventInfo.end}.\n    \u003C/event information\u003E\n\n    \u003Csession information JSON\u003E\n    Title (the name of the session), \n    Content (2 paragraphs of relevant content in HTML. Include tags \u003Cp\u003E and optionally \u003Cstrong\u003E\u003Cul\u003E\u003Col\u003E\u003Cli\u003E), \n    Date (YYYY-MM-DD), \n    Start Time (HH:MM), \n    End Time (HH:MM), \n    Location (must be one of the following: \"Room 101\",\"Room 144\",\"Room 156\",\"Main Hall\",\"Restaurant\",\"Registration Hall\"),\n    Speakers (one or several emails (in a comma-separated list) that must be from this list: speaker@email.com, l.silva@email.com, ksoo-min@email.com, aito@email.com, conyeka@email.com)\n    \u003C/session information\u003E\n\n    \u003Cexample output JSON\u003E\n        {\n            \"Title\": \"Registration\",\n            \"Content\": \"\u003Cp\u003EBe sure to check in at the registration desk to receive your badge and one free drink voucher.\u003C/p\u003E\",\n            \"Date\": \"2024-03-01\",\n            \"Start Time\": \"08:30\",\n            \"End Time\": \"10:00\",\n            \"Location\": \"Registration Hall\"\n        },\n        {\n            \"Title\": \"Keynote Address\",\n            \"Content\": \"\u003Cp\u003EWelcome to our annual conference! We are delighted to have you all here today. Our keynote speaker will take the stage to kick off the event with an inspiring speech about the future of technology and innovation.\u003C/p\u003E\",\n            \"Date\": \"2024-03-01\",\n            \"Start Time\": \"10:00\",\n            \"End Time\": \"11:00\",\n            \"Location\": \"Main Hall\",\n            \"Speakers\": \"speaker@email.com\"\n        },\n        {\n            \"Title\": \"How to code in python\",\n            \"Content\": \"\u003Cp\u003EAn introduction to Python programming language.\u003C/p\u003E\u003Cp\u003EBring your computer with Python installed and ready to go.\u003C/p\u003E\",\n            \"Date\": \"2024-03-01\",\n            \"Start Time\": \"11:30\",\n            \"End Time\": \"12:30\",\n            \"Location\": \"Room 156\",\n            \"Speakers\":\"ksoo-min@email.com, aito@email.com\"\n        }\n    \u003C/example output\u003E\n    `;\n\n  console.log(content);\n\n  try {\n    const result = await Fliplet.AI.createCompletion({\n      model: 'gpt-4-0125-preview', // 'gpt-4-1106-preview', 'gpt-3.5-turbo-1106', 'gpt-3.5-turbo-0125'\n      temperature: 0.5,\n      messages: [{ role: 'user', content: content }],\n      response_format: { type: 'json_object' }\n    });\n\n    const parsedResult = JSON.parse(result.choices[0].message.content).sessions;\n\n    if (!Array.isArray(parsedResult)) {\n      handleAiError();\n\n      return;\n    }\n\n    return Fliplet.DataSources.connectByName(dsToInsertData)\n      .then(async function(connection) {\n        const records = await connection.find();\n\n        await connection.commit({\n          entries: [],\n          delete: records.map(el =\u003E el.id),\n          append: true,\n          extend: true\n        });\n\n        await connection.commit({\n          entries: parsedResult.map(el =\u003E ({ data: el })),\n          append: true,\n          extend: true\n        });;\n      });\n  } catch (error) {\n    handleAiError();;\n  }\n}\n\nfunction updateSetupDs(formData) {\n  var dsConnection = null;\n\n  if (\n    formData.paragraph ||\n    formData.highlight ||\n    formData.secondary\n  ) {\n    return Fliplet.DataSources.connect(dsSetupId)\n      .then(function(connection) {\n        dsConnection = connection;\n\n        return dsConnection.findOne();\n      })\n      .then(function(record) {\n        var data = {\n          'Paragraph Text Color': formData.paragraph,\n          'Highlight Color': formData.highlight,\n          'Secondary Color': formData.secondary\n        };\n\n        return dsConnection.update(record.id, data);\n      });\n  } else {\n    return Promise.resolve('');\n  }\n}\n\nfunction initColorPicker(form) {\n  $('[name=\"Paragraph Text Color\"]').spectrum({\n    type: 'component',\n    cancelText: 'Cancel',\n    clearText: 'Clear',\n    chooseText: 'Select',\n    //preferredFormat: 'hex',\n    showPalette: false/*,\n    change: function(color) {\n      if (color) {\n        $('input[name=\"Paragraph Text Color\"]').val(color.toRgbString());\n        form.field('Paragraph Text Color').set(color.toRgbString());\n      }\n    }*/\n  });\n\n  $('[name=\"Paragraph Text Color\"]').spectrum({\n    type: 'component',\n    cancelText: 'Cancel',\n    clearText: 'Clear',\n    chooseText: 'Select',\n    //preferredFormat: 'hex',\n    showPalette: false/*,\n    change: function(color) {\n      if (color) {\n        $('input[name=\"Paragraph Text Color\"]').val(color.toRgbString());\n        form.field('Paragraph Text Color').set(color.toRgbString());\n      }\n    }*/\n  });\n\n  $('[name=\"Highlight Color\"]').spectrum({\n    type: 'component',\n    cancelText: 'Cancel',\n    clearText: 'Clear',\n    chooseText: 'Select',\n    //preferredFormat: 'hex',\n    showPalette: false/*,\n    change: function(color) {\n      if (color) {\n        $('input[name=\"Highlight Color\"]').val(color.toRgbString());\n        form.field('Highlight Color').set(color.toRgbString());\n      }\n    }*/\n  });\n\n  $('[name=\"Secondary Color\"]').spectrum({\n    type: 'component',\n    cancelText: 'Cancel',\n    clearText: 'Clear',\n    chooseText: 'Select',\n    //preferredFormat: 'hex',\n    showPalette: false/*,\n    change: function(color) {\n      if (color) {\n        $('input[name=\"Secondary Color\"]').val(color.toRgbString());\n        form.field('Secondary Color').set(color.toRgbString());\n      }\n    }*/\n  });\n}\n\nfunction saveAppearanceSettings() {\n  return Fliplet.FormBuilder.get('Branding')\n    .then(function(form) {\n      var paragraph = form.field('Paragraph Text Color').get();\n      var secondary = form.field('Secondary Color').get();\n      var highlight = form.field('Highlight Color').get();\n\n      formData = {\n        paragraph,\n        secondary,\n        highlight\n      };\n\n      return formData;\n    });\n}\n\nfunction setAppearance() {\n  var sourceValues = {};\n  var targetID = null;\n\n  Fliplet.UI.Toast({\n    message: 'Branding your app... This may take up to 2 minutes.',\n    position: 'center',\n    backdrop: true,\n    tapToDismiss: false,\n    duration: false\n  });\n\n  return Fliplet.API.request({\n    url:\n      'v1/widgets/?include_instances=true&appId=' +\n      Fliplet.Env.get('appId') +\n      '&tags=type:theme&package=com.fliplet.theme.default&organizationId=' +\n      Fliplet.Env.get('organizationId'),\n    method: 'GET'\n  }).then(function onSuccess(response) {\n    sourceValues = response.widgets[0].instances[0].settings.values;\n    targetID = response.widgets[0].instances[0].id;\n\n    if (formData.paragraph) {\n      paragraphTextColors.forEach(el =\u003E {\n        sourceValues[el] = formData.paragraph;\n      });\n    }\n\n    sourceValues.secondaryButtonColor = 'rgba(0,0,0,0)';\n    sourceValues.secondaryButtonHoverColor = '#e7e7e7';\n    sourceValues.linkHoverColor = '#474975';\n\n    if (formData.secondary) {\n      secondaryColors.forEach(el =\u003E {\n        sourceValues[el] = formData.secondary;\n      });\n    }\n\n    if (formData.highlight) {\n      highlightColors.forEach(el =\u003E {\n        sourceValues[el] = formData.highlight;\n      });\n    }\n\n    return Fliplet.API.request({\n      url: 'v1/widget-instances/' + targetID,\n      method: 'PUT',\n      data: { values: sourceValues }\n    });\n  })\n  .then(function() {\n    return updateSetupDs(formData);\n  })\n  .then(function() {\n    Fliplet.UI.Toast.dismiss();\n  });\n}\n\nfunction handleAiError() {\n  Fliplet.UI.Toast('An error occurred with AI response, please try again');\n}\n\nfunction showStepContainer(currentStep) {\n  var dsConnection = null;\n\n  $('.step-container').removeClass('active').addClass('hidden');\n  $('.step-container[data-step=\"' + currentStep + '\"]').removeClass('hidden').addClass('active');\n\n  return Fliplet.DataSources.connect(dsSetupId)\n    .then(function(connection) {\n      dsConnection = connection;\n\n      return dsConnection.findOne();\n    })\n    .then(function(record) {\n      var data = {};\n\n      if (!Fliplet.Env.get('appTemplate') && record.data['First time'] === 'Yes') {\n        data['First time'] = 'No';\n      }\n\n      if (currentStep !== 0) {\n        data['Setup Phase'] = currentStep;\n      }\n\n      if (JSON.stringify(data) === '{}') return;\n\n      return dsConnection.update(record.id, data);\n    });\n}\n\nfunction generateAgenda(form, currentStep) {\n  Fliplet.UI.Toast({\n    message: 'Generating your event agenda... This may take up to 2 minutes.',\n    position: 'center',\n    backdrop: true,\n    tapToDismiss: false,\n    duration: false\n  });\n\n  return getAiContent(form)\n    .then(function() {\n      return showStepContainer(currentStep + 1);\n    })\n    .then(function() {\n      Fliplet.UI.Toast.dismiss();\n\n      return Promise.reject('');\n    })\n    .catch(function() {\n      return showStepContainer(currentStep + 1)\n      .then(function() {\n        Fliplet.UI.Toast.dismiss();\n\n        return Promise.reject('');\n      });\n    });\n}\n\nfunction attachEventListeners() {\n  $(document).on('click', '.next-btn', function() {\n    var nextStep = $(this).data('next');\n\n    showStepContainer(nextStep);\n  });\n\n  Fliplet.Hooks.on('beforeFormSubmit', function(form) {\n    var currentStep = parseInt($('.step-container.active').data('step'), 10);\n\n    // If the current step is 1, we are on the event details step of the setup\n    if (currentStep === 1) {\n      return generateAgenda(form, currentStep)\n        .then(function() {\n          Fliplet.Studio.emit('track-event', {\n            category: 'app_solution_setup',\n            action: 'agenda_generated'\n          });\n\n          showStepContainer(currentStep + 1);\n        });\n    }\n\n    if (currentStep === 2) {\n      return saveAppearanceSettings()\n        .then(function() {\n          showStepContainer(currentStep + 1);\n        });\n    }\n\n    form.Admin = 'Yes';\n    return finishSetup();\n  });\n\n  Fliplet.FormBuilder.get('Branding')\n    .then(function(form) {\n      setTimeout(function() {\n        initColorPicker(form);\n      }, 2000);\n    });\n}\n\ninitStep();\n",
        "customCSS": ".mode-interact-ready .hidden{display:block !important}[data-has-notch].no-supports-container body,[data-has-notch].supports-container .fl-page-content-wrapper{padding-bottom:0px !important}.supports-container .fl-page-content-wrapper{padding-bottom:0px !important}[data-fl-widget-instance][data-type=\"menu\"]{display:none}.btn.btn-primary,.btn.btn-primary:hover,.btn.btn-primary:focus,.btn.btn-primary:active:hover,.btn.btn-primary:active:focus{width:auto;height:auto;background-color:#CFCBCB;color:#000;padding:15px 30px 15px 30px;border-radius:10px;font-family:helvetica;font-size:18px;font-weight:normal;line-height:24px;font-style:normal;text-decoration:none;border:none;box-shadow:none}form .btn.btn-primary{margin-top:40px;float:right !important}[data-step=\"3\"] form .btn.btn-primary{margin-left:auto;margin-right:auto;float:none !important;display:block !important}.sp-container{position:absolute;top:0;left:0;display:inline-block;z-index:9999994;overflow:hidden}.sp-original-input-container{position:relative;display:inline-flex}.sp-original-input-container input{margin:0 !important}.sp-original-input-container .sp-add-on{width:40px !important;border-top-right-radius:0 !important;border-bottom-right-radius:0 !important}input.spectrum.with-add-on{border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.sp-original-input-container .sp-add-on .sp-colorize{height:100%;width:100%;border-radius:inherit}.sp-colorize-container{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==);background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12' fill='%23ccc' fill-opacity='1'%3E%3Crect x='0' y='0' width='6' height='6' /%3E%3Crect x='6' y='6' width='6' height='6' /%3E%3C/svg%3E\")}.sp-container.sp-flat{position:relative}.sp-container,.sp-container *{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}.sp-top{position:relative;width:100%;display:inline-block}.sp-top-inner{position:absolute;top:0;left:0;bottom:0;right:0}.sp-color{position:absolute;top:0;left:0;bottom:0;right:20px !important}.sp-hue{position:absolute;top:0;right:0;bottom:0;width:12px;height:100%;left:initial !important}.sp-clear-enabled .sp-hue{top:15%;height:85%}.sp-fill{padding-top:80%}.sp-sat,.sp-val{position:absolute;top:0;left:0;right:0;bottom:0}.sp-alpha-enabled .sp-top{margin-bottom:28px !important}.sp-alpha-enabled .sp-alpha{display:block}.sp-alpha-handle{position:absolute;top:-3px;cursor:pointer;height:16px;border-radius:50%;width:16px;margin-right:5px;left:-2px;right:0;background:#f9f9f9;box-shadow:0 0 2px 0 #3a3a3a}.sp-alpha{display:none;position:absolute;bottom:-18px;right:0;left:0;height:10px}.sp-alpha-inner{border-radius:4px}.sp-clear{display:none}.sp-clear.sp-clear-display{background-position:center}.sp-clear-enabled .sp-clear{display:block;position:absolute;top:3px;right:0;bottom:0;cursor:pointer;left:initial;height:14px;width:14px}.sp-alpha,.sp-alpha-handle,.sp-clear,.sp-container,.sp-container button,.sp-container.sp-dragging .sp-input,.sp-dragger,.sp-preview,.sp-replacer,.sp-slider{-webkit-user-select:none;-moz-user-select:-moz-none;-o-user-select:none;user-select:none}.sp-container.sp-input-disabled .sp-input-container{display:none}.sp-container.sp-buttons-disabled .sp-button-container{display:none}.sp-container.sp-palette-buttons-disabled .sp-palette-button-container{display:none}.sp-palette-only .sp-picker-container{display:none}.sp-palette-disabled .sp-palette-container{display:none}.sp-initial-disabled .sp-initial{display:none}.sp-sat{background-image:-webkit-gradient(linear, 0 0, 100% 0, from(#fff), to(rgba(204,154,129,0)));background-image:-webkit-linear-gradient(left, #fff, rgba(204,154,129,0));background-image:-moz-linear-gradient(left, #fff, rgba(204,154,129,0));background-image:-o-linear-gradient(left, #fff, rgba(204,154,129,0));background-image:-ms-linear-gradient(left, #fff, rgba(204,154,129,0));background-image:linear-gradient(to right, #fff, rgba(204,154,129,0))}.sp-val{border-radius:4px;background-image:-webkit-gradient(linear, 0 100%, 0 0, from(#000), to(rgba(204,154,129,0)));background-image:-webkit-linear-gradient(bottom, #000, rgba(204,154,129,0));background-image:-moz-linear-gradient(bottom, #000, rgba(204,154,129,0));background-image:-o-linear-gradient(bottom, #000, rgba(204,154,129,0));background-image:-ms-linear-gradient(bottom, #000, rgba(204,154,129,0));background-image:linear-gradient(to top, #000, rgba(204,154,129,0))}.sp-hue{background:-moz-linear-gradient(top, red 0, #ff0 17%, lime 33%, cyan 50%, blue 67%, #f0f 83%, red 100%);background:-ms-linear-gradient(top, red 0, #ff0 17%, lime 33%, cyan 50%, blue 67%, #f0f 83%, red 100%);background:-o-linear-gradient(top, red 0, #ff0 17%, lime 33%, cyan 50%, blue 67%, #f0f 83%, red 100%);background:-webkit-gradient(linear, left top, left bottom, from(red), color-stop(0.17, #ff0), color-stop(0.33, lime), color-stop(0.5, cyan), color-stop(0.67, blue), color-stop(0.83, #f0f), to(red));background:-webkit-linear-gradient(top, red 0, #ff0 17%, lime 33%, cyan 50%, blue 67%, #f0f 83%, red 100%);background:linear-gradient(to bottom, red 0, #ff0 17%, lime 33%, cyan 50%, blue 67%, #f0f 83%, red 100%)}.sp-1{height:17%}.sp-2{height:16%}.sp-3{height:17%}.sp-4{height:17%}.sp-5{height:16%}.sp-6{height:17%}.sp-hidden{display:none !important}.sp-cf:after,.sp-cf:before{content:\"\";display:table}.sp-cf:after{clear:both}@media (max-device-width: 480px){.sp-color{right:40%}.sp-hue{left:63%}.sp-fill{padding-top:60%}}.sp-dragger{border-radius:5px;height:10px;width:10px;border:1px solid #fff;cursor:pointer;position:absolute;top:0;left:0;margin-left:3px;margin-top:3px;box-shadow:0 0 2px 1px rgba(0,0,0,0.2)}.sp-slider{position:absolute;top:0;cursor:pointer;height:16px;border-radius:50%;width:16px;left:-2px;background:#f9f9f9;box-shadow:0 0 2px 0 #3a3a3a;margin-top:8px}.sp-container{display:inline-flex;border-radius:0;background-color:#fff;padding:0;border-radius:4px;color:#000;box-shadow:0 0 0 1px rgba(99,114,130,0.16),0 8px 16px rgba(27,39,51,0.08)}.sp-clear,.sp-color,.sp-container,.sp-container button,.sp-container input,.sp-hue{font-size:12px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box}.sp-top{margin-bottom:10px}.sp-clear,.sp-color,.sp-hue,.sp-sat,.sp-val{border-radius:3px}.sp-input-container{margin-top:-5px}.sp-button-container.sp-cf,.sp-initial.sp-thumb.sp-cf,.sp-input-container.sp-cf{height:25px}.sp-picker-container .sp-cf{margin-bottom:10px}.sp-palette-row-initial\u003Espan:first-child{cursor:pointer}.sp-initial-disabled .sp-input-container{width:100%}.sp-input{padding:0 5px !important;margin:0;width:100%;box-shadow:none !important;height:100% !important;background:0 0;color:#3a3a3a;border-radius:2px !important;border:1px solid #e0e0e0 !important;text-align:center;font-family:monospace;font-size:inherit !important}.sp-input:focus{border:1px solid orange}.sp-input.sp-validation-error{border:1px solid red;background:#fdd}.sp-palette-container,.sp-picker-container{position:relative;padding:10px}.sp-picker-container{width:200px;padding-bottom:0}.sp-palette-container{border-right:solid 1px #ccc}.sp-palette-only .sp-palette-container{border:0}.sp-palette .sp-thumb-el{display:block;position:relative;float:left;width:24px;height:15px;margin:3px;cursor:pointer;border:solid 2px transparent}.sp-palette .sp-thumb-el.sp-thumb-active,.sp-palette .sp-thumb-el:hover{border-color:orange}.sp-thumb-el{position:relative}.sp-initial{float:left}.sp-initial span{width:30px;height:25px;border:none;display:block;float:left;margin:0}.sp-initial .spe-thumb-el.sp-thumb-active{border-radius:0 5px 5px 0}.sp-initial .spe-thumb-el{border-radius:5px 0 0 5px}.sp-initial .sp-clear-display{background-position:center}.sp-button-container{float:right}.sp-palette-button-container{margin-top:10px}.sp-replacer{position:relative;overflow:hidden;cursor:pointer;display:inline-block;border-radius:3px;border:1px solid #aaa;color:#666;transition:border-color .3s;vertical-align:middle;width:3rem;height:1.5rem}.sp-replacer.sp-active,.sp-replacer:hover{border:1px solid #666;color:#000}.sp-replacer.sp-disabled{cursor:default;border-color:silver;color:silver}.sp-dd{position:absolute;font-size:10px;right:0;top:0;bottom:0;padding:0 2px;line-height:1.6rem;background-color:#fff}.sp-preview{position:relative;width:100%;height:100%;float:left;z-index:0}.sp-preview-inner{transition:background-color .2s}.sp-preview-inner.sp-clear-display{display:none}.sp-palette .sp-thumb-el{width:16px;height:16px;margin:3px;border:none;border-radius:3px}.sp-container button{border-radius:3px;border:none;background:0 0;line-height:1;padding:0 8px;height:25px;text-transform:capitalize;text-align:center;vertical-align:middle;cursor:pointer;color:#606c72;font-weight:700}.sp-container button.sp-choose{background-color:#3cab3b;color:#fff;margin-left:5px}.sp-container button:hover{opacity:.8}.sp-container button.sp-palette-toggle{width:100%;background-color:#f3f3f3;margin:0}.sp-palette span.sp-thumb-active,.sp-palette span:hover{border-color:#000}.sp-alpha,.sp-preview,.sp-thumb-el{position:relative;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==);background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12' fill='%23ccc' fill-opacity='1'%3E%3Crect x='0' y='0' width='6' height='6' /%3E%3Crect x='6' y='6' width='6' height='6' /%3E%3C/svg%3E\")}.sp-alpha-inner,.sp-preview-inner,.sp-thumb-inner{display:block;position:absolute;top:0;left:0;bottom:0;right:0}.sp-palette .sp-thumb-inner{border-radius:3px;background-position:50% 50%;background-repeat:no-repeat}.sp-palette .sp-thumb-light.sp-thumb-active .sp-thumb-inner{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIVJREFUeNpiYBhsgJFMffxAXABlN5JruT4Q3wfi/0DsT64h8UD8HmpIPCWG/KemIfOJCUB+Aoacx6EGBZyHBqI+WsDCwuQ9mhxeg2A210Ntfo8klk9sOMijaURm7yc1UP2RNCMbKE9ODK1HM6iegYLkfx8pligC9lCD7KmRof0ZhjQACDAAceovrtpVBRkAAAAASUVORK5CYII=);background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='18' height='18'%3E%3Cpath d='M9 16.172l10.594-10.594 1.406 1.406-12 12-5.578-5.578 1.406-1.406z' fill='%23000'%3E%3C/path%3E%3C/svg%3E\")}.sp-palette .sp-thumb-dark.sp-thumb-active .sp-thumb-inner{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAMdJREFUOE+tkgsNwzAMRMugEAahEAahEAZhEAqlEAZhEAohEAYh81X2dIm8fKpEspLGvudPOsUYpxE2BIJCroJmEW9qJ+MKaBFhEMNabSy9oIcIPwrB+afvAUFoK4H0tMaQ3XtlrggDhOVVMuT4E5MMG0FBbCEYzjYT7OxLEvIHQLY2zWwQ3D+9luyOQTfKDiFD3iUIfPk8VqrKjgAiSfGFPecrg6HN6m/iBcwiDAo7WiBeawa+Kwh7tZoSCGLMqwlSAzVDhoK+6vH4G0P5wdkAAAAASUVORK5CYII=);background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='18' height='18'%3E%3Cpath d='M9 16.172l10.594-10.594 1.406 1.406-12 12-5.578-5.578 1.406-1.406z' fill='%23fff'%3E%3C/path%3E%3C/svg%3E\")}.sp-clear-display{background-repeat:no-repeat;background-position:center;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAABe0lEQVQokYXSsUtcQRTF4d8Jj+VhHSxkEQuLsEUKK0nhTBFTmLSSUhBCMCAWsmgIwWrBLk0akfwLCaSQKBJmtrIIISwpRFKIhViETScphGMzysMtvOVwvpm5d0bGNCuGWAOPgYdl6S8wSDn9b+bUhDHEKWAdeAFMANg+l/TV9ofcz6cjMIbYBvaBMds7QCqZ58CmpBNgPuV0DvAAIMyFGugWtJr7eTv38xEwkPRPErY7QDeG2LqFkjrAgu0dSd/KDVqSNmxvAZ8lfbS9AHRuYemnLWkv5XRVBrQMbAI/gTXgEzAJtJuwBVS2L2OIle03QA/4Lmkl5XQBXEqqbFcAVYFDYChpFngiqWf7l6TXKaezMt2Zkhk24THwG+jZriX9AFZvUAyxLbRke2D75O5zPAO+ADXwEtizjaRHwDvbTyUtppwOmicCHAJvbXcl9YA1SQDjtseA97YPRz7ATcUQp2y/kjRdevsjaTfldNrMjcDGBjXA3T96L7yvrgFzP69+0Ao/HAAAAABJRU5ErkJggg==);background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='14' height='14'%3E%3Cpath d='M12 20.016q3.281 0 5.648-2.367t2.367-5.648q0-2.672-1.734-4.922l-11.203 11.203q2.25 1.734 4.922 1.734zM3.984 12q0 2.672 1.734 4.922l11.203-11.203q-2.25-1.734-4.922-1.734-3.281 0-5.648 2.367t-2.367 5.648zM12 2.016q4.125 0 7.055 2.93t2.93 7.055-2.93 7.055-7.055 2.93-7.055-2.93-2.93-7.055 2.93-7.055 7.055-2.93z' fill='%23000'%3E%3C/path%3E%3C/svg%3E\")}\n",
        "customSCSS": ".mode-interact-ready .hidden {\n  display: block !important;\n}\n[data-has-notch].no-supports-container body, [data-has-notch].supports-container .fl-page-content-wrapper{\n  padding-bottom: 0px !important;\n}\n.supports-container .fl-page-content-wrapper {\n  padding-bottom: 0px !important;\n}\n[data-fl-widget-instance][data-type=\"menu\"]{\n  display: none;\n}\n.btn.btn-primary,\n.btn.btn-primary:hover,\n.btn.btn-primary:focus,\n.btn.btn-primary:active:hover,\n.btn.btn-primary:active:focus {\n  width: auto;\n  height: auto;\n  background-color: #CFCBCB;\n  color: #000;\n  padding: 15px 30px 15px 30px;\n  border-radius: 10px;\n  font-family: helvetica;\n  font-size: 18px;\n  font-weight: normal;\n  line-height: 24px;\n  font-style: normal;\n  text-decoration: none;\n  border: none;\n  box-shadow: none;\n}\nform .btn.btn-primary {\n\tmargin-top: 40px;\n  float: right !important;\n}\n[data-step=\"3\"] form .btn.btn-primary {\n\tmargin-left: auto;\n  margin-right: auto;\n  float: none !important;\n  display: block !important;\n}\n.sp-container{\n  position:absolute;\n  top:0;\n  left:0;\n  display:inline-block;\n  z-index:9999994;\n  overflow:hidden}\n.sp-original-input-container{\n  position:relative;\n  display:inline-flex}\n.sp-original-input-container input{\n  margin:0!important}\n.sp-original-input-container .sp-add-on{\n  width:40px!important;\n  border-top-right-radius:0!important;\n  border-bottom-right-radius:0!important}\ninput.spectrum.with-add-on{\n  border-top-left-radius:0;\n  border-bottom-left-radius:0;\n  border-left:0}\n.sp-original-input-container .sp-add-on .sp-colorize{\n  height:100%;\n  width:100%;\n  border-radius:inherit}\n.sp-colorize-container{\n  background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==);\n  background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12' fill='%23ccc' fill-opacity='1'%3E%3Crect x='0' y='0' width='6' height='6' /%3E%3Crect x='6' y='6' width='6' height='6' /%3E%3C/svg%3E\")}\n.sp-container.sp-flat{\n  position:relative}\n.sp-container,.sp-container *{\n  -webkit-box-sizing:content-box;\n  -moz-box-sizing:content-box;\n  box-sizing:content-box}\n.sp-top{\n  position:relative;\n  width:100%;\n  display:inline-block}\n.sp-top-inner{\n  position:absolute;\n  top:0;\n  left:0;\n  bottom:0;\n  right:0}\n.sp-color{\n  position:absolute;\n  top:0;\n  left:0;\n  bottom:0;\n  right:20px!important}\n.sp-hue{\n  position:absolute;\n  top:0;\n  right:0;\n  bottom:0;\n  width:12px;\n  height:100%;\n  left:initial!important}\n.sp-clear-enabled .sp-hue{\n  top:15%;\n  height:85%}\n.sp-fill{\n  padding-top:80%}\n.sp-sat,.sp-val{\n  position:absolute;\n  top:0;\n  left:0;\n  right:0;\n  bottom:0}\n.sp-alpha-enabled .sp-top{\n  margin-bottom:28px!important}\n.sp-alpha-enabled .sp-alpha{\n  display:block}\n.sp-alpha-handle{\n  position:absolute;\n  top:-3px;\n  cursor:pointer;\n  height:16px;\n  border-radius:50%;\n  width:16px;\n  margin-right:5px;\n  left:-2px;\n  right:0;\n  background:#f9f9f9;\n  box-shadow:0 0 2px 0 #3a3a3a}\n.sp-alpha{\n  display:none;\n  position:absolute;\n  bottom:-18px;\n  right:0;\n  left:0;\n  height:10px}\n.sp-alpha-inner{\n  border-radius:4px}\n.sp-clear{\n  display:none}\n.sp-clear.sp-clear-display{\n  background-position:center}\n.sp-clear-enabled .sp-clear{\n  display:block;\n  position:absolute;\n  top:3px;\n  right:0;\n  bottom:0;\n  cursor:pointer;\n  left:initial;\n  height:14px;\n  width:14px}\n.sp-alpha,.sp-alpha-handle,.sp-clear,.sp-container,.sp-container button,.sp-container.sp-dragging .sp-input,.sp-dragger,.sp-preview,.sp-replacer,.sp-slider{\n  -webkit-user-select:none;\n  -moz-user-select:-moz-none;\n  -o-user-select:none;\n  user-select:none}\n.sp-container.sp-input-disabled .sp-input-container{\n  display:none}\n.sp-container.sp-buttons-disabled .sp-button-container{\n  display:none}\n.sp-container.sp-palette-buttons-disabled .sp-palette-button-container{\n  display:none}\n.sp-palette-only .sp-picker-container{\n  display:none}\n.sp-palette-disabled .sp-palette-container{\n  display:none}\n.sp-initial-disabled .sp-initial{\n  display:none}\n.sp-sat{\n  background-image:-webkit-gradient(linear,0 0,100% 0,from(#fff),to(rgba(204,154,129,0)));\n  background-image:-webkit-linear-gradient(left,#fff,rgba(204,154,129,0));\n  background-image:-moz-linear-gradient(left,#fff,rgba(204,154,129,0));\n  background-image:-o-linear-gradient(left,#fff,rgba(204,154,129,0));\n  background-image:-ms-linear-gradient(left,#fff,rgba(204,154,129,0));\n  background-image:linear-gradient(to right,#fff,rgba(204,154,129,0))}\n.sp-val{\n  border-radius:4px;\n  background-image:-webkit-gradient(linear,0 100%,0 0,from(#000),to(rgba(204,154,129,0)));\n  background-image:-webkit-linear-gradient(bottom,#000,rgba(204,154,129,0));\n  background-image:-moz-linear-gradient(bottom,#000,rgba(204,154,129,0));\n  background-image:-o-linear-gradient(bottom,#000,rgba(204,154,129,0));\n  background-image:-ms-linear-gradient(bottom,#000,rgba(204,154,129,0));\n  background-image:linear-gradient(to top,#000,rgba(204,154,129,0))}\n.sp-hue{\n  background:-moz-linear-gradient(top,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%);\n  background:-ms-linear-gradient(top,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%);\n  background:-o-linear-gradient(top,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%);\n  background:-webkit-gradient(linear,left top,left bottom,from(red),color-stop(.17,#ff0),color-stop(.33,#0f0),color-stop(.5,#0ff),color-stop(.67,#00f),color-stop(.83,#f0f),to(red));\n  background:-webkit-linear-gradient(top,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%);\n  background:linear-gradient(to bottom,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%)}\n.sp-1{\n  height:17%}\n.sp-2{\n  height:16%}\n.sp-3{\n  height:17%}\n.sp-4{\n  height:17%}\n.sp-5{\n  height:16%}\n.sp-6{\n  height:17%}\n.sp-hidden{\n  display:none!important}\n.sp-cf:after,.sp-cf:before{\n  content:\"\";\n  display:table}\n.sp-cf:after{\n  clear:both}\n@media (max-device-width:480px){\n  .sp-color{\n    right:40%}\n  .sp-hue{\n    left:63%}\n  .sp-fill{\n    padding-top:60%}\n}\n.sp-dragger{\n  border-radius:5px;\n  height:10px;\n  width:10px;\n  border:1px solid #fff;\n  cursor:pointer;\n  position:absolute;\n  top:0;\n  left:0;\n  margin-left:3px;\n  margin-top:3px;\n  box-shadow:0 0 2px 1px rgba(0,0,0,.2)}\n.sp-slider{\n  position:absolute;\n  top:0;\n  cursor:pointer;\n  height:16px;\n  border-radius:50%;\n  width:16px;\n  left:-2px;\n  background:#f9f9f9;\n  box-shadow:0 0 2px 0 #3a3a3a;\n  margin-top:8px}\n.sp-container{\n  display:inline-flex;\n  border-radius:0;\n  background-color:#fff;\n  padding:0;\n  border-radius:4px;\n  color:#000;\n  box-shadow:0 0 0 1px rgba(99,114,130,.16),0 8px 16px rgba(27,39,51,.08)}\n.sp-clear,.sp-color,.sp-container,.sp-container button,.sp-container input,.sp-hue{\n  font-size:12px;\n  -webkit-box-sizing:border-box;\n  -moz-box-sizing:border-box;\n  -ms-box-sizing:border-box;\n  box-sizing:border-box}\n.sp-top{\n  margin-bottom:10px}\n.sp-clear,.sp-color,.sp-hue,.sp-sat,.sp-val{\n  border-radius:3px}\n.sp-input-container{\n  margin-top:-5px}\n.sp-button-container.sp-cf,.sp-initial.sp-thumb.sp-cf,.sp-input-container.sp-cf{\n  height:25px}\n.sp-picker-container .sp-cf{\n  margin-bottom:10px}\n.sp-palette-row-initial\u003Espan:first-child{\n  cursor:pointer}\n.sp-initial-disabled .sp-input-container{\n  width:100%}\n.sp-input{\n  padding:0 5px!important;\n  margin:0;\n  width:100%;\n  box-shadow:none!important;\n  height:100%!important;\n  background:0 0;\n  color:#3a3a3a;\n  border-radius:2px!important;\n  border:1px solid #e0e0e0!important;\n  text-align:center;\n  font-family:monospace;\n  font-size:inherit!important}\n.sp-input:focus{\n  border:1px solid orange}\n.sp-input.sp-validation-error{\n  border:1px solid red;\n  background:#fdd}\n.sp-palette-container,.sp-picker-container{\n  position:relative;\n  padding:10px}\n.sp-picker-container{\n  width:200px;\n  padding-bottom:0}\n.sp-palette-container{\n  border-right:solid 1px #ccc}\n.sp-palette-only .sp-palette-container{\n  border:0}\n.sp-palette .sp-thumb-el{\n  display:block;\n  position:relative;\n  float:left;\n  width:24px;\n  height:15px;\n  margin:3px;\n  cursor:pointer;\n  border:solid 2px transparent}\n.sp-palette .sp-thumb-el.sp-thumb-active,.sp-palette .sp-thumb-el:hover{\n  border-color:orange}\n.sp-thumb-el{\n  position:relative}\n.sp-initial{\n  float:left}\n.sp-initial span{\n  width:30px;\n  height:25px;\n  border:none;\n  display:block;\n  float:left;\n  margin:0}\n.sp-initial .spe-thumb-el.sp-thumb-active{\n  border-radius:0 5px 5px 0}\n.sp-initial .spe-thumb-el{\n  border-radius:5px 0 0 5px}\n.sp-initial .sp-clear-display{\n  background-position:center}\n.sp-button-container{\n  float:right}\n.sp-palette-button-container{\n  margin-top:10px}\n.sp-replacer{\n  position:relative;\n  overflow:hidden;\n  cursor:pointer;\n  display:inline-block;\n  border-radius:3px;\n  border:1px solid #aaa;\n  color:#666;\n  transition:border-color .3s;\n  vertical-align:middle;\n  width:3rem;\n  height:1.5rem}\n.sp-replacer.sp-active,.sp-replacer:hover{\n  border:1px solid #666;\n  color:#000}\n.sp-replacer.sp-disabled{\n  cursor:default;\n  border-color:silver;\n  color:silver}\n.sp-dd{\n  position:absolute;\n  font-size:10px;\n  right:0;\n  top:0;\n  bottom:0;\n  padding:0 2px;\n  line-height:1.6rem;\n  background-color:#fff}\n.sp-preview{\n  position:relative;\n  width:100%;\n  height:100%;\n  float:left;\n  z-index:0}\n.sp-preview-inner{\n  transition:background-color .2s}\n.sp-preview-inner.sp-clear-display{\n  display:none}\n.sp-palette .sp-thumb-el{\n  width:16px;\n  height:16px;\n  margin:3px;\n  border:none;\n  border-radius:3px}\n.sp-container button{\n  border-radius:3px;\n  border:none;\n  background:0 0;\n  line-height:1;\n  padding:0 8px;\n  height:25px;\n  text-transform:capitalize;\n  text-align:center;\n  vertical-align:middle;\n  cursor:pointer;\n  color:#606c72;\n  font-weight:700}\n.sp-container button.sp-choose{\n  background-color:#3cab3b;\n  color:#fff;\n  margin-left:5px}\n.sp-container button:hover{\n  opacity:.8}\n.sp-container button.sp-palette-toggle{\n  width:100%;\n  background-color:#f3f3f3;\n  margin:0}\n.sp-palette span.sp-thumb-active,.sp-palette span:hover{\n  border-color:#000}\n.sp-alpha,.sp-preview,.sp-thumb-el{\n  position:relative;\n  background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==);\n  background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12' fill='%23ccc' fill-opacity='1'%3E%3Crect x='0' y='0' width='6' height='6' /%3E%3Crect x='6' y='6' width='6' height='6' /%3E%3C/svg%3E\")}\n.sp-alpha-inner,.sp-preview-inner,.sp-thumb-inner{\n  display:block;\n  position:absolute;\n  top:0;\n  left:0;\n  bottom:0;\n  right:0}\n.sp-palette .sp-thumb-inner{\n  border-radius:3px;\n  background-position:50% 50%;\n  background-repeat:no-repeat}\n.sp-palette .sp-thumb-light.sp-thumb-active .sp-thumb-inner{\n  background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIVJREFUeNpiYBhsgJFMffxAXABlN5JruT4Q3wfi/0DsT64h8UD8HmpIPCWG/KemIfOJCUB+Aoacx6EGBZyHBqI+WsDCwuQ9mhxeg2A210Ntfo8klk9sOMijaURm7yc1UP2RNCMbKE9ODK1HM6iegYLkfx8pligC9lCD7KmRof0ZhjQACDAAceovrtpVBRkAAAAASUVORK5CYII=);\n  background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='18' height='18'%3E%3Cpath d='M9 16.172l10.594-10.594 1.406 1.406-12 12-5.578-5.578 1.406-1.406z' fill='%23000'%3E%3C/path%3E%3C/svg%3E\")}\n.sp-palette .sp-thumb-dark.sp-thumb-active .sp-thumb-inner{\n  background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAMdJREFUOE+tkgsNwzAMRMugEAahEAahEAZhEAqlEAZhEAohEAYh81X2dIm8fKpEspLGvudPOsUYpxE2BIJCroJmEW9qJ+MKaBFhEMNabSy9oIcIPwrB+afvAUFoK4H0tMaQ3XtlrggDhOVVMuT4E5MMG0FBbCEYzjYT7OxLEvIHQLY2zWwQ3D+9luyOQTfKDiFD3iUIfPk8VqrKjgAiSfGFPecrg6HN6m/iBcwiDAo7WiBeawa+Kwh7tZoSCGLMqwlSAzVDhoK+6vH4G0P5wdkAAAAASUVORK5CYII=);\n  background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='18' height='18'%3E%3Cpath d='M9 16.172l10.594-10.594 1.406 1.406-12 12-5.578-5.578 1.406-1.406z' fill='%23fff'%3E%3C/path%3E%3C/svg%3E\")}\n.sp-clear-display{\n  background-repeat:no-repeat;\n  background-position:center;\n  background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAABe0lEQVQokYXSsUtcQRTF4d8Jj+VhHSxkEQuLsEUKK0nhTBFTmLSSUhBCMCAWsmgIwWrBLk0akfwLCaSQKBJmtrIIISwpRFKIhViETScphGMzysMtvOVwvpm5d0bGNCuGWAOPgYdl6S8wSDn9b+bUhDHEKWAdeAFMANg+l/TV9ofcz6cjMIbYBvaBMds7QCqZ58CmpBNgPuV0DvAAIMyFGugWtJr7eTv38xEwkPRPErY7QDeG2LqFkjrAgu0dSd/KDVqSNmxvAZ8lfbS9AHRuYemnLWkv5XRVBrQMbAI/gTXgEzAJtJuwBVS2L2OIle03QA/4Lmkl5XQBXEqqbFcAVYFDYChpFngiqWf7l6TXKaezMt2Zkhk24THwG+jZriX9AFZvUAyxLbRke2D75O5zPAO+ADXwEtizjaRHwDvbTyUtppwOmicCHAJvbXcl9YA1SQDjtseA97YPRz7ATcUQp2y/kjRdevsjaTfldNrMjcDGBjXA3T96L7yvrgFzP69+0Ao/HAAAAABJRU5ErkJggg==);\n  background-image:url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='14' height='14'%3E%3Cpath d='M12 20.016q3.281 0 5.648-2.367t2.367-5.648q0-2.672-1.734-4.922l-11.203 11.203q2.25 1.734 4.922 1.734zM3.984 12q0 2.672 1.734 4.922l11.203-11.203q-2.25-1.734-4.922-1.734-3.281 0-5.648 2.367t-2.367 5.648zM12 2.016q4.125 0 7.055 2.93t2.93 7.055-2.93 7.055-7.055 2.93-7.055-2.93-2.93-7.055 2.93-7.055 7.055-2.93z' fill='%23000'%3E%3C/path%3E%3C/svg%3E\")}\n",
        "interactVersion": "3.0",
        "isBlockedScreen": false,
        "widgetInstancesInUse": [30951803, 30951804, 30951805, 30951806, 30951807, 30951808, 30951809, 30951810, 30951811, 30951812, 30951813, 30951814, 30951815, 30951816, 30951817, 30951818, 30951819, 30951820, 30951821, 30951822, 30951823, 30951824, 30951825, 30951826, 30951827, 30951828, 30951829, 30951830, 30951831, 30951832, 30951833, 30951834, 30951835, 30951836, 30951837, 30951838, 30951839, 30951840, 30951841, 30951842, 30951843, 30951844, 30951845, 30951846, 30951847, 30951848, 30951849, 30951850, 30951851, 30951852, 30951853, 30951854, 30951855, 30951856, 30951857, 30951858, 30951859, 30951860, 30951861, 30951862, 30951863, 30951864, 30951865, 30951866]
      },
      "updatedAt": "2025-07-02T16:49:49.139Z",
      "slug": "app-setup-1l7mc"
    }
  ]
}